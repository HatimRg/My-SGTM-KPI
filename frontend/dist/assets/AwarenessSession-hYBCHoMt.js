import{a as oe,u as me,m as K,j as e,f as xe}from"./index-B_O7GBLG.js";import{r}from"./vendor-react-Bagy_njL.js";import{u as he}from"./projectStore-DKE1LgDP.js";import{D as T}from"./DatePicker-BulF6DGw.js";import{S as A}from"./Select-DRJkHVy9.js";import{a4 as pe,al as ye,C as ue,a5 as ge,i as je,a as Q,a6 as V,a1 as be,z as O}from"./vendor-ui-ByylQ01J.js";import{c as fe}from"./weekHelper-DiwCDpdk.js";import"./vendor-utils-MYqKZVQ3.js";const Ne=[15,30,45,60],D=10;function Te(){const{t:a}=oe(),{user:v}=me(),{projects:k,isLoading:L,fetchProjects:I}=he(),[d,Y]=r.useState([]),[M,W]=r.useState(!1),[g,R]=r.useState(""),[x,U]=r.useState(""),[H,Z]=r.useState(""),[h,S]=r.useState(""),[n,C]=r.useState(""),[j,q]=r.useState(""),[p,B]=r.useState(15),[$,z]=r.useState(""),[l,ee]=r.useState(""),[i,se]=r.useState(""),[c,ae]=r.useState(""),[o,te]=r.useState(""),[_,re]=r.useState(!1),[y,u]=r.useState(1),[ne,G]=r.useState(!1);r.useEffect(()=>{v?.name&&Z(v.name)},[v]),r.useEffect(()=>{(async()=>{try{const t=await I();t.length===1&&R(t[0].id)}catch(t){console.error("Failed to load projects",t)}})()},[I]),r.useEffect(()=>{X()},[l,i]);const X=async()=>{try{W(!0);const s={};l&&(s.project_id=l),i&&(s.week=i);const t=await K.getAll(s);Y(t.data?.data||t.data||[])}catch(s){console.error("Failed to load awareness sessions",s)}finally{W(!1)}},P=r.useMemo(()=>{const s=a("awareness.themes");return Array.isArray(s)?s:[]},[a]),le=r.useMemo(()=>{if(!h)return P;const s=h.toLowerCase();return P.filter(t=>t.toLowerCase().includes(s))},[P,h]),b=parseInt($,10)||0,E=p/60*b,f=r.useMemo(()=>Array.isArray(d)?d.filter(s=>{const t=s.date?s.date.substring(0,10):"";return!(c&&(!t||t<c)||o&&(!t||t>o))}):[],[d,c,o]),N=Math.max(1,Math.ceil((f.length||0)/D)),J=r.useMemo(()=>{if(!Array.isArray(f))return[];const s=(y-1)*D;return f.slice(s,s+D)},[f,y]);r.useEffect(()=>{u(1)},[l,i]);const ie=async()=>{try{G(!0);const s={};l&&(s.project_id=l),i&&(s.week=i),c&&(s.from_date=c),o&&(s.to_date=o);const t=await xe.exportAwareness(s),F=new Blob([t.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),w=window.URL.createObjectURL(F),m=document.createElement("a");m.href=w,m.download="awareness_sessions.xlsx",m.click(),window.URL.revokeObjectURL(w)}catch(s){console.error("Error exporting awareness sessions:",s),O.error(a("errors.somethingWentWrong")||"Error while exporting")}finally{G(!1)}},de=s=>{if(s.preventDefault(),!g||!x||!n||!b||n==="Other"&&!j.trim())return;const{week:t,year:F}=fe(x),w={project_id:g,date:x,week_number:t,week_year:F,by_name:H,theme:n==="Other"?j:n,duration_minutes:p,participants:b,session_hours:E};K.create(w).then(()=>{O.success(a("awareness.created")||"Session saved"),U(""),S(""),C(""),q(""),B(15),z(""),X()}).catch(m=>{console.error("Failed to create awareness session",m);const ce=m.response?.data?.message||a("errors.somethingWentWrong")||"Failed to save session";O.error(ce)})};return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 animate-fade-in",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:[a("nav.dashboard")," / ",a("awareness.navLabel")]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:a("awareness.pageTitle")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:a("awareness.pageSubtitle")})]}),e.jsxs("div",{className:"card",children:[e.jsxs("button",{type:"button",onClick:()=>re(!_),className:"w-full p-4 flex items-center justify-between text-left hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-hse-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(pe,{className:"w-5 h-5 text-hse-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a("awareness.addSession")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a("awareness.clickToExpand")})]})]}),_?e.jsx(ye,{className:"w-5 h-5 text-gray-400"}):e.jsx(ue,{className:"w-5 h-5 text-gray-400"})]}),_&&e.jsxs("form",{onSubmit:de,className:"p-6 pt-2 space-y-6 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("awareness.project")}),e.jsxs(A,{value:g,onChange:s=>R(s.target.value),disabled:L||k.length===1,required:!0,children:[e.jsx("option",{value:"",children:a(L?"common.loading":"awareness.selectProject")}),k.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("awareness.date")}),e.jsx(T,{value:x,onChange:U,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("awareness.by")}),e.jsx("input",{type:"text",className:"input bg-gray-50 dark:bg-gray-800",value:H,readOnly:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"label",children:a("awareness.theme")}),e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",className:"input pl-9",placeholder:a("awareness.searchTheme"),value:h,onChange:s=>S(s.target.value)}),h&&e.jsx("button",{type:"button",onClick:()=>S(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(je,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"max-h-48 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg divide-y divide-gray-100 dark:divide-gray-700 bg-white dark:bg-gray-800",children:[le.map((s,t)=>e.jsxs("button",{type:"button",onClick:()=>C(s),className:`w-full text-left px-3 py-2.5 text-sm flex items-center justify-between gap-2 transition-colors ${n===s?"bg-hse-primary/10 text-hse-primary font-medium border-l-4 border-hse-primary":"text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700/50 border-l-4 border-transparent"}`,children:[e.jsx("span",{children:s}),n===s&&e.jsx(Q,{className:"w-4 h-4 text-hse-primary flex-shrink-0"})]},t)),e.jsxs("button",{type:"button",onClick:()=>C("Other"),className:`w-full text-left px-3 py-2.5 text-sm flex items-center justify-between gap-2 transition-colors ${n==="Other"?"bg-hse-primary/10 text-hse-primary font-medium border-l-4 border-hse-primary":"text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700/50 border-l-4 border-transparent"}`,children:[e.jsx("span",{className:"font-medium",children:a("awareness.other")}),n==="Other"&&e.jsx(Q,{className:"w-4 h-4 text-hse-primary flex-shrink-0"})]})]}),n==="Other"&&e.jsxs("div",{className:"pt-2",children:[e.jsx("label",{className:"label text-sm",children:a("awareness.otherTheme")}),e.jsx("input",{type:"text",placeholder:a("awareness.otherTheme"),className:"input",value:j,onChange:s=>q(s.target.value),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("awareness.duration")}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"range",min:"15",max:"60",step:"15",value:p,onChange:s=>B(parseInt(s.target.value,10)),className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-hse-primary"}),e.jsx("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400",children:Ne.map(s=>e.jsxs("span",{className:`${p===s?"text-hse-primary font-semibold":""}`,children:[s," min"]},s))}),e.jsx("div",{className:"text-center",children:e.jsxs("span",{className:"inline-block px-4 py-1 bg-hse-primary/10 text-hse-primary rounded-full text-sm font-medium",children:[p," ",a("awareness.minutes")]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("awareness.participants")}),e.jsx("input",{type:"number",min:"1",className:"input",value:$,onChange:s=>z(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("awareness.sessionHours")}),e.jsxs("div",{className:"input bg-gray-50 dark:bg-gray-800 flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-hse-primary",children:Number.isFinite(E)?E.toFixed(2):0}),e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:a("awareness.hoursUnit")})]})]})]}),e.jsx("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{type:"submit",className:"btn-primary",disabled:!g||!x||!b||!n||n==="Other"&&!j,children:a("awareness.submit")})})]})]}),e.jsxs("div",{className:"card p-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4 text-hse-primary"}),a("awareness.listTitle")]}),e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap items-center gap-3",children:[e.jsxs(A,{value:l,onChange:s=>ee(s.target.value),className:"h-10 text-sm min-w-[140px]",children:[e.jsx("option",{value:"",children:a("awareness.allProjects")}),k.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs(A,{value:i,onChange:s=>se(s.target.value),className:"h-10 text-sm min-w-[130px]",children:[e.jsx("option",{value:"",children:a("awareness.allWeeks")}),Array.from({length:52},(s,t)=>t+1).map(s=>e.jsx("option",{value:s,children:a("awareness.weekLabel").replace("{{week}}",s)},s))]}),e.jsx(T,{value:c,onChange:s=>{ae(s),u(1)},placeholder:"From date",className:"w-40 h-10"}),e.jsx(T,{value:o,onChange:s=>{te(s),u(1)},placeholder:"To date",className:"w-40 h-10"}),e.jsxs("button",{type:"button",onClick:ie,disabled:ne||d.length===0,className:"btn-secondary flex items-center gap-2 text-sm",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{children:a("dashboard.exportExcel")})]})]})]}),M?e.jsxs("div",{className:"space-y-3 py-4",children:[e.jsx("div",{className:"hidden md:block space-y-2 animate-pulse",children:Array.from({length:4},(s,t)=>e.jsx("div",{className:"h-10 rounded-md bg-gray-100 dark:bg-gray-800"},t))}),e.jsx("div",{className:"md:hidden space-y-3 animate-pulse",children:Array.from({length:3},(s,t)=>e.jsx("div",{className:"h-24 rounded-lg bg-gray-100 dark:bg-gray-800"},t))})]}):d.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-hse-primary/10 mb-3",children:e.jsx(V,{className:"w-5 h-5 text-hse-primary"})}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:a("awareness.noSessions")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 md:hidden",children:J.map(s=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3 bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:s.project?.name||"-"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:s.date?s.date.substring(0,10):"-"}),e.jsx("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-300",children:s.by_name||"-"})]}),e.jsxs("div",{className:"text-right text-xs text-gray-600 dark:text-gray-300 space-y-1",children:[e.jsx("p",{className:"font-medium truncate max-w-[140px]",children:s.theme}),e.jsxs("p",{children:[s.duration_minutes," min"]})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-[11px] text-gray-600 dark:text-gray-300",children:[e.jsxs("span",{className:"px-1.5 py-0.5 rounded-full bg-gray-50 dark:bg-gray-900",children:[a("awareness.participants"),": ",s.participants]}),e.jsxs("span",{className:"px-1.5 py-0.5 rounded-full bg-hse-primary/10 text-hse-primary",children:[a("awareness.sessionHours"),": ",s.session_hours]})]})]},s.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:a("awareness.colDate")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:a("awareness.colProject")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:a("awareness.colBy")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:a("awareness.colTheme")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:a("awareness.colDuration")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:a("awareness.colParticipants")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:a("awareness.colHours")})]})}),e.jsx("tbody",{children:J.map(s=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-4 text-gray-900 dark:text-gray-100 text-xs",children:s.date?s.date.substring(0,10):"-"}),e.jsx("td",{className:"py-2 pr-4 text-gray-900 dark:text-gray-100",children:s.project?.name||"-"}),e.jsx("td",{className:"py-2 pr-4 text-gray-700 dark:text-gray-200",children:s.by_name||"-"}),e.jsx("td",{className:"py-2 pr-4 text-gray-700 dark:text-gray-200 max-w-xs truncate",children:s.theme}),e.jsxs("td",{className:"py-2 pr-4 text-gray-700 dark:text-gray-200",children:[s.duration_minutes," min"]}),e.jsx("td",{className:"py-2 pr-4 text-gray-700 dark:text-gray-200",children:s.participants}),e.jsx("td",{className:"py-2 pr-4 text-gray-700 dark:text-gray-200",children:s.session_hours})]},s.id))})]})})]}),!M&&d.length>0&&N>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100 dark:border-gray-800",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a("common.page")," ",y," ",a("common.of")," ",N]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>u(s=>Math.max(1,s-1)),disabled:y===1,className:"btn-secondary text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:a("common.previous")??"Previous"}),e.jsx("button",{type:"button",onClick:()=>u(s=>Math.min(N,s+1)),disabled:y===N,className:"btn-secondary text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:a("common.next")??"Next"})]})]})]})]})}export{Te as default};
