import{d as H,j as e,e as ve,f as ke}from"./index-B_O7GBLG.js";import{r as n,u as Ie,L as Le}from"./vendor-react-Bagy_njL.js";import{J as Ge,v as Se,K as se,c as q,N as Oe,A as he,O as Be,T as Te,Q as Me,U as ae,o as Ne,n as Ee,V as He,Y as Ue,Z as Ye,_ as Ve,$ as qe,z as xe,r as Je,a0 as Xe,a1 as Ze,e as we,F as Qe,a2 as ea,a3 as aa}from"./vendor-ui-ByylQ01J.js";import{R as v,A as re,C,X as S,Y as N,T as k,a as E,P as Ae,b as $e,c as te,L as P,d as ge,e as z,B as V,f as W,g as Re}from"./vendor-charts-BIh7BMeg.js";import{g as me}from"./weekHelper-DiwCDpdk.js";import"./vendor-utils-MYqKZVQ3.js";class ta{constructor(){this.cache=new Map,this.timestamps=new Map}generateKey(r,c={}){const d=Object.keys(c).sort().reduce((a,s)=>(a[s]=c[s],a),{});return`${r}:${JSON.stringify(d)}`}get(r,c={},d=3e4){const a=this.generateKey(r,c),s=this.timestamps.get(a);return!s||Date.now()-s>d?(this.delete(a),null):this.cache.get(a)}set(r,c={},d){const a=this.generateKey(r,c);this.cache.set(a,d),this.timestamps.set(a,Date.now())}delete(r){this.cache.delete(r),this.timestamps.delete(r)}clearPattern(r){for(const c of this.cache.keys())c.includes(r)&&this.delete(c)}clear(){this.cache.clear(),this.timestamps.clear()}getStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}}const _e=new ta;async function Ce(h,r,c={},d=3e4){const a=_e.get(r,c,d);if(a)return Promise.resolve(a);try{const s=await h(c);return _e.set(r,c,s),s}catch(s){throw s}}const sa=[{id:"overview",nameKey:"dashboard.themes.overview",icon:Ge,gradient:"from-purple-500 to-purple-700"},{id:"safety",nameKey:"dashboard.themes.safety",icon:Se,gradient:"from-red-500 to-red-700"},{id:"training",nameKey:"dashboard.themes.training",icon:se,gradient:"from-blue-500 to-blue-700"},{id:"compliance",nameKey:"dashboard.themes.compliance",icon:q,gradient:"from-green-500 to-green-700"},{id:"environmental",nameKey:"dashboard.themes.environmental",icon:Oe,gradient:"from-emerald-500 to-emerald-700"}],ra=n.memo(function({activeTheme:r,onThemeChange:c}){const d=H();return e.jsx("div",{className:"relative mb-4",children:e.jsx("div",{className:"flex items-center justify-center gap-1 flex-wrap",children:sa.map(a=>{const s=a.icon,i=r===a.id;return e.jsxs("button",{onClick:()=>c(a.id),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg border transition-all duration-200 ${i?`bg-gradient-to-r ${a.gradient} text-white border-transparent shadow-md`:"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600 hover:shadow-sm"}`,children:[e.jsx(s,{className:`w-4 h-4 ${i?"text-white":""}`}),e.jsx("span",{className:`font-medium text-xs ${i?"text-white":""}`,children:d(a.nameKey)})]},a.id)})})})}),R={fatal:"#dc2626",serious:"#f59e0b",minor:"#16a34a",tf:"#f59e0b",tg:"#8b5cf6"},X=n.memo(function({title:r,value:c,icon:d,color:a,trend:s}){const i={red:"border-red-200 bg-red-50 dark:border-red-700 dark:bg-red-900/50 text-red-600 dark:text-red-400",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${i[a]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(d,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:r})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:c}),s&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:s})]})}),na=n.memo(function({kpiSummary:r,weeklyTrends:c,projectPerformance:d}){const a=H(),s=n.useMemo(()=>({totalAccidents:r?.total_accidents||0,fatalAccidents:r?.fatal_accidents||0,avgTF:Number(r?.avg_tf||0).toFixed(2),avgTG:Number(r?.avg_tg||0).toFixed(2),lostWorkdays:r?.lost_workdays||0}),[r]),i=n.useMemo(()=>c?.map(m=>({week:m.week_label,accidents:m.accidents||0}))||[],[c]),g=n.useMemo(()=>{const m=s.totalAccidents,w=s.fatalAccidents,A=r?.serious_accidents??null,y=r?.minor_accidents??null;if(A!==null&&y!==null)return[{name:a("dashboard.safety.fatal"),value:w,color:R.fatal},{name:a("dashboard.safety.serious"),value:A,color:R.serious},{name:a("dashboard.safety.minor"),value:y,color:R.minor}].filter(o=>o.value>0);const l=Math.max(0,m-w);return[{name:a("dashboard.safety.fatal"),value:w,color:R.fatal},{name:a("dashboard.safety.serious"),value:Math.floor(l*.3),color:R.serious},{name:a("dashboard.safety.minor"),value:Math.ceil(l*.7),color:R.minor}].filter(o=>o.value>0)},[s,a,r]),T=n.useMemo(()=>c?.map(m=>({week:m.week_label,tf:Number(m.tf||0).toFixed(4),tg:Number(m.tg||0).toFixed(4)}))||[],[c]),x=n.useMemo(()=>d?.slice(0,6).map(m=>({name:m.name?.length>15?m.name.substring(0,15)+"...":m.name,accidents:m.total_accidents||0}))||[],[d]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(X,{title:a("dashboard.safety.totalAccidents"),value:s.totalAccidents,icon:he,color:s.totalAccidents>0?"red":"green",trend:a("dashboard.safety.yearToDate")}),e.jsx(X,{title:a("dashboard.safety.fatalAccidents"),value:s.fatalAccidents,icon:Be,color:s.fatalAccidents>0?"red":"green",trend:s.fatalAccidents===0?a("dashboard.safety.noFatalities"):a("dashboard.safety.critical")}),e.jsx(X,{title:a("dashboard.safety.tfRate"),value:s.avgTF,icon:Te,color:"amber",trend:a("dashboard.safety.avgFrequencyRate")}),e.jsx(X,{title:a("dashboard.safety.tgRate"),value:s.avgTG,icon:Me,color:"purple",trend:a("dashboard.safety.avgSeverityRate")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a("dashboard.safety.accidentTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(re,{data:i,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"accidentGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#dc2626",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#dc2626",stopOpacity:.1})]})}),e.jsx(C,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(S,{dataKey:"week",tick:{fontSize:11}}),e.jsx(N,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(k,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(E,{type:"monotone",dataKey:"accidents",stroke:"#dc2626",fill:"url(#accidentGradient)",name:"Accidents"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a("dashboard.safety.accidentsBySeverity")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:g.length>0?e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(Ae,{children:[e.jsx($e,{data:g,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:m,value:w})=>`${m}: ${w}`,children:g.map((m,w)=>e.jsx(te,{fill:m.color},`cell-${w}`))}),e.jsx(k,{}),e.jsx(P,{})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-green-600 dark:text-green-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(he,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"font-medium",children:a("dashboard.safety.noAccidents")}),e.jsx("p",{className:"text-sm text-gray-500",children:a("dashboard.safety.greatSafety")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a("dashboard.safety.tfVsTg")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(ge,{data:T,children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(S,{dataKey:"week",tick:{fontSize:11}}),e.jsx(N,{tick:{fontSize:11}}),e.jsx(k,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(P,{}),e.jsx(z,{type:"monotone",dataKey:"tf",stroke:R.tf,strokeWidth:2,dot:{fill:R.tf,r:3},name:"TF Rate"}),e.jsx(z,{type:"monotone",dataKey:"tg",stroke:R.tg,strokeWidth:2,dot:{fill:R.tg,r:3},name:"TG Rate"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a("dashboard.safety.accidentsByProject")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(V,{data:x,layout:"vertical",children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(S,{type:"number",allowDecimals:!1,tick:{fontSize:11}}),e.jsx(N,{type:"category",dataKey:"name",tick:{fontSize:10},width:100}),e.jsx(k,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(W,{dataKey:"accidents",fill:"#dc2626",radius:[0,4,4,0],name:"Accidents"})]})})})})]})]})]})}),L=n.memo(function({title:r,value:c,icon:d,color:a,trend:s}){const i={blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${i[a]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(d,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:r})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:c}),s&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:s})]})}),ia=n.memo(function({kpiSummary:r,weeklyTrends:c,projectPerformance:d,trainingData:a,awarenessData:s}){const i=H(),g=n.useMemo(()=>{const l=a?.total||r?.total_trainings||0,o=a?.total_participants||r?.employees_trained||0,$=a?.total_hours||r?.training_hours||0,I=r?.total_trainings_planned||0,ne=I>0?Math.round(l/I*100):null;return{totalTrainings:l,employeesTrained:o,trainingHours:$,completionRate:ne}},[r,a]),T=n.useMemo(()=>({totalSessions:s?.total||0,totalParticipants:s?.total_participants||0,totalHours:s?.total_hours||0}),[s]),x=n.useMemo(()=>a?.by_week?.length>0?a.by_week.map(l=>({week:"S"+l.week_number,trainings:l.count||0,participants:l.participants||0})):c?.map(l=>({week:l.week_label,trainings:l.trainings||0}))||[],[c,a]),m=n.useMemo(()=>{if(a?.by_theme?.length>0){const l=["#3b82f6","#8b5cf6","#ec4899","#14b8a6","#f59e0b","#ef4444","#10b981","#6366f1"];return a.by_theme.slice(0,8).map((o,$)=>({name:o.theme?.length>20?o.theme.substring(0,20)+"...":o.theme,fullName:o.theme,value:o.count,participants:o.participants||0,color:l[$%l.length]}))}return[]},[a]),w=n.useMemo(()=>a?.by_duration?.length>0?a.by_duration.map(l=>({duration:l.duration,count:l.count,participants:l.participants||0})):[],[a]),A=n.useMemo(()=>{if(s?.by_theme?.length>0){const l=["#16a34a","#0ea5e9","#f97316","#a855f7","#eab308","#06b6d4","#84cc16","#d946ef"];return s.by_theme.slice(0,8).map((o,$)=>({name:o.theme?.length>20?o.theme.substring(0,20)+"...":o.theme,fullName:o.theme,value:o.count,participants:o.participants||0,color:l[$%l.length]}))}return[]},[s]),y=n.useMemo(()=>a?.by_type?.length>0?a.by_type.map(l=>({name:l.type==="internal"?i("dashboard.training.internal"):i("dashboard.training.external"),value:l.count,color:l.type==="internal"?"#3b82f6":"#8b5cf6"})):[],[a,i]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(L,{title:i("dashboard.training.totalTrainings"),value:g.totalTrainings,icon:se,color:"blue",trend:i("dashboard.training.sessionsCompleted")}),e.jsx(L,{title:i("dashboard.training.employeesTrained"),value:g.employeesTrained,icon:ae,color:"green",trend:i("dashboard.training.uniqueAttendees")}),e.jsx(L,{title:i("dashboard.training.trainingHours"),value:g.trainingHours,icon:Ne,color:"purple",trend:i("dashboard.training.totalHoursDelivered")}),e.jsx(L,{title:i("dashboard.training.completionRate"),value:g.completionRate!==null?`${g.completionRate}%`:"â€”",icon:Ee,color:"amber",trend:`${i("dashboard.training.target")}: 95%`})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i("dashboard.training.trainingTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(re,{data:x,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"trainingGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.1})]})}),e.jsx(C,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(S,{dataKey:"week",tick:{fontSize:11}}),e.jsx(N,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(k,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(E,{type:"monotone",dataKey:"trainings",stroke:"#3b82f6",fill:"url(#trainingGradient)",name:"Trainings"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i("dashboard.training.trainingByTheme")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-72",children:m.length>0?e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(V,{data:m,layout:"vertical",margin:{left:10,right:20},children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(S,{type:"number",allowDecimals:!1,tick:{fontSize:11}}),e.jsx(N,{type:"category",dataKey:"name",tick:{fontSize:10},width:120}),e.jsx(k,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},formatter:(l,o,$)=>[`${l} sessions (${$.payload.participants} participants)`,"Count"]}),e.jsx(W,{dataKey:"value",radius:[0,4,4,0],children:m.map((l,o)=>e.jsx(te,{fill:l.color},`cell-${o}`))})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(se,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"font-medium",children:i("dashboard.training.noTrainingData")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i("dashboard.training.trainingByDuration")||"Training by Duration"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:w.length>0?e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(V,{data:w,children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(S,{dataKey:"duration",tick:{fontSize:11}}),e.jsx(N,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(k,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},formatter:(l,o)=>[l,o==="count"?"Sessions":"Participants"]}),e.jsx(W,{dataKey:"count",fill:"#8b5cf6",radius:[4,4,0,0],name:"Sessions"})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{className:"font-medium",children:"No duration data"})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i("dashboard.training.awarenessByTheme")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-72",children:A.length>0?e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(V,{data:A,layout:"vertical",margin:{left:10,right:20},children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(S,{type:"number",allowDecimals:!1,tick:{fontSize:11}}),e.jsx(N,{type:"category",dataKey:"name",tick:{fontSize:10},width:120}),e.jsx(k,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},formatter:(l,o,$)=>[`${l} sessions (${$.payload.participants} participants)`,"Count"]}),e.jsx(W,{dataKey:"value",radius:[0,4,4,0],children:A.map((l,o)=>e.jsx(te,{fill:l.color},`cell-${o}`))})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{className:"font-medium",children:"No awareness session data"})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i("dashboard.training.trainingByType")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:y.length>0?e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(Ae,{children:[e.jsx($e,{data:y,cx:"50%",cy:"45%",innerRadius:40,outerRadius:70,paddingAngle:5,dataKey:"value",label:({value:l})=>l,labelLine:!1,children:y.map((l,o)=>e.jsx(te,{fill:l.color},`cell-${o}`))}),e.jsx(k,{formatter:(l,o)=>[l,o]}),e.jsx(P,{verticalAlign:"bottom",height:36,formatter:l=>e.jsx("span",{className:"text-sm",children:l})})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{className:"font-medium",children:"No type data"})})})})]})]}),T.totalSessions>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx(L,{title:i("dashboard.training.totalAwareness")||"TBT/TBM Sessions",value:T.totalSessions,icon:ae,color:"green",trend:`${T.totalParticipants} participants`}),e.jsx(L,{title:i("dashboard.training.awarenessParticipants")||"Awareness Participants",value:T.totalParticipants,icon:ae,color:"purple"}),e.jsx(L,{title:i("dashboard.training.awarenessHours")||"Awareness Hours",value:Math.round(T.totalHours||0),icon:Ne,color:"amber"})]})]})}),da={compliance:"#16a34a"},Z=n.memo(function({title:r,value:c,icon:d,color:a,trend:s}){const i={green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${i[a]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(d,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:r})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:c}),s&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:s})]})}),la=n.memo(function({kpiSummary:r,weeklyTrends:c,projectPerformance:d,inspectionData:a,sorData:s}){const i=H(),g=n.useMemo(()=>{const m=r?.total_inspections||0,w=Number(r?.avg_hse_compliance||0).toFixed(1),A=Number(r?.avg_medical_compliance||0).toFixed(1),y=s?.stats?.total||0,l=s?.stats?.closed||0,o=y>0?Math.round(l/y*100):null;return{totalInspections:m,hseCompliance:w,medicalCompliance:A,auditScore:o}},[r,s]),T=n.useMemo(()=>c?.map(m=>({week:m.week_label,inspections:m.inspections||0}))||[],[c]),x=n.useMemo(()=>s?.by_category?.map(m=>({category:m.label||m.category,count:m.count||0}))||[],[s]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Z,{title:i("dashboard.compliance.totalInspections"),value:g.totalInspections,icon:q,color:"green",trend:i("dashboard.compliance.completedThisYear")}),e.jsx(Z,{title:i("dashboard.compliance.hseCompliance"),value:`${g.hseCompliance}%`,icon:Se,color:"blue",trend:i("dashboard.compliance.avgScore")}),e.jsx(Z,{title:i("dashboard.compliance.medicalCompliance"),value:`${g.medicalCompliance}%`,icon:He,color:"purple",trend:i("dashboard.compliance.healthChecks")}),g.auditScore!==null&&e.jsx(Z,{title:i("dashboard.compliance.auditScore"),value:`${g.auditScore}%`,icon:Ue,color:"amber",trend:i("dashboard.compliance.latestAudit")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i("dashboard.compliance.inspectionTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(re,{data:T,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"complianceGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#16a34a",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#16a34a",stopOpacity:.1})]})}),e.jsx(C,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(S,{dataKey:"week",tick:{fontSize:11}}),e.jsx(N,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(k,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(E,{type:"monotone",dataKey:"inspections",stroke:"#16a34a",fill:"url(#complianceGradient)",name:"Inspections"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i("dashboard.compliance.auditFindings")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(V,{data:x,children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(S,{dataKey:"category",tick:{fontSize:11}}),e.jsx(N,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(k,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(W,{dataKey:"count",fill:da.compliance,name:i("dashboard.compliance.findings"),radius:[4,4,0,0]})]})})})})]})]})]})}),j={water:"#0ea5e9",electricity:"#eab308",hse:"#22c55e",medical:"#8b5cf6",training:"#f59e0b",nearMiss:"#ef4444"},Q=n.memo(function({title:r,value:c,icon:d,color:a,trend:s,unit:i}){const g={blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400",yellow:"border-yellow-200 bg-yellow-50 dark:border-yellow-700 dark:bg-yellow-900/50 text-yellow-600 dark:text-yellow-400",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${g[a]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(d,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:r})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:[c,e.jsx("span",{className:"text-sm font-normal ml-1",children:i})]}),s&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:s})]})}),ca=n.memo(function({kpiSummary:r,weeklyTrends:c}){const d=H(),a=n.useMemo(()=>({waterConsumption:r?.total_water_consumption||0,electricityUsage:r?.total_electricity_consumption||0,hseCompliance:Math.round(r?.avg_hse_compliance||0),medicalCompliance:Math.round(r?.avg_medical_compliance||0),trainingHours:Math.round(r?.total_training_hours||0),nearMisses:r?.total_near_misses||0,workPermits:r?.total_work_permits||0}),[r]),s=n.useMemo(()=>c?.map(x=>({week:x.week_label,water:x.water||0,electricity:x.electricity||0,training_hours:x.training_hours||0}))||[],[c]),i=n.useMemo(()=>c?.map(x=>({week:x.week_label,hse:x.hse_compliance||0,medical:x.medical_compliance||0}))||[],[c]),g=n.useMemo(()=>c?.map(x=>({week:x.week_label,near_misses:x.near_misses||0,accidents:x.accidents||0,inspections:x.inspections||0}))||[],[c]),T=n.useMemo(()=>[{name:d("dashboard.environmental.hseCompliance"),current:a.hseCompliance,target:95,color:j.hse},{name:d("dashboard.environmental.medicalCompliance"),current:a.medicalCompliance,target:95,color:j.medical}],[d,a]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Q,{title:d("dashboard.environmental.hseCompliance"),value:a.hseCompliance,icon:q,color:"green",unit:"%",trend:d("dashboard.environmental.yearToDate")}),e.jsx(Q,{title:d("dashboard.environmental.medicalCompliance"),value:a.medicalCompliance,icon:Ye,color:"purple",unit:"%",trend:d("dashboard.environmental.yearToDate")}),e.jsx(Q,{title:d("dashboard.environmental.waterConsumption"),value:a.waterConsumption.toLocaleString(),icon:Ve,color:"blue",unit:"mÂ³",trend:d("dashboard.environmental.yearToDate")}),e.jsx(Q,{title:d("dashboard.environmental.electricityUsage"),value:a.electricityUsage.toLocaleString(),icon:qe,color:"yellow",unit:"kWh",trend:d("dashboard.environmental.yearToDate")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:d("dashboard.environmental.complianceTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(ge,{data:i,children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(S,{dataKey:"week",tick:{fontSize:11}}),e.jsx(N,{tick:{fontSize:11},domain:[0,100]}),e.jsx(k,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(P,{}),e.jsx(z,{type:"monotone",dataKey:"hse",stroke:j.hse,strokeWidth:2,dot:{fill:j.hse,r:3},name:d("dashboard.environmental.hseCompliance")}),e.jsx(z,{type:"monotone",dataKey:"medical",stroke:j.medical,strokeWidth:2,dot:{fill:j.medical,r:3},name:d("dashboard.environmental.medicalCompliance")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:d("dashboard.environmental.waterVsElectricity")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(Re,{data:s,children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(S,{dataKey:"week",tick:{fontSize:11}}),e.jsx(N,{yAxisId:"left",tick:{fontSize:11},stroke:j.water}),e.jsx(N,{yAxisId:"right",orientation:"right",tick:{fontSize:11},stroke:j.electricity}),e.jsx(k,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(P,{}),e.jsx(W,{yAxisId:"left",dataKey:"water",fill:j.water,name:"Water (mÂ³)",radius:[4,4,0,0]}),e.jsx(z,{yAxisId:"right",type:"monotone",dataKey:"electricity",stroke:j.electricity,strokeWidth:2,name:"Electricity (kWh)"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:d("dashboard.environmental.safetyTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(re,{data:g,children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(S,{dataKey:"week",tick:{fontSize:11}}),e.jsx(N,{tick:{fontSize:11}}),e.jsx(k,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(P,{}),e.jsx(E,{type:"monotone",dataKey:"inspections",stroke:j.hse,fill:j.hse,fillOpacity:.6,name:d("dashboard.inspections")}),e.jsx(E,{type:"monotone",dataKey:"near_misses",stroke:j.training,fill:j.training,fillOpacity:.6,name:d("dashboard.nearMisses")}),e.jsx(E,{type:"monotone",dataKey:"accidents",stroke:j.nearMiss,fill:j.nearMiss,fillOpacity:.6,name:d("dashboard.accidents")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:d("dashboard.environmental.complianceProgress")})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"space-y-6 py-4",children:[T.map((x,m)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:x.name}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[x.current,"% / ",x.target,"%"]})]}),e.jsxs("div",{className:"relative h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:[e.jsx("div",{className:"absolute h-full rounded-full transition-all duration-500",style:{width:`${Math.min(x.current,100)}%`,backgroundColor:x.color}}),e.jsx("div",{className:"absolute h-full w-0.5 bg-gray-800 dark:bg-gray-300",style:{left:`${x.target}%`},title:`Target: ${x.target}%`})]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:x.current>=x.target?`âœ“ ${d("dashboard.environmental.targetAchieved")}`:`${x.target-x.current}% ${d("dashboard.environmental.toTarget")}`})]},m)),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:a.trainingHours.toLocaleString()}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:d("dashboard.environmental.trainingHoursYTD")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:a.nearMisses}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:d("dashboard.environmental.nearMissesYTD")})]})]})})]})})]})]})]})});function pa(){const h=H(),[r,c]=n.useState(null),[d,a]=n.useState(!0),[s,i]=n.useState(new Date().getFullYear()),[g,T]=n.useState(new Date().getFullYear()-1),[x,m]=n.useState(null),[w,A]=n.useState(!1),[y,l]=n.useState("overview"),[o,$]=n.useState(null),[I,ne]=n.useState("all"),[F,be]=n.useState(null),ie=n.useRef(null),de=Ie(),pe=n.useCallback(async()=>{try{a(!0);const t=await Ce(ve.getAdminDashboard,"/dashboard/admin",{year:s},3e4);c(t.data.data)}catch{xe.error("Failed to load dashboard data")}finally{a(!1)}},[s]),ue=n.useCallback(async()=>{if(!g){m(null);return}try{const t=await Ce(ve.getAdminDashboard,"/dashboard/admin",{year:g},3e4);m(t.data.data?.kpi_summary||{})}catch(t){console.error("Failed to load comparison dashboard data",t)}},[g]);n.useEffect(()=>{pe(),ue()},[pe,ue]),n.useEffect(()=>{T(s-1)},[s]);const fe=n.useCallback(async t=>{A(!0);try{const p=t==="excel"?await ke.exportExcel({year:s}):await ke.exportPdf({year:s}),u=new Blob([p.data],{type:t==="excel"?"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"application/pdf"}),_=window.URL.createObjectURL(u),M=document.createElement("a");M.href=_,M.download=`kpi_report_${s}.${t==="excel"?"xlsx":"pdf"}`,M.click(),window.URL.revokeObjectURL(_),xe.success("Report exported successfully")}catch{xe.error("Failed to export report")}finally{A(!1)}},[s]),G=n.useMemo(()=>r?.stats||{},[r?.stats]),f=n.useMemo(()=>r?.kpi_summary||{},[r?.kpi_summary]),D=n.useMemo(()=>r?.weekly_trends||[],[r?.weekly_trends]),O=n.useMemo(()=>r?.project_performance||[],[r?.project_performance]),le=n.useMemo(()=>r?.weekly_status||[],[r?.weekly_status]),Ke=n.useMemo(()=>r?.projects||[],[r?.projects]),Fe=n.useMemo(()=>r?.training_data||{},[r?.training_data]),De=n.useMemo(()=>r?.awareness_data||{},[r?.awareness_data]),Pe=n.useMemo(()=>r?.sor_data||{},[r?.sor_data]);n.useMemo(()=>r?.permit_data||{},[r?.permit_data]);const ze=n.useCallback(t=>{if(!t||!t.activeLabel)return;const p=t.activeLabel,u=D.find(_=>_.week_label===p);if(u){$(u);const _=new URLSearchParams;let M=u.week;if(!M&&typeof p=="string"){const U=parseInt(p.replace(/\D/g,""),10);Number.isNaN(U)||(M=U)}M&&_.set("week",M);const b=u.year||s;b&&_.set("year",b),de(`/admin/kpi?${_.toString()}`)}},[D,s,de]),We=n.useMemo(()=>[...Array(5)].map((t,p)=>new Date().getFullYear()-p),[]);return d?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(Je,{className:"w-8 h-8 animate-spin text-hse-primary"})}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:h("dashboard.adminTitle")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:h("dashboard.overview")})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 px-3 py-2",children:[e.jsx(Xe,{className:"w-4 h-4 text-gray-400"}),e.jsx("select",{value:s,onChange:t=>i(Number(t.target.value)),className:"bg-transparent border-none focus:ring-0 text-sm font-medium dark:text-gray-200",children:We.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>fe("excel"),disabled:w,className:"btn-secondary flex items-center gap-2",children:[e.jsx(Ze,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Excel"})]}),e.jsxs("button",{onClick:()=>fe("pdf"),disabled:w,className:"btn-secondary flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"PDF"})]})]})]})]}),e.jsx(ra,{activeTheme:y,onThemeChange:l}),y==="safety"&&e.jsx(na,{kpiSummary:f,weeklyTrends:D,projectPerformance:O}),y==="training"&&e.jsx(ia,{kpiSummary:f,weeklyTrends:D,projectPerformance:O,trainingData:Fe,awarenessData:De}),y==="compliance"&&e.jsx(la,{kpiSummary:f,weeklyTrends:D,projectPerformance:O,inspectionData:r?.inspection_data,sorData:Pe}),y==="environmental"&&e.jsx(ca,{kpiSummary:f,weeklyTrends:D}),y==="overview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(ee,{title:"Total Projects",value:G.total_projects||0,subtitle:`${G.active_projects||0} active`,icon:Qe,color:"blue"}),e.jsx(ee,{title:"Total Users",value:G.total_users||0,subtitle:`${G.active_users||0} active`,icon:ae,color:"green"}),e.jsx(ee,{title:"Pending Reports",value:G.pending_reports||0,subtitle:"Awaiting approval",icon:q,color:"amber"}),e.jsx(ee,{title:"Total Reports",value:G.total_reports||0,subtitle:`In ${s}`,icon:we,color:"purple"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(Y,{title:"Total Accidents",value:f.total_accidents||0,icon:he,color:f.total_accidents>0?"red":"green",trend:f.fatal_accidents>0?`${f.fatal_accidents} fatal`:"No fatalities"}),e.jsx(Y,{title:"Trainings",value:f.total_trainings||0,icon:se,color:"blue",trend:`${f.employees_trained||0} trained`}),e.jsx(Y,{title:"Inspections",value:f.total_inspections||0,icon:q,color:"green"}),e.jsx(Y,{title:"Avg TF Rate",value:Number(f.avg_tf||0).toFixed(2),icon:Me,color:"amber",trend:"Frequency Rate"}),e.jsx(Y,{title:"Avg TG Rate",value:Number(f.avg_tg||0).toFixed(2),icon:Te,color:"purple",trend:"Severity Rate"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Weekly KPI Trends"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"h-80",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(ge,{data:D,onClick:ze,children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(S,{dataKey:"week_label",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(N,{tick:{fontSize:12}}),e.jsx(k,{labelFormatter:t=>`Week ${t.replace("S","")}`}),e.jsx(P,{}),e.jsx(z,{type:"monotone",dataKey:"accidents",stroke:"#dc2626",strokeWidth:2,dot:{fill:"#dc2626",r:3},name:"Accidents"}),e.jsx(z,{type:"monotone",dataKey:"trainings",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:3},name:"Trainings"}),e.jsx(z,{type:"monotone",dataKey:"inspections",stroke:"#16a34a",strokeWidth:2,dot:{fill:"#16a34a",r:3},name:"Inspections"})]})})}),o&&e.jsxs("div",{className:"mt-4 text-xs text-gray-600 dark:text-gray-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("p",{className:"font-semibold",children:["Details for ",o.week_label]}),e.jsx("button",{type:"button",onClick:()=>de("/admin/kpi"),className:"btn-secondary btn-sm",children:"View KPI reports"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Accidents"}),e.jsx("p",{className:"font-semibold",children:o.accidents??0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Trainings"}),e.jsx("p",{className:"font-semibold",children:o.trainings??0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Inspections"}),e.jsx("p",{className:"font-semibold",children:o.inspections??0})]})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"TF & TG Rates"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-80",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(Re,{data:D,children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(S,{dataKey:"week_label",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(N,{yAxisId:"left",tick:{fontSize:12},stroke:"#f59e0b",label:{value:"TF Rate",angle:-90,position:"insideLeft",style:{fill:"#f59e0b"}}}),e.jsx(N,{yAxisId:"right",orientation:"right",tick:{fontSize:12},stroke:"#8b5cf6",label:{value:"TG Rate",angle:90,position:"insideRight",style:{fill:"#8b5cf6"}}}),e.jsx(k,{labelFormatter:t=>`Week ${t.replace("S","")}`,formatter:(t,p)=>[Number(t).toFixed(4),p]}),e.jsx(P,{}),e.jsx(W,{yAxisId:"left",dataKey:"tf",fill:"#f59e0b",name:"TF Rate",radius:[4,4,0,0]}),e.jsx(W,{yAxisId:"right",dataKey:"tg",fill:"#8b5cf6",name:"TG Rate",radius:[4,4,0,0]})]})})})})]})]}),le.filter(t=>t.total_projects>0).length>0&&e.jsxs("div",{className:"card mt-6",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:h("dashboard.submissionStatus")}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("select",{value:I,onChange:t=>ne(t.target.value),className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg px-3 py-1.5 text-sm font-medium dark:text-gray-200 focus:ring-2 focus:ring-hse-primary",children:[e.jsx("option",{value:"all",children:h("common.allProjects")}),Ke.map(t=>e.jsxs("option",{value:t.id,children:[t.code," - ",t.name]},t.id))]})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>ie.current?.scrollBy({left:-300,behavior:"smooth"}),className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 bg-white/90 dark:bg-gray-700/90 hover:bg-white dark:hover:bg-gray-600 shadow-lg rounded-full p-2 border dark:border-gray-600",children:e.jsx(ea,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})}),e.jsx("button",{type:"button",onClick:()=>ie.current?.scrollBy({left:300,behavior:"smooth"}),className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 bg-white/90 dark:bg-gray-700/90 hover:bg-white dark:hover:bg-gray-600 shadow-lg rounded-full p-2 border dark:border-gray-600",children:e.jsx(aa,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})}),e.jsx("div",{ref:ie,className:"flex gap-2 overflow-x-auto scroll-smooth px-10 py-3 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",style:{scrollbarWidth:"thin"},children:(()=>{const t=me(),p=s<t.year?52:t.week;return Array.from({length:p},(u,_)=>_+1)})().map(t=>{const p=le.find(K=>K.week===t),u=me(),_=s<u.year||s===u.year&&t<u.week,M=t===u.week&&s===u.year;let b="not_submitted";const U=p?.projects||[];I==="all"?b=p?.status||"not_submitted":b=U.find(je=>je.project_id===parseInt(I))?.status||"not_submitted";const B=p?.approved_count||0,ce=p?.submitted_count||0,ye=p?.draft_count||0,J=p?.total_projects||1;let oe="";if(b==="partial"&&J>0){const K=[];B>0&&K.push("rgb(34, 197, 94)"),ce>0&&K.push("rgb(251, 191, 36)"),ye>0&&K.push("rgb(96, 165, 250)"),J-B-ce-ye>0&&K.push("rgb(254, 202, 202)"),oe=K.length>1?`linear-gradient(135deg, ${K.join(", ")})`:""}return e.jsxs("div",{"data-week":t,className:`relative flex-shrink-0 w-14 p-2 rounded-lg text-center transition-all cursor-pointer ${F===t?"ring-2 ring-gray-900 ring-offset-2 scale-110":""} ${M&&F!==t?"ring-2 ring-hse-primary ring-offset-2":""} ${b==="approved"?"bg-green-500 text-white":b==="partial"?"text-white":b==="submitted"?"bg-amber-400 text-white":b==="draft"?"bg-blue-400 text-white":_?"bg-red-100 text-red-600 hover:bg-red-200":"bg-gray-100 text-gray-500"}`,style:b==="partial"&&oe?{background:oe}:{},onClick:()=>be(F===t?null:t),children:[e.jsxs("p",{className:"text-xs font-medium",children:[h("dashboard.weekShortPrefix"),t]}),I==="all"&&J>1?e.jsxs("p",{className:"text-xs font-bold mt-0.5",children:[B+ce,"/",J]}):e.jsx("p",{className:"text-lg font-bold mt-0.5",children:b==="approved"?"âœ“":b==="partial"?"â—":b==="submitted"?"â³":b==="draft"?"ðŸ“":_?"!":"-"})]},`admin-week-${s}-${t}`)})})]}),F&&(()=>{const p=le.find(b=>b.week===F)?.projects||[],u=me(),_=F===u.week&&s===u.year,M=s<u.year||s===u.year&&F<u.week;return p.length===0?null:e.jsxs("div",{className:"mt-3 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-700 pb-2 mb-2",children:[e.jsxs("p",{className:"font-semibold",children:[h("dashboard.weekDetailsTitle").replace("{{week}}",F),_&&e.jsxs("span",{className:"ml-2 text-hse-primary",children:["(",h("dashboard.currentWeekLabel"),")"]})]}),e.jsx("button",{type:"button",onClick:()=>be(null),className:"text-gray-400 hover:text-white",children:"âœ•"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:p.map(b=>{const B=b.status==="not_submitted"&&M;return e.jsxs("div",{className:"flex items-center justify-between gap-2 bg-gray-800 rounded px-2 py-1.5",children:[e.jsx("span",{className:"truncate font-medium",children:b.project_code}),e.jsx("span",{className:`flex-shrink-0 px-1.5 py-0.5 rounded text-[10px] font-medium ${b.status==="approved"?"bg-green-500":b.status==="submitted"?"bg-amber-400":b.status==="draft"?"bg-blue-400":B?"bg-red-400":"bg-gray-500"}`,children:b.status==="approved"?h("status.approved"):b.status==="submitted"?h("status.pending"):b.status==="draft"?h("status.draft"):h(B?"status.missing":"status.notSubmitted")})]},b.project_id)})})]})})(),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4 pt-4 mt-2 border-t dark:border-gray-700 text-xs text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-green-500"})," ",h("status.approved")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-gradient-to-br from-green-400 to-amber-400"})," ",h("status.partial")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-amber-400"})," ",h("status.pending")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-blue-400"})," ",h("status.draft")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-red-100 border border-red-200"})," ",h("status.missing")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded ring-2 ring-hse-primary ring-offset-1"})," ",h("dashboard.currentWeekLabel")]})]})]})]}),x&&e.jsxs("div",{className:"card mt-6",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:["Year-over-year summary (",s," vs ",g,")"]})}),e.jsxs("div",{className:"card-body grid grid-cols-1 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Total accidents"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[f.total_accidents??0," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["(",s,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[x.total_accidents??0," (",g,")"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Trainings"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[f.total_trainings??0," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["(",s,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[x.total_trainings??0," (",g,")"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Inspections"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[f.total_inspections??0," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["(",s,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[x.total_inspections??0," (",g,")"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Avg TF / TG"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[(Number(f.avg_tf)||0).toFixed(2)," / ",(Number(f.avg_tg)||0).toFixed(2),e.jsxs("span",{className:"text-xs text-gray-400",children:[" (",s,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[(Number(x.avg_tf)||0).toFixed(2)," / ",(Number(x.avg_tg)||0).toFixed(2)," (",g,")"]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Project Performance"}),e.jsx(Le,{to:"/admin/projects",className:"text-sm text-hse-primary hover:underline",children:"View all projects"})]}),O.length===0?e.jsx("div",{className:"p-6 text-center text-sm text-gray-500 dark:text-gray-400",children:"No project data available."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 p-4 md:hidden",children:O.slice(0,5).map(t=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3 bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.code})]}),e.jsxs("div",{className:"text-right text-xs text-gray-600 dark:text-gray-300 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Reports:"})," ",t.reports_count]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Trainings:"})," ",t.total_trainings]})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-[11px] text-gray-600 dark:text-gray-300",children:[e.jsxs("span",{children:["Accidents:"," ",e.jsx("span",{className:t.total_accidents>0?"text-red-600 dark:text-red-400 font-semibold":"text-green-600 dark:text-green-400",children:t.total_accidents})]}),e.jsxs("span",{children:["TF: ",Number(t.avg_tf).toFixed(2)," â€¢ TG: ",Number(t.avg_tg).toFixed(2)]})]})]},t.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Project"}),e.jsx("th",{children:"Reports"}),e.jsx("th",{children:"Accidents"}),e.jsx("th",{children:"Trainings"}),e.jsx("th",{children:"Avg TF"}),e.jsx("th",{children:"Avg TG"})]})}),e.jsx("tbody",{children:O.slice(0,5).map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium dark:text-gray-100",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.code})]})}),e.jsx("td",{children:t.reports_count}),e.jsx("td",{children:e.jsx("span",{className:t.total_accidents>0?"text-red-600 dark:text-red-400 font-semibold":"text-green-600 dark:text-green-400",children:t.total_accidents})}),e.jsx("td",{children:t.total_trainings}),e.jsx("td",{children:Number(t.avg_tf).toFixed(2)}),e.jsx("td",{children:Number(t.avg_tg).toFixed(2)})]},t.id))})]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:h("dashboard.recentSubmissions")})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:r?.recent_reports?.filter(t=>t.status!=="draft").slice(0,5).map(t=>e.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:t.project?.name||"Unknown Project"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.report_month,"/",t.report_year," â€¢ Submitted by ",t.submitter?.name]})]}),e.jsx("span",{className:`badge ${t.status==="approved"?"badge-success":t.status==="submitted"?"badge-warning":t.status==="rejected"?"badge-danger":"badge-info"}`,children:t.status})]})},t.id))})]})]})]})}const ee=n.memo(function({title:r,value:c,subtitle:d,icon:a,color:s}){const i={blue:"bg-blue-50 text-blue-600",green:"bg-green-50 text-green-600",amber:"bg-amber-50 text-amber-600",purple:"bg-purple-50 text-purple-600",red:"bg-red-50 text-red-600"};return e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1",children:c}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:d})]}),e.jsx("div",{className:`p-3 rounded-lg ${i[s]}`,children:e.jsx(a,{className:"w-5 h-5"})})]})})}),Y=n.memo(function({title:r,value:c,icon:d,color:a,trend:s}){const i={red:"border-red-200 bg-red-50 dark:border-red-700 dark:bg-red-900/50",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50",blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50"},g={red:"text-red-600 dark:text-red-400",green:"text-green-600 dark:text-green-400",blue:"text-blue-600 dark:text-blue-400",amber:"text-amber-600 dark:text-amber-400",purple:"text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${i[a]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(d,{className:`w-5 h-5 ${g[a]}`}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:r})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:c}),s&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:s})]})});export{pa as default};
