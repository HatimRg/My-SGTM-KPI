import{p as m,g as B,j as e}from"./index-B_O7GBLG.js";import{r,L as G}from"./vendor-react-Bagy_njL.js";import{M as H}from"./Modal-DNf25r5Z.js";import{D as _}from"./DatePicker-BulF6DGw.js";import{C as K}from"./ConfirmDialog-CiIl8vCj.js";import{S as w}from"./Select-DRJkHVy9.js";import{z as i,a4 as R,a5 as V,a6 as J,r as k,F as Q,ab as W,a0 as X,U as Y,D as Z,a7 as I,aa as ee}from"./vendor-ui-ByylQ01J.js";import"./vendor-utils-MYqKZVQ3.js";function ce(){const[C,S]=r.useState([]),[P,D]=r.useState([]),[M,y]=r.useState(!0),[x,A]=r.useState(""),[u,F]=r.useState(""),[L,b]=r.useState(!1),[o,g]=r.useState(null),[a,l]=r.useState({name:"",code:"",description:"",location:"",start_date:"",end_date:"",status:"active",budget:"",client_name:"",user_ids:[]}),[v,f]=r.useState(!1),[n,E]=r.useState({current_page:1,last_page:1}),[d,h]=r.useState(null);r.useEffect(()=>{c(),T()},[x,u]);const c=async(s=1)=>{try{y(!0);const t=await m.getAll({page:s,search:x,status:u,per_page:10});S(t.data.data||[]),E(t.data.meta||{current_page:1,last_page:1})}catch{i.error("Failed to load projects")}finally{y(!1)}},T=async()=>{try{const s=await B.getAll({per_page:100,role:"responsable"});D(s.data.data||[])}catch{console.error("Failed to load users")}},N=(s=null)=>{s?(g(s),l({name:s.name,code:s.code,description:s.description||"",location:s.location||"",start_date:s.start_date?.split("T")[0]||"",end_date:s.end_date?.split("T")[0]||"",status:s.status,budget:s.budget||"",client_name:s.client_name||"",user_ids:s.users?.map(t=>t.id)||[]})):(g(null),l({name:"",code:"",description:"",location:"",start_date:"",end_date:"",status:"active",budget:"",client_name:"",user_ids:[]})),b(!0)},p=()=>{b(!1),g(null)},U=async s=>{s.preventDefault(),f(!0);try{o?(await m.update(o.id,a),i.success("Project updated successfully")):(await m.create(a),i.success("Project created successfully")),p(),c()}catch(t){const j=t.response?.data?.message||"Failed to save project";i.error(j)}finally{f(!1)}},O=s=>{h(s)},$=async()=>{if(d)try{await m.delete(d.id),i.success("Project deleted successfully"),c()}catch(s){i.error(s.response?.data?.message||"Failed to delete project")}finally{h(null)}},q=s=>{l(t=>({...t,user_ids:t.user_ids.includes(s)?t.user_ids.filter(j=>j!==s):[...t.user_ids,s]}))},z={active:"badge-success",completed:"badge-info",on_hold:"badge-warning",cancelled:"badge-danger"};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Project Management"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Manage projects and assign responsible users"})]}),e.jsxs("button",{onClick:()=>N(),className:"btn-primary flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4"}),"Add Project"]})]}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search projects...",value:x,onChange:s=>A(s.target.value),className:"input pl-10"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4 text-gray-400"}),e.jsxs(w,{value:u,onChange:s=>F(s.target.value),className:"w-40",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"on_hold",children:"On Hold"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})]})}),M?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(k,{className:"w-8 h-8 animate-spin text-hse-primary"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:C.map(s=>e.jsx("div",{className:"card hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-hse-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(Q,{className:"w-6 h-6 text-hse-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s.code})]})]}),e.jsx("span",{className:`badge ${z[s.status]}`,children:s.status.replace("_"," ")})]}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4 line-clamp-2",children:s.description}),e.jsxs("div",{className:"space-y-2 text-sm",children:[s.location&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-gray-400",children:[e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{children:s.location})]}),s.start_date&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-gray-400",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsxs("span",{children:[new Date(s.start_date).toLocaleDateString(),s.end_date&&` - ${new Date(s.end_date).toLocaleDateString()}`]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-gray-400",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.users?.length||0," assigned users"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex -space-x-2",children:[s.users?.slice(0,3).map(t=>e.jsx("div",{className:"w-8 h-8 bg-hse-secondary rounded-full flex items-center justify-center border-2 border-white dark:border-gray-800",title:t.name,children:e.jsx("span",{className:"text-white text-xs font-medium",children:t.name.charAt(0)})},t.id)),s.users?.length>3&&e.jsx("div",{className:"w-8 h-8 bg-gray-200 dark:bg-gray-600 rounded-full flex items-center justify-center border-2 border-white dark:border-gray-800",children:e.jsxs("span",{className:"text-gray-600 dark:text-gray-300 text-xs font-medium",children:["+",s.users.length-3]})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{to:`/admin/projects/${s.id}`,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",title:"View",children:e.jsx(Z,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})}),e.jsx("button",{onClick:()=>N(s),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",title:"Edit",children:e.jsx(I,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})}),e.jsx("button",{onClick:()=>O(s),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",title:"Delete",children:e.jsx(ee,{className:"w-4 h-4 text-red-600"})})]})]})]})},s.id))}),n.last_page>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Page ",n.current_page," of ",n.last_page]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>c(n.current_page-1),disabled:n.current_page===1,className:"btn-secondary text-sm",children:"Previous"}),e.jsx("button",{onClick:()=>c(n.current_page+1),disabled:n.current_page===n.last_page,className:"btn-secondary text-sm",children:"Next"})]})]}),e.jsx(H,{isOpen:L,onClose:p,title:o?"Modifier le projet":"Nouveau projet",size:"lg",children:e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nom du projet *"}),e.jsx("input",{type:"text",value:a.name,onChange:s=>l({...a,name:s.target.value}),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Code projet *"}),e.jsx("input",{type:"text",value:a.code,onChange:s=>l({...a,code:s.target.value.toUpperCase()}),className:"input",required:!0,placeholder:"ex: SGTM-001"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Description"}),e.jsx("textarea",{value:a.description,onChange:s=>l({...a,description:s.target.value}),className:"input",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Localisation"}),e.jsx("input",{type:"text",value:a.location,onChange:s=>l({...a,location:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nom du client"}),e.jsx("input",{type:"text",value:a.client_name,onChange:s=>l({...a,client_name:s.target.value}),className:"input"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Date de début"}),e.jsx(_,{value:a.start_date,onChange:s=>l({...a,start_date:s})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Date de fin"}),e.jsx(_,{value:a.end_date,onChange:s=>l({...a,end_date:s})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Statut"}),e.jsxs(w,{value:a.status,onChange:s=>l({...a,status:s.target.value}),children:[e.jsx("option",{value:"active",children:"Actif"}),e.jsx("option",{value:"completed",children:"Terminé"}),e.jsx("option",{value:"on_hold",children:"En pause"}),e.jsx("option",{value:"cancelled",children:"Annulé"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Budget"}),e.jsx("input",{type:"number",value:a.budget,onChange:s=>l({...a,budget:s.target.value}),className:"input",placeholder:"0.00",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Assigner des responsables"}),e.jsx("div",{className:"max-h-40 overflow-y-auto border border-gray-200 dark:border-gray-600 rounded-lg p-2 space-y-1 bg-white dark:bg-gray-700",children:P.map(s=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-600 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.user_ids.includes(s.id),onChange:()=>q(s.id),className:"w-4 h-4 text-hse-primary border-gray-300 dark:border-gray-500 rounded focus:ring-hse-primary"}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-gray-100",children:s.name}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",s.email,")"]})]},s.id))})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:p,className:"btn-secondary w-full sm:w-auto",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:v,className:"btn-primary w-full sm:w-auto",children:v?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(k,{className:"w-4 h-4 animate-spin"}),"Enregistrement..."]}):o?"Mettre à jour":"Créer le projet"})]})]})}),e.jsx(K,{isOpen:!!d,title:"Confirm deletion",message:d?`Are you sure you want to delete ${d.name}?`:"",confirmLabel:"Delete",cancelLabel:"Cancel",variant:"danger",onConfirm:$,onCancel:()=>h(null)})]})}export{ce as default};
