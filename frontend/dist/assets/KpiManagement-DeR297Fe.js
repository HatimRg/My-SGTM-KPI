import{a as ae,k,p as de,j as e,f as le}from"./index-B_O7GBLG.js";import{b as ne,r as n}from"./vendor-react-Bagy_njL.js";import{M as A}from"./Modal-DNf25r5Z.js";import{D as ie}from"./DailyKpiPreview-DCZ4lxOF.js";import{z as i,g as M,a1 as T,a5 as ce,a6 as oe,a0 as B,r as m,D as O,ac as xe,k as ge,a as z,i as U,ad as me,X as pe,n as he,A as be,o as H}from"./vendor-ui-ByylQ01J.js";import"./vendor-utils-MYqKZVQ3.js";function ve(){const{t}=ae(),D=ne(),[K,V]=n.useState([]),[f,Y]=n.useState([]),[G,P]=n.useState(!0),[s,x]=n.useState(null),[X,v]=n.useState([]),[q,$]=n.useState(!1),[L,g]=n.useState(!1),[w,p]=n.useState(""),[c,h]=n.useState(null),[J,b]=n.useState(!1),[_,F]=n.useState(!1),[d,E]=n.useState({project_id:"",week:new Date().getWeek?new Date().getWeek():Math.ceil((new Date-new Date(new Date().getFullYear(),0,1))/6048e5),year:new Date().getFullYear()}),[o,j]=n.useState({status:"",project_id:"",search:"",week:"",year:""}),S=K.filter(r=>r.status!=="draft");n.useEffect(()=>{const r=new URLSearchParams(D.search),a=r.get("week")||"",l=r.get("year")||"";(a||l)&&j(N=>({...N,week:a,year:l}))},[D.search]),n.useEffect(()=>{u()},[o]);const u=async()=>{try{P(!0);const[r,a]=await Promise.all([k.getAll(o),de.getAll()]);console.log("KPI Reports API response:",r.data);const l=r.data.data||r.data||[];V(Array.isArray(l)?l:[]),Y(a.data.data||a.data||[])}catch(r){console.error("Error loading KPI data:",r),console.error("Error details:",r.response?.data||r.message),i.error(t("errors.somethingWentWrong"))}finally{P(!1)}},R=async r=>{try{h(r),await k.approve(r),i.success(t("kpi.reportApproved")),u()}catch(a){console.error("Error approving report:",a),i.error(t("errors.somethingWentWrong"))}finally{h(null)}},Q=async()=>{if(!s||!w.trim()){i.error("Veuillez entrer un motif de rejet");return}try{h(s.id),await k.reject(s.id,w),i.success(t("kpi.reportRejected")),g(!1),p(""),x(null),u()}catch(r){console.error("Error rejecting report:",r),i.error(t("errors.somethingWentWrong"))}finally{h(null)}},I=async r=>{$(!0),x(r),v([]);try{const l=(await k.getById(r.id)).data.data;x(l.report||l),v(l.daily_snapshots||[])}catch(a){console.error("Failed to load report details:",a)}finally{$(!1)}},W=r=>{x(r),g(!0)},Z=async()=>{if(!d.project_id){i.error(t("hseExport.noProject"));return}if(!d.week||!d.year){i.error(t("hseExport.noWeek"));return}try{F(!0);const r=await le.exportHseWeekly({project_id:d.project_id,week:d.week,year:d.year}),a=window.URL.createObjectURL(new Blob([r.data])),l=document.createElement("a");l.href=a;const se=`HSE_Report_${f.find(te=>te.id==d.project_id)?.code||"project"}_S${String(d.week).padStart(2,"0")}_${d.year}.xlsx`;l.setAttribute("download",se),document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(a),i.success(t("hseExport.success")),b(!1)}catch(r){console.error("Export error:",r),i.error(r.response?.data?.message||t("hseExport.error"))}finally{F(!1)}},ee=Array.from({length:53},(r,a)=>a+1),y=new Date().getFullYear(),re=[y-2,y-1,y,y+1],C=r=>{const a={draft:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-200",submitted:"bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-200",approved:"bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-200",rejected:"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-200"},N={draft:H,submitted:be,approved:he,rejected:pe}[r]||H;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${a[r]||a.draft}`,children:[e.jsx(N,{className:"w-3 h-3"}),t(`kpi.status.${r}`)]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(M,{className:"w-7 h-7 text-hse-primary"}),"Gestion des Rapports KPI"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Approuver ou rejeter les rapports soumis"})]}),e.jsxs("button",{onClick:()=>b(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),t("hseExport.exportButton")]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Rechercher...",value:o.search,onChange:r=>j({...o,search:r.target.value}),className:"input pl-10"})]}),e.jsxs("select",{value:o.status,onChange:r=>j({...o,status:r.target.value}),className:"input",children:[e.jsx("option",{value:"",children:"Tous les statuts"}),e.jsx("option",{value:"submitted",children:"En attente"}),e.jsx("option",{value:"approved",children:"Approuvé"}),e.jsx("option",{value:"rejected",children:"Rejeté"})]}),e.jsxs("select",{value:o.project_id,onChange:r=>j({...o,project_id:r.target.value}),className:"input",children:[e.jsx("option",{value:"",children:"Tous les projets"}),f.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),e.jsxs("button",{onClick:u,className:"btn-secondary flex items-center justify-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Actualiser"]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:G?e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"hidden md:block space-y-2 animate-pulse",children:Array.from({length:5},(r,a)=>e.jsx("div",{className:"h-10 rounded-md bg-gray-100 dark:bg-gray-800"},a))}),e.jsx("div",{className:"md:hidden space-y-3 animate-pulse",children:Array.from({length:3},(r,a)=>e.jsx("div",{className:"h-24 rounded-lg bg-gray-100 dark:bg-gray-800"},a))})]}):S.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(M,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Aucun rapport trouvé"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 px-4 py-4 md:hidden",children:S.map(r=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3 bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.project?.name||"N/A"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r.submitter?.name||"N/A"}),e.jsxs("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-300 flex items-center gap-1",children:[e.jsx(B,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{children:r.week_number?`Sem. ${r.week_number} - ${r.report_year}`:`${r.report_month}/${r.report_year}`})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(r.created_at).toLocaleDateString("fr-FR")})]}),e.jsx("div",{className:"text-right",children:C(r.status)})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2",children:[r.status==="submitted"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>R(r.id),disabled:c===r.id,className:"px-2 py-1 text-xs rounded-md bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300",children:c===r.id?e.jsx(m,{className:"w-4 h-4 animate-spin"}):e.jsx("span",{children:"Approuver"})}),e.jsx("button",{onClick:()=>W(r),disabled:c===r.id,className:"px-2 py-1 text-xs rounded-md bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300",children:"Rejeter"})]}),e.jsxs("button",{onClick:()=>I(r),className:"px-2 py-1 text-xs rounded-md bg-gray-50 dark:bg-gray-900 text-gray-700 dark:text-gray-200 flex items-center gap-1",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsx("span",{children:"Voir"})]})]})]},r.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Projet"}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Soumis par"}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Période"}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Date"}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Statut"}),e.jsx("th",{className:"text-right px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:S.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.project?.name||"N/A"})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:r.submitter?.name||"N/A"})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:r.week_number?`Sem. ${r.week_number} - ${r.report_year}`:`${r.report_month}/${r.report_year}`})]})}),e.jsx("td",{className:"px-4 py-4 text-gray-500 dark:text-gray-400 text-sm",children:new Date(r.created_at).toLocaleDateString("fr-FR")}),e.jsx("td",{className:"px-4 py-4",children:C(r.status)}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[r.status==="submitted"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>R(r.id),disabled:c===r.id,className:"p-2 text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/30 rounded-lg transition-colors",title:"Approuver",children:c===r.id?e.jsx(m,{className:"w-5 h-5 animate-spin"}):e.jsx(z,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>W(r),disabled:c===r.id,className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors",title:"Rejeter",children:e.jsx(U,{className:"w-5 h-5"})})]}),e.jsx("button",{onClick:()=>I(r),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Voir détails",children:e.jsx(O,{className:"w-5 h-5"})})]})})]},r.id))})]})})]})}),e.jsx(A,{isOpen:L,onClose:()=>{g(!1),p(""),x(null)},title:"Rejeter le rapport",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:["Projet: ",e.jsx("strong",{children:s?.project?.name}),e.jsx("br",{}),"Période: ",e.jsx("strong",{children:s?.week_number?`Semaine ${s.week_number} - ${s.report_year}`:`${s?.report_month}/${s?.report_year}`})]}),e.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-700 rounded-lg p-3",children:e.jsxs("p",{className:"text-amber-800 dark:text-amber-300 text-sm",children:["⚠️ Le rapport sera remis en ",e.jsx("strong",{children:"brouillon"})," pour permettre au soumetteur de corriger et resoumettre."]})}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Motif du rejet *"}),e.jsx("textarea",{value:w,onChange:r=>p(r.target.value),className:"input",rows:3,placeholder:"Entrez le motif du rejet..."})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-3 justify-end pt-2",children:[e.jsx("button",{onClick:()=>{g(!1),p(""),x(null)},className:"btn-secondary w-full sm:w-auto",children:"Annuler"}),e.jsx("button",{onClick:Q,disabled:c,className:"btn-primary bg-red-600 hover:bg-red-700 w-full sm:w-auto",children:c?e.jsx(m,{className:"w-4 h-4 animate-spin mx-auto"}):"Rejeter"})]})]})}),e.jsx(A,{isOpen:!!s&&!L,onClose:()=>{x(null),v([])},title:"Détails du rapport",size:"lg",children:s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Projet"}),e.jsx("p",{className:"font-medium dark:text-gray-100",children:s.project?.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Soumis par"}),e.jsx("p",{className:"font-medium dark:text-gray-100",children:s.submitter?.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Période"}),e.jsx("p",{className:"font-medium",children:s.week_number?`Semaine ${s.week_number} (${new Date(s.start_date).toLocaleDateString("fr-FR")} - ${new Date(s.end_date).toLocaleDateString("fr-FR")})`:`${s.report_month}/${s.report_year}`})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Statut"}),C(s.status)]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-3",children:"1-2. Effectif & Induction"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"1. Effectif"}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:s.hours_worked||0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"2. Induction"}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:s.employees_trained||0})]})]})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-amber-900 mb-3",children:"3-4. Observations & Sensibilisation"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-amber-200 dark:border-amber-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"3. Relevé des écarts"}),e.jsx("p",{className:"text-lg font-bold text-amber-600",children:s.unsafe_conditions_reported||0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-amber-200 dark:border-amber-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"4. Nombre de Sensibilisation"}),e.jsx("p",{className:"text-lg font-bold text-amber-600",children:s.toolbox_talks||0})]})]})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-red-900 mb-3",children:"5-8. Accidents & Incidents"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-amber-200 dark:border-amber-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"5. Presqu'accident"}),e.jsx("p",{className:"text-lg font-bold text-amber-600",children:s.near_misses||0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-green-200 dark:border-green-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"6. Premiers soins"}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:s.first_aid_cases||0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-red-300 dark:border-red-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"7. Accident"}),e.jsx("p",{className:"text-lg font-bold text-red-600",children:s.accidents||0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-orange-200 dark:border-orange-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"8. Nombre de jours d'arrêt"}),e.jsx("p",{className:"text-lg font-bold text-orange-600",children:s.lost_workdays||0})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:"9-11. Inspections & Indicateurs"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"9. Nombre d'Inspections"}),e.jsx("p",{className:"text-lg font-bold text-gray-700 dark:text-gray-100",children:s.inspections_completed||0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"10. TG (Taux de Gravité)"}),e.jsx("p",{className:"text-lg font-bold text-gray-700 dark:text-gray-100",children:s.tg_value||0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border dark:border-gray-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"11. TF (Taux de Fréquence)"}),e.jsx("p",{className:"text-lg font-bold text-gray-700 dark:text-gray-100",children:s.tf_value||0})]})]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-purple-900 mb-3",children:"12-14. Formation, Permis & Discipline"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-purple-200 dark:border-purple-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"12. Heures de formation"}),e.jsxs("p",{className:"text-lg font-bold text-purple-600",children:[s.training_hours||0,"h"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-purple-200 dark:border-purple-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"13. Permis de travail"}),e.jsx("p",{className:"text-lg font-bold text-purple-600",children:s.work_permits||0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-purple-200 dark:border-purple-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"14. Mesures disciplinaires"}),e.jsx("p",{className:"text-lg font-bold text-purple-600",children:s.corrective_actions||0})]})]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-green-900 mb-3",children:"15-17. Conformité & Suivi"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-green-200 dark:border-green-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"15. Taux conformité HSE"}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[s.ppe_compliance_rate||0,"%"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-green-200 dark:border-green-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"16. Taux conformité médecine"}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[s.medical_compliance_rate||0,"%"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-green-200 dark:border-green-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"17. Suivi du bruit"}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[s.noise_monitoring||0," dB"]})]})]})]}),e.jsxs("div",{className:"bg-cyan-50 dark:bg-cyan-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-cyan-900 mb-3",children:"18-19. Consommation d'énergie"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-cyan-200 dark:border-cyan-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"18. Consommation : Eau"}),e.jsxs("p",{className:"text-lg font-bold text-cyan-600",children:[s.water_consumption||0," m³"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-cyan-200 dark:border-cyan-700",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"19. Consommation : Électricité"}),e.jsxs("p",{className:"text-lg font-bold text-cyan-600",children:[s.electricity_consumption||0," kWh"]})]})]})]}),s.rejection_reason&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-red-800 dark:text-red-200 mb-1",children:"⚠️ Précédemment rejeté"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:s.rejection_reason}),s.rejected_at&&e.jsxs("p",{className:"text-red-600 dark:text-red-300 text-xs mt-2",children:["Rejeté le ",new Date(s.rejected_at).toLocaleDateString("fr-FR")]})]}),s.notes&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Notes"}),e.jsx("p",{className:"bg-gray-50 dark:bg-gray-900 p-3 rounded-lg text-gray-700 dark:text-gray-100",children:s.notes})]}),q?e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx(m,{className:"w-5 h-5 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500 dark:text-gray-400",children:"Chargement des données journalières..."})]}):e.jsx(ie,{dailySnapshots:X}),s.status==="submitted"&&e.jsxs("div",{className:"flex gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>R(s.id),disabled:c,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Approuver"]}),e.jsxs("button",{onClick:()=>{g(!0)},className:"btn-secondary flex-1 flex items-center justify-center gap-2 text-red-600 dark:text-red-400 border-red-200 dark:border-red-700 hover:bg-red-50 dark:hover:bg-red-900/30",children:[e.jsx(U,{className:"w-4 h-4"}),"Rejeter"]})]})]})}),e.jsx(A,{isOpen:J,onClose:()=>b(!1),title:t("hseExport.title"),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx(T,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:t("hseExport.exportButton")}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:t("hseExport.description")})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t("hseExport.selectProject")," *"]}),e.jsxs("select",{value:d.project_id,onChange:r=>E({...d,project_id:r.target.value}),className:"input w-full",children:[e.jsx("option",{value:"",children:t("hseExport.selectProject")}),f.map(r=>e.jsxs("option",{value:r.id,children:[r.name," (",r.code,")"]},r.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t("hseExport.week")," *"]}),e.jsx("select",{value:d.week,onChange:r=>E({...d,week:parseInt(r.target.value)}),className:"input w-full",children:ee.map(r=>e.jsxs("option",{value:r,children:[t("hseExport.week")," ",r]},r))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[t("hseExport.year")," *"]}),e.jsx("select",{value:d.year,onChange:r=>E({...d,year:parseInt(r.target.value)}),className:"input w-full",children:re.map(r=>e.jsx("option",{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 p-3 rounded-lg",children:[e.jsxs("p",{className:"font-medium mb-1",children:[t("hseExport.sheets.projectInfo"),":"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("span",{children:["• ",t("hseExport.sheets.projectInfo")]}),e.jsxs("span",{children:["• ",t("hseExport.sheets.hseReporting")]}),e.jsxs("span",{children:["• ",t("hseExport.sheets.incidents")]}),e.jsxs("span",{children:["• ",t("hseExport.sheets.deviationsSgtm")]}),e.jsxs("span",{children:["• ",t("hseExport.sheets.deviationsSt")]}),e.jsxs("span",{children:["• ",t("hseExport.sheets.categories")]}),e.jsxs("span",{children:["• ",t("hseExport.sheets.certifications")]}),e.jsxs("span",{children:["• ",t("hseExport.sheets.personnel")]}),e.jsxs("span",{children:["• ",t("hseExport.sheets.training")]}),e.jsxs("span",{children:["• ",t("hseExport.sheets.inspections")]}),e.jsxs("span",{children:["• ",t("hseExport.sheets.workPermits")]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{onClick:()=>b(!1),className:"btn-secondary flex-1",disabled:_,children:t("common.cancel")}),e.jsx("button",{onClick:Z,disabled:_||!d.project_id,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:_?e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"w-4 h-4 animate-spin"}),t("hseExport.exporting")]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"w-4 h-4"}),t("hseExport.exportButton")]})})]})]})})]})}export{ve as default};
