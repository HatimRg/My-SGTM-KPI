import{a as we,u as _e,t as oe,j as e,f as Se}from"./index-B_O7GBLG.js";import{r}from"./vendor-react-Bagy_njL.js";import{u as Pe}from"./projectStore-DKE1LgDP.js";import{D as O}from"./DatePicker-BulF6DGw.js";import{S}from"./Select-DRJkHVy9.js";import{M as Te}from"./Modal-DNf25r5Z.js";import{z as P,a4 as Ce,al as Ee,C as De,a5 as Fe,i as Le,a as Ae,aq as M,a6 as de,a1 as Oe,ad as Me}from"./vendor-ui-ByylQ01J.js";import{c as Ie}from"./weekHelper-DiwCDpdk.js";import"./vendor-utils-MYqKZVQ3.js";const Re=["30min","1h","1h30","2h","3h","halfDay","1day","2days","3days"],He={"30min":.5,"1h":1,"1h30":1.5,"2h":2,"3h":3,halfDay:12,"1day":24,"2days":48,"3days":72},I=10,ce={"30 Min":"30min","1 H":"1h","1 H 30 Min":"1h30","2 H":"2h","3 H":"3h","Half a day":"halfDay","1 day":"1day","2 days":"2days","3 days":"3days"};function Xe(){const{t}=we(),{user:T}=_e(),{projects:C,isLoading:R,fetchProjects:H}=Pe(),[c,xe]=r.useState([]),[W,U]=r.useState(!1),[b,q]=r.useState(""),[g,B]=r.useState(""),[i,$]=r.useState(!1),[z,G]=r.useState(""),[K,Y]=r.useState(""),[p,E]=r.useState(""),[n,X]=r.useState(""),[f,J]=r.useState(""),[u,Q]=r.useState(""),[V,Z]=r.useState(""),[me,ee]=r.useState(null),[ae,D]=r.useState(""),[N,te]=r.useState(null),[l,he]=r.useState(""),[o,ge]=r.useState(""),[x,pe]=r.useState(""),[m,ue]=r.useState(""),[F,ye]=r.useState(!1),[y,j]=r.useState(1),[je,re]=r.useState(!1);r.useEffect(()=>{T?.name&&G(T.name)},[T]),r.useEffect(()=>{(async()=>{try{const s=await H({per_page:50});s.length===1&&q(s[0].id.toString())}catch(s){console.error("Failed to load projects for training page",s)}})()},[H]),r.useEffect(()=>{se()},[l,o]);const se=async()=>{try{U(!0);const a={};l&&(a.project_id=l),o&&(a.week=o);const s=await oe.getAll(a);xe(s.data.data||[])}catch(a){console.error("Failed to load trainings",a),P.error(t("errors.somethingWentWrong")||"Failed to load trainings")}finally{U(!1)}},L=t("training.themes")||[],be=r.useMemo(()=>{if(!p.trim())return L;const a=p.toLowerCase();return L.filter(s=>s.toLowerCase().includes(a))},[p,L]),v=Number(V)||0,ne=He[u]||0,A=ne*v,k=r.useMemo(()=>Array.isArray(c)?c.filter(a=>{const s=a.date?a.date.split("T")[0]:"";return!(x&&(!s||s<x)||m&&(!s||s>m))}):[],[c,x,m]),w=Math.max(1,Math.ceil((k.length||0)/I)),ie=r.useMemo(()=>{if(!Array.isArray(k))return[];const a=(y-1)*I;return k.slice(a,a+I)},[k,y]);r.useEffect(()=>{j(1)},[l,o]);const fe=async()=>{try{re(!0);const a={};l&&(a.project_id=l),o&&(a.week=o),x&&(a.from_date=x),m&&(a.to_date=m);const s=await Se.exportTrainings(a),d=new Blob([s.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),_=window.URL.createObjectURL(d),h=document.createElement("a");h.href=_,h.download="trainings.xlsx",h.click(),window.URL.revokeObjectURL(_)}catch(a){console.error("Error exporting trainings:",a),P.error(t("errors.somethingWentWrong")||"Error while exporting")}finally{re(!1)}},Ne=a=>{const s=a.target.files?.[0];if(ee(s||null),s){const d=new FileReader;d.onloadend=()=>{D(d.result.toString())},d.readAsDataURL(s)}else D("")},le=a=>{a?.photo_url&&te(a)},ve=a=>{if(a.preventDefault(),!b||!g||!u||!v||!n||n==="Other"&&!f)return;const{week:s,year:d}=Ie(g),_={project_id:b,date:g,week_number:s,week_year:d,by_internal:!i,by_name:i?null:z,external_company:i?K:null,theme:n==="Other"?f:n,duration_label:u,duration_hours:ne,participants:v,training_hours:A,photo:me};oe.create(_).then(()=>{P.success(t("training.created")||"Training saved"),B(""),$(!1),Y(""),E(""),X(""),J(""),Q(""),Z(""),ee(null),D(""),se()}).catch(h=>{console.error("Failed to create training",h);const ke=h.response?.data?.message||t("errors.somethingWentWrong")||"Failed to save training";P.error(ke)})};return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 animate-fade-in",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:[t("nav.dashboard")," / ",t("training.navLabel")]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:t("training.pageTitle")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:t("training.pageSubtitle")})]}),e.jsxs("div",{className:"card",children:[e.jsxs("button",{type:"button",onClick:()=>ye(!F),className:"w-full p-4 flex items-center justify-between text-left hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-hse-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(Ce,{className:"w-5 h-5 text-hse-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t("training.addTraining")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("training.clickToExpand")})]})]}),F?e.jsx(Ee,{className:"w-5 h-5 text-gray-400"}):e.jsx(De,{className:"w-5 h-5 text-gray-400"})]}),F&&e.jsxs("form",{onSubmit:ve,className:"p-6 pt-2 space-y-6 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:t("training.project")}),e.jsxs(S,{value:b,onChange:a=>q(a.target.value),disabled:R||C.length===1,required:!0,children:[e.jsx("option",{value:"",children:t(R?"common.loading":"training.selectProject")}),C.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:t("training.date")}),e.jsx(O,{value:g,onChange:B,required:!0})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-end",children:e.jsxs("div",{children:[e.jsxs("label",{className:"label flex items-center justify-between",children:[e.jsx("span",{children:t("training.by")}),e.jsxs("label",{className:"flex items-center gap-2 text-xs cursor-pointer select-none",children:[e.jsx("div",{onClick:()=>$(!i),className:`w-4 h-4 rounded border-2 flex items-center justify-center transition-colors cursor-pointer ${i?"bg-hse-primary border-hse-primary":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"}`,children:i&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:3,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsx("span",{children:t("training.external")})]})]}),i?e.jsx("input",{type:"text",className:"input",value:K,onChange:a=>Y(a.target.value),placeholder:t("training.externalPlaceholder"),required:!0}):e.jsx("input",{type:"text",className:"input",value:z,onChange:a=>G(a.target.value),readOnly:!0})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"label",children:t("training.theme")}),e.jsxs("div",{className:"relative mb-2",children:[e.jsx(Fe,{className:"w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"}),e.jsx("input",{type:"text",className:"input pl-9",placeholder:t("training.searchTheme"),value:p,onChange:a=>E(a.target.value)}),p&&e.jsx("button",{type:"button",onClick:()=>E(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(Le,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"max-h-48 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg divide-y divide-gray-100 dark:divide-gray-700 bg-white dark:bg-gray-800",children:be.map(a=>e.jsxs("button",{type:"button",onClick:()=>X(a),className:`w-full text-left px-3 py-2.5 text-sm flex items-center justify-between gap-2 transition-colors ${n===a?"bg-hse-primary/10 text-hse-primary font-medium border-l-4 border-hse-primary":"text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700/50 border-l-4 border-transparent"}`,children:[e.jsx("span",{children:a}),n===a&&e.jsx(Ae,{className:"w-4 h-4 text-hse-primary flex-shrink-0"})]},a))}),n==="Other"&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"label",children:t("training.otherTheme")}),e.jsx("input",{type:"text",className:"input",value:f,onChange:a=>J(a.target.value),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:t("training.duration")}),e.jsxs(S,{value:u,onChange:a=>Q(a.target.value),children:[e.jsx("option",{value:"",children:t("training.selectDuration")}),Re.map(a=>e.jsx("option",{value:a,children:t(`training.durations.${a}`)},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:t("training.participants")}),e.jsx("input",{type:"number",min:"1",className:"input",value:V,onChange:a=>Z(a.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:t("training.trainingHours")}),e.jsxs("div",{className:"input bg-gray-50 dark:bg-gray-800 flex items-center justify-between",children:[e.jsx("span",{children:Number.isFinite(A)?A:0}),e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:t("training.hoursUnit")})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),t("training.photo")]}),e.jsxs("label",{className:"flex items-center justify-center border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5 transition-colors",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:Ne,className:"hidden"}),ae?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:ae,alt:"Preview",className:"w-12 h-12 object-cover rounded"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("training.changePhoto")})]}):e.jsxs("div",{className:"text-center",children:[e.jsx(M,{className:"w-8 h-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("training.uploadPhoto")})]})]})]}),e.jsx("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{type:"submit",className:"btn-primary",disabled:!b||!g||!u||!v||!n||n==="Other"&&!f,children:t("training.submit")})})]})]}),e.jsxs("div",{className:"card p-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-hse-primary"}),t("training.listTitle")]}),e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap items-center gap-3",children:[e.jsxs(S,{value:l,onChange:a=>he(a.target.value),className:"h-10 text-sm min-w-[140px]",children:[e.jsx("option",{value:"",children:t("training.allProjects")}),C.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsxs(S,{value:o,onChange:a=>ge(a.target.value),className:"h-10 text-sm min-w-[130px]",children:[e.jsx("option",{value:"",children:t("training.allWeeks")}),Array.from({length:52},(a,s)=>s+1).map(a=>e.jsx("option",{value:a,children:t("training.weekLabel").replace("{{week}}",a)},a))]}),e.jsx(O,{value:x,onChange:a=>{pe(a),j(1)},placeholder:"From date",className:"w-40 h-10"}),e.jsx(O,{value:m,onChange:a=>{ue(a),j(1)},placeholder:"To date",className:"w-40 h-10"}),e.jsxs("button",{type:"button",onClick:fe,disabled:je||c.length===0,className:"btn-secondary flex items-center gap-2 text-sm",children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsx("span",{children:t("dashboard.exportExcel")})]})]})]}),W?e.jsxs("div",{className:"space-y-3 py-4",children:[e.jsx("div",{className:"hidden md:block space-y-2 animate-pulse",children:Array.from({length:4},(a,s)=>e.jsx("div",{className:"h-10 rounded-md bg-gray-100 dark:bg-gray-800"},s))}),e.jsx("div",{className:"md:hidden space-y-3 animate-pulse",children:Array.from({length:3},(a,s)=>e.jsx("div",{className:"h-24 rounded-lg bg-gray-100 dark:bg-gray-800"},s))})]}):c.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-hse-primary/10 mb-3",children:e.jsx(de,{className:"w-5 h-5 text-hse-primary"})}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:t("training.noTrainings")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 md:hidden",children:ie.map(a=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3 bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:a.project?.name||"-"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:a.date?a.date.split("T")[0]:"-"}),e.jsx("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-300",children:a.by_internal?a.by_name:a.external_company||"-"})]}),e.jsxs("div",{className:"text-right text-xs text-gray-600 dark:text-gray-300 space-y-1",children:[e.jsx("p",{className:"font-medium truncate max-w-[140px]",children:a.theme}),e.jsx("p",{children:t(`training.durations.${ce[a.duration_label]||a.duration_label}`)})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-[11px] text-gray-600 dark:text-gray-300",children:[e.jsxs("span",{className:"px-1.5 py-0.5 rounded-full bg-gray-50 dark:bg-gray-900",children:[t("training.participants"),": ",a.participants]}),e.jsxs("span",{className:"px-1.5 py-0.5 rounded-full bg-hse-primary/10 text-hse-primary",children:[t("training.trainingHours"),": ",a.training_hours]})]}),a.photo_url&&e.jsx("div",{className:"mt-2 flex justify-end",children:e.jsxs("button",{type:"button",onClick:()=>le(a),className:"text-[11px] text-hse-primary hover:underline flex items-center gap-1",children:[e.jsx(M,{className:"w-3 h-3"}),t("training.viewPhoto")]})})]},a.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:t("training.colDate")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:t("training.colProject")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:t("training.colBy")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:t("training.colTheme")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:t("training.colDuration")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:t("training.colParticipants")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:t("training.colHours")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:t("training.colPhoto")})]})}),e.jsx("tbody",{children:ie.map(a=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-4 text-gray-900 dark:text-gray-100 text-xs",children:a.date?a.date.split("T")[0]:"-"}),e.jsx("td",{className:"py-2 pr-4 text-gray-900 dark:text-gray-100",children:a.project?.name||"-"}),e.jsx("td",{className:"py-2 pr-4 text-gray-700 dark:text-gray-200",children:a.by_internal?a.by_name:a.external_company||"-"}),e.jsx("td",{className:"py-2 pr-4 text-gray-700 dark:text-gray-200",children:a.theme}),e.jsx("td",{className:"py-2 pr-4 text-gray-700 dark:text-gray-200",children:t(`training.durations.${ce[a.duration_label]||a.duration_label}`)}),e.jsx("td",{className:"py-2 pr-4 text-gray-700 dark:text-gray-200",children:a.participants}),e.jsx("td",{className:"py-2 pr-4 text-gray-700 dark:text-gray-200",children:a.training_hours}),e.jsx("td",{className:"py-2 pr-4 text-gray-700 dark:text-gray-200",children:a.photo_url?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>le(a),className:"text-xs text-hse-primary hover:underline",children:t("training.viewPhoto")}),e.jsx("a",{href:a.photo_url,download:!0,className:"text-xs text-gray-500 hover:underline",children:t("training.downloadPhoto")})]}):e.jsx("span",{className:"text-xs text-gray-400",children:"-"})})]},a.id))})]})})]}),!W&&c.length>0&&w>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100 dark:border-gray-800",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t("common.page")," ",y," ",t("common.of")," ",w]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>j(a=>Math.max(1,a-1)),disabled:y===1,className:"btn-secondary text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:t("common.previous")??"Previous"}),e.jsx("button",{type:"button",onClick:()=>j(a=>Math.min(w,a+1)),disabled:y===w,className:"btn-secondary text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:t("common.next")??"Next"})]})]})]}),N&&e.jsx(Te,{isOpen:!!N,onClose:()=>te(null),title:t("training.photo"),size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:N.photo_url,alt:t("training.photo"),className:"max-h-[70vh] w-auto rounded-lg shadow-md object-contain bg-gray-900/5"})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("a",{href:N.photo_url,download:!0,className:"btn-primary inline-flex items-center gap-2 text-sm",children:[e.jsx(Me,{className:"w-4 h-4"}),t("training.downloadPhoto")]})})]})})]})}export{Xe as default};
