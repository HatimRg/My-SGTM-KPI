import{a as ce,u as oe,p as H,o as f,j as e,f as de}from"./index-B_O7GBLG.js";import{r as l}from"./vendor-react-Bagy_njL.js";import{C as xe}from"./ConfirmDialog-CiIl8vCj.js";import{D}from"./DatePicker-BulF6DGw.js";import{S as p}from"./Select-DRJkHVy9.js";import{r as O,c as $,a5 as he,a4 as pe,a1 as me,o as F,n as T,au as ue,aa as je,i as ge,z as o}from"./vendor-ui-ByylQ01J.js";import"./vendor-utils-MYqKZVQ3.js";import"./Modal-DNf25r5Z.js";const J=[{value:"sst",labelKey:"sst"},{value:"environment",labelKey:"environment"},{value:"third_party",labelKey:"thirdParty"},{value:"equipment",labelKey:"equipment"},{value:"other",labelKey:"other"}],Q=t=>{if(!t)return"-";const g=t.substring(0,10),[m,N,w]=g.split("-");return`${w}/${N}/${m}`};function _e(){const{t}=ce(),{user:g}=oe(),[m,N]=l.useState([]),[w,V]=l.useState([]),[q,k]=l.useState(!0),[Y,K]=l.useState(!1),[A,R]=l.useState([]),[i,W]=l.useState(null),[d,ee]=l.useState(""),[x,se]=l.useState(""),[C,te]=l.useState(""),[y,U]=l.useState(!1),[b,_]=l.useState(null),[a,r]=l.useState(E()),[M,Z]=l.useState(!1),[S,P]=l.useState(null);function E(){return{project_id:"",inspection_date:new Date().toISOString().split("T")[0],nature:"sst",nature_other:"",type:"internal",location:"",start_date:new Date().toISOString().split("T")[0],end_date:"",zone:"",inspector:g?.name||"",enterprise:"",status:"open",notes:""}}l.useEffect(()=>{ae()},[]),l.useEffect(()=>{const s=n=>{n.key==="Escape"&&y&&v()};if(y)return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[y]),l.useEffect(()=>{i&&(I(),L(i.id))},[i,d,x]);const ae=async()=>{try{const n=(await H.getAll({per_page:100})).data.data||[];N(n),n.length===1&&W(n[0])}catch(s){console.error("Error fetching projects:",s)}finally{k(!1)}},I=async()=>{if(i){k(!0);try{const s={project_id:i.id,per_page:100};d&&(s.status=d),x&&(s.nature=x);const c=(await f.getAll(s)).data,h=c.data||c,j=Array.isArray(h)?h:h.data||[];V(j)}catch(s){console.error("Error fetching inspections:",s)}finally{k(!1)}}},L=async s=>{try{const n=await H.getZones(s);R(n.data.data.zones||[])}catch(n){console.error("Error fetching zones:",n),R([])}},z=(s=null)=>{s?(_(s),r({project_id:s.project_id.toString(),inspection_date:s.inspection_date,nature:s.nature,nature_other:s.nature_other||"",type:s.type,location:s.location||"",start_date:s.start_date,end_date:s.end_date||"",zone:s.zone||"",inspector:s.inspector,enterprise:s.enterprise||"",status:s.status,notes:s.notes||""}),L(s.project_id)):(_(null),r({...E(),project_id:i?.id?.toString()||"",inspector:g?.name||""})),U(!0)},v=()=>{U(!1),_(null),r(E())},ne=async s=>{s.preventDefault(),Z(!0);try{const n={...a,project_id:parseInt(a.project_id)};b?(await f.update(b.id,n),o.success(t("inspections.updated"))):(await f.create(n),o.success(t("inspections.created"))),v(),I()}catch(n){console.error("Error saving inspection:",n),o.error(t("errors.somethingWentWrong"))}finally{Z(!1)}},B=s=>{P(s)},re=async()=>{if(S)try{await f.delete(S.id),o.success(t("inspections.deleted")),I()}catch{o.error(t("errors.somethingWentWrong"))}finally{P(null)}},X=s=>{const n=m.find(c=>c.id===parseInt(s));W(n),r(c=>({...c,project_id:s,zone:""})),n&&L(n.id)},u=w.filter(s=>{if(!C)return!0;const n=C.toLowerCase();return s.inspector?.toLowerCase().includes(n)||s.location?.toLowerCase().includes(n)||s.zone?.toLowerCase().includes(n)||s.enterprise?.toLowerCase().includes(n)||s.notes?.toLowerCase().includes(n)}),G=(s,n)=>s==="other"&&n?n:t(`inspections.natures.${s}`),le=async()=>{if(!i){o.error(t("inspections.selectProjectFirst"));return}try{K(!0);const s={project_id:i.id};d&&(s.status=d),x&&(s.nature=x);const n=await de.exportInspections(s),c=new Blob([n.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),h=window.URL.createObjectURL(c),j=document.createElement("a");j.href=h;const ie=i.code||i.id;j.download=`inspections_${ie}.xlsx`,j.click(),window.URL.revokeObjectURL(h)}catch(s){console.error("Error exporting inspections:",s),o.error(t("errors.somethingWentWrong"))}finally{K(!1)}};return q&&!i?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(O,{className:"w-8 h-8 animate-spin text-hse-primary"})}):e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 dark:bg-blue-900/50 rounded-xl flex items-center justify-center",children:e.jsx($,{className:"w-6 h-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:[t("nav.dashboard")," / ",t("inspections.title")]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:t("inspections.pageTitle")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:t("inspections.pageSubtitle")})]})]}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:t("inspections.project")}),e.jsxs(p,{value:i?.id||"",onChange:s=>X(s.target.value),children:[e.jsx("option",{value:"",children:t("inspections.selectProject")}),m.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.code,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:t("inspections.status")}),e.jsxs(p,{value:d,onChange:s=>ee(s.target.value),children:[e.jsx("option",{value:"",children:t("common.all")}),e.jsx("option",{value:"open",children:t("inspections.statusOpen")}),e.jsx("option",{value:"closed",children:t("inspections.statusClosed")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:t("inspections.nature")}),e.jsxs(p,{value:x,onChange:s=>se(s.target.value),children:[e.jsx("option",{value:"",children:t("common.all")}),J.map(s=>e.jsx("option",{value:s.value,children:t(`inspections.natures.${s.labelKey}`)},s.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:t("common.search")}),e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:C,onChange:s=>te(s.target.value),placeholder:t("inspections.searchPlaceholder"),className:"input pl-10"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:()=>z(),disabled:!i,className:"btn-primary flex items-center gap-2 w-full justify-center",children:[e.jsx(pe,{className:"w-4 h-4"}),t("inspections.newInspection")]})})]})}),i?e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[t("inspections.listTitle")," (",u.length,")"]}),e.jsxs("button",{type:"button",onClick:le,disabled:Y||u.length===0,className:"btn-secondary flex items-center gap-2 text-sm",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{children:t("dashboard.exportExcel")})]})]}),e.jsx("div",{className:"overflow-x-auto",children:q?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsx(O,{className:"w-6 h-6 animate-spin text-hse-primary"})}):u.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 md:hidden",children:u.map(s=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3 bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:Q(s.inspection_date)}),e.jsx("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-300",children:G(s.nature,s.nature_other)}),e.jsxs("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-300",children:[s.location||"-"," Â· ",s.zone||"-"]}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[t("inspections.inspector"),": ",s.inspector]})]}),e.jsxs("div",{className:"text-right text-xs text-gray-600 dark:text-gray-300 space-y-1",children:[e.jsx("span",{className:`inline-flex items-center gap-1 badge ${s.type==="internal"?"badge-info":"badge-warning"}`,children:t(`inspections.types.${s.type}`)}),e.jsx("span",{className:`inline-flex items-center gap-1 badge ${s.status==="open"?"badge-warning":"badge-success"}`,children:s.status==="open"?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-3 h-3"}),t("inspections.statusOpen")]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-3 h-3"}),t("inspections.statusClosed")]})})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>z(s),className:"px-2 py-1 text-xs rounded-md bg-gray-50 dark:bg-gray-900 text-gray-700 dark:text-gray-200",title:t("common.edit"),children:t("common.edit")}),e.jsx("button",{onClick:()=>B(s),className:"px-2 py-1 text-xs rounded-md bg-red-50 dark:bg-red-900/30 text-red-600",title:t("common.delete"),children:t("common.delete")})]})]},s.id))}),e.jsx("div",{className:"hidden md:block",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:t("inspections.date")}),e.jsx("th",{children:t("inspections.nature")}),e.jsx("th",{children:t("inspections.type")}),e.jsx("th",{children:t("inspections.location")}),e.jsx("th",{children:t("inspections.zone")}),e.jsx("th",{children:t("inspections.inspector")}),e.jsx("th",{children:t("inspections.status")}),e.jsx("th",{children:t("common.actions")})]})}),e.jsx("tbody",{children:u.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"whitespace-nowrap",children:Q(s.inspection_date)}),e.jsx("td",{children:e.jsx("span",{className:"text-sm",children:G(s.nature,s.nature_other)})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.type==="internal"?"badge-info":"badge-warning"}`,children:t(`inspections.types.${s.type}`)})}),e.jsx("td",{children:s.location||"-"}),e.jsx("td",{children:s.zone||"-"}),e.jsx("td",{children:s.inspector}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.status==="open"?"badge-warning":"badge-success"}`,children:s.status==="open"?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-3 h-3 mr-1"}),t("inspections.statusOpen")]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),t("inspections.statusClosed")]})})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>z(s),className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",title:t("common.edit"),children:e.jsx(ue,{className:"w-4 h-4 text-gray-500"})}),e.jsx("button",{onClick:()=>B(s),className:"p-1.5 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",title:t("common.delete"),children:e.jsx(je,{className:"w-4 h-4 text-red-500"})})]})})]},s.id))})]})})]}):e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx($,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:t("inspections.noInspections")})]})})]}):e.jsxs("div",{className:"card p-12 text-center text-gray-500 dark:text-gray-400",children:[e.jsx($,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:t("inspections.selectProjectFirst")})]}),y&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 z-[200] bg-white dark:bg-gray-800 border-b dark:border-gray-700 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold dark:text-gray-100",children:t(b?"inspections.editInspection":"inspections.newInspection")}),e.jsx("button",{onClick:v,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:ne,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[t("inspections.project")," *"]}),e.jsxs(p,{value:a.project_id,onChange:s=>X(s.target.value),required:!0,children:[e.jsx("option",{value:"",children:t("inspections.selectProject")}),m.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[t("inspections.date")," *"]}),e.jsx(D,{value:a.inspection_date,onChange:s=>r({...a,inspection_date:s}),required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[t("inspections.nature")," *"]}),e.jsx(p,{value:a.nature,onChange:s=>r({...a,nature:s.target.value}),required:!0,children:J.map(s=>e.jsx("option",{value:s.value,children:t(`inspections.natures.${s.labelKey}`)},s.value))})]}),a.nature==="other"&&e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[t("inspections.natureOther")," *"]}),e.jsx("input",{type:"text",value:a.nature_other,onChange:s=>r({...a,nature_other:s.target.value}),className:"input",placeholder:t("inspections.natureOtherPlaceholder"),required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[t("inspections.type")," *"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"type",value:"internal",checked:a.type==="internal",onChange:s=>r({...a,type:s.target.value}),className:"w-4 h-4 text-hse-primary"}),e.jsx("span",{children:t("inspections.types.internal")})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"type",value:"external",checked:a.type==="external",onChange:s=>r({...a,type:s.target.value}),className:"w-4 h-4 text-hse-primary"}),e.jsx("span",{children:t("inspections.types.external")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:t("inspections.location")}),e.jsx("input",{type:"text",value:a.location,onChange:s=>r({...a,location:s.target.value}),className:"input",placeholder:t("inspections.locationPlaceholder")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:t("inspections.zone")}),e.jsxs(p,{value:a.zone,onChange:s=>r({...a,zone:s.target.value}),disabled:A.length===0,children:[e.jsxs("option",{value:"",children:[t("common.select"),"..."]}),A.map((s,n)=>e.jsx("option",{value:s,children:s},n))]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[t("inspections.startDate")," *"]}),e.jsx(D,{value:a.start_date,onChange:s=>r({...a,start_date:s}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:t("inspections.endDate")}),e.jsx(D,{value:a.end_date,onChange:s=>r({...a,end_date:s})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[t("inspections.inspector")," *"]}),e.jsx("input",{type:"text",value:a.inspector,onChange:s=>r({...a,inspector:s.target.value}),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:t("inspections.enterprise")}),e.jsx("input",{type:"text",value:a.enterprise,onChange:s=>r({...a,enterprise:s.target.value}),className:"input",placeholder:t("inspections.enterprisePlaceholder")})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[t("inspections.status")," *"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"status",value:"open",checked:a.status==="open",onChange:s=>r({...a,status:s.target.value}),className:"w-4 h-4 text-hse-primary"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"w-4 h-4 text-amber-500"}),t("inspections.statusOpen")]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"status",value:"closed",checked:a.status==="closed",onChange:s=>r({...a,status:s.target.value}),className:"w-4 h-4 text-hse-primary"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4 text-green-500"}),t("inspections.statusClosed")]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:t("inspections.notes")}),e.jsx("textarea",{value:a.notes,onChange:s=>r({...a,notes:s.target.value}),className:"input",rows:3,placeholder:t("inspections.notesPlaceholder")})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:v,className:"btn-outline",children:t("common.cancel")}),e.jsxs("button",{type:"submit",disabled:M,className:"btn-primary flex items-center gap-2",children:[M&&e.jsx(O,{className:"w-4 h-4 animate-spin"}),t(b?"common.save":"inspections.create")]})]})]})]})}),e.jsx(xe,{isOpen:!!S,title:t("common.confirm"),message:t("inspections.confirmDelete"),confirmLabel:t("common.delete"),cancelLabel:t("common.cancel"),variant:"danger",onConfirm:re,onCancel:()=>P(null)})]})}export{_e as default};
