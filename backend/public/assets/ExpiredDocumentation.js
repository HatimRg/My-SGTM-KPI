import{a as C,F as L,j as e}from"./index.js";import{r as d}from"./vendor-react.js";import{z as O,A as E,q as P,v as T}from"./vendor-ui.js";import{S as _}from"./Select.js";import"./vendor-utils.js";const f={expiring:"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-300",expired:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300",unknown:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300"},g=t=>{const x=String(t??"").toLowerCase();return x==="expired"?"expired":x==="expiring"?"expiring":"unknown"};function B(){const{t}=C(),[x,k]=d.useState(!1),[j,w]=d.useState(null),[m,M]=d.useState(""),[y,A]=d.useState(""),b=d.useCallback(async()=>{try{k(!0);const r=await L.expiredDocumentation();w(r.data?.data??null)}catch(r){O.error(r.response?.data?.message??t("errors.somethingWentWrong")),w(null)}finally{k(!1)}},[t]);d.useEffect(()=>{b()},[b]);const D=j?.stats??{expiring_count:0,expired_count:0},h=d.useMemo(()=>Array.isArray(j?.projects)?j.projects:[],[j]),$=d.useMemo(()=>h.map(r=>r?.project).filter(Boolean).map(r=>({id:String(r.id),name:r.name})),[h]),S=d.useMemo(()=>{const r=m?h.filter(s=>String(s?.project?.id??"")===String(m)):h,l=y?String(y):"";if(!l)return r;const p=s=>s.some(i=>g(i?.status)===l);return r.map(s=>{const i=Array.isArray(s?.machines)?s.machines:[],n=Array.isArray(s?.operators)?s.operators:[],c=i.map(a=>{const v=(Array.isArray(a?.documents)?a.documents:[]).filter(N=>g(N?.status)===l);return{...a,documents:v}}).filter(a=>Array.isArray(a?.documents)?a.documents.length>0:!1),u=n.map(a=>{const v=(Array.isArray(a?.trainings)?a.trainings:[]).filter(N=>g(N?.status)===l);return{...a,trainings:v}}).filter(a=>Array.isArray(a?.trainings)?a.trainings.length>0:!1);return{...s,machines:c,operators:u}}).filter(s=>{const i=Array.isArray(s?.machines)?s.machines.flatMap(c=>c?.documents??[]):[],n=Array.isArray(s?.operators)?s.operators.flatMap(c=>c?.trainings??[]):[];return p(i)||p(n)})},[h,m,y]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:t("heavyMachinery.title")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:t("heavyMachinery.expiredDocumentation.title")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t("heavyMachinery.expiredDocumentation.stats.expired")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1",children:D.expired_count??0})]}),e.jsx("div",{className:"w-10 h-10 rounded-xl bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:e.jsx(E,{className:"w-5 h-5 text-red-600 dark:text-red-300"})})]}),e.jsxs("div",{className:"card p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t("heavyMachinery.expiredDocumentation.stats.expiring")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1",children:D.expiring_count??0})]}),e.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center",children:e.jsx(P,{className:"w-5 h-5 text-amber-700 dark:text-amber-300"})})]})]}),e.jsxs("div",{className:"card p-4 md:p-6 space-y-3",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"label text-xs",children:t("heavyMachinery.expiredDocumentation.filters.project")}),e.jsxs(_,{value:m,onChange:r=>M(r.target.value),children:[e.jsx("option",{value:"",children:t("common.allProjects")}),$.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{className:"md:w-64",children:[e.jsx("label",{className:"label text-xs",children:t("heavyMachinery.expiredDocumentation.filters.status")}),e.jsxs(_,{value:y,onChange:r=>A(r.target.value),children:[e.jsx("option",{value:"",children:t("heavyMachinery.expiredDocumentation.status.all")}),e.jsx("option",{value:"expired",children:t("heavyMachinery.expiredDocumentation.status.expired")}),e.jsx("option",{value:"expiring",children:t("heavyMachinery.expiredDocumentation.status.expiring")})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"btn-outline",onClick:()=>b(),disabled:x,children:t("common.refresh")}),e.jsx("button",{type:"button",className:"btn-outline",onClick:()=>{M(""),A("")},disabled:!m&&!y,children:t("common.reset")})]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t("heavyMachinery.expiredDocumentation.help")})]}),e.jsx("div",{className:"space-y-4",children:x?e.jsx("div",{className:"card p-10 flex items-center justify-center",children:e.jsx(T,{className:"w-6 h-6 animate-spin text-hse-primary"})}):S.length===0?e.jsx("div",{className:"card p-8 text-center text-sm text-gray-600 dark:text-gray-300",children:t("heavyMachinery.expiredDocumentation.empty")}):S.map(r=>{const l=r?.project?.name??t("common.unknown"),p=Array.isArray(r?.machines)?r.machines:[],s=Array.isArray(r?.operators)?r.operators:[];return e.jsxs("div",{className:"card p-4 md:p-6 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between gap-3",children:e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 truncate",children:l}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t("heavyMachinery.expiredDocumentation.projectSubtitle")})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:t("heavyMachinery.expiredDocumentation.sections.machines")}),p.length===0?e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("heavyMachinery.expiredDocumentation.sections.emptyMachines")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:t("heavyMachinery.expiredDocumentation.columns.machine")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:t("heavyMachinery.expiredDocumentation.columns.document")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:t("heavyMachinery.expiredDocumentation.columns.expiryDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:t("heavyMachinery.expiredDocumentation.columns.status")})]})}),e.jsx("tbody",{children:p.flatMap(i=>{const n=i?.machine,c=Array.isArray(i?.documents)?i.documents:[],u=n?n.internal_code?`${n.internal_code} Â· ${n.serial_number}`:n.serial_number:"-";return c.map(a=>{const o=g(a?.status);return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100 whitespace-nowrap",children:u}),e.jsxs("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:[e.jsx("div",{className:"font-medium",children:a.document_label}),e.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:a.document_key})]}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200 whitespace-nowrap",children:a.expiry_date??""}),e.jsx("td",{className:"py-2 pr-3",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] ${f[o]??f.unknown}`,children:t(`heavyMachinery.expiredDocumentation.status.${o}`)})})]},`m-${n?.id??"x"}-d-${a.id}`)})})})]})})]}),e.jsxs("div",{className:"space-y-3 pt-2 border-t border-gray-100 dark:border-gray-800",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:t("heavyMachinery.expiredDocumentation.sections.operators")}),s.length===0?e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("heavyMachinery.expiredDocumentation.sections.emptyOperators")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:t("heavyMachinery.expiredDocumentation.columns.worker")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:t("heavyMachinery.expiredDocumentation.columns.training")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:t("heavyMachinery.expiredDocumentation.columns.expiryDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:t("heavyMachinery.expiredDocumentation.columns.status")})]})}),e.jsx("tbody",{children:s.flatMap(i=>{const n=i?.worker,c=Array.isArray(i?.trainings)?i.trainings:[],u=n?`${n.full_name}${n.cin?` (${n.cin})`:""}`:"-";return c.map(a=>{const o=g(a?.status);return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100 whitespace-nowrap",children:u}),e.jsxs("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:[e.jsx("div",{className:"font-medium",children:a.training_label??a.training_type}),e.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:a.training_type})]}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200 whitespace-nowrap",children:a.expiry_date??""}),e.jsx("td",{className:"py-2 pr-3",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] ${f[o]??f.unknown}`,children:t(`heavyMachinery.expiredDocumentation.status.${o}`)})})]},`w-${n?.id??"x"}-t-${a.id}`)})})})]})})]})]},String(r?.project?.id??l))})})]})}export{B as default};
