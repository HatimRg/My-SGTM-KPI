import{d as E,j as e,e as ke,f as ve}from"./index-Cj_Nywl_.js";import{r as n,u as We,L as Le}from"./vendor-react-Bagy_njL.js";import{J as Ge,v as Se,K as se,c as V,N as Oe,A as he,O as Be,T as Te,Q as Me,U as ae,o as Ne,n as Ee,V as He,Y as Ue,Z as Ye,_ as Ve,$ as qe,z as oe,r as Je,a0 as Xe,a1 as Ze,e as we,F as Qe,a2 as ea,a3 as aa}from"./vendor-ui-ByylQ01J.js";import{R as k,A as re,C as _,X as C,Y as N,T as v,a as B,P as Ae,b as $e,c as te,L as F,d as ge,e as z,B as Y,f as A,g as Ke}from"./vendor-charts-BIh7BMeg.js";import{g as xe}from"./weekHelper-DiwCDpdk.js";import"./vendor-utils-MYqKZVQ3.js";class ta{constructor(){this.cache=new Map,this.timestamps=new Map}generateKey(r,d={}){const i=Object.keys(d).sort().reduce((a,s)=>(a[s]=d[s],a),{});return`${r}:${JSON.stringify(i)}`}get(r,d={},i=3e4){const a=this.generateKey(r,d),s=this.timestamps.get(a);return!s||Date.now()-s>i?(this.delete(a),null):this.cache.get(a)}set(r,d={},i){const a=this.generateKey(r,d);this.cache.set(a,i),this.timestamps.set(a,Date.now())}delete(r){this.cache.delete(r),this.timestamps.delete(r)}clearPattern(r){for(const d of this.cache.keys())d.includes(r)&&this.delete(d)}clear(){this.cache.clear(),this.timestamps.clear()}getStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}}const _e=new ta;async function Ce(x,r,d={},i=3e4){const a=_e.get(r,d,i);if(a)return Promise.resolve(a);try{const s=await x(d);return _e.set(r,d,s),s}catch(s){throw s}}const sa=[{id:"overview",nameKey:"dashboard.themes.overview",icon:Ge,gradient:"from-purple-500 to-purple-700"},{id:"safety",nameKey:"dashboard.themes.safety",icon:Se,gradient:"from-red-500 to-red-700"},{id:"training",nameKey:"dashboard.themes.training",icon:se,gradient:"from-blue-500 to-blue-700"},{id:"compliance",nameKey:"dashboard.themes.compliance",icon:V,gradient:"from-green-500 to-green-700"},{id:"environmental",nameKey:"dashboard.themes.environmental",icon:Oe,gradient:"from-emerald-500 to-emerald-700"}],ra=n.memo(function({activeTheme:r,onThemeChange:d}){const i=E();return e.jsx("div",{className:"relative mb-4",children:e.jsx("div",{className:"flex items-center justify-center gap-1 flex-wrap",children:sa.map(a=>{const s=a.icon,l=r===a.id;return e.jsxs("button",{onClick:()=>d(a.id),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg border transition-all duration-200 ${l?`bg-gradient-to-r ${a.gradient} text-white border-transparent shadow-md`:"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600 hover:shadow-sm"}`,children:[e.jsx(s,{className:`w-4 h-4 ${l?"text-white":""}`}),e.jsx("span",{className:`font-medium text-xs ${l?"text-white":""}`,children:i(a.nameKey)})]},a.id)})})})}),I={fatal:"#dc2626",serious:"#f59e0b",minor:"#16a34a",tf:"#f59e0b",tg:"#8b5cf6"},X=n.memo(function({title:r,value:d,icon:i,color:a,trend:s}){const l={red:"border-red-200 bg-red-50 dark:border-red-700 dark:bg-red-900/50 text-red-600 dark:text-red-400",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${l[a]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(i,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:r})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:d}),s&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:s})]})}),na=n.memo(function({kpiSummary:r,weeklyTrends:d,projectPerformance:i}){const a=E(),s=n.useMemo(()=>({totalAccidents:r?.total_accidents||0,fatalAccidents:r?.fatal_accidents||0,avgTF:Number(r?.avg_tf||0).toFixed(2),avgTG:Number(r?.avg_tg||0).toFixed(2),lostWorkdays:r?.lost_workdays||0}),[r]),l=n.useMemo(()=>d?.map(g=>({week:g.week_label,accidents:g.accidents||0}))||[],[d]),b=n.useMemo(()=>{const g=s.totalAccidents,S=s.fatalAccidents,$=Math.max(0,g-S);return[{name:a("dashboard.safety.fatal"),value:S,color:I.fatal},{name:a("dashboard.safety.serious"),value:Math.floor($*.3),color:I.serious},{name:a("dashboard.safety.minor"),value:Math.ceil($*.7),color:I.minor}].filter(T=>T.value>0)},[s,a]),y=n.useMemo(()=>d?.map(g=>({week:g.week_label,tf:Number(g.tf||0).toFixed(4),tg:Number(g.tg||0).toFixed(4)}))||[],[d]),o=n.useMemo(()=>i?.slice(0,6).map(g=>({name:g.name?.length>15?g.name.substring(0,15)+"...":g.name,accidents:g.total_accidents||0}))||[],[i]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(X,{title:a("dashboard.safety.totalAccidents"),value:s.totalAccidents,icon:he,color:s.totalAccidents>0?"red":"green",trend:a("dashboard.safety.yearToDate")}),e.jsx(X,{title:a("dashboard.safety.fatalAccidents"),value:s.fatalAccidents,icon:Be,color:s.fatalAccidents>0?"red":"green",trend:s.fatalAccidents===0?a("dashboard.safety.noFatalities"):a("dashboard.safety.critical")}),e.jsx(X,{title:a("dashboard.safety.tfRate"),value:s.avgTF,icon:Te,color:"amber",trend:a("dashboard.safety.avgFrequencyRate")}),e.jsx(X,{title:a("dashboard.safety.tgRate"),value:s.avgTG,icon:Me,color:"purple",trend:a("dashboard.safety.avgSeverityRate")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a("dashboard.safety.accidentTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(re,{data:l,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"accidentGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#dc2626",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#dc2626",stopOpacity:.1})]})}),e.jsx(_,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(C,{dataKey:"week",tick:{fontSize:11}}),e.jsx(N,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(v,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(B,{type:"monotone",dataKey:"accidents",stroke:"#dc2626",fill:"url(#accidentGradient)",name:"Accidents"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a("dashboard.safety.accidentsBySeverity")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:b.length>0?e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(Ae,{children:[e.jsx($e,{data:b,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:g,value:S})=>`${g}: ${S}`,children:b.map((g,S)=>e.jsx(te,{fill:g.color},`cell-${S}`))}),e.jsx(v,{}),e.jsx(F,{})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-green-600 dark:text-green-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(he,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"font-medium",children:a("dashboard.safety.noAccidents")}),e.jsx("p",{className:"text-sm text-gray-500",children:a("dashboard.safety.greatSafety")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a("dashboard.safety.tfVsTg")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(ge,{data:y,children:[e.jsx(_,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(C,{dataKey:"week",tick:{fontSize:11}}),e.jsx(N,{tick:{fontSize:11}}),e.jsx(v,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(F,{}),e.jsx(z,{type:"monotone",dataKey:"tf",stroke:I.tf,strokeWidth:2,dot:{fill:I.tf,r:3},name:"TF Rate"}),e.jsx(z,{type:"monotone",dataKey:"tg",stroke:I.tg,strokeWidth:2,dot:{fill:I.tg,r:3},name:"TG Rate"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a("dashboard.safety.accidentsByProject")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(Y,{data:o,layout:"vertical",children:[e.jsx(_,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(C,{type:"number",allowDecimals:!1,tick:{fontSize:11}}),e.jsx(N,{type:"category",dataKey:"name",tick:{fontSize:10},width:100}),e.jsx(v,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(A,{dataKey:"accidents",fill:"#dc2626",radius:[0,4,4,0],name:"Accidents"})]})})})})]})]})]})}),W=n.memo(function({title:r,value:d,icon:i,color:a,trend:s}){const l={blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${l[a]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(i,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:r})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:d}),s&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:s})]})}),ia=n.memo(function({kpiSummary:r,weeklyTrends:d,projectPerformance:i,trainingData:a,awarenessData:s}){const l=E(),b=n.useMemo(()=>({totalTrainings:a?.total||r?.total_trainings||0,employeesTrained:a?.total_participants||r?.employees_trained||0,trainingHours:a?.total_hours||r?.training_hours||0,completionRate:95}),[r,a]),y=n.useMemo(()=>({totalSessions:s?.total||0,totalParticipants:s?.total_participants||0,totalHours:s?.total_hours||0}),[s]),o=n.useMemo(()=>a?.by_week?.length>0?a.by_week.map(c=>({week:"S"+c.week_number,trainings:c.count||0,participants:c.participants||0})):d?.map(c=>({week:c.week_label,trainings:c.trainings||0}))||[],[d,a]),g=n.useMemo(()=>{if(a?.by_theme?.length>0){const c=["#3b82f6","#8b5cf6","#ec4899","#14b8a6","#f59e0b","#ef4444","#10b981","#6366f1"];return a.by_theme.slice(0,8).map((m,K)=>({name:m.theme?.length>20?m.theme.substring(0,20)+"...":m.theme,fullName:m.theme,value:m.count,participants:m.participants||0,color:c[K%c.length]}))}return[]},[a]),S=n.useMemo(()=>a?.by_duration?.length>0?a.by_duration.map(c=>({duration:c.duration,count:c.count,participants:c.participants||0})):[],[a]),$=n.useMemo(()=>{if(s?.by_theme?.length>0){const c=["#16a34a","#0ea5e9","#f97316","#a855f7","#eab308","#06b6d4","#84cc16","#d946ef"];return s.by_theme.slice(0,8).map((m,K)=>({name:m.theme?.length>20?m.theme.substring(0,20)+"...":m.theme,fullName:m.theme,value:m.count,participants:m.participants||0,color:c[K%c.length]}))}return[]},[s]),T=n.useMemo(()=>a?.by_type?.length>0?a.by_type.map(c=>({name:c.type==="internal"?l("dashboard.training.internal"):l("dashboard.training.external"),value:c.count,color:c.type==="internal"?"#3b82f6":"#8b5cf6"})):[],[a,l]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(W,{title:l("dashboard.training.totalTrainings"),value:b.totalTrainings,icon:se,color:"blue",trend:l("dashboard.training.sessionsCompleted")}),e.jsx(W,{title:l("dashboard.training.employeesTrained"),value:b.employeesTrained,icon:ae,color:"green",trend:l("dashboard.training.uniqueAttendees")}),e.jsx(W,{title:l("dashboard.training.trainingHours"),value:b.trainingHours,icon:Ne,color:"purple",trend:l("dashboard.training.totalHoursDelivered")}),e.jsx(W,{title:l("dashboard.training.completionRate"),value:`${b.completionRate}%`,icon:Ee,color:"amber",trend:`${l("dashboard.training.target")}: 95%`})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:l("dashboard.training.trainingTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(re,{data:o,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"trainingGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.1})]})}),e.jsx(_,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(C,{dataKey:"week",tick:{fontSize:11}}),e.jsx(N,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(v,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(B,{type:"monotone",dataKey:"trainings",stroke:"#3b82f6",fill:"url(#trainingGradient)",name:"Trainings"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:l("dashboard.training.trainingByTheme")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-72",children:g.length>0?e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(Y,{data:g,layout:"vertical",margin:{left:10,right:20},children:[e.jsx(_,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(C,{type:"number",allowDecimals:!1,tick:{fontSize:11}}),e.jsx(N,{type:"category",dataKey:"name",tick:{fontSize:10},width:120}),e.jsx(v,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},formatter:(c,m,K)=>[`${c} sessions (${K.payload.participants} participants)`,"Count"]}),e.jsx(A,{dataKey:"value",radius:[0,4,4,0],children:g.map((c,m)=>e.jsx(te,{fill:c.color},`cell-${m}`))})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(se,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"font-medium",children:l("dashboard.training.noTrainingData")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:l("dashboard.training.trainingByDuration")||"Training by Duration"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:S.length>0?e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(Y,{data:S,children:[e.jsx(_,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(C,{dataKey:"duration",tick:{fontSize:11}}),e.jsx(N,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(v,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},formatter:(c,m)=>[c,m==="count"?"Sessions":"Participants"]}),e.jsx(A,{dataKey:"count",fill:"#8b5cf6",radius:[4,4,0,0],name:"Sessions"})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{className:"font-medium",children:"No duration data"})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:l("dashboard.training.awarenessByTheme")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-72",children:$.length>0?e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(Y,{data:$,layout:"vertical",margin:{left:10,right:20},children:[e.jsx(_,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(C,{type:"number",allowDecimals:!1,tick:{fontSize:11}}),e.jsx(N,{type:"category",dataKey:"name",tick:{fontSize:10},width:120}),e.jsx(v,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},formatter:(c,m,K)=>[`${c} sessions (${K.payload.participants} participants)`,"Count"]}),e.jsx(A,{dataKey:"value",radius:[0,4,4,0],children:$.map((c,m)=>e.jsx(te,{fill:c.color},`cell-${m}`))})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{className:"font-medium",children:"No awareness session data"})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:l("dashboard.training.trainingByType")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:T.length>0?e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(Ae,{children:[e.jsx($e,{data:T,cx:"50%",cy:"45%",innerRadius:40,outerRadius:70,paddingAngle:5,dataKey:"value",label:({value:c})=>c,labelLine:!1,children:T.map((c,m)=>e.jsx(te,{fill:c.color},`cell-${m}`))}),e.jsx(v,{formatter:(c,m)=>[c,m]}),e.jsx(F,{verticalAlign:"bottom",height:36,formatter:c=>e.jsx("span",{className:"text-sm",children:c})})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{className:"font-medium",children:"No type data"})})})})]})]}),y.totalSessions>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx(W,{title:l("dashboard.training.totalAwareness")||"TBT/TBM Sessions",value:y.totalSessions,icon:ae,color:"green",trend:`${y.totalParticipants} participants`}),e.jsx(W,{title:l("dashboard.training.awarenessParticipants")||"Awareness Participants",value:y.totalParticipants,icon:ae,color:"purple"}),e.jsx(W,{title:l("dashboard.training.awarenessHours")||"Awareness Hours",value:Math.round(y.totalHours||0),icon:Ne,color:"amber"})]})]})}),me={critical:"#dc2626",major:"#f59e0b",minor:"#3b82f6"},Z=n.memo(function({title:r,value:d,icon:i,color:a,trend:s}){const l={green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${l[a]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(i,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:r})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:d}),s&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:s})]})}),da=n.memo(function({kpiSummary:r,weeklyTrends:d,projectPerformance:i}){const a=E(),s=n.useMemo(()=>({totalInspections:r?.total_inspections||0,hseCompliance:Number(r?.avg_hse_compliance||0).toFixed(1),medicalCompliance:r?.medical_compliance||85,auditScore:r?.audit_score||88}),[r]),l=n.useMemo(()=>d?.map(y=>({week:y.week_label,inspections:y.inspections||0}))||[],[d]),b=n.useMemo(()=>d?.slice(0,8).map((y,o)=>({week:y.week_label,critical:Math.floor(Math.random()*2),major:Math.floor(Math.random()*4),minor:Math.floor(Math.random()*8)+2}))||[],[d]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Z,{title:a("dashboard.compliance.totalInspections"),value:s.totalInspections,icon:V,color:"green",trend:a("dashboard.compliance.completedThisYear")}),e.jsx(Z,{title:a("dashboard.compliance.hseCompliance"),value:`${s.hseCompliance}%`,icon:Se,color:"blue",trend:a("dashboard.compliance.avgScore")}),e.jsx(Z,{title:a("dashboard.compliance.medicalCompliance"),value:`${s.medicalCompliance}%`,icon:He,color:"purple",trend:a("dashboard.compliance.healthChecks")}),e.jsx(Z,{title:a("dashboard.compliance.auditScore"),value:`${s.auditScore}%`,icon:Ue,color:"amber",trend:a("dashboard.compliance.latestAudit")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a("dashboard.compliance.inspectionTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(re,{data:l,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"complianceGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#16a34a",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#16a34a",stopOpacity:.1})]})}),e.jsx(_,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(C,{dataKey:"week",tick:{fontSize:11}}),e.jsx(N,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(v,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(B,{type:"monotone",dataKey:"inspections",stroke:"#16a34a",fill:"url(#complianceGradient)",name:"Inspections"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a("dashboard.compliance.auditFindings")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(Y,{data:b,children:[e.jsx(_,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(C,{dataKey:"week",tick:{fontSize:11}}),e.jsx(N,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(v,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(F,{}),e.jsx(A,{dataKey:"critical",stackId:"a",fill:me.critical,name:"Critical"}),e.jsx(A,{dataKey:"major",stackId:"a",fill:me.major,name:"Major"}),e.jsx(A,{dataKey:"minor",stackId:"a",fill:me.minor,name:"Minor",radius:[4,4,0,0]})]})})})})]})]})]})}),j={water:"#0ea5e9",electricity:"#eab308",hse:"#22c55e",medical:"#8b5cf6",training:"#f59e0b",nearMiss:"#ef4444"},Q=n.memo(function({title:r,value:d,icon:i,color:a,trend:s,unit:l}){const b={blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400",yellow:"border-yellow-200 bg-yellow-50 dark:border-yellow-700 dark:bg-yellow-900/50 text-yellow-600 dark:text-yellow-400",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${b[a]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(i,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:r})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:[d,e.jsx("span",{className:"text-sm font-normal ml-1",children:l})]}),s&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:s})]})}),la=n.memo(function({kpiSummary:r,weeklyTrends:d}){const i=E(),a=n.useMemo(()=>({waterConsumption:r?.total_water_consumption||0,electricityUsage:r?.total_electricity_consumption||0,hseCompliance:Math.round(r?.avg_hse_compliance||0),medicalCompliance:Math.round(r?.avg_medical_compliance||0),trainingHours:Math.round(r?.total_training_hours||0),nearMisses:r?.total_near_misses||0,workPermits:r?.total_work_permits||0}),[r]),s=n.useMemo(()=>d?.map(o=>({week:o.week_label,water:o.water||0,electricity:o.electricity||0,training_hours:o.training_hours||0}))||[],[d]),l=n.useMemo(()=>d?.map(o=>({week:o.week_label,hse:o.hse_compliance||0,medical:o.medical_compliance||0}))||[],[d]),b=n.useMemo(()=>d?.map(o=>({week:o.week_label,near_misses:o.near_misses||0,accidents:o.accidents||0,inspections:o.inspections||0}))||[],[d]),y=n.useMemo(()=>[{name:i("dashboard.environmental.hseCompliance"),current:a.hseCompliance,target:95,color:j.hse},{name:i("dashboard.environmental.medicalCompliance"),current:a.medicalCompliance,target:95,color:j.medical}],[i,a]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Q,{title:i("dashboard.environmental.hseCompliance"),value:a.hseCompliance,icon:V,color:"green",unit:"%",trend:i("dashboard.environmental.yearToDate")}),e.jsx(Q,{title:i("dashboard.environmental.medicalCompliance"),value:a.medicalCompliance,icon:Ye,color:"purple",unit:"%",trend:i("dashboard.environmental.yearToDate")}),e.jsx(Q,{title:i("dashboard.environmental.waterConsumption"),value:a.waterConsumption.toLocaleString(),icon:Ve,color:"blue",unit:"mÂ³",trend:i("dashboard.environmental.yearToDate")}),e.jsx(Q,{title:i("dashboard.environmental.electricityUsage"),value:a.electricityUsage.toLocaleString(),icon:qe,color:"yellow",unit:"kWh",trend:i("dashboard.environmental.yearToDate")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i("dashboard.environmental.complianceTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(ge,{data:l,children:[e.jsx(_,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(C,{dataKey:"week",tick:{fontSize:11}}),e.jsx(N,{tick:{fontSize:11},domain:[0,100]}),e.jsx(v,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(F,{}),e.jsx(z,{type:"monotone",dataKey:"hse",stroke:j.hse,strokeWidth:2,dot:{fill:j.hse,r:3},name:i("dashboard.environmental.hseCompliance")}),e.jsx(z,{type:"monotone",dataKey:"medical",stroke:j.medical,strokeWidth:2,dot:{fill:j.medical,r:3},name:i("dashboard.environmental.medicalCompliance")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i("dashboard.environmental.waterVsElectricity")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(Ke,{data:s,children:[e.jsx(_,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(C,{dataKey:"week",tick:{fontSize:11}}),e.jsx(N,{yAxisId:"left",tick:{fontSize:11},stroke:j.water}),e.jsx(N,{yAxisId:"right",orientation:"right",tick:{fontSize:11},stroke:j.electricity}),e.jsx(v,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(F,{}),e.jsx(A,{yAxisId:"left",dataKey:"water",fill:j.water,name:"Water (mÂ³)",radius:[4,4,0,0]}),e.jsx(z,{yAxisId:"right",type:"monotone",dataKey:"electricity",stroke:j.electricity,strokeWidth:2,name:"Electricity (kWh)"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i("dashboard.environmental.safetyTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(re,{data:b,children:[e.jsx(_,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(C,{dataKey:"week",tick:{fontSize:11}}),e.jsx(N,{tick:{fontSize:11}}),e.jsx(v,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(F,{}),e.jsx(B,{type:"monotone",dataKey:"inspections",stroke:j.hse,fill:j.hse,fillOpacity:.6,name:i("dashboard.inspections")}),e.jsx(B,{type:"monotone",dataKey:"near_misses",stroke:j.training,fill:j.training,fillOpacity:.6,name:i("dashboard.nearMisses")}),e.jsx(B,{type:"monotone",dataKey:"accidents",stroke:j.nearMiss,fill:j.nearMiss,fillOpacity:.6,name:i("dashboard.accidents")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i("dashboard.environmental.complianceProgress")})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"space-y-6 py-4",children:[y.map((o,g)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:o.name}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[o.current,"% / ",o.target,"%"]})]}),e.jsxs("div",{className:"relative h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:[e.jsx("div",{className:"absolute h-full rounded-full transition-all duration-500",style:{width:`${Math.min(o.current,100)}%`,backgroundColor:o.color}}),e.jsx("div",{className:"absolute h-full w-0.5 bg-gray-800 dark:bg-gray-300",style:{left:`${o.target}%`},title:`Target: ${o.target}%`})]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:o.current>=o.target?`âœ“ ${i("dashboard.environmental.targetAchieved")}`:`${o.target-o.current}% ${i("dashboard.environmental.toTarget")}`})]},g)),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:a.trainingHours.toLocaleString()}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:i("dashboard.environmental.trainingHoursYTD")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:a.nearMisses}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:i("dashboard.environmental.nearMissesYTD")})]})]})})]})})]})]})]})});function ba(){const x=E(),[r,d]=n.useState(null),[i,a]=n.useState(!0),[s,l]=n.useState(new Date().getFullYear()),[b,y]=n.useState(new Date().getFullYear()-1),[o,g]=n.useState(null),[S,$]=n.useState(!1),[T,c]=n.useState("overview"),[m,K]=n.useState(null),[q,Re]=n.useState("all"),[D,be]=n.useState(null),ne=n.useRef(null),ie=We(),pe=n.useCallback(async()=>{try{a(!0);const t=await Ce(ke.getAdminDashboard,"/dashboard/admin",{year:s},3e4);d(t.data.data)}catch{oe.error("Failed to load dashboard data")}finally{a(!1)}},[s]),ue=n.useCallback(async()=>{if(!b){g(null);return}try{const t=await Ce(ke.getAdminDashboard,"/dashboard/admin",{year:b},3e4);g(t.data.data?.kpi_summary||{})}catch(t){console.error("Failed to load comparison dashboard data",t)}},[b]);n.useEffect(()=>{pe(),ue()},[pe,ue]),n.useEffect(()=>{y(s-1)},[s]);const fe=n.useCallback(async t=>{$(!0);try{const p=t==="excel"?await ve.exportExcel({year:s}):await ve.exportPdf({year:s}),u=new Blob([p.data],{type:t==="excel"?"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"application/pdf"}),w=window.URL.createObjectURL(u),M=document.createElement("a");M.href=w,M.download=`kpi_report_${s}.${t==="excel"?"xlsx":"pdf"}`,M.click(),window.URL.revokeObjectURL(w),oe.success("Report exported successfully")}catch{oe.error("Failed to export report")}finally{$(!1)}},[s]),L=n.useMemo(()=>r?.stats||{},[r?.stats]),f=n.useMemo(()=>r?.kpi_summary||{},[r?.kpi_summary]),P=n.useMemo(()=>r?.weekly_trends||[],[r?.weekly_trends]),G=n.useMemo(()=>r?.project_performance||[],[r?.project_performance]),de=n.useMemo(()=>r?.weekly_status||[],[r?.weekly_status]),Fe=n.useMemo(()=>r?.projects||[],[r?.projects]),De=n.useMemo(()=>r?.training_data||{},[r?.training_data]),Pe=n.useMemo(()=>r?.awareness_data||{},[r?.awareness_data]);n.useMemo(()=>r?.sor_data||{},[r?.sor_data]),n.useMemo(()=>r?.permit_data||{},[r?.permit_data]);const ze=n.useCallback(t=>{if(!t||!t.activeLabel)return;const p=t.activeLabel,u=P.find(w=>w.week_label===p);if(u){K(u);const w=new URLSearchParams;let M=u.week;if(!M&&typeof p=="string"){const H=parseInt(p.replace(/\D/g,""),10);Number.isNaN(H)||(M=H)}M&&w.set("week",M);const h=u.year||s;h&&w.set("year",h),ie(`/admin/kpi?${w.toString()}`)}},[P,s,ie]),Ie=n.useMemo(()=>[...Array(5)].map((t,p)=>new Date().getFullYear()-p),[]);return i?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(Je,{className:"w-8 h-8 animate-spin text-hse-primary"})}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:x("dashboard.adminTitle")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:x("dashboard.overview")})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 px-3 py-2",children:[e.jsx(Xe,{className:"w-4 h-4 text-gray-400"}),e.jsx("select",{value:s,onChange:t=>l(Number(t.target.value)),className:"bg-transparent border-none focus:ring-0 text-sm font-medium dark:text-gray-200",children:Ie.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>fe("excel"),disabled:S,className:"btn-secondary flex items-center gap-2",children:[e.jsx(Ze,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Excel"})]}),e.jsxs("button",{onClick:()=>fe("pdf"),disabled:S,className:"btn-secondary flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"PDF"})]})]})]})]}),e.jsx(ra,{activeTheme:T,onThemeChange:c}),T==="safety"&&e.jsx(na,{kpiSummary:f,weeklyTrends:P,projectPerformance:G}),T==="training"&&e.jsx(ia,{kpiSummary:f,weeklyTrends:P,projectPerformance:G,trainingData:De,awarenessData:Pe}),T==="compliance"&&e.jsx(da,{kpiSummary:f,weeklyTrends:P,projectPerformance:G}),T==="environmental"&&e.jsx(la,{kpiSummary:f,weeklyTrends:P}),T==="overview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(ee,{title:"Total Projects",value:L.total_projects||0,subtitle:`${L.active_projects||0} active`,icon:Qe,color:"blue"}),e.jsx(ee,{title:"Total Users",value:L.total_users||0,subtitle:`${L.active_users||0} active`,icon:ae,color:"green"}),e.jsx(ee,{title:"Pending Reports",value:L.pending_reports||0,subtitle:"Awaiting approval",icon:V,color:"amber"}),e.jsx(ee,{title:"Total Reports",value:L.total_reports||0,subtitle:`In ${s}`,icon:we,color:"purple"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(U,{title:"Total Accidents",value:f.total_accidents||0,icon:he,color:f.total_accidents>0?"red":"green",trend:f.fatal_accidents>0?`${f.fatal_accidents} fatal`:"No fatalities"}),e.jsx(U,{title:"Trainings",value:f.total_trainings||0,icon:se,color:"blue",trend:`${f.employees_trained||0} trained`}),e.jsx(U,{title:"Inspections",value:f.total_inspections||0,icon:V,color:"green"}),e.jsx(U,{title:"Avg TF Rate",value:Number(f.avg_tf||0).toFixed(2),icon:Me,color:"amber",trend:"Frequency Rate"}),e.jsx(U,{title:"Avg TG Rate",value:Number(f.avg_tg||0).toFixed(2),icon:Te,color:"purple",trend:"Severity Rate"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Weekly KPI Trends"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"h-80",children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(ge,{data:P,onClick:ze,children:[e.jsx(_,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(C,{dataKey:"week_label",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(N,{tick:{fontSize:12}}),e.jsx(v,{labelFormatter:t=>`Week ${t.replace("S","")}`}),e.jsx(F,{}),e.jsx(z,{type:"monotone",dataKey:"accidents",stroke:"#dc2626",strokeWidth:2,dot:{fill:"#dc2626",r:3},name:"Accidents"}),e.jsx(z,{type:"monotone",dataKey:"trainings",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:3},name:"Trainings"}),e.jsx(z,{type:"monotone",dataKey:"inspections",stroke:"#16a34a",strokeWidth:2,dot:{fill:"#16a34a",r:3},name:"Inspections"})]})})}),m&&e.jsxs("div",{className:"mt-4 text-xs text-gray-600 dark:text-gray-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("p",{className:"font-semibold",children:["Details for ",m.week_label]}),e.jsx("button",{type:"button",onClick:()=>ie("/admin/kpi"),className:"btn-secondary btn-sm",children:"View KPI reports"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Accidents"}),e.jsx("p",{className:"font-semibold",children:m.accidents??0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Trainings"}),e.jsx("p",{className:"font-semibold",children:m.trainings??0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Inspections"}),e.jsx("p",{className:"font-semibold",children:m.inspections??0})]})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"TF & TG Rates"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-80",children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(Ke,{data:P,children:[e.jsx(_,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(C,{dataKey:"week_label",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(N,{yAxisId:"left",tick:{fontSize:12},stroke:"#f59e0b",label:{value:"TF Rate",angle:-90,position:"insideLeft",style:{fill:"#f59e0b"}}}),e.jsx(N,{yAxisId:"right",orientation:"right",tick:{fontSize:12},stroke:"#8b5cf6",label:{value:"TG Rate",angle:90,position:"insideRight",style:{fill:"#8b5cf6"}}}),e.jsx(v,{labelFormatter:t=>`Week ${t.replace("S","")}`,formatter:(t,p)=>[Number(t).toFixed(4),p]}),e.jsx(F,{}),e.jsx(A,{yAxisId:"left",dataKey:"tf",fill:"#f59e0b",name:"TF Rate",radius:[4,4,0,0]}),e.jsx(A,{yAxisId:"right",dataKey:"tg",fill:"#8b5cf6",name:"TG Rate",radius:[4,4,0,0]})]})})})})]})]}),de.filter(t=>t.total_projects>0).length>0&&e.jsxs("div",{className:"card mt-6",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:x("dashboard.submissionStatus")}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("select",{value:q,onChange:t=>Re(t.target.value),className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg px-3 py-1.5 text-sm font-medium dark:text-gray-200 focus:ring-2 focus:ring-hse-primary",children:[e.jsx("option",{value:"all",children:x("common.allProjects")}),Fe.map(t=>e.jsxs("option",{value:t.id,children:[t.code," - ",t.name]},t.id))]})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>ne.current?.scrollBy({left:-300,behavior:"smooth"}),className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 bg-white/90 dark:bg-gray-700/90 hover:bg-white dark:hover:bg-gray-600 shadow-lg rounded-full p-2 border dark:border-gray-600",children:e.jsx(ea,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})}),e.jsx("button",{type:"button",onClick:()=>ne.current?.scrollBy({left:300,behavior:"smooth"}),className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 bg-white/90 dark:bg-gray-700/90 hover:bg-white dark:hover:bg-gray-600 shadow-lg rounded-full p-2 border dark:border-gray-600",children:e.jsx(aa,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})}),e.jsx("div",{ref:ne,className:"flex gap-2 overflow-x-auto scroll-smooth px-10 py-3 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",style:{scrollbarWidth:"thin"},children:(()=>{const t=xe(),p=s<t.year?52:t.week;return Array.from({length:p},(u,w)=>w+1)})().map(t=>{const p=de.find(R=>R.week===t),u=xe(),w=s<u.year||s===u.year&&t<u.week,M=t===u.week&&s===u.year;let h="not_submitted";const H=p?.projects||[];q==="all"?h=p?.status||"not_submitted":h=H.find(je=>je.project_id===parseInt(q))?.status||"not_submitted";const O=p?.approved_count||0,le=p?.submitted_count||0,ye=p?.draft_count||0,J=p?.total_projects||1;let ce="";if(h==="partial"&&J>0){const R=[];O>0&&R.push("rgb(34, 197, 94)"),le>0&&R.push("rgb(251, 191, 36)"),ye>0&&R.push("rgb(96, 165, 250)"),J-O-le-ye>0&&R.push("rgb(254, 202, 202)"),ce=R.length>1?`linear-gradient(135deg, ${R.join(", ")})`:""}return e.jsxs("div",{"data-week":t,className:`relative flex-shrink-0 w-14 p-2 rounded-lg text-center transition-all cursor-pointer ${D===t?"ring-2 ring-gray-900 ring-offset-2 scale-110":""} ${M&&D!==t?"ring-2 ring-hse-primary ring-offset-2":""} ${h==="approved"?"bg-green-500 text-white":h==="partial"?"text-white":h==="submitted"?"bg-amber-400 text-white":h==="draft"?"bg-blue-400 text-white":w?"bg-red-100 text-red-600 hover:bg-red-200":"bg-gray-100 text-gray-500"}`,style:h==="partial"&&ce?{background:ce}:{},onClick:()=>be(D===t?null:t),children:[e.jsxs("p",{className:"text-xs font-medium",children:[x("dashboard.weekShortPrefix"),t]}),q==="all"&&J>1?e.jsxs("p",{className:"text-xs font-bold mt-0.5",children:[O+le,"/",J]}):e.jsx("p",{className:"text-lg font-bold mt-0.5",children:h==="approved"?"âœ“":h==="partial"?"â—":h==="submitted"?"â³":h==="draft"?"ðŸ“":w?"!":"-"})]},`admin-week-${s}-${t}`)})})]}),D&&(()=>{const p=de.find(h=>h.week===D)?.projects||[],u=xe(),w=D===u.week&&s===u.year,M=s<u.year||s===u.year&&D<u.week;return p.length===0?null:e.jsxs("div",{className:"mt-3 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-700 pb-2 mb-2",children:[e.jsxs("p",{className:"font-semibold",children:[x("dashboard.weekDetailsTitle").replace("{{week}}",D),w&&e.jsxs("span",{className:"ml-2 text-hse-primary",children:["(",x("dashboard.currentWeekLabel"),")"]})]}),e.jsx("button",{type:"button",onClick:()=>be(null),className:"text-gray-400 hover:text-white",children:"âœ•"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:p.map(h=>{const O=h.status==="not_submitted"&&M;return e.jsxs("div",{className:"flex items-center justify-between gap-2 bg-gray-800 rounded px-2 py-1.5",children:[e.jsx("span",{className:"truncate font-medium",children:h.project_code}),e.jsx("span",{className:`flex-shrink-0 px-1.5 py-0.5 rounded text-[10px] font-medium ${h.status==="approved"?"bg-green-500":h.status==="submitted"?"bg-amber-400":h.status==="draft"?"bg-blue-400":O?"bg-red-400":"bg-gray-500"}`,children:h.status==="approved"?x("status.approved"):h.status==="submitted"?x("status.pending"):h.status==="draft"?x("status.draft"):x(O?"status.missing":"status.notSubmitted")})]},h.project_id)})})]})})(),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4 pt-4 mt-2 border-t dark:border-gray-700 text-xs text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-green-500"})," ",x("status.approved")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-gradient-to-br from-green-400 to-amber-400"})," ",x("status.partial")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-amber-400"})," ",x("status.pending")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-blue-400"})," ",x("status.draft")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-red-100 border border-red-200"})," ",x("status.missing")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded ring-2 ring-hse-primary ring-offset-1"})," ",x("dashboard.currentWeekLabel")]})]})]})]}),o&&e.jsxs("div",{className:"card mt-6",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:["Year-over-year summary (",s," vs ",b,")"]})}),e.jsxs("div",{className:"card-body grid grid-cols-1 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Total accidents"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[f.total_accidents??0," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["(",s,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[o.total_accidents??0," (",b,")"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Trainings"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[f.total_trainings??0," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["(",s,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[o.total_trainings??0," (",b,")"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Inspections"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[f.total_inspections??0," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["(",s,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[o.total_inspections??0," (",b,")"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Avg TF / TG"}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[(Number(f.avg_tf)||0).toFixed(2)," / ",(Number(f.avg_tg)||0).toFixed(2),e.jsxs("span",{className:"text-xs text-gray-400",children:[" (",s,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[(Number(o.avg_tf)||0).toFixed(2)," / ",(Number(o.avg_tg)||0).toFixed(2)," (",b,")"]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Project Performance"}),e.jsx(Le,{to:"/admin/projects",className:"text-sm text-hse-primary hover:underline",children:"View all projects"})]}),G.length===0?e.jsx("div",{className:"p-6 text-center text-sm text-gray-500 dark:text-gray-400",children:"No project data available."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 p-4 md:hidden",children:G.slice(0,5).map(t=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3 bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.code})]}),e.jsxs("div",{className:"text-right text-xs text-gray-600 dark:text-gray-300 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Reports:"})," ",t.reports_count]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Trainings:"})," ",t.total_trainings]})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-[11px] text-gray-600 dark:text-gray-300",children:[e.jsxs("span",{children:["Accidents:"," ",e.jsx("span",{className:t.total_accidents>0?"text-red-600 dark:text-red-400 font-semibold":"text-green-600 dark:text-green-400",children:t.total_accidents})]}),e.jsxs("span",{children:["TF: ",Number(t.avg_tf).toFixed(2)," â€¢ TG: ",Number(t.avg_tg).toFixed(2)]})]})]},t.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Project"}),e.jsx("th",{children:"Reports"}),e.jsx("th",{children:"Accidents"}),e.jsx("th",{children:"Trainings"}),e.jsx("th",{children:"Avg TF"}),e.jsx("th",{children:"Avg TG"})]})}),e.jsx("tbody",{children:G.slice(0,5).map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium dark:text-gray-100",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.code})]})}),e.jsx("td",{children:t.reports_count}),e.jsx("td",{children:e.jsx("span",{className:t.total_accidents>0?"text-red-600 dark:text-red-400 font-semibold":"text-green-600 dark:text-green-400",children:t.total_accidents})}),e.jsx("td",{children:t.total_trainings}),e.jsx("td",{children:Number(t.avg_tf).toFixed(2)}),e.jsx("td",{children:Number(t.avg_tg).toFixed(2)})]},t.id))})]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:x("dashboard.recentSubmissions")})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:r?.recent_reports?.filter(t=>t.status!=="draft").slice(0,5).map(t=>e.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:t.project?.name||"Unknown Project"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.report_month,"/",t.report_year," â€¢ Submitted by ",t.submitter?.name]})]}),e.jsx("span",{className:`badge ${t.status==="approved"?"badge-success":t.status==="submitted"?"badge-warning":t.status==="rejected"?"badge-danger":"badge-info"}`,children:t.status})]})},t.id))})]})]})]})}const ee=n.memo(function({title:r,value:d,subtitle:i,icon:a,color:s}){const l={blue:"bg-blue-50 text-blue-600",green:"bg-green-50 text-green-600",amber:"bg-amber-50 text-amber-600",purple:"bg-purple-50 text-purple-600",red:"bg-red-50 text-red-600"};return e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1",children:d}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:i})]}),e.jsx("div",{className:`p-3 rounded-lg ${l[s]}`,children:e.jsx(a,{className:"w-5 h-5"})})]})})}),U=n.memo(function({title:r,value:d,icon:i,color:a,trend:s}){const l={red:"border-red-200 bg-red-50 dark:border-red-700 dark:bg-red-900/50",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50",blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50"},b={red:"text-red-600 dark:text-red-400",green:"text-green-600 dark:text-green-400",blue:"text-blue-600 dark:text-blue-400",amber:"text-amber-600 dark:text-amber-400",purple:"text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${l[a]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(i,{className:`w-5 h-5 ${b[a]}`}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:r})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:d}),s&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:s})]})});export{ba as default};
