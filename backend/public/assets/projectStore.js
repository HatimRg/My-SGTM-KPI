import{c as D}from"./vendor-utils.js";import{u as P,i as m,D as c,p as f}from"./index.js";const w=D((e,i)=>({projects:[],isLoading:!1,hasLoaded:!1,error:null,lastScope:null,lastUserKey:null,fetchProjects:async(l,h={})=>{const{isLoading:L,hasLoaded:g,projects:n}=i(),r=P.getState?.()?.user,o=r?.role==="dev",j=o?m.getState?.()?.projectScope:null,t=o&&j===c.ASSIGNED?c.ASSIGNED:c.ALL,d=r?`${r.id??"na"}:${r.role??"na"}:${o?t:""}`:null,{lastUserKey:y,lastScope:p}=i(),u=y!==d;u&&e({projects:[],hasLoaded:!1,error:null,lastScope:null,lastUserKey:d});const A=o&&p&&p!==t;if(!h.force&&!u&&!A&&g&&n.length>0||L)return n;const a={...l||{}};o&&(t===c.ASSIGNED&&(a.scope="assigned"),e({lastScope:t})),e({isLoading:!0,error:null});try{if(Object.prototype.hasOwnProperty.call(a,"page")){const S=(await f.getAll(a)).data?.data??[];return e({projects:S,isLoading:!1,hasLoaded:!0}),S}const s=await f.getAllList(a);return e({projects:s,isLoading:!1,hasLoaded:!0}),s}catch(s){throw console.error("Failed to load projects:",s),e({error:s,isLoading:!1}),s}},setProjects:l=>e({projects:l}),reset:()=>e({projects:[],hasLoaded:!1,error:null,lastScope:null})}));export{w as u};
