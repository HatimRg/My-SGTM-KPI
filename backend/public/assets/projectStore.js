import{c as D}from"./vendor-utils.js";import{u as P,l as m,D as l,g as f}from"./index.js";const w=D((e,i)=>({projects:[],isLoading:!1,hasLoaded:!1,error:null,lastScope:null,lastUserKey:null,fetchProjects:async(c,g={})=>{const{isLoading:h,hasLoaded:L,projects:n}=i(),r=P.getState?.()?.user,o=r?.role==="dev",j=o?m.getState?.()?.projectScope:null,t=o&&j===l.ASSIGNED?l.ASSIGNED:l.ALL,d=r?`${r.id??"na"}:${r.role??"na"}:${o?t:""}`:null,{lastUserKey:y,lastScope:u}=i(),p=y!==d;p&&e({projects:[],hasLoaded:!1,error:null,lastScope:null,lastUserKey:d});const A=o&&u&&u!==t;if(!g.force&&!p&&!A&&L&&n.length>0||h)return n;const a={...c||{}};o&&(t===l.ASSIGNED&&(a.scope="assigned"),e({lastScope:t})),e({isLoading:!0,error:null});try{if(Object.prototype.hasOwnProperty.call(a,"page")){const S=(await f.getAll(a)).data?.data??[];return e({projects:S,isLoading:!1,hasLoaded:!0}),S}const s=await f.getAllList(a);return e({projects:s,isLoading:!1,hasLoaded:!0}),s}catch(s){throw console.error("Failed to load projects:",s),e({error:s,isLoading:!1}),s}},setProjects:c=>e({projects:c}),reset:()=>e({projects:[],hasLoaded:!1,error:null,lastScope:null})}));export{w as u};
