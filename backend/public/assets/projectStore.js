import{c as A}from"./vendor-utils.js";import{u as D,m as P,D as c,g as f}from"./index.js";const w=A((e,i)=>({projects:[],isLoading:!1,hasLoaded:!1,error:null,lastScope:null,lastUserKey:null,fetchProjects:async(l,g={})=>{const{isLoading:h,hasLoaded:L,projects:n}=i(),r=D.getState?.()?.user,o=r?.role==="dev",j=o?P.getState?.()?.projectScope:null,t=o&&j===c.ASSIGNED?c.ASSIGNED:c.ALL,d=r?`${r.id??"na"}:${r.role??"na"}:${o?t:""}`:null,{lastUserKey:y,lastScope:u}=i(),p=y!==d;p&&e({projects:[],hasLoaded:!1,error:null,lastScope:null,lastUserKey:d});const m=o&&u&&u!==t;if(!g.force&&!p&&!m&&L&&n.length>0||h)return n;const a={...l||{}};o&&(t===c.ASSIGNED&&(a.scope="assigned"),e({lastScope:t})),e({isLoading:!0,error:null});try{if(Object.prototype.hasOwnProperty.call(a,"page")){const S=(await f.getAll(a)).data?.data??[];return e({projects:S,isLoading:!1,hasLoaded:!0}),S}const s=await f.getAllList(a);return e({projects:s,isLoading:!1,hasLoaded:!0}),s}catch(s){throw console.error("Failed to load projects:",s),e({error:s,isLoading:!1}),s}},setProjects:l=>e({projects:l}),reset:()=>e({projects:[],hasLoaded:!1,error:null,lastScope:null})}));export{w as u};
