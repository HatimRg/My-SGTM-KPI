import{a as vr,u as kr,w as C,p as ts,j as e,v as jt,x as vt,m as Le,y as Me,z as Ee,A as Oe}from"./index.js";import{b as _r,u as wr,r as i}from"./vendor-react.js";import{D as L}from"./DatePicker.js";import{C as as}from"./ConfirmDialog.js";import{M as R}from"./Modal.js";import{S as h}from"./Select.js";import{A as ss}from"./AutocompleteInput.js";import{s as Nr,g as rs}from"./projectList.js";import{z as l,a9 as kt,ac as Sr,am as se,aA as Cr,U as is,i as _t,q as wt,ae as Wr,aI as qr,C as Tr,aj as re,v as y,aB as Dr,aD as Ar,B as Pr,P as ye,ax as Kr,h as ie,c as Ir,j as Lr,I as Ue,aJ as Nt,aK as Mr,k as Er}from"./vendor-ui.js";import"./vendor-utils.js";const St=[{value:"bypassing_safety_controls",labelKey:"workers.details.trainings.types.bypassing_safety_controls"},{value:"formation_coactivite",labelKey:"workers.details.trainings.types.formation_coactivite"},{value:"formation_coffrage_decoffrage",labelKey:"workers.details.trainings.types.formation_coffrage_decoffrage"},{value:"formation_conduite_defensive",labelKey:"workers.details.trainings.types.formation_conduite_defensive"},{value:"formation_analyse_des_risques",labelKey:"workers.details.trainings.types.formation_analyse_des_risques"},{value:"formation_elingage_manutention",labelKey:"workers.details.trainings.types.formation_elingage_manutention"},{value:"formation_ergonomie",labelKey:"workers.details.trainings.types.formation_ergonomie"},{value:"formation_excavations",labelKey:"workers.details.trainings.types.formation_excavations"},{value:"formation_outils_electroportatifs",labelKey:"workers.details.trainings.types.formation_outils_electroportatifs"},{value:"formation_epi",labelKey:"workers.details.trainings.types.formation_epi"},{value:"formation_environnement",labelKey:"workers.details.trainings.types.formation_environnement"},{value:"formation_espaces_confines",labelKey:"workers.details.trainings.types.formation_espaces_confines"},{value:"formation_flagman",labelKey:"workers.details.trainings.types.formation_flagman"},{value:"formation_jha",labelKey:"workers.details.trainings.types.formation_jha"},{value:"formation_line_of_fire",labelKey:"workers.details.trainings.types.formation_line_of_fire"},{value:"formation_manutention_manuelle",labelKey:"workers.details.trainings.types.formation_manutention_manuelle"},{value:"formation_manutention_mecanique",labelKey:"workers.details.trainings.types.formation_manutention_mecanique"},{value:"formation_point_chaud",labelKey:"workers.details.trainings.types.formation_point_chaud"},{value:"formation_produits_chimiques",labelKey:"workers.details.trainings.types.formation_produits_chimiques"},{value:"formation_risques_electriques",labelKey:"workers.details.trainings.types.formation_risques_electriques"},{value:"induction_hse",labelKey:"workers.details.trainings.types.induction_hse"},{value:"travail_en_hauteur",labelKey:"workers.details.trainings.types.travail_en_hauteur"},{value:"other",labelKey:"workers.details.trainings.types.other"}],Ct=[{value:"elingueur",labelKey:"workers.details.qualifications.types.elingueur"},{value:"equipier_premiere_intervention",labelKey:"workers.details.qualifications.types.equipier_premiere_intervention"},{value:"habilitation_electrique",labelKey:"workers.details.qualifications.types.habilitation_electrique"},{value:"inspecteur_echafaudage",labelKey:"workers.details.qualifications.types.inspecteur_echafaudage"},{value:"monteur_echafaudage",labelKey:"workers.details.qualifications.types.monteur_echafaudage"},{value:"monteur_grue_a_tour",labelKey:"workers.details.qualifications.types.monteur_grue_a_tour"},{value:"operateur_bulldozer",labelKey:"workers.details.qualifications.types.operateur_bulldozer"},{value:"operateur_chargeuse",labelKey:"workers.details.qualifications.types.operateur_chargeuse"},{value:"operateur_chariot_elevateur",labelKey:"workers.details.qualifications.types.operateur_chariot_elevateur"},{value:"operateur_compacteur",labelKey:"workers.details.qualifications.types.operateur_compacteur"},{value:"operateur_dumper",labelKey:"workers.details.qualifications.types.operateur_dumper"},{value:"operateur_grue_a_tour",labelKey:"workers.details.qualifications.types.operateur_grue_a_tour"},{value:"operateur_grue_mobile",labelKey:"workers.details.qualifications.types.operateur_grue_mobile"},{value:"operateur_niveleuse",labelKey:"workers.details.qualifications.types.operateur_niveleuse"},{value:"operateur_nacelle",labelKey:"workers.details.qualifications.types.operateur_nacelle"},{value:"operateur_pelle",labelKey:"workers.details.qualifications.types.operateur_pelle"},{value:"sst",labelKey:"workers.details.qualifications.types.sst"},{value:"soudeur",labelKey:"workers.details.qualifications.types.soudeur"},{value:"utilisation_meule",labelKey:"workers.details.qualifications.types.utilisation_meule"},{value:"other",labelKey:"workers.details.qualifications.types.other"}],ns=[{value:"embauche_reintegration",labelKey:"workers.details.medical.examNatures.embauche_reintegration"},{value:"visite_systematique",labelKey:"workers.details.medical.examNatures.visite_systematique"},{value:"surveillance_medical_special",labelKey:"workers.details.medical.examNatures.surveillance_medical_special"},{value:"visite_de_reprise",labelKey:"workers.details.medical.examNatures.visite_de_reprise"},{value:"visite_spontanee",labelKey:"workers.details.medical.examNatures.visite_spontanee"}],Or=[{value:"travaux_en_hauteur",labelKey:"workers.details.medical.ableToOptions.travaux_en_hauteur"},{value:"travaux_electrique",labelKey:"workers.details.medical.ableToOptions.travaux_electrique"},{value:"travaux_en_espace_confine",labelKey:"workers.details.medical.ableToOptions.travaux_en_espace_confine"},{value:"operateur",labelKey:"workers.details.medical.ableToOptions.operateur"},{value:"travaux_point_chaud",labelKey:"workers.details.medical.ableToOptions.travaux_point_chaud"}];function Xr(){const{t:a}=vr(),{user:Re}=kr(),$e=_r(),ls=wr(),Wt=i.useRef(null),qt=["hse_manager","responsable","supervisor","user"].includes(Re?.role),os=Re?.role==="hse_manager",Fe=i.useRef(0),Qe=i.useRef(null),Be=i.useRef(null),Tt=i.useRef(null),cs=t=>{const s=t?.training_type;if(!s)return"-";if(s==="other")return String(t?.training_label??"").trim()||a("workers.details.trainings.types.other");const r=St.find(n=>n.value===s);return r?.labelKey?a(r.labelKey):String(s)},ds=t=>{const s=t?.qualification_type;if(!s)return"-";if(s==="other")return String(t?.qualification_label??"").trim()||a("workers.details.qualifications.types.other");const r=Ct.find(n=>n.value===s);return r?.labelKey?a(r.labelKey):String(s)},ms=t=>{const s=t?.exam_nature;if(!s)return"-";const r=ns.find(n=>n.value===s);return r?.labelKey?a(r.labelKey):String(s)},ps=t=>{const s=t?.sanction_type;return s?a(`workers.details.sanctions.types.${s}`):"-"},[Dt,At]=i.useState(!1),[o,Pt]=i.useState(null),[I,z]=i.useState("trainings"),[Kt,ze]=i.useState([]),[us,It]=i.useState(!1),[Lt,He]=i.useState([]),[xs,Mt]=i.useState(!1),[Et,Ye]=i.useState([]),[gs,Ot]=i.useState(!1),[fe,Ve]=i.useState([]),[hs,Ut]=i.useState(!1),[be,Ge]=i.useState([]),[ys,Rt]=i.useState(!1),[Je,je]=i.useState([]),[fs,$t]=i.useState(!1),[Ft,ne]=i.useState(!1),[Qt,Bt]=i.useState(!1),[w,X]=i.useState({ppe_item_id:"",ppe_other:"",quantity:1,received_at:""}),[zt,le]=i.useState(!1),[Ht,Yt]=i.useState(!1),[m,$]=i.useState({sanction_date:"",sanction_type:"",reason:"",mise_a_pied_days:"",document:null}),[Vt,Gt]=i.useState(!1),[Jt,Xt]=i.useState(!1),[Xe,Zt]=i.useState(null),[bs,Ze]=i.useState(!1),[u,F]=i.useState({training_type:"",training_label:"",training_date:"",expiry_date:"",certificate:null}),[ea,ta]=i.useState(!1),[aa,sa]=i.useState(!1),[et,ra]=i.useState(null),[js,tt]=i.useState(!1),[d,M]=i.useState({qualification_type:"",qualification_level:"",qualification_label:"",start_date:"",expiry_date:"",certificate:null}),[ia,na]=i.useState(!1),[la,oa]=i.useState(!1),[at,ca]=i.useState(null),[vs,st]=i.useState(!1),[x,E]=i.useState({aptitude_status:"apte",exam_nature:"",able_to:[],exam_date:"",expiry_date:"",certificate:null}),[Z,ve]=i.useState(null),[ks,da]=i.useState(!1),[ma,pa]=i.useState(!1),oe=i.useRef(!1),[W,rt]=i.useState(null),[O,ke]=i.useState(null),[_s,it]=i.useState(!1),ee=i.useRef(!1),[H,ua]=i.useState([]),[ce,ws]=i.useState([]),[xa,Ns]=i.useState([]),[ga,Ss]=i.useState([]),[te,Cs]=i.useState(null),[Ws,ha]=i.useState(!0),[nt,b]=i.useState(1),[Ur,qs]=i.useState(1),[lt,Ts]=i.useState(0),[Ds]=i.useState(50),[de,As]=i.useState(""),[Q,Ps]=i.useState(""),[j,ya]=i.useState(""),[f,_e]=i.useState(""),[q,fa]=i.useState(""),[T,ba]=i.useState(""),[we,Ne]=i.useState(!1),ja=i.useRef(null),va=i.useRef(null),[v,ka]=i.useState(""),[Y,_a]=i.useState("has"),[k,wa]=i.useState(""),[V,Na]=i.useState("has"),[N,Sa]=i.useState(""),[D,Ca]=i.useState(""),[A,Wa]=i.useState(""),[Ks,qa]=i.useState([]),Ta=Re?.project_list_preference??"code",Se=i.useMemo(()=>Nr(ce,Ta),[ce,Ta]),Is=i.useMemo(()=>{const t=Array.isArray(Se)?Se:[];return j?t.filter(s=>s?.pole===j):t},[Se,j]),[G,Ce]=i.useState([]),[We,Da]=i.useState(!1),[Ls,Aa]=i.useState(!1),[Ms,qe]=i.useState(!1),[me,ot]=i.useState(null),[Pa,Ka]=i.useState(!1),[Ia,La]=i.useState(!1),[pe,Te]=i.useState(null),[ae,ct]=i.useState(null),[Es,De]=i.useState(!1),[p,P]=i.useState({nom:"",prenom:"",fonction:"",cin:"",date_naissance:"",entreprise:"",project_id:"",date_entree:"",is_active:!0});i.useEffect(()=>{Ma(),J()},[]),i.useEffect(()=>{const s=new URLSearchParams($e.search).get("worker_id"),r=s?String(s).trim():"";r&&(async()=>{try{const n=await C.getById(r),c=n.data?.data??n.data;c&&await ht(c)}catch{}finally{const n=new URLSearchParams($e.search);n.delete("worker_id"),ls({pathname:$e.pathname,search:n.toString()?`?${n.toString()}`:""},{replace:!0})}})()},[]),i.useEffect(()=>{Ae()},[nt,Q,f,q,T,j,v,Y,k,V,N,D,A]),i.useEffect(()=>{J()},[Q,f,q,T,j,v,Y,k,V,N,D,A]),i.useEffect(()=>{if(!we)return;const t=r=>{r.key==="Escape"&&Ne(!1)},s=r=>{const n=ja.current,c=va.current,g=r.target;n&&n.contains(g)||c&&c.contains(g)||Ne(!1)};return document.addEventListener("keydown",t),document.addEventListener("mousedown",s),()=>{document.removeEventListener("keydown",t),document.removeEventListener("mousedown",s)}},[we]),i.useEffect(()=>{(async()=>{try{const s=await ts.getPoles(),r=s.data?.data?.poles??s.data?.poles??[];qa(Array.isArray(r)?r:[])}catch{qa([])}})()},[]),i.useEffect(()=>{if(!j)return;!ce.some(s=>String(s.id)===String(f)&&s?.pole===j)&&f&&_e("")},[j,f,ce]),i.useEffect(()=>{const t=setTimeout(()=>{Ps(de)},300);return()=>clearTimeout(t)},[de]);const Ma=async()=>{try{const[t,s,r]=await Promise.all([ts.getAllList({status:"active"}),C.getEntreprises(),C.getFonctions()]);ws(Array.isArray(t)?t:[]),Ns(s.data.data??[]),Ss(r.data.data??[])}catch(t){console.error("Failed to load initial data:",t)}},J=async()=>{try{Be.current&&Be.current.abort();const t=new AbortController;Be.current=t;const s={search:Q||void 0,pole:j||void 0,project_id:f||void 0,entreprise:q||void 0,fonction:T||void 0,training_type:v||void 0,training_presence:v?Y:void 0,qualification_type:k||void 0,qualification_presence:k?V:void 0,medical_presence:N||void 0,medical_status:D||void 0,expired_filter:A||void 0,is_active:!0},r=await C.getStatistics(s,{signal:t.signal});Cs(r.data.data)}catch(t){if(t?.name==="CanceledError"||t?.name==="AbortError"||t?.code==="ERR_CANCELED")return}},Ae=async()=>{try{ha(!0),Qe.current&&Qe.current.abort();const t=new AbortController;Qe.current=t;const s=Fe.current+1;Fe.current=s;const r={page:nt,per_page:Ds,search:Q||void 0,pole:j||void 0,project_id:f||void 0,entreprise:q||void 0,fonction:T||void 0,training_type:v||void 0,training_presence:v?Y:void 0,qualification_type:k||void 0,qualification_presence:k?V:void 0,medical_presence:N||void 0,medical_status:D||void 0,expired_filter:A||void 0,is_active:!0},n=await C.getAll(r,{signal:t.signal});if(s!==Fe.current)return;const c=n.data,g=c.data??c,S=Array.isArray(g)?g:g?.data??[],B=c.meta??g.meta??g;ua(U=>{if(nt===1)return S;const _=[...U,...S],Ke=new Set;return _.filter(xe=>{const ge=xe?.id;if(ge==null)return!0;const Ie=String(ge);return Ke.has(Ie)?!1:(Ke.add(Ie),!0)})}),qs(B.last_page??1),Ts(B.total??S.length)}catch(t){if(t?.name==="CanceledError"||t?.name==="AbortError"||t?.code==="ERR_CANCELED")return;l.error(a("errors.somethingWentWrong"))}finally{ha(!1)}},Os=te?.hse_team??H.filter(t=>t.fonction?.toLowerCase().includes("hse")).length,Us=te?.induction_hse??0,Rs=te?.travail_en_hauteur??0,$s=te?.medical_aptitude??0,Ea=(t=null)=>{t?(ot(t),P({nom:t.nom??"",prenom:t.prenom??"",fonction:t.fonction??"",cin:t.cin?.toUpperCase()??"",date_naissance:t.date_naissance?.split("T")[0]??"",entreprise:t.entreprise??"",project_id:t.project_id??"",date_entree:t.date_entree?.split("T")[0]??"",is_active:t.is_active??!0})):(ot(null),P({nom:"",prenom:"",fonction:"",cin:"",date_naissance:"",entreprise:"",project_id:"",date_entree:"",is_active:!0})),Aa(!0)},dt=()=>{Aa(!1),ot(null)},Fs=async t=>{t.preventDefault(),Ka(!0);const s={...p,cin:p.cin?.toUpperCase()};try{me?(await C.update(me.id,s),l.success(a("workers.updated"))):(await C.create(s)).data.data?.merged?l.success(a("workers.merged")):l.success(a("workers.created")),dt(),Ae(),J()}catch(r){l.error(r.response?.data?.message??a("errors.somethingWentWrong"))}finally{Ka(!1)}},Qs=t=>{ct(t)},Bs=async()=>{if(ae)try{await C.delete(ae.id),l.success(a("workers.deactivated")),Ae(),J()}catch{l.error(a("errors.somethingWentWrong"))}finally{ct(null)}},zs=()=>{G.length!==0&&De(!0)},Hs=async()=>{if(G.length===0){De(!1);return}try{const t=await C.bulkDeactivate(G);l.success(a("workers.bulkDeactivated",{count:t.data.data.deactivated_count})),Ce([]),Da(!1),Ae(),J()}catch{l.error(a("errors.somethingWentWrong"))}finally{De(!1)}},Oa=async()=>{try{const t=await C.downloadTemplate(),s=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=s,r.setAttribute("download","workers_template.xlsx"),document.body.appendChild(r),r.click(),r.remove()}catch{l.error(a("errors.somethingWentWrong"))}},Ys=async()=>{try{const s={pole:j||void 0,project_id:f||void 0,entreprise:q||void 0,fonction:T||void 0,training_type:v||void 0,training_presence:v?Y:void 0,qualification_type:k||void 0,qualification_presence:k?V:void 0,medical_presence:N||void 0,medical_status:D||void 0,expired_filter:A||void 0,is_active:!0,search:Q||de||void 0},r=await C.export(s),n=r.data instanceof Blob?r.data:new Blob([r.data]),c=window.URL.createObjectURL(n),S=(r.headers?.["content-disposition"]??r.headers?.["Content-Disposition"])?.match(/filename\*=UTF-8''([^;]+)|filename="?([^";]+)"?/i),B=S?.[1]??S?.[2],U=B?decodeURIComponent(B):null,_=[];if(f){const es=ce.find(jr=>String(jr.id)===String(f))?.name;es&&_.push(es)}q&&_.push(q),T&&_.push(T),v&&_.push(`training:${v}-${Y}`),k&&_.push(`qualification:${k}-${V}`),N&&_.push(`medical:${N}${D?`-${D}`:""}`),A&&_.push(`expired:${A}`);const Ke=_.length?_.join(", "):"active",xe=new Date,ge=String(xe.getDate()).padStart(2,"0"),Ie=String(xe.getMonth()+1).padStart(2,"0"),xr=String(xe.getFullYear()),gr=`${ge}-${Ie}-${xr}`,hr=Ke.replace(/[\\/:*?"<>|]/g,"-").replace(/\s+/g," ").trim(),yr=(n.type?.includes("csv")?!0:!!n.type?.includes("text/plain"))?"csv":"xlsx",fr=`Workers_export_(${hr})_date(${gr}).${yr}`,br=U??fr,he=document.createElement("a");he.href=c,he.setAttribute("download",br),document.body.appendChild(he),he.click(),he.remove(),l.success(a("common.exportSuccess"))}catch(t){try{const s=t?.response?.data;if(s instanceof Blob&&s.type?.includes("application/json")){const r=await s.text(),n=JSON.parse(r);l.error(n?.message??a("errors.somethingWentWrong"));return}}catch{}l.error(t.response?.data?.message??a("errors.somethingWentWrong"))}},Vs=async()=>{if(pe){La(!0);try{const t=new FormData;t.append("file",pe),f&&t.append("project_id",f);const s=await C.import(t);l.success(a("workers.importSuccess",{imported:s.data.data.imported_count,merged:s.data.data.merged_count})),qe(!1),Te(null),b(1),ua([]),Ma()}catch(t){l.error(t.response?.data?.message??a("errors.somethingWentWrong"))}finally{La(!1)}}},Gs=t=>{Ce(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},Ua=()=>{Ce(We?[]:H.map(t=>t.id)),Da(!We)},K=t=>t?new Date(t).toLocaleDateString("fr-FR"):"-",Js=i.useMemo(()=>{const t={};for(const s of fe){const r=s?.ppe_item_id??s?.ppe_item?.id??s?.ppeItem?.id,n=s?.received_at;!r||!n||(!t[r]||new Date(n)>new Date(t[r]))&&(t[r]=n)}return t},[fe]),Ra=i.useMemo(()=>{const t=[...be].sort((n,c)=>{const g=n?.sanction_date?new Date(`${n.sanction_date}T00:00:00`).getTime():0,S=c?.sanction_date?new Date(`${c.sanction_date}T00:00:00`).getTime():0;return g!==S?g-S:Number(n?.id??0)-Number(c?.id??0)});let s=0;const r={};for(const n of t){if(n?.sanction_type==="mise_a_pied"){s=0;continue}n?.sanction_type==="avertissement"&&(s+=1,r[n.id]=s)}return r},[be]),mt=(t,s)=>{if(!t)return"";const r=new Date(`${t}T00:00:00`);if(Number.isNaN(r.getTime()))return"";r.setFullYear(r.getFullYear()+s);const n=r.getFullYear(),c=String(r.getMonth()+1).padStart(2,"0"),g=String(r.getDate()).padStart(2,"0");return`${n}-${c}-${g}`},Xs=t=>t?.id?`/api/worker-trainings/${t.id}/certificate/view`:null,$a=t=>t?.id?`/api/worker-trainings/${t.id}/certificate/download`:null,Zs=t=>t?.id?`/api/worker-qualifications/${t.id}/certificate/view`:null,Fa=t=>t?.id?`/api/worker-qualifications/${t.id}/certificate/download`:null,er=t=>t?.id?`/api/worker-medical-aptitudes/${t.id}/certificate/view`:null,Qa=t=>t?.id?`/api/worker-medical-aptitudes/${t.id}/certificate/download`:null,tr=t=>t?.id?`/api/worker-sanctions/${t.id}/document/view`:null,Ba=t=>t?.id?`/api/worker-sanctions/${t.id}/document/download`:null,za=t=>{if(!t||typeof t!="string")return null;if(t.startsWith("/api/"))return t.slice(4);if(t.startsWith("api/"))return t.slice(3);if(t.startsWith("/storage/"))return t;if(t.startsWith("storage/"))return`/${t}`;if(t.startsWith("http://")||t.startsWith("https://"))try{const s=new URL(t);if(s.pathname.startsWith("/storage/"))return`${s.pathname}${s.search}`}catch{}return t},ue=async(t,s="document.pdf")=>{if(t)try{const r=za(t),n=await Le.get(r,{responseType:"blob"}),c=n.data;let g=s;const S=n.headers?.["content-disposition"];if(typeof S=="string"){const _=/filename="?([^";]+)"?/i.exec(S);_&&_[1]&&(g=_[1])}const B=URL.createObjectURL(c),U=document.createElement("a");U.href=B,U.download=g,document.body.appendChild(U),U.click(),U.remove(),setTimeout(()=>URL.revokeObjectURL(B),1e3)}catch(r){l.error(r.response?.data?.message??a("errors.somethingWentWrong"))}},Ha=()=>{rt(null),it(!1),O&&ee.current&&URL.revokeObjectURL(O),ee.current=!1,ke(null)},Pe=async(t,s)=>{if(t)try{if(rt(s??{}),it(!0),O&&ee.current&&URL.revokeObjectURL(O),ee.current=!1,ke(null),typeof t=="string"&&t.startsWith("blob:")){ke(t);return}const r=za(t);let n;if(typeof r=="string"&&r.startsWith("/storage/")){const g=await fetch(r);if(!g.ok)throw new Error(`Failed to fetch: ${g.status}`);n=await g.blob()}else n=(await Le.get(r,{responseType:"blob"})).data;const c=URL.createObjectURL(n);ee.current=!0,ke(c)}catch(r){l.error(r.response?.data?.message??a("errors.somethingWentWrong")),rt(null)}finally{it(!1)}};i.useEffect(()=>()=>{O&&ee.current&&URL.revokeObjectURL(O)},[O]);const pt=async t=>{if(t)try{It(!0);const r=(await Me.getAll({worker_id:t,per_page:100})).data,n=r.data??r,c=Array.isArray(n)?n:n.data??[];ze(Array.isArray(c)?c:[])}catch(s){ze([]),l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{It(!1)}},ut=async t=>{if(t)try{Mt(!0);const r=(await Ee.getAll({worker_id:t,per_page:100})).data,n=r.data??r,c=Array.isArray(n)?n:n.data??[];He(Array.isArray(c)?c:[])}catch(s){He([]),l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Mt(!1)}},xt=async t=>{if(t)try{Ot(!0);const r=(await Oe.getAll({worker_id:t,per_page:100})).data,n=r.data??r,c=Array.isArray(n)?n:n.data??[];Ye(Array.isArray(c)?c:[])}catch(s){Ye([]),l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Ot(!1)}},Ya=async t=>{if(t)try{Ut(!0);const r=(await vt.getWorkerIssues(t)).data,n=r.data??r,c=Array.isArray(n)?n:n.data??[];Ve(Array.isArray(c)?c:[])}catch(s){Ve([]),l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Ut(!1)}},gt=async t=>{if(t)try{Rt(!0);const r=(await jt.getAll({worker_id:t,per_page:100})).data,n=r.data??r,c=Array.isArray(n)?n:n.data??[];Ge(Array.isArray(c)?c:[])}catch(s){Ge([]),l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Rt(!1)}},Va=async t=>{if(!t){je([]);return}try{$t(!0);const s=await vt.getItems({project_id:Number(t)});je(s.data?.data??[])}catch(s){je([]),l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{$t(!1)}},Ga=async t=>{if(t)try{da(!0),Z&&oe.current&&(URL.revokeObjectURL(Z),oe.current=!1),ve(null);const s=await Le.get(`/workers/${t}/image`,{responseType:"blob"}),r=URL.createObjectURL(s.data);oe.current=!0,ve(r)}catch{ve(null)}finally{da(!1)}},ar=async t=>{if(!(!o?.id||!t))try{pa(!0);const s=new FormData;s.append("image",t),await Le.post(`/workers/${o.id}/image`,s,{headers:{"Content-Type":"multipart/form-data"}}),await Ga(o.id),l.success(a("success.saved"))}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{pa(!1)}},ht=async t=>{t&&(Pt(t),At(!0),z("trainings"),await Promise.all([pt(t.id),ut(t.id),xt(t.id),Ya(t.id),gt(t.id),Va(t.project_id??t.project?.id),Ga(t.id)]))},sr=()=>{At(!1),Pt(null),z("trainings"),ze([]),He([]),Ye([]),Ve([]),Ge([]),je([]),ne(!1),X({ppe_item_id:"",ppe_other:"",quantity:1,received_at:""}),le(!1),$({sanction_date:"",sanction_type:"",reason:"",mise_a_pied_days:"",document:null}),Z&&oe.current&&URL.revokeObjectURL(Z),oe.current=!1,ve(null),Ha()},Ja=(t=null)=>{Zt(t),Ze(!1),F(t?{training_type:t.training_type??"",training_label:t.training_label??"",training_date:t.training_date??"",expiry_date:t.expiry_date??"",certificate:null}:{training_type:"",training_label:"",training_date:"",expiry_date:"",certificate:null}),Gt(!0)},yt=()=>{Gt(!1),Zt(null),Ze(!1),F({training_type:"",training_label:"",training_date:"",expiry_date:"",certificate:null})},rr=t=>{const s=t.target.files?.[0];if(s&&s.type!=="application/pdf"){l.error(a("workers.details.common.pdfOnly"));return}F(r=>({...r,certificate:s??null}))},Xa=(t=null)=>{ra(t),tt(!1),M(t?{qualification_type:t.qualification_type??"",qualification_level:t.qualification_level??"",qualification_label:t.qualification_label??"",start_date:t.start_date??"",expiry_date:t.expiry_date??"",certificate:null}:{qualification_type:"",qualification_level:"",qualification_label:"",start_date:"",expiry_date:"",certificate:null}),ta(!0)},ft=()=>{ta(!1),ra(null),tt(!1),M({qualification_type:"",qualification_level:"",qualification_label:"",start_date:"",expiry_date:"",certificate:null})},ir=t=>{const s=t.target.files?.[0];if(s&&s.type!=="application/pdf"){l.error(a("workers.details.common.pdfOnly"));return}M(r=>({...r,certificate:s??null}))},nr=async t=>{if(t.preventDefault(),!!o?.id&&!(!d.qualification_type||!d.start_date)&&!(d.qualification_type==="other"&&!String(d.qualification_label??"").trim())&&!(d.qualification_type==="habilitation_electrique"&&!String(d.qualification_level??"").trim())){sa(!0);try{const s={worker_id:o.id,qualification_type:d.qualification_type,qualification_level:d.qualification_type==="habilitation_electrique"?String(d.qualification_level??"").trim():void 0,qualification_label:d.qualification_type==="other"?String(d.qualification_label??"").trim():void 0,start_date:d.start_date,expiry_date:d.expiry_date?d.expiry_date:void 0,certificate:d.certificate?d.certificate:void 0};et?.id?await Ee.update(et.id,s):await Ee.create(s),l.success(a("success.saved")),ft(),await ut(o.id)}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{sa(!1)}}},lr=async t=>{if(t?.id)try{await Ee.delete(t.id),l.success(a("success.deleted")),o?.id&&await ut(o.id)}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}},Za=(t=null)=>{ca(t),st(!1),E(t?{aptitude_status:t.aptitude_status??"apte",exam_nature:t.exam_nature??"",able_to:Array.isArray(t.able_to)?t.able_to:[],exam_date:t.exam_date??"",expiry_date:t.expiry_date??"",certificate:null}:{aptitude_status:"apte",exam_nature:"",able_to:[],exam_date:"",expiry_date:"",certificate:null}),na(!0)},bt=()=>{na(!1),ca(null),st(!1),E({aptitude_status:"apte",exam_nature:"",able_to:[],exam_date:"",expiry_date:"",certificate:null})},or=t=>{const s=t.target.files?.[0];if(s&&s.type!=="application/pdf"){l.error(a("workers.details.common.pdfOnly"));return}E(r=>({...r,certificate:s??null}))},cr=t=>{E(s=>{const r=Array.isArray(s.able_to)?s.able_to:[];return r.includes(t)?{...s,able_to:r.filter(n=>n!==t)}:{...s,able_to:[...r,t]}})},dr=async t=>{if(t.preventDefault(),!!o?.id&&!(!x.exam_nature||!x.exam_date)){oa(!0);try{const s={worker_id:o.id,aptitude_status:x.aptitude_status,exam_nature:x.exam_nature,able_to:Array.isArray(x.able_to)?x.able_to:[],exam_date:x.exam_date,expiry_date:x.expiry_date?x.expiry_date:void 0,certificate:x.certificate?x.certificate:void 0};at?.id?await Oe.update(at.id,s):await Oe.create(s),l.success(a("success.saved")),bt(),await xt(o.id),J()}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{oa(!1)}}},mr=async t=>{if(t?.id)try{await Oe.delete(t.id),l.success(a("success.deleted")),o?.id&&await xt(o.id),J()}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}},pr=async t=>{if(t.preventDefault(),!!o?.id&&!(!u.training_type||!u.training_date)&&!(u.training_type==="other"&&!String(u.training_label??"").trim())){Xt(!0);try{const s={worker_id:o.id,training_type:u.training_type,training_label:u.training_type==="other"?String(u.training_label??"").trim():void 0,training_date:u.training_date,expiry_date:u.expiry_date?u.expiry_date:void 0,certificate:u.certificate?u.certificate:void 0};Xe?.id?(await Me.update(Xe.id,s),l.success(a("success.saved"))):(await Me.create(s),l.success(a("success.saved"))),yt(),await pt(o.id)}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Xt(!1)}}},ur=async t=>{if(t?.id)try{await Me.delete(t.id),l.success(a("success.deleted")),o?.id&&await pt(o.id)}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:a("workers.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:a("workers.subtitle")})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:Oa,className:"btn-outline btn-sm flex items-center gap-2",children:[e.jsx(kt,{className:"w-4 h-4"}),a("workers.downloadTemplate")]}),e.jsxs("button",{onClick:()=>qe(!0),className:"btn-outline btn-sm flex items-center gap-2",children:[e.jsx(Sr,{className:"w-4 h-4"}),a("workers.import")]}),e.jsxs("button",{onClick:Ys,className:"btn-outline btn-sm flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4"}),a("workers.export")]}),e.jsxs("button",{onClick:()=>Ea(),className:"btn-primary btn-sm flex items-center gap-2",children:[e.jsx(Cr,{className:"w-4 h-4"}),a("workers.addWorker")]})]})]}),te&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(is,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.totalWorkers")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:te.active})]})]}),e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-orange-100 dark:bg-orange-900/50 rounded-lg",children:e.jsx(_t,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.hseTeam")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:Os})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-emerald-100 dark:bg-emerald-900/50 rounded-lg",children:e.jsx(wt,{className:"w-5 h-5 text-emerald-600 dark:text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.stats.inductionHse")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:Us})]})]}),e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-purple-100 dark:bg-purple-900/50 rounded-lg",children:e.jsx(_t,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.stats.workAtHeight")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:Rs})]})]}),e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-sky-100 dark:bg-sky-900/50 rounded-lg",children:e.jsx(wt,{className:"w-5 h-5 text-sky-600 dark:text-sky-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.stats.medicalAptitude")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:$s})]})]})]})]}),e.jsx("div",{className:"card p-3 overflow-visible",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:max-w-md",children:[e.jsx(Wr,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:de,onChange:t=>{As(t.target.value),b(1)},placeholder:a("common.search"),className:"input pl-9 py-1.5 text-sm"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:ja,type:"button",onClick:()=>Ne(t=>!t),className:"btn-outline btn-sm flex items-center gap-2","aria-haspopup":"menu","aria-expanded":we,children:[e.jsx(qr,{className:"w-4 h-4"}),a("common.filter"),e.jsx(Tr,{className:"w-4 h-4"})]}),we&&e.jsxs("div",{ref:va,role:"menu",className:"absolute right-0 mt-2 w-[min(28rem,calc(100vw-2rem))] z-[60] card overflow-visible p-3 shadow-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.pole")}),e.jsxs(h,{value:j,onChange:t=>{ya(t.target.value),_e(""),b(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("common.allPoles")}),Ks.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.project")}),e.jsxs(h,{value:f,onChange:t=>{_e(t.target.value),b(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("workers.allProjects")}),Is.map(t=>e.jsx("option",{value:t.id,children:rs(t)},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.entreprise")}),e.jsxs(h,{value:q,onChange:t=>{fa(t.target.value),b(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("workers.allEntreprises")}),xa.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.fonction")}),e.jsxs(h,{value:T,onChange:t=>{ba(t.target.value),b(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("workers.allFonctions")}),ga.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsx("div",{className:"md:col-span-2 border-t border-gray-200 dark:border-gray-700 pt-3"}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.training")}),e.jsxs(h,{value:v,onChange:t=>{ka(t.target.value),b(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("common.all")}),St.filter(t=>t.value!=="other").map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.presence")}),e.jsxs(h,{value:Y,onChange:t=>{_a(t.target.value),b(1)},className:"py-1.5 text-sm",disabled:!v,children:[e.jsx("option",{value:"has",children:a("workers.filters.with")}),e.jsx("option",{value:"missing",children:a("workers.filters.without")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.qualification")}),e.jsxs(h,{value:k,onChange:t=>{wa(t.target.value),b(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("common.all")}),Ct.filter(t=>t.value!=="other").map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.presence")}),e.jsxs(h,{value:V,onChange:t=>{Na(t.target.value),b(1)},className:"py-1.5 text-sm",disabled:!k,children:[e.jsx("option",{value:"has",children:a("workers.filters.with")}),e.jsx("option",{value:"missing",children:a("workers.filters.without")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.medical")}),e.jsxs(h,{value:N,onChange:t=>{Sa(t.target.value),b(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("common.all")}),e.jsx("option",{value:"has",children:a("workers.filters.with")}),e.jsx("option",{value:"missing",children:a("workers.filters.without")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.medicalStatus")}),e.jsxs(h,{value:D,onChange:t=>{Ca(t.target.value),b(1)},className:"py-1.5 text-sm",disabled:!N||N==="missing",children:[e.jsx("option",{value:"",children:a("common.all")}),e.jsx("option",{value:"apte",children:a("workers.details.medical.apte")}),e.jsx("option",{value:"inapte",children:a("workers.details.medical.inapte")})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.expired")}),e.jsxs(h,{value:A,onChange:t=>{Wa(t.target.value),b(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("workers.filters.expiredAny")}),e.jsx("option",{value:"only_expired",children:a("workers.filters.expiredOnly")}),e.jsx("option",{value:"without_expired",children:a("workers.filters.expiredWithout")})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3 border-t border-gray-200 dark:border-gray-700 pt-3",children:[e.jsx("button",{type:"button",onClick:()=>{ya(""),_e(""),fa(""),ba(""),ka(""),_a("has"),wa(""),Na("has"),Sa(""),Ca(""),Wa(""),b(1)},className:"btn-outline btn-sm",children:a("common.reset")}),e.jsx("button",{type:"button",onClick:()=>Ne(!1),className:"btn-primary btn-sm",children:a("common.apply")})]})]})]})]})}),G.length>0&&e.jsxs("div",{className:"card p-2.5 flex items-center justify-between bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:We,onChange:Ua,className:"rounded border-red-300 text-red-600 focus:ring-red-500"}),e.jsxs("span",{className:"text-sm font-medium text-red-700 dark:text-red-300",children:[G.length," ",a("common.selected")]})]}),e.jsxs("button",{onClick:zs,className:"btn-danger btn-sm flex items-center gap-1.5 text-xs",children:[e.jsx(re,{className:"w-3.5 h-3.5"}),a("workers.bulkDeactivate")]})]}),e.jsxs("div",{className:"card overflow-hidden",children:[Ws?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(y,{className:"w-6 h-6 animate-spin text-hse-primary"})}):H.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-[14px]",children:[e.jsx("thead",{className:"text-[11px] uppercase tracking-wider text-gray-500 dark:text-gray-400",children:e.jsxs("tr",{className:"sticky top-0 z-10 bg-white/95 dark:bg-gray-900/95 backdrop-blur border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"w-12 px-3 py-3",children:e.jsx("input",{type:"checkbox",checked:We,onChange:Ua,className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-hse-primary focus:ring-hse-primary"})}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.nom")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.prenom")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.cin")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.fonction")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.entreprise")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.projet")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold whitespace-nowrap",children:a("workers.dateEntree")}),e.jsx("th",{className:"px-3 py-3 text-center font-semibold w-24",children:a("common.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-800",children:H.map((t,s)=>e.jsxs("tr",{role:"button",tabIndex:0,onClick:r=>{const n=r.target;n instanceof Element&&(n.closest("button")||n.closest("a")||n.closest("input"))||ht(t)},onKeyDown:r=>{r.key==="Enter"&&ht(t)},className:`${s%2===0?"bg-white dark:bg-gray-900":"bg-gray-50/60 dark:bg-gray-800/30"} hover:bg-hse-primary/5 dark:hover:bg-hse-primary/10 transition-colors cursor-pointer`,children:[e.jsx("td",{className:"px-3 py-2.5 align-middle",children:e.jsx("input",{type:"checkbox",checked:G.includes(t.id),onChange:r=>{r.stopPropagation(),Gs(t.id)},className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-hse-primary focus:ring-hse-primary"})}),e.jsx("td",{className:"px-3 py-2.5 font-medium text-gray-900 dark:text-gray-100 whitespace-nowrap",children:t.nom}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200 whitespace-nowrap",children:t.prenom}),e.jsx("td",{className:"px-3 py-2.5 font-mono text-gray-600 dark:text-gray-300 whitespace-nowrap",children:t.cin?.toUpperCase()}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200",children:t.fonction??""}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200",children:t.entreprise??""}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200",children:t.project?.name??""}),e.jsx("td",{className:"px-3 py-2.5 text-gray-600 dark:text-gray-300 whitespace-nowrap",children:K(t.date_entree)}),e.jsx("td",{className:"px-3 py-2.5 align-middle",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:r=>{r.stopPropagation(),Ea(t)},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 border border-transparent hover:border-gray-200 dark:hover:border-gray-600",title:a("common.edit"),children:e.jsx(Dr,{className:"w-4 h-4 text-gray-600 dark:text-gray-300"})}),e.jsx("button",{onClick:r=>{r.stopPropagation(),Qs(t)},className:"p-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 border border-transparent hover:border-red-200 dark:hover:border-red-800",title:a("workers.deactivate"),children:e.jsx(re,{className:"w-4 h-4 text-red-600 dark:text-red-400"})})]})})]},t.id))})]})}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(is,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:a("workers.noWorkers")})]}),(H.length>0?!0:lt>0)&&e.jsxs("div",{className:"px-3 py-2 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[a("pagination.showing")," ",H.length," ",a("pagination.of")," ",lt," ",a("pagination.results")]}),H.length<lt&&e.jsx("button",{onClick:()=>b(t=>t+1),className:"px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300",children:a("common.showMore")})]})]}),e.jsx(R,{isOpen:Ls,onClose:dt,title:a(me?"workers.editWorker":"workers.newWorker"),size:"lg",children:e.jsxs("form",{onSubmit:Fs,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("workers.nom")," *"]}),e.jsx("input",{type:"text",value:p.nom,onChange:t=>P({...p,nom:t.target.value}),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("workers.prenom")," *"]}),e.jsx("input",{type:"text",value:p.prenom,onChange:t=>P({...p,prenom:t.target.value}),className:"input",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("workers.cin")," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ar,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:p.cin,onChange:t=>P({...p,cin:t.target.value.toUpperCase()}),className:"input pl-10 uppercase",placeholder:"AB123456",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.fonction")}),e.jsx(ss,{value:p.fonction,onChange:t=>P({...p,fonction:t}),suggestions:ga,placeholder:a("workers.fonctionPlaceholder"),icon:e.jsx(_t,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.dateNaissance")}),e.jsx(L,{value:p.date_naissance,onChange:t=>P({...p,date_naissance:t}),placeholder:a("workers.selectDate")}),p.date_naissance&&(()=>{const t=new Date(p.date_naissance),s=new Date,r=s.getFullYear()-t.getFullYear(),n=s.getMonth()-t.getMonth();return(n<0||n===0&&s.getDate()<t.getDate()?r-1:r)<18?e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 font-semibold mt-1 flex items-center gap-1",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-red-500 rounded-full animate-pulse"}),a("workers.minAge")]}):null})()]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.dateEntree")}),e.jsx(L,{value:p.date_entree,onChange:t=>P({...p,date_entree:t}),placeholder:a("workers.selectDate")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.entreprise")}),e.jsx(ss,{value:p.entreprise,onChange:t=>P({...p,entreprise:t}),suggestions:xa,placeholder:a("workers.entreprisePlaceholder"),defaultValue:"SGTM",icon:e.jsx(Pr,{className:"w-4 h-4"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.projet")}),e.jsxs(h,{value:p.project_id,onChange:t=>P({...p,project_id:t.target.value}),children:[e.jsx("option",{value:"",children:a("common.select")}),Se.map(t=>e.jsx("option",{value:t.id,children:rs(t)},t.id))]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white text-sm",children:a("workers.status")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.statusHelp")})]}),e.jsx("button",{type:"button",onClick:()=>P({...p,is_active:!p.is_active}),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${p.is_active?"bg-green-500":"bg-gray-300 dark:bg-gray-600"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${p.is_active?"translate-x-6":"translate-x-1"}`})})]}),!me&&e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg text-sm text-blue-700 dark:text-blue-300",children:e.jsx("p",{children:a("workers.cinInfo")})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:dt,className:"btn-outline",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:Pa,className:"btn-primary flex items-center gap-2",children:[Pa&&e.jsx(y,{className:"w-4 h-4 animate-spin"}),a(me?"common.save":"workers.addWorker")]})]})]})}),Dt&&o&&e.jsx(R,{isOpen:Dt,onClose:sr,title:a("workers.details.title"),size:"full",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"min-w-0 flex flex-col justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:o.project?.name??"-"}),e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 truncate",children:[o.prenom," ",o.nom]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:o.fonction??"-"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 font-mono",children:o.cin?.toUpperCase()??"-"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:a("workers.entreprise")}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-medium",children:o.entreprise??"-"})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:a("workers.dateEntree")}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-medium",children:K(o.date_entree)})]})]})]}),e.jsxs("div",{className:"w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 overflow-hidden relative",children:[e.jsxs("div",{className:"absolute top-3 right-3 z-10 flex items-center gap-2",children:[e.jsx("input",{ref:Tt,type:"file",accept:"image/*",className:"hidden",onChange:t=>{const s=t.target.files?.[0];s&&(ar(s),t.target.value="")}}),e.jsxs("button",{type:"button",onClick:()=>Tt.current?.click(),className:"btn-outline btn-sm flex items-center gap-2",disabled:ma,children:[ma?e.jsx(y,{className:"w-4 h-4 animate-spin"}):e.jsx(ye,{className:"w-4 h-4"}),a("workers.details.image.add")]})]}),ks?e.jsx("div",{className:"w-full h-72 flex items-center justify-center",children:e.jsx(y,{className:"w-6 h-6 animate-spin text-hse-primary"})}):Z?e.jsx("div",{className:"w-full h-72 flex items-center justify-center p-2",children:e.jsx("img",{src:Z,alt:"",className:"max-w-full max-h-full object-contain"})}):e.jsxs("div",{className:"w-full h-72 flex flex-col items-center justify-center text-sm text-gray-500 dark:text-gray-400 gap-2",children:[e.jsx(Kr,{className:"w-8 h-8"}),e.jsx("span",{children:a("workers.details.noImage")})]})]})]}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{className:"px-4 pt-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex gap-2 -mb-px flex-wrap",children:[e.jsxs("button",{type:"button",onClick:()=>z("trainings"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${I==="trainings"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(ie,{className:"w-4 h-4"}),a("workers.details.tabs.trainings")]}),e.jsxs("button",{type:"button",onClick:()=>z("qualifications"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${I==="qualifications"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(Ir,{className:"w-4 h-4"}),a("workers.details.tabs.qualifications")]}),e.jsxs("button",{type:"button",onClick:()=>z("medical"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${I==="medical"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(wt,{className:"w-4 h-4"}),a("workers.details.tabs.medical")]}),e.jsxs("button",{type:"button",onClick:()=>z("ppe"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${I==="ppe"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(Lr,{className:"w-4 h-4"}),a("ppe.workerTab.title")]}),e.jsxs("button",{type:"button",onClick:()=>z("sanctions"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${I==="sanctions"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(ie,{className:"w-4 h-4"}),a("workers.details.tabs.sanctions")]})]})}),e.jsxs("div",{className:"p-4",children:[I==="trainings"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>Ja(null),children:[e.jsx(ye,{className:"w-4 h-4"}),a("common.add")]})}),us?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(y,{className:"w-6 h-6 animate-spin text-hse-primary"})}):Kt.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:a("workers.details.trainings.empty")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.trainings.type")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.startDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("common.actions")})]})}),e.jsx("tbody",{children:Kt.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("div",{className:"font-medium",children:cs(t)})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:K(t.training_date)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:K(t.expiry_date)}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Pe(Xs(t),{...t,download_url:$a(t)}),children:[e.jsx(Ue,{className:"w-4 h-4"}),a("common.view")]}),t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:s=>{s.stopPropagation(),ue($a(t),"certificate.pdf")},children:[e.jsx(se,{className:"w-4 h-4"}),a("common.download")]}),e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Ja(t),children:[e.jsx(Nt,{className:"w-4 h-4"}),a("common.edit")]}),e.jsxs("button",{type:"button",className:"btn-danger btn-sm flex items-center gap-2",onClick:()=>ur(t),children:[e.jsx(re,{className:"w-4 h-4"}),a("common.delete")]})]})})]},t.id))})]})})]}),I==="qualifications"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>Xa(null),children:[e.jsx(ye,{className:"w-4 h-4"}),a("common.add")]})}),xs?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(y,{className:"w-6 h-6 animate-spin text-hse-primary"})}):Lt.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:a("workers.details.qualifications.empty")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.qualifications.type")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.startDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("common.actions")})]})}),e.jsx("tbody",{children:Lt.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[e.jsx("span",{children:ds(t)}),t.qualification_type==="habilitation_electrique"&&t.qualification_level?e.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200",children:t.qualification_level}):null]})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:K(t.start_date)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:K(t.expiry_date)}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Pe(Zs(t),{...t,download_url:Fa(t)}),children:[e.jsx(Ue,{className:"w-4 h-4"}),a("common.view")]}),t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:s=>{s.stopPropagation(),ue(Fa(t),"certificate.pdf")},children:[e.jsx(se,{className:"w-4 h-4"}),a("common.download")]}),e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Xa(t),children:[e.jsx(Nt,{className:"w-4 h-4"}),a("common.edit")]}),e.jsxs("button",{type:"button",className:"btn-danger btn-sm flex items-center gap-2",onClick:()=>lr(t),children:[e.jsx(re,{className:"w-4 h-4"}),a("common.delete")]})]})})]},t.id))})]})})]}),I==="medical"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>Za(null),children:[e.jsx(ye,{className:"w-4 h-4"}),a("common.add")]})}),gs?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(y,{className:"w-6 h-6 animate-spin text-hse-primary"})}):Et.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:a("workers.details.medical.empty")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.medical.status")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.medical.examNature")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.startDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("common.actions")})]})}),e.jsx("tbody",{children:Et.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-semibold ${t.aptitude_status==="apte"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300"}`,children:t.aptitude_status==="apte"?a("workers.details.medical.apte"):a("workers.details.medical.inapte")})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:ms(t)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:K(t.exam_date)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:K(t.expiry_date)}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Pe(er(t),{...t,download_url:Qa(t)}),children:[e.jsx(Ue,{className:"w-4 h-4"}),a("common.view")]}),t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:s=>{s.stopPropagation(),ue(Qa(t),"certificate.pdf")},children:[e.jsx(se,{className:"w-4 h-4"}),a("common.download")]}),e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Za(t),children:[e.jsx(Nt,{className:"w-4 h-4"}),a("common.edit")]}),e.jsxs("button",{type:"button",className:"btn-danger btn-sm flex items-center gap-2",onClick:()=>mr(t),children:[e.jsx(re,{className:"w-4 h-4"}),a("common.delete")]})]})})]},t.id))})]})})]}),I==="ppe"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>{o?.id&&(X({ppe_item_id:"",ppe_other:"",quantity:1,received_at:new Date().toISOString().slice(0,10)}),ne(!0))},children:[e.jsx(Mr,{className:"w-4 h-4"}),a("ppe.workerTab.issueButton")]})}),e.jsxs("div",{className:"card p-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:a("ppe.workerTab.lastIssuedTitle")}),fs?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(y,{className:"w-5 h-5 animate-spin text-hse-primary"})}):Je.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2",children:a("common.noData")}):e.jsx("div",{className:"overflow-x-auto mt-2",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.item")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.items.stock")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.receivedAt")})]})}),e.jsx("tbody",{children:[...Je].sort((t,s)=>String(t?.name??"").localeCompare(String(s?.name??""))).map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("div",{className:"font-medium",children:t.name})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200 font-mono",children:t.stock_quantity??0}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:K(Js[t.id])})]},t.id))})]})})]}),e.jsxs("div",{className:"card p-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:a("ppe.workerTab.title")}),hs?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(y,{className:"w-5 h-5 animate-spin text-hse-primary"})}):fe.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2",children:a("ppe.workerTab.empty")}):e.jsx("div",{className:"overflow-x-auto mt-2",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.item")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.quantity")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.receivedAt")})]})}),e.jsx("tbody",{children:fe.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("div",{className:"font-medium",children:t.ppe_item?.name??t.ppeItem?.name??"-"})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200 font-mono",children:t.quantity??1}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:K(t.received_at)})]},t.id))})]})})]})]}),I==="sanctions"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:qt&&e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>{$({sanction_date:new Date().toISOString().slice(0,10),sanction_type:"",reason:"",mise_a_pied_days:"",document:null}),le(!0)},children:[e.jsx(ye,{className:"w-4 h-4"}),a("common.add")]})}),ys?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(y,{className:"w-6 h-6 animate-spin text-hse-primary"})}):be.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:a("workers.details.sanctions.empty")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.sanctions.date")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.sanctions.type")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("common.project")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.sanctions.reason")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("common.actions")})]})}),e.jsx("tbody",{children:[...be].sort((t,s)=>{const r=t?.sanction_date?new Date(`${t.sanction_date}T00:00:00`).getTime():0,n=s?.sanction_date?new Date(`${s.sanction_date}T00:00:00`).getTime():0;return r!==n?n-r:Number(s?.id??0)-Number(t?.id??0)}).map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200 whitespace-nowrap",children:K(t.sanction_date)}),e.jsxs("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:[e.jsx("div",{className:"font-medium",children:ps(t)}),t.sanction_type==="mise_a_pied"&&t.mise_a_pied_days?e.jsxs("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:[t.mise_a_pied_days,"j"]}):null,t.sanction_type==="avertissement"&&Ra[t.id]?e.jsxs("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:[a("workers.details.sanctions.successiveAvertissement")," ",Ra[t.id]]}):null]}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:t.project?.name??"-"}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:t.reason??""}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.document_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Pe(tr(t),{...t,download_url:Ba(t)}),children:[e.jsx(Ue,{className:"w-4 h-4"}),a("common.view")]}),t.document_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:s=>{s.stopPropagation(),ue(Ba(t),"document.pdf")},children:[e.jsx(se,{className:"w-4 h-4"}),a("common.download")]}),os&&e.jsxs("button",{type:"button",className:"btn-danger btn-sm flex items-center gap-2",onClick:async()=>{if(!(!t?.id||!o?.id))try{await jt.delete(t.id),l.success(a("success.deleted")),await gt(o.id)}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}},children:[e.jsx(re,{className:"w-4 h-4"}),a("common.delete")]})]})})]},t.id))})]})})]})]})]})]})}),Ft&&o&&e.jsx(R,{isOpen:Ft,onClose:()=>ne(!1),title:a("ppe.issue.title"),size:"lg",children:e.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),!!o?.id){if(!w.ppe_item_id&&!String(w.ppe_other??"").trim()){l.error(a("ppe.issue.chooseItem"));return}try{Bt(!0),await vt.issueToWorker({worker_id:Number(o.id),ppe_item_id:w.ppe_item_id?Number(w.ppe_item_id):void 0,ppe_name:w.ppe_item_id?void 0:String(w.ppe_other??"").trim(),quantity:Number(w.quantity??1),received_at:w.received_at}),l.success(a("ppe.issue.success")),ne(!1),await Promise.all([Ya(o.id),Va(o.project_id??o.project?.id)])}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Bt(!1)}}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("ppe.issue.item")}),e.jsxs(h,{value:w.ppe_item_id,onChange:t=>X(s=>({...s,ppe_item_id:t.target.value,ppe_other:""})),children:[e.jsx("option",{value:"",children:a("ppe.issue.other")}),[...Je].sort((t,s)=>String(t?.name??"").localeCompare(String(s?.name??""))).map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.stock_quantity??0,")"]},t.id))]}),!w.ppe_item_id&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"label text-xs",children:a("ppe.issue.otherSpecify")}),e.jsx("input",{className:"input",value:w.ppe_other,onChange:t=>X(s=>({...s,ppe_other:t.target.value})),placeholder:a("ppe.issue.otherPlaceholder")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("ppe.issue.quantity")}),e.jsx("input",{type:"number",min:1,className:"input",value:w.quantity,onChange:t=>X(s=>({...s,quantity:t.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("ppe.issue.receivedAt")}),e.jsx(L,{value:w.received_at,onChange:t=>X(s=>({...s,received_at:t})),required:!0})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>ne(!1),className:"btn-outline btn-sm",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:Qt,className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[Qt&&e.jsx(y,{className:"w-4 h-4 animate-spin"}),a("ppe.issue.submit")]})]})]})}),zt&&o&&qt&&e.jsx(R,{isOpen:zt,onClose:()=>le(!1),title:a("workers.details.sanctions.addTitle"),size:"lg",children:e.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),!!o?.id&&!(!m.sanction_date||!m.sanction_type||!String(m.reason??"").trim())&&!(m.sanction_type==="mise_a_pied"&&!Number(m.mise_a_pied_days))&&m.document)try{Yt(!0),await jt.create({worker_id:o.id,sanction_date:m.sanction_date,sanction_type:m.sanction_type,reason:String(m.reason??"").trim(),mise_a_pied_days:m.sanction_type==="mise_a_pied"?Number(m.mise_a_pied_days):void 0,document:m.document}),l.success(a("success.saved")),le(!1),$({sanction_date:"",sanction_type:"",reason:"",mise_a_pied_days:"",document:null}),await gt(o.id)}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Yt(!1)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.sanctions.date")}),e.jsx(L,{value:m.sanction_date,onChange:t=>$(s=>({...s,sanction_date:t})),placeholder:a("workers.selectDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.sanctions.type")}),e.jsxs(h,{value:m.sanction_type,onChange:t=>$(s=>({...s,sanction_type:t.target.value})),children:[e.jsx("option",{value:"",children:a("common.select")}),e.jsx("option",{value:"mise_a_pied",children:a("workers.details.sanctions.types.mise_a_pied")}),e.jsx("option",{value:"avertissement",children:a("workers.details.sanctions.types.avertissement")}),e.jsx("option",{value:"rappel_a_lordre",children:a("workers.details.sanctions.types.rappel_a_lordre")}),e.jsx("option",{value:"blame",children:a("workers.details.sanctions.types.blame")})]})]}),m.sanction_type==="mise_a_pied"&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.sanctions.miseAPiedDays")}),e.jsx("input",{type:"number",min:1,className:"input",value:m.mise_a_pied_days,onChange:t=>$(s=>({...s,mise_a_pied_days:t.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.sanctions.reason")}),e.jsx("textarea",{className:"input min-h-[96px]",value:m.reason,onChange:t=>$(s=>({...s,reason:t.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.sanctions.document")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:m.document?m.document.name:a("workers.details.common.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",className:"hidden",onChange:t=>{const s=t.target.files?.[0];if(s&&s.type!=="application/pdf"){l.error(a("workers.details.common.pdfOnly"));return}$(r=>({...r,document:s??null}))}})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>le(!1),className:"btn-outline btn-sm",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:Ht||!m.sanction_date||!m.sanction_type||!String(m.reason??"").trim()||m.sanction_type==="mise_a_pied"&&!Number(m.mise_a_pied_days)||!m.document,className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[Ht&&e.jsx(y,{className:"w-4 h-4 animate-spin"}),a("common.save")]})]})]})}),ea&&e.jsx(R,{isOpen:ea,onClose:ft,title:a(et?"common.edit":"workers.details.qualifications.addTitle"),size:"lg",children:e.jsxs("form",{onSubmit:nr,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.qualifications.type")}),e.jsxs(h,{value:d.qualification_type,onChange:t=>{const s=t.target.value;M(r=>({...r,qualification_type:s}))},children:[e.jsx("option",{value:"",children:a("common.select")}),Ct.map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),d.qualification_type==="habilitation_electrique"&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.qualifications.level")}),e.jsx("input",{className:"input",value:d.qualification_level,onChange:t=>M(s=>({...s,qualification_level:t.target.value})),placeholder:a("workers.details.qualifications.levelPlaceholder")})]}),d.qualification_type==="other"&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.qualifications.otherLabel")}),e.jsx("input",{className:"input",value:d.qualification_label,onChange:t=>M(s=>({...s,qualification_label:t.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.startDate")}),e.jsx(L,{value:d.start_date,onChange:t=>{M(s=>{const r={...s,start_date:t};return js||(r.expiry_date=t?mt(t,1):""),r})},placeholder:a("workers.details.common.startDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.endDate")}),e.jsx(L,{value:d.expiry_date,onChange:t=>{tt(!0),M(s=>({...s,expiry_date:t}))},placeholder:a("workers.details.common.endDate")}),e.jsx("div",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDateAutoHelp")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.file")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:d.certificate?d.certificate.name:a("workers.details.common.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:ir,className:"hidden"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:ft,className:"btn-outline btn-sm",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:aa||!d.qualification_type||!d.start_date||d.qualification_type==="other"&&!String(d.qualification_label??"").trim()||d.qualification_type==="habilitation_electrique"&&!String(d.qualification_level??"").trim(),className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[aa&&e.jsx(y,{className:"w-4 h-4 animate-spin"}),a("common.save")]})]})]})}),ia&&e.jsx(R,{isOpen:ia,onClose:bt,title:a(at?"common.edit":"workers.details.medical.addTitle"),size:"lg",children:e.jsxs("form",{onSubmit:dr,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("div",{children:e.jsx("label",{className:"font-medium text-gray-900 dark:text-white text-sm",children:a("workers.details.medical.status")})}),e.jsx("button",{type:"button",onClick:()=>E(t=>({...t,aptitude_status:t.aptitude_status==="apte"?"inapte":"apte"})),className:`relative inline-flex h-6 w-14 items-center rounded-full transition-colors ${x.aptitude_status==="apte"?"bg-green-500":"bg-red-500"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${x.aptitude_status==="apte"?"translate-x-8":"translate-x-1"}`})})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:x.aptitude_status==="apte"?a("workers.details.medical.apte"):a("workers.details.medical.inapte")}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.medical.examNature")}),e.jsxs(h,{value:x.exam_nature,onChange:t=>E(s=>({...s,exam_nature:t.target.value})),children:[e.jsx("option",{value:"",children:a("common.select")}),ns.map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.medical.ableTo")}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:Or.map(t=>e.jsxs("label",{className:"flex items-center gap-2 p-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900",children:[e.jsx("input",{type:"checkbox",checked:Array.isArray(x.able_to)&&x.able_to.includes(t.value),onChange:()=>cr(t.value),className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-hse-primary focus:ring-hse-primary"}),e.jsx("span",{className:"text-xs text-gray-700 dark:text-gray-200",children:a(t.labelKey)})]},t.value))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.startDate")}),e.jsx(L,{value:x.exam_date,onChange:t=>{E(s=>{const r={...s,exam_date:t};return vs||(r.expiry_date=t?mt(t,1):""),r})},placeholder:a("workers.details.common.startDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.endDate")}),e.jsx(L,{value:x.expiry_date,onChange:t=>{st(!0),E(s=>({...s,expiry_date:t}))},placeholder:a("workers.details.common.endDate")}),e.jsx("div",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDateAutoHelp")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.file")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:x.certificate?x.certificate.name:a("workers.details.common.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:or,className:"hidden"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:bt,className:"btn-outline btn-sm",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:la||!x.exam_nature||!x.exam_date,className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[la&&e.jsx(y,{className:"w-4 h-4 animate-spin"}),a("common.save")]})]})]})}),Vt&&e.jsx(R,{isOpen:Vt,onClose:yt,title:a(Xe?"common.edit":"workers.details.trainings.addTitle"),size:"lg",children:e.jsxs("form",{onSubmit:pr,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.trainings.type")}),e.jsxs(h,{value:u.training_type,onChange:t=>{const s=t.target.value;F(r=>({...r,training_type:s}))},children:[e.jsx("option",{value:"",children:a("common.select")}),St.map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),u.training_type==="other"&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.trainings.otherLabel")}),e.jsx("input",{className:"input",value:u.training_label,onChange:t=>F(s=>({...s,training_label:t.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.startDate")}),e.jsx(L,{value:u.training_date,onChange:t=>{F(s=>{const r={...s,training_date:t};return bs||(r.expiry_date=t?mt(t,1):""),r})},placeholder:a("workers.details.common.startDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.endDate")}),e.jsx(L,{value:u.expiry_date,onChange:t=>{Ze(!0),F(s=>({...s,expiry_date:t}))},placeholder:a("workers.details.common.endDate")}),e.jsx("div",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDateAutoHelp")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.file")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:u.certificate?u.certificate.name:a("workers.details.common.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:rr,className:"hidden"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:yt,className:"btn-outline btn-sm",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:Jt||!u.training_type||!u.training_date||u.training_type==="other"&&!String(u.training_label??"").trim(),className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[Jt&&e.jsx(y,{className:"w-4 h-4 animate-spin"}),a("common.save")]})]})]})}),W&&e.jsx(R,{isOpen:!!W,onClose:Ha,title:a("common.view"),size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[70vh]",children:_s?e.jsx("div",{className:"w-full h-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 flex items-center justify-center",children:e.jsx(y,{className:"w-6 h-6 animate-spin text-hse-primary"})}):O?e.jsx("iframe",{src:O,title:a("common.view"),className:"w-full h-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white"}):e.jsx("div",{className:"w-full h-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 flex items-center justify-center text-sm text-gray-500 dark:text-gray-400",children:a("errors.somethingWentWrong")})}),typeof W?.download_url=="string"&&W.download_url||typeof W?.certificate_url=="string"&&W.certificate_url||typeof W?.document_url=="string"&&W.document_url?e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn-primary inline-flex items-center gap-2 text-sm",onClick:()=>ue(W.download_url??W.certificate_url??W.document_url,"document.pdf"),children:[e.jsx(se,{className:"w-4 h-4"}),a("common.download")]})}):null]})}),e.jsx(R,{isOpen:Ms,onClose:()=>qe(!1),title:a("workers.importTitle"),size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a("workers.importHelp")}),e.jsxs("button",{onClick:Oa,className:"w-full btn-outline flex items-center justify-center gap-2",children:[e.jsx(kt,{className:"w-4 h-4"}),a("workers.downloadTemplate")]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center",children:[e.jsx("input",{ref:Wt,type:"file",accept:".xlsx,.xls,.csv",onChange:t=>Te(t.target.files[0]),className:"hidden"}),pe?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(kt,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:pe.name}),e.jsx("button",{type:"button",onClick:()=>Te(null),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:e.jsx(Er,{className:"w-4 h-4"})})]}):e.jsx("button",{type:"button",onClick:()=>Wt.current?.click(),className:"text-hse-primary hover:underline",children:a("workers.selectFile")})]}),e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg text-sm text-amber-700 dark:text-amber-300",children:e.jsx("p",{children:a("workers.cinInfo")})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>{qe(!1),Te(null)},className:"btn-outline",children:a("common.cancel")}),e.jsxs("button",{type:"button",onClick:Vs,disabled:!pe||Ia,className:"btn-primary flex items-center gap-2",children:[Ia&&e.jsx(y,{className:"w-4 h-4 animate-spin"}),a("workers.import")]})]})]})}),e.jsx(as,{isOpen:!!ae,title:a("common.confirm"),message:ae?a("workers.confirmDeactivate",{name:`${ae.prenom} ${ae.nom}`}):"",confirmLabel:a("workers.deactivate"),cancelLabel:a("common.cancel"),variant:"danger",onConfirm:Bs,onCancel:()=>ct(null)}),e.jsx(as,{isOpen:Es,title:a("common.confirm"),message:a("workers.confirmBulkDeactivate",{count:G.length}),confirmLabel:a("workers.bulkDeactivate"),cancelLabel:a("common.cancel"),variant:"danger",onConfirm:Hs,onCancel:()=>De(!1)})]})}export{Xr as default};
