import{a as Gs,u as Js,w,p as Ia,j as e,v as dt,m as mt,x as Ce,y as qe,z as We}from"./index.js";import{b as Xs,u as Zs,r as i}from"./vendor-react.js";import{D as I}from"./DatePicker.js";import{C as Ma}from"./ConfirmDialog.js";import{M as O}from"./Modal.js";import{S as g}from"./Select.js";import{A as Ea}from"./AutocompleteInput.js";import{s as er,g as La}from"./projectList.js";import{z as n,a9 as ut,ac as tr,am as ce,aA as ar,U as Oa,i as pt,q as xt,ae as sr,aI as rr,C as ir,aj as de,v as j,aB as lr,aD as nr,B as or,P as Te,ax as cr,h as De,c as dr,j as mr,I as gt,aJ as ht,aK as ur,k as pr}from"./vendor-ui.js";import"./vendor-utils.js";const yt=[{value:"bypassing_safety_controls",labelKey:"workers.details.trainings.types.bypassing_safety_controls"},{value:"formation_coactivite",labelKey:"workers.details.trainings.types.formation_coactivite"},{value:"formation_coffrage_decoffrage",labelKey:"workers.details.trainings.types.formation_coffrage_decoffrage"},{value:"formation_conduite_defensive",labelKey:"workers.details.trainings.types.formation_conduite_defensive"},{value:"formation_analyse_des_risques",labelKey:"workers.details.trainings.types.formation_analyse_des_risques"},{value:"formation_elingage_manutention",labelKey:"workers.details.trainings.types.formation_elingage_manutention"},{value:"formation_ergonomie",labelKey:"workers.details.trainings.types.formation_ergonomie"},{value:"formation_excavations",labelKey:"workers.details.trainings.types.formation_excavations"},{value:"formation_outils_electroportatifs",labelKey:"workers.details.trainings.types.formation_outils_electroportatifs"},{value:"formation_epi",labelKey:"workers.details.trainings.types.formation_epi"},{value:"formation_environnement",labelKey:"workers.details.trainings.types.formation_environnement"},{value:"formation_espaces_confines",labelKey:"workers.details.trainings.types.formation_espaces_confines"},{value:"formation_flagman",labelKey:"workers.details.trainings.types.formation_flagman"},{value:"formation_jha",labelKey:"workers.details.trainings.types.formation_jha"},{value:"formation_line_of_fire",labelKey:"workers.details.trainings.types.formation_line_of_fire"},{value:"formation_manutention_manuelle",labelKey:"workers.details.trainings.types.formation_manutention_manuelle"},{value:"formation_manutention_mecanique",labelKey:"workers.details.trainings.types.formation_manutention_mecanique"},{value:"formation_point_chaud",labelKey:"workers.details.trainings.types.formation_point_chaud"},{value:"formation_produits_chimiques",labelKey:"workers.details.trainings.types.formation_produits_chimiques"},{value:"formation_risques_electriques",labelKey:"workers.details.trainings.types.formation_risques_electriques"},{value:"induction_hse",labelKey:"workers.details.trainings.types.induction_hse"},{value:"travail_en_hauteur",labelKey:"workers.details.trainings.types.travail_en_hauteur"},{value:"other",labelKey:"workers.details.trainings.types.other"}],ft=[{value:"elingueur",labelKey:"workers.details.qualifications.types.elingueur"},{value:"equipier_premiere_intervention",labelKey:"workers.details.qualifications.types.equipier_premiere_intervention"},{value:"habilitation_electrique",labelKey:"workers.details.qualifications.types.habilitation_electrique"},{value:"inspecteur_echafaudage",labelKey:"workers.details.qualifications.types.inspecteur_echafaudage"},{value:"monteur_echafaudage",labelKey:"workers.details.qualifications.types.monteur_echafaudage"},{value:"monteur_grue_a_tour",labelKey:"workers.details.qualifications.types.monteur_grue_a_tour"},{value:"operateur_bulldozer",labelKey:"workers.details.qualifications.types.operateur_bulldozer"},{value:"operateur_chargeuse",labelKey:"workers.details.qualifications.types.operateur_chargeuse"},{value:"operateur_chariot_elevateur",labelKey:"workers.details.qualifications.types.operateur_chariot_elevateur"},{value:"operateur_compacteur",labelKey:"workers.details.qualifications.types.operateur_compacteur"},{value:"operateur_dumper",labelKey:"workers.details.qualifications.types.operateur_dumper"},{value:"operateur_grue_a_tour",labelKey:"workers.details.qualifications.types.operateur_grue_a_tour"},{value:"operateur_grue_mobile",labelKey:"workers.details.qualifications.types.operateur_grue_mobile"},{value:"operateur_niveleuse",labelKey:"workers.details.qualifications.types.operateur_niveleuse"},{value:"operateur_nacelle",labelKey:"workers.details.qualifications.types.operateur_nacelle"},{value:"operateur_pelle",labelKey:"workers.details.qualifications.types.operateur_pelle"},{value:"sst",labelKey:"workers.details.qualifications.types.sst"},{value:"soudeur",labelKey:"workers.details.qualifications.types.soudeur"},{value:"utilisation_meule",labelKey:"workers.details.qualifications.types.utilisation_meule"},{value:"other",labelKey:"workers.details.qualifications.types.other"}],Ra=[{value:"embauche_reintegration",labelKey:"workers.details.medical.examNatures.embauche_reintegration"},{value:"visite_systematique",labelKey:"workers.details.medical.examNatures.visite_systematique"},{value:"surveillance_medical_special",labelKey:"workers.details.medical.examNatures.surveillance_medical_special"},{value:"visite_de_reprise",labelKey:"workers.details.medical.examNatures.visite_de_reprise"},{value:"visite_spontanee",labelKey:"workers.details.medical.examNatures.visite_spontanee"}],xr=[{value:"travaux_en_hauteur",labelKey:"workers.details.medical.ableToOptions.travaux_en_hauteur"},{value:"travaux_electrique",labelKey:"workers.details.medical.ableToOptions.travaux_electrique"},{value:"travaux_en_espace_confine",labelKey:"workers.details.medical.ableToOptions.travaux_en_espace_confine"},{value:"operateur",labelKey:"workers.details.medical.ableToOptions.operateur"},{value:"travaux_point_chaud",labelKey:"workers.details.medical.ableToOptions.travaux_point_chaud"}];function Cr(){const{t:a}=Gs(),{user:Ua}=Js(),Pe=Xs(),Fa=Zs(),bt=i.useRef(null),Ae=i.useRef(0),Ke=i.useRef(null),Ie=i.useRef(null),jt=i.useRef(null),$a=t=>{const s=t?.training_type;if(!s)return"-";if(s==="other")return String(t?.training_label??"").trim()||a("workers.details.trainings.types.other");const r=yt.find(l=>l.value===s);return r?.labelKey?a(r.labelKey):String(s)},Qa=t=>{const s=t?.qualification_type;if(!s)return"-";if(s==="other")return String(t?.qualification_label??"").trim()||a("workers.details.qualifications.types.other");const r=ft.find(l=>l.value===s);return r?.labelKey?a(r.labelKey):String(s)},Ba=t=>{const s=t?.exam_nature;if(!s)return"-";const r=Ra.find(l=>l.value===s);return r?.labelKey?a(r.labelKey):String(s)},[vt,kt]=i.useState(!1),[o,_t]=i.useState(null),[M,B]=i.useState("trainings"),[wt,Me]=i.useState([]),[za,Nt]=i.useState(!1),[St,Ee]=i.useState([]),[Ha,Ct]=i.useState(!1),[qt,Le]=i.useState([]),[Ya,Wt]=i.useState(!1),[me,Oe]=i.useState([]),[Va,Tt]=i.useState(!1),[Re,ue]=i.useState([]),[Ga,Dt]=i.useState(!1),[Pt,X]=i.useState(!1),[At,Kt]=i.useState(!1),[v,z]=i.useState({ppe_item_id:"",ppe_other:"",quantity:1,received_at:""}),[It,Mt]=i.useState(!1),[Et,Lt]=i.useState(!1),[Ue,Ot]=i.useState(null),[Ja,Fe]=i.useState(!1),[u,E]=i.useState({training_type:"",training_label:"",training_date:"",expiry_date:"",certificate:null}),[Rt,Ut]=i.useState(!1),[Ft,$t]=i.useState(!1),[$e,Qt]=i.useState(null),[Xa,Qe]=i.useState(!1),[c,P]=i.useState({qualification_type:"",qualification_level:"",qualification_label:"",start_date:"",expiry_date:"",certificate:null}),[Bt,zt]=i.useState(!1),[Ht,Yt]=i.useState(!1),[Be,Vt]=i.useState(null),[Za,ze]=i.useState(!1),[p,A]=i.useState({aptitude_status:"apte",exam_nature:"",able_to:[],exam_date:"",expiry_date:"",certificate:null}),[H,pe]=i.useState(null),[es,Gt]=i.useState(!1),[Jt,Xt]=i.useState(!1),Z=i.useRef(!1),[ee,He]=i.useState(null),[K,xe]=i.useState(null),[ts,Ye]=i.useState(!1),Y=i.useRef(!1),[R,Zt]=i.useState([]),[te,as]=i.useState([]),[ea,ss]=i.useState([]),[ta,rs]=i.useState([]),[V,is]=i.useState(null),[ls,aa]=i.useState(!0),[Ve,h]=i.useState(1),[gr,ns]=i.useState(1),[Ge,os]=i.useState(0),[cs]=i.useState(50),[ae,ds]=i.useState(""),[L,ms]=i.useState(""),[y,sa]=i.useState(""),[x,ge]=i.useState(""),[N,ra]=i.useState(""),[S,ia]=i.useState(""),[he,ye]=i.useState(!1),la=i.useRef(null),na=i.useRef(null),[f,oa]=i.useState(""),[U,ca]=i.useState("has"),[b,da]=i.useState(""),[F,ma]=i.useState("has"),[k,ua]=i.useState(""),[C,pa]=i.useState(""),[q,xa]=i.useState(""),[us,ga]=i.useState([]),ha=Ua?.project_list_preference??"code",fe=i.useMemo(()=>er(te,ha),[te,ha]),ps=i.useMemo(()=>{const t=Array.isArray(fe)?fe:[];return y?t.filter(s=>s?.pole===y):t},[fe,y]),[$,be]=i.useState([]),[je,ya]=i.useState(!1),[xs,fa]=i.useState(!1),[gs,ve]=i.useState(!1),[se,Je]=i.useState(null),[ba,ja]=i.useState(!1),[va,ka]=i.useState(!1),[re,ke]=i.useState(null),[G,Xe]=i.useState(null),[hs,_e]=i.useState(!1),[m,W]=i.useState({nom:"",prenom:"",fonction:"",cin:"",date_naissance:"",entreprise:"",project_id:"",date_entree:"",is_active:!0});i.useEffect(()=>{_a(),Q()},[]),i.useEffect(()=>{const s=new URLSearchParams(Pe.search).get("worker_id"),r=s?String(s).trim():"";r&&(async()=>{try{const l=await w.getById(r),d=l.data?.data??l.data;d&&await it(d)}catch{}finally{const l=new URLSearchParams(Pe.search);l.delete("worker_id"),Fa({pathname:Pe.pathname,search:l.toString()?`?${l.toString()}`:""},{replace:!0})}})()},[]),i.useEffect(()=>{we()},[Ve,L,x,N,S,y,f,U,b,F,k,C,q]),i.useEffect(()=>{Q()},[L,x,N,S,y,f,U,b,F,k,C,q]),i.useEffect(()=>{if(!he)return;const t=r=>{r.key==="Escape"&&ye(!1)},s=r=>{const l=la.current,d=na.current,_=r.target;l&&l.contains(_)||d&&d.contains(_)||ye(!1)};return document.addEventListener("keydown",t),document.addEventListener("mousedown",s),()=>{document.removeEventListener("keydown",t),document.removeEventListener("mousedown",s)}},[he]),i.useEffect(()=>{(async()=>{try{const s=await Ia.getPoles(),r=s.data?.data?.poles??s.data?.poles??[];ga(Array.isArray(r)?r:[])}catch{ga([])}})()},[]),i.useEffect(()=>{if(!y)return;!te.some(s=>String(s.id)===String(x)&&s?.pole===y)&&x&&ge("")},[y,x,te]),i.useEffect(()=>{const t=setTimeout(()=>{ms(ae)},300);return()=>clearTimeout(t)},[ae]);const _a=async()=>{try{const[t,s,r]=await Promise.all([Ia.getAllList({status:"active"}),w.getEntreprises(),w.getFonctions()]);as(Array.isArray(t)?t:[]),ss(s.data.data??[]),rs(r.data.data??[])}catch(t){console.error("Failed to load initial data:",t)}},Q=async()=>{try{Ie.current&&Ie.current.abort();const t=new AbortController;Ie.current=t;const s={search:L||void 0,pole:y||void 0,project_id:x||void 0,entreprise:N||void 0,fonction:S||void 0,training_type:f||void 0,training_presence:f?U:void 0,qualification_type:b||void 0,qualification_presence:b?F:void 0,medical_presence:k||void 0,medical_status:C||void 0,expired_filter:q||void 0,is_active:!0},r=await w.getStatistics(s,{signal:t.signal});is(r.data.data)}catch(t){if(t?.name==="CanceledError"||t?.code==="ERR_CANCELED")return}},we=async()=>{try{aa(!0),Ke.current&&Ke.current.abort();const t=new AbortController;Ke.current=t;const s=Ae.current+1;Ae.current=s;const r={page:Ve,per_page:cs,search:L||void 0,pole:y||void 0,project_id:x||void 0,entreprise:N||void 0,fonction:S||void 0,training_type:f||void 0,training_presence:f?U:void 0,qualification_type:b||void 0,qualification_presence:b?F:void 0,medical_presence:k||void 0,medical_status:C||void 0,expired_filter:q||void 0,is_active:!0},l=await w.getAll(r,{signal:t.signal});if(s!==Ae.current)return;const d=l.data,_=d.data??d,J=Array.isArray(_)?_:_?.data??[],ie=d.meta??_.meta??_;Zt(ct=>{if(Ve===1)return J;const T=[...ct,...J],Ne=new Set;return T.filter(le=>{const ne=le?.id;if(ne==null)return!0;const Se=String(ne);return Ne.has(Se)?!1:(Ne.add(Se),!0)})}),ns(ie.last_page??1),os(ie.total??J.length)}catch(t){if(t?.name==="CanceledError"||t?.code==="ERR_CANCELED")return;n.error(a("errors.somethingWentWrong"))}finally{aa(!1)}},ys=V?.hse_team??R.filter(t=>t.fonction?.toLowerCase().includes("hse")).length,fs=V?.induction_hse??0,bs=V?.travail_en_hauteur??0,js=V?.medical_aptitude??0,wa=(t=null)=>{t?(Je(t),W({nom:t.nom??"",prenom:t.prenom??"",fonction:t.fonction??"",cin:t.cin?.toUpperCase()??"",date_naissance:t.date_naissance?.split("T")[0]??"",entreprise:t.entreprise??"",project_id:t.project_id??"",date_entree:t.date_entree?.split("T")[0]??"",is_active:t.is_active??!0})):(Je(null),W({nom:"",prenom:"",fonction:"",cin:"",date_naissance:"",entreprise:"",project_id:"",date_entree:"",is_active:!0})),fa(!0)},Ze=()=>{fa(!1),Je(null)},vs=async t=>{t.preventDefault(),ja(!0);const s={...m,cin:m.cin?.toUpperCase()};try{se?(await w.update(se.id,s),n.success(a("workers.updated"))):(await w.create(s)).data.data?.merged?n.success(a("workers.merged")):n.success(a("workers.created")),Ze(),we(),Q()}catch(r){n.error(r.response?.data?.message??a("errors.somethingWentWrong"))}finally{ja(!1)}},ks=t=>{Xe(t)},_s=async()=>{if(G)try{await w.delete(G.id),n.success(a("workers.deactivated")),we(),Q()}catch{n.error(a("errors.somethingWentWrong"))}finally{Xe(null)}},ws=()=>{$.length!==0&&_e(!0)},Ns=async()=>{if($.length===0){_e(!1);return}try{const t=await w.bulkDeactivate($);n.success(a("workers.bulkDeactivated",{count:t.data.data.deactivated_count})),be([]),ya(!1),we(),Q()}catch{n.error(a("errors.somethingWentWrong"))}finally{_e(!1)}},Na=async()=>{try{const t=await w.downloadTemplate(),s=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=s,r.setAttribute("download","workers_template.xlsx"),document.body.appendChild(r),r.click(),r.remove()}catch{n.error(a("errors.somethingWentWrong"))}},Ss=async()=>{try{const s={pole:y||void 0,project_id:x||void 0,entreprise:N||void 0,fonction:S||void 0,training_type:f||void 0,training_presence:f?U:void 0,qualification_type:b||void 0,qualification_presence:b?F:void 0,medical_presence:k||void 0,medical_status:C||void 0,expired_filter:q||void 0,is_active:!0,search:L||ae||void 0},r=await w.export(s),l=r.data instanceof Blob?r.data:new Blob([r.data]),d=window.URL.createObjectURL(l),J=(r.headers?.["content-disposition"]??r.headers?.["Content-Disposition"])?.match(/filename\*=UTF-8''([^;]+)|filename="?([^";]+)"?/i),ie=J?.[1]??J?.[2],ct=ie?decodeURIComponent(ie):null,T=[];if(x){const Ka=te.find(Vs=>String(Vs.id)===String(x))?.name;Ka&&T.push(Ka)}N&&T.push(N),S&&T.push(S),f&&T.push(`training:${f}-${U}`),b&&T.push(`qualification:${b}-${F}`),k&&T.push(`medical:${k}${C?`-${C}`:""}`),q&&T.push(`expired:${q}`);const Ne=T.length?T.join(", "):"active",le=new Date,ne=String(le.getDate()).padStart(2,"0"),Se=String(le.getMonth()+1).padStart(2,"0"),$s=String(le.getFullYear()),Qs=`${ne}-${Se}-${$s}`,Bs=Ne.replace(/[\\/:*?"<>|]/g,"-").replace(/\s+/g," ").trim(),zs=(l.type?.includes("csv")?!0:!!l.type?.includes("text/plain"))?"csv":"xlsx",Hs=`Workers_export_(${Bs})_date(${Qs}).${zs}`,Ys=ct??Hs,oe=document.createElement("a");oe.href=d,oe.setAttribute("download",Ys),document.body.appendChild(oe),oe.click(),oe.remove(),n.success(a("common.exportSuccess"))}catch(t){try{const s=t?.response?.data;if(s instanceof Blob&&s.type?.includes("application/json")){const r=await s.text(),l=JSON.parse(r);n.error(l?.message??a("errors.somethingWentWrong"));return}}catch{}n.error(t.response?.data?.message??a("errors.somethingWentWrong"))}},Cs=async()=>{if(re){ka(!0);try{const t=new FormData;t.append("file",re),x&&t.append("project_id",x);const s=await w.import(t);n.success(a("workers.importSuccess",{imported:s.data.data.imported_count,merged:s.data.data.merged_count})),ve(!1),ke(null),h(1),Zt([]),_a()}catch(t){n.error(t.response?.data?.message??a("errors.somethingWentWrong"))}finally{ka(!1)}}},qs=t=>{be(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},Sa=()=>{be(je?[]:R.map(t=>t.id)),ya(!je)},D=t=>t?new Date(t).toLocaleDateString("fr-FR"):"-",Ws=i.useMemo(()=>{const t={};for(const s of me){const r=s?.ppe_item_id??s?.ppe_item?.id??s?.ppeItem?.id,l=s?.received_at;!r||!l||(!t[r]||new Date(l)>new Date(t[r]))&&(t[r]=l)}return t},[me]),et=(t,s)=>{if(!t)return"";const r=new Date(`${t}T00:00:00`);if(Number.isNaN(r.getTime()))return"";r.setFullYear(r.getFullYear()+s);const l=r.getFullYear(),d=String(r.getMonth()+1).padStart(2,"0"),_=String(r.getDate()).padStart(2,"0");return`${l}-${d}-${_}`},Ts=t=>!t||typeof t!="string"?null:t.startsWith("/api/")?t.slice(4):t.startsWith("api/")?t.slice(3):t,Ca=()=>{He(null),Ye(!1),K&&Y.current&&URL.revokeObjectURL(K),Y.current=!1,xe(null)},tt=async(t,s)=>{if(t)try{if(He(s??{}),Ye(!0),K&&Y.current&&URL.revokeObjectURL(K),Y.current=!1,xe(null),typeof t=="string"&&(t.startsWith("http://")||t.startsWith("https://")||t.startsWith("/storage/"))){xe(t);return}const r=Ts(t),l=await mt.get(r,{responseType:"blob"}),d=URL.createObjectURL(l.data);Y.current=!0,xe(d)}catch(r){n.error(r.response?.data?.message??a("errors.somethingWentWrong")),He(null)}finally{Ye(!1)}};i.useEffect(()=>()=>{K&&Y.current&&URL.revokeObjectURL(K)},[K]);const at=async t=>{if(t)try{Nt(!0);const r=(await Ce.getAll({worker_id:t,per_page:100})).data,l=r.data??r,d=Array.isArray(l)?l:l.data??[];Me(Array.isArray(d)?d:[])}catch(s){Me([]),n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Nt(!1)}},st=async t=>{if(t)try{Ct(!0);const r=(await qe.getAll({worker_id:t,per_page:100})).data,l=r.data??r,d=Array.isArray(l)?l:l.data??[];Ee(Array.isArray(d)?d:[])}catch(s){Ee([]),n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Ct(!1)}},rt=async t=>{if(t)try{Wt(!0);const r=(await We.getAll({worker_id:t,per_page:100})).data,l=r.data??r,d=Array.isArray(l)?l:l.data??[];Le(Array.isArray(d)?d:[])}catch(s){Le([]),n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Wt(!1)}},qa=async t=>{if(t)try{Tt(!0);const r=(await dt.getWorkerIssues(t)).data,l=r.data??r,d=Array.isArray(l)?l:l.data??[];Oe(Array.isArray(d)?d:[])}catch(s){Oe([]),n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Tt(!1)}},Wa=async t=>{if(!t){ue([]);return}try{Dt(!0);const s=await dt.getItems({project_id:Number(t)});ue(s.data?.data??[])}catch(s){ue([]),n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Dt(!1)}},Ta=async t=>{if(t)try{Gt(!0),H&&Z.current&&(URL.revokeObjectURL(H),Z.current=!1),pe(null);const s=await mt.get(`/workers/${t}/image`,{responseType:"blob"}),r=URL.createObjectURL(s.data);Z.current=!0,pe(r)}catch{pe(null)}finally{Gt(!1)}},Ds=async t=>{if(!(!o?.id||!t))try{Xt(!0);const s=new FormData;s.append("image",t),await mt.post(`/workers/${o.id}/image`,s,{headers:{"Content-Type":"multipart/form-data"}}),await Ta(o.id),n.success(a("success.saved"))}catch(s){n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Xt(!1)}},it=async t=>{t&&(_t(t),kt(!0),B("trainings"),await Promise.all([at(t.id),st(t.id),rt(t.id),qa(t.id),Wa(t.project_id??t.project?.id),Ta(t.id)]))},Ps=()=>{kt(!1),_t(null),B("trainings"),Me([]),Ee([]),Le([]),Oe([]),ue([]),X(!1),z({ppe_item_id:"",ppe_other:"",quantity:1,received_at:""}),H&&Z.current&&URL.revokeObjectURL(H),Z.current=!1,pe(null),Ca()},Da=(t=null)=>{Ot(t),Fe(!1),E(t?{training_type:t.training_type??"",training_label:t.training_label??"",training_date:t.training_date??"",expiry_date:t.expiry_date??"",certificate:null}:{training_type:"",training_label:"",training_date:"",expiry_date:"",certificate:null}),Mt(!0)},lt=()=>{Mt(!1),Ot(null),Fe(!1),E({training_type:"",training_label:"",training_date:"",expiry_date:"",certificate:null})},As=t=>{const s=t.target.files?.[0];if(s&&s.type!=="application/pdf"){n.error(a("workers.details.common.pdfOnly"));return}E(r=>({...r,certificate:s??null}))},Pa=(t=null)=>{Qt(t),Qe(!1),P(t?{qualification_type:t.qualification_type??"",qualification_level:t.qualification_level??"",qualification_label:t.qualification_label??"",start_date:t.start_date??"",expiry_date:t.expiry_date??"",certificate:null}:{qualification_type:"",qualification_level:"",qualification_label:"",start_date:"",expiry_date:"",certificate:null}),Ut(!0)},nt=()=>{Ut(!1),Qt(null),Qe(!1),P({qualification_type:"",qualification_level:"",qualification_label:"",start_date:"",expiry_date:"",certificate:null})},Ks=t=>{const s=t.target.files?.[0];if(s&&s.type!=="application/pdf"){n.error(a("workers.details.common.pdfOnly"));return}P(r=>({...r,certificate:s??null}))},Is=async t=>{if(t.preventDefault(),!!o?.id&&!(!c.qualification_type||!c.start_date)&&!(c.qualification_type==="other"&&!String(c.qualification_label??"").trim())&&!(c.qualification_type==="habilitation_electrique"&&!String(c.qualification_level??"").trim())){$t(!0);try{const s={worker_id:o.id,qualification_type:c.qualification_type,qualification_level:c.qualification_type==="habilitation_electrique"?String(c.qualification_level??"").trim():void 0,qualification_label:c.qualification_type==="other"?String(c.qualification_label??"").trim():void 0,start_date:c.start_date,expiry_date:c.expiry_date?c.expiry_date:void 0,certificate:c.certificate?c.certificate:void 0};$e?.id?await qe.update($e.id,s):await qe.create(s),n.success(a("success.saved")),nt(),await st(o.id)}catch(s){n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{$t(!1)}}},Ms=async t=>{if(t?.id)try{await qe.delete(t.id),n.success(a("success.deleted")),o?.id&&await st(o.id)}catch(s){n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}},Aa=(t=null)=>{Vt(t),ze(!1),A(t?{aptitude_status:t.aptitude_status??"apte",exam_nature:t.exam_nature??"",able_to:Array.isArray(t.able_to)?t.able_to:[],exam_date:t.exam_date??"",expiry_date:t.expiry_date??"",certificate:null}:{aptitude_status:"apte",exam_nature:"",able_to:[],exam_date:"",expiry_date:"",certificate:null}),zt(!0)},ot=()=>{zt(!1),Vt(null),ze(!1),A({aptitude_status:"apte",exam_nature:"",able_to:[],exam_date:"",expiry_date:"",certificate:null})},Es=t=>{const s=t.target.files?.[0];if(s&&s.type!=="application/pdf"){n.error(a("workers.details.common.pdfOnly"));return}A(r=>({...r,certificate:s??null}))},Ls=t=>{A(s=>{const r=Array.isArray(s.able_to)?s.able_to:[];return r.includes(t)?{...s,able_to:r.filter(l=>l!==t)}:{...s,able_to:[...r,t]}})},Os=async t=>{if(t.preventDefault(),!!o?.id&&!(!p.exam_nature||!p.exam_date)){Yt(!0);try{const s={worker_id:o.id,aptitude_status:p.aptitude_status,exam_nature:p.exam_nature,able_to:Array.isArray(p.able_to)?p.able_to:[],exam_date:p.exam_date,expiry_date:p.expiry_date?p.expiry_date:void 0,certificate:p.certificate?p.certificate:void 0};Be?.id?await We.update(Be.id,s):await We.create(s),n.success(a("success.saved")),ot(),await rt(o.id),Q()}catch(s){n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Yt(!1)}}},Rs=async t=>{if(t?.id)try{await We.delete(t.id),n.success(a("success.deleted")),o?.id&&await rt(o.id),Q()}catch(s){n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}},Us=async t=>{if(t.preventDefault(),!!o?.id&&!(!u.training_type||!u.training_date)&&!(u.training_type==="other"&&!String(u.training_label??"").trim())){Lt(!0);try{const s={worker_id:o.id,training_type:u.training_type,training_label:u.training_type==="other"?String(u.training_label??"").trim():void 0,training_date:u.training_date,expiry_date:u.expiry_date?u.expiry_date:void 0,certificate:u.certificate?u.certificate:void 0};Ue?.id?(await Ce.update(Ue.id,s),n.success(a("success.saved"))):(await Ce.create(s),n.success(a("success.saved"))),lt(),await at(o.id)}catch(s){n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Lt(!1)}}},Fs=async t=>{if(t?.id)try{await Ce.delete(t.id),n.success(a("success.deleted")),o?.id&&await at(o.id)}catch(s){n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:a("workers.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:a("workers.subtitle")})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:Na,className:"btn-outline btn-sm flex items-center gap-2",children:[e.jsx(ut,{className:"w-4 h-4"}),a("workers.downloadTemplate")]}),e.jsxs("button",{onClick:()=>ve(!0),className:"btn-outline btn-sm flex items-center gap-2",children:[e.jsx(tr,{className:"w-4 h-4"}),a("workers.import")]}),e.jsxs("button",{onClick:Ss,className:"btn-outline btn-sm flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),a("workers.export")]}),e.jsxs("button",{onClick:()=>wa(),className:"btn-primary btn-sm flex items-center gap-2",children:[e.jsx(ar,{className:"w-4 h-4"}),a("workers.addWorker")]})]})]}),V&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(Oa,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.totalWorkers")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:V.active})]})]}),e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-orange-100 dark:bg-orange-900/50 rounded-lg",children:e.jsx(pt,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.hseTeam")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:ys})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-emerald-100 dark:bg-emerald-900/50 rounded-lg",children:e.jsx(xt,{className:"w-5 h-5 text-emerald-600 dark:text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.stats.inductionHse")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:fs})]})]}),e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-purple-100 dark:bg-purple-900/50 rounded-lg",children:e.jsx(pt,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.stats.workAtHeight")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:bs})]})]}),e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-sky-100 dark:bg-sky-900/50 rounded-lg",children:e.jsx(xt,{className:"w-5 h-5 text-sky-600 dark:text-sky-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.stats.medicalAptitude")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:js})]})]})]})]}),e.jsx("div",{className:"card p-3 overflow-visible",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:max-w-md",children:[e.jsx(sr,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:ae,onChange:t=>{ds(t.target.value),h(1)},placeholder:a("common.search"),className:"input pl-9 py-1.5 text-sm"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:la,type:"button",onClick:()=>ye(t=>!t),className:"btn-outline btn-sm flex items-center gap-2","aria-haspopup":"menu","aria-expanded":he,children:[e.jsx(rr,{className:"w-4 h-4"}),a("common.filter"),e.jsx(ir,{className:"w-4 h-4"})]}),he&&e.jsxs("div",{ref:na,role:"menu",className:"absolute right-0 mt-2 w-[min(28rem,calc(100vw-2rem))] z-[60] card overflow-visible p-3 shadow-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.pole")}),e.jsxs(g,{value:y,onChange:t=>{sa(t.target.value),ge(""),h(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("common.allPoles")}),us.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.project")}),e.jsxs(g,{value:x,onChange:t=>{ge(t.target.value),h(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("workers.allProjects")}),ps.map(t=>e.jsx("option",{value:t.id,children:La(t)},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.entreprise")}),e.jsxs(g,{value:N,onChange:t=>{ra(t.target.value),h(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("workers.allEntreprises")}),ea.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.fonction")}),e.jsxs(g,{value:S,onChange:t=>{ia(t.target.value),h(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("workers.allFonctions")}),ta.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsx("div",{className:"md:col-span-2 border-t border-gray-200 dark:border-gray-700 pt-3"}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.training")}),e.jsxs(g,{value:f,onChange:t=>{oa(t.target.value),h(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("common.all")}),yt.filter(t=>t.value!=="other").map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.presence")}),e.jsxs(g,{value:U,onChange:t=>{ca(t.target.value),h(1)},className:"py-1.5 text-sm",disabled:!f,children:[e.jsx("option",{value:"has",children:a("workers.filters.with")}),e.jsx("option",{value:"missing",children:a("workers.filters.without")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.qualification")}),e.jsxs(g,{value:b,onChange:t=>{da(t.target.value),h(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("common.all")}),ft.filter(t=>t.value!=="other").map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.presence")}),e.jsxs(g,{value:F,onChange:t=>{ma(t.target.value),h(1)},className:"py-1.5 text-sm",disabled:!b,children:[e.jsx("option",{value:"has",children:a("workers.filters.with")}),e.jsx("option",{value:"missing",children:a("workers.filters.without")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.medical")}),e.jsxs(g,{value:k,onChange:t=>{ua(t.target.value),h(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("common.all")}),e.jsx("option",{value:"has",children:a("workers.filters.with")}),e.jsx("option",{value:"missing",children:a("workers.filters.without")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.medicalStatus")}),e.jsxs(g,{value:C,onChange:t=>{pa(t.target.value),h(1)},className:"py-1.5 text-sm",disabled:!k||k==="missing",children:[e.jsx("option",{value:"",children:a("common.all")}),e.jsx("option",{value:"apte",children:a("workers.details.medical.apte")}),e.jsx("option",{value:"inapte",children:a("workers.details.medical.inapte")})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.expired")}),e.jsxs(g,{value:q,onChange:t=>{xa(t.target.value),h(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("workers.filters.expiredAny")}),e.jsx("option",{value:"only_expired",children:a("workers.filters.expiredOnly")}),e.jsx("option",{value:"without_expired",children:a("workers.filters.expiredWithout")})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3 border-t border-gray-200 dark:border-gray-700 pt-3",children:[e.jsx("button",{type:"button",onClick:()=>{sa(""),ge(""),ra(""),ia(""),oa(""),ca("has"),da(""),ma("has"),ua(""),pa(""),xa(""),h(1)},className:"btn-outline btn-sm",children:a("common.reset")}),e.jsx("button",{type:"button",onClick:()=>ye(!1),className:"btn-primary btn-sm",children:a("common.apply")})]})]})]})]})}),$.length>0&&e.jsxs("div",{className:"card p-2.5 flex items-center justify-between bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:je,onChange:Sa,className:"rounded border-red-300 text-red-600 focus:ring-red-500"}),e.jsxs("span",{className:"text-sm font-medium text-red-700 dark:text-red-300",children:[$.length," ",a("common.selected")]})]}),e.jsxs("button",{onClick:ws,className:"btn-danger btn-sm flex items-center gap-1.5 text-xs",children:[e.jsx(de,{className:"w-3.5 h-3.5"}),a("workers.bulkDeactivate")]})]}),e.jsxs("div",{className:"card overflow-hidden",children:[ls?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(j,{className:"w-6 h-6 animate-spin text-hse-primary"})}):R.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-[14px]",children:[e.jsx("thead",{className:"text-[11px] uppercase tracking-wider text-gray-500 dark:text-gray-400",children:e.jsxs("tr",{className:"sticky top-0 z-10 bg-white/95 dark:bg-gray-900/95 backdrop-blur border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"w-12 px-3 py-3",children:e.jsx("input",{type:"checkbox",checked:je,onChange:Sa,className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-hse-primary focus:ring-hse-primary"})}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.nom")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.prenom")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.cin")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.fonction")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.entreprise")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.projet")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold whitespace-nowrap",children:a("workers.dateEntree")}),e.jsx("th",{className:"px-3 py-3 text-center font-semibold w-24",children:a("common.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-800",children:R.map((t,s)=>e.jsxs("tr",{role:"button",tabIndex:0,onClick:r=>{const l=r.target;l instanceof Element&&(l.closest("button")||l.closest("a")||l.closest("input"))||it(t)},onKeyDown:r=>{r.key==="Enter"&&it(t)},className:`${s%2===0?"bg-white dark:bg-gray-900":"bg-gray-50/60 dark:bg-gray-800/30"} hover:bg-hse-primary/5 dark:hover:bg-hse-primary/10 transition-colors cursor-pointer`,children:[e.jsx("td",{className:"px-3 py-2.5 align-middle",children:e.jsx("input",{type:"checkbox",checked:$.includes(t.id),onChange:r=>{r.stopPropagation(),qs(t.id)},className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-hse-primary focus:ring-hse-primary"})}),e.jsx("td",{className:"px-3 py-2.5 font-medium text-gray-900 dark:text-gray-100 whitespace-nowrap",children:t.nom}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200 whitespace-nowrap",children:t.prenom}),e.jsx("td",{className:"px-3 py-2.5 font-mono text-gray-600 dark:text-gray-300 whitespace-nowrap",children:t.cin?.toUpperCase()}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200",children:t.fonction??""}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200",children:t.entreprise??""}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200",children:t.project?.name??""}),e.jsx("td",{className:"px-3 py-2.5 text-gray-600 dark:text-gray-300 whitespace-nowrap",children:D(t.date_entree)}),e.jsx("td",{className:"px-3 py-2.5 align-middle",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:r=>{r.stopPropagation(),wa(t)},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 border border-transparent hover:border-gray-200 dark:hover:border-gray-600",title:a("common.edit"),children:e.jsx(lr,{className:"w-4 h-4 text-gray-600 dark:text-gray-300"})}),e.jsx("button",{onClick:r=>{r.stopPropagation(),ks(t)},className:"p-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 border border-transparent hover:border-red-200 dark:hover:border-red-800",title:a("workers.deactivate"),children:e.jsx(de,{className:"w-4 h-4 text-red-600 dark:text-red-400"})})]})})]},t.id))})]})}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Oa,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:a("workers.noWorkers")})]}),(R.length>0?!0:Ge>0)&&e.jsxs("div",{className:"px-3 py-2 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[a("pagination.showing")," ",R.length," ",a("pagination.of")," ",Ge," ",a("pagination.results")]}),R.length<Ge&&e.jsx("button",{onClick:()=>h(t=>t+1),className:"px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300",children:a("common.showMore")})]})]}),e.jsx(O,{isOpen:xs,onClose:Ze,title:a(se?"workers.editWorker":"workers.newWorker"),size:"lg",children:e.jsxs("form",{onSubmit:vs,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("workers.nom")," *"]}),e.jsx("input",{type:"text",value:m.nom,onChange:t=>W({...m,nom:t.target.value}),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("workers.prenom")," *"]}),e.jsx("input",{type:"text",value:m.prenom,onChange:t=>W({...m,prenom:t.target.value}),className:"input",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("workers.cin")," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx(nr,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:m.cin,onChange:t=>W({...m,cin:t.target.value.toUpperCase()}),className:"input pl-10 uppercase",placeholder:"AB123456",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.fonction")}),e.jsx(Ea,{value:m.fonction,onChange:t=>W({...m,fonction:t}),suggestions:ta,placeholder:a("workers.fonctionPlaceholder"),icon:e.jsx(pt,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.dateNaissance")}),e.jsx(I,{value:m.date_naissance,onChange:t=>W({...m,date_naissance:t}),placeholder:a("workers.selectDate")}),m.date_naissance&&(()=>{const t=new Date(m.date_naissance),s=new Date,r=s.getFullYear()-t.getFullYear(),l=s.getMonth()-t.getMonth();return(l<0||l===0&&s.getDate()<t.getDate()?r-1:r)<18?e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 font-semibold mt-1 flex items-center gap-1",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-red-500 rounded-full animate-pulse"}),a("workers.minAge")]}):null})()]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.dateEntree")}),e.jsx(I,{value:m.date_entree,onChange:t=>W({...m,date_entree:t}),placeholder:a("workers.selectDate")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.entreprise")}),e.jsx(Ea,{value:m.entreprise,onChange:t=>W({...m,entreprise:t}),suggestions:ea,placeholder:a("workers.entreprisePlaceholder"),defaultValue:"SGTM",icon:e.jsx(or,{className:"w-4 h-4"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.projet")}),e.jsxs(g,{value:m.project_id,onChange:t=>W({...m,project_id:t.target.value}),children:[e.jsx("option",{value:"",children:a("common.select")}),fe.map(t=>e.jsx("option",{value:t.id,children:La(t)},t.id))]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white text-sm",children:a("workers.status")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.statusHelp")})]}),e.jsx("button",{type:"button",onClick:()=>W({...m,is_active:!m.is_active}),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${m.is_active?"bg-green-500":"bg-gray-300 dark:bg-gray-600"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${m.is_active?"translate-x-6":"translate-x-1"}`})})]}),!se&&e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg text-sm text-blue-700 dark:text-blue-300",children:e.jsx("p",{children:a("workers.cinInfo")})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:Ze,className:"btn-outline",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:ba,className:"btn-primary flex items-center gap-2",children:[ba&&e.jsx(j,{className:"w-4 h-4 animate-spin"}),a(se?"common.save":"workers.addWorker")]})]})]})}),vt&&o&&e.jsx(O,{isOpen:vt,onClose:Ps,title:a("workers.details.title"),size:"full",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"min-w-0 flex flex-col justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:o.project?.name??"-"}),e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 truncate",children:[o.prenom," ",o.nom]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:o.fonction??"-"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 font-mono",children:o.cin?.toUpperCase()??"-"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:a("workers.entreprise")}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-medium",children:o.entreprise??"-"})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:a("workers.dateEntree")}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-medium",children:D(o.date_entree)})]})]})]}),e.jsxs("div",{className:"w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 overflow-hidden relative",children:[e.jsxs("div",{className:"absolute top-3 right-3 z-10 flex items-center gap-2",children:[e.jsx("input",{ref:jt,type:"file",accept:"image/*",className:"hidden",onChange:t=>{const s=t.target.files?.[0];s&&(Ds(s),t.target.value="")}}),e.jsxs("button",{type:"button",onClick:()=>jt.current?.click(),className:"btn-outline btn-sm flex items-center gap-2",disabled:Jt,children:[Jt?e.jsx(j,{className:"w-4 h-4 animate-spin"}):e.jsx(Te,{className:"w-4 h-4"}),a("workers.details.image.add")]})]}),es?e.jsx("div",{className:"w-full h-72 flex items-center justify-center",children:e.jsx(j,{className:"w-6 h-6 animate-spin text-hse-primary"})}):H?e.jsx("div",{className:"w-full h-72 flex items-center justify-center p-2",children:e.jsx("img",{src:H,alt:"",className:"max-w-full max-h-full object-contain"})}):e.jsxs("div",{className:"w-full h-72 flex flex-col items-center justify-center text-sm text-gray-500 dark:text-gray-400 gap-2",children:[e.jsx(cr,{className:"w-8 h-8"}),e.jsx("span",{children:a("workers.details.noImage")})]})]})]}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{className:"px-4 pt-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex gap-2 -mb-px flex-wrap",children:[e.jsxs("button",{type:"button",onClick:()=>B("trainings"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${M==="trainings"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(De,{className:"w-4 h-4"}),a("workers.details.tabs.trainings")]}),e.jsxs("button",{type:"button",onClick:()=>B("qualifications"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${M==="qualifications"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(dr,{className:"w-4 h-4"}),a("workers.details.tabs.qualifications")]}),e.jsxs("button",{type:"button",onClick:()=>B("medical"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${M==="medical"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(xt,{className:"w-4 h-4"}),a("workers.details.tabs.medical")]}),e.jsxs("button",{type:"button",onClick:()=>B("ppe"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${M==="ppe"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(mr,{className:"w-4 h-4"}),a("ppe.workerTab.title")]})]})}),e.jsxs("div",{className:"p-4",children:[M==="trainings"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>Da(null),children:[e.jsx(Te,{className:"w-4 h-4"}),a("common.add")]})}),za?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(j,{className:"w-6 h-6 animate-spin text-hse-primary"})}):wt.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:a("workers.details.trainings.empty")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.trainings.type")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.startDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("common.actions")})]})}),e.jsx("tbody",{children:wt.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("div",{className:"font-medium",children:$a(t)})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:D(t.training_date)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:D(t.expiry_date)}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>tt(t.certificate_url,t),children:[e.jsx(gt,{className:"w-4 h-4"}),a("common.view")]}),t.certificate_url&&e.jsxs("a",{href:t.certificate_url,download:!0,className:"btn-outline btn-sm flex items-center gap-2",onClick:s=>s.stopPropagation(),children:[e.jsx(ce,{className:"w-4 h-4"}),a("common.download")]}),e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Da(t),children:[e.jsx(ht,{className:"w-4 h-4"}),a("common.edit")]}),e.jsxs("button",{type:"button",className:"btn-danger btn-sm flex items-center gap-2",onClick:()=>Fs(t),children:[e.jsx(de,{className:"w-4 h-4"}),a("common.delete")]})]})})]},t.id))})]})})]}),M==="qualifications"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>Pa(null),children:[e.jsx(Te,{className:"w-4 h-4"}),a("common.add")]})}),Ha?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(j,{className:"w-6 h-6 animate-spin text-hse-primary"})}):St.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:a("workers.details.qualifications.empty")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.qualifications.type")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.startDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("common.actions")})]})}),e.jsx("tbody",{children:St.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[e.jsx("span",{children:Qa(t)}),t.qualification_type==="habilitation_electrique"&&t.qualification_level?e.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200",children:t.qualification_level}):null]})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:D(t.start_date)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:D(t.expiry_date)}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>tt(t.certificate_url,t),children:[e.jsx(gt,{className:"w-4 h-4"}),a("common.view")]}),t.certificate_url&&e.jsxs("a",{href:t.certificate_url,download:!0,className:"btn-outline btn-sm flex items-center gap-2",onClick:s=>s.stopPropagation(),children:[e.jsx(ce,{className:"w-4 h-4"}),a("common.download")]}),e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Pa(t),children:[e.jsx(ht,{className:"w-4 h-4"}),a("common.edit")]}),e.jsxs("button",{type:"button",className:"btn-danger btn-sm flex items-center gap-2",onClick:()=>Ms(t),children:[e.jsx(de,{className:"w-4 h-4"}),a("common.delete")]})]})})]},t.id))})]})})]}),M==="medical"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>Aa(null),children:[e.jsx(Te,{className:"w-4 h-4"}),a("common.add")]})}),Ya?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(j,{className:"w-6 h-6 animate-spin text-hse-primary"})}):qt.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:a("workers.details.medical.empty")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.medical.status")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.medical.examNature")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.startDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("common.actions")})]})}),e.jsx("tbody",{children:qt.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-semibold ${t.aptitude_status==="apte"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300"}`,children:t.aptitude_status==="apte"?a("workers.details.medical.apte"):a("workers.details.medical.inapte")})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:Ba(t)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:D(t.exam_date)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:D(t.expiry_date)}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>tt(t.certificate_url,t),children:[e.jsx(gt,{className:"w-4 h-4"}),a("common.view")]}),t.certificate_url&&e.jsxs("a",{href:t.certificate_url,download:!0,className:"btn-outline btn-sm flex items-center gap-2",onClick:s=>s.stopPropagation(),children:[e.jsx(ce,{className:"w-4 h-4"}),a("common.download")]}),e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Aa(t),children:[e.jsx(ht,{className:"w-4 h-4"}),a("common.edit")]}),e.jsxs("button",{type:"button",className:"btn-danger btn-sm flex items-center gap-2",onClick:()=>Rs(t),children:[e.jsx(de,{className:"w-4 h-4"}),a("common.delete")]})]})})]},t.id))})]})})]}),M==="ppe"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>{o?.id&&(z({ppe_item_id:"",ppe_other:"",quantity:1,received_at:new Date().toISOString().slice(0,10)}),X(!0))},children:[e.jsx(ur,{className:"w-4 h-4"}),a("ppe.workerTab.issueButton")]})}),e.jsxs("div",{className:"card p-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:a("ppe.workerTab.lastIssuedTitle")}),Ga?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(j,{className:"w-5 h-5 animate-spin text-hse-primary"})}):Re.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2",children:a("common.noData")}):e.jsx("div",{className:"overflow-x-auto mt-2",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.item")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.items.stock")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.receivedAt")})]})}),e.jsx("tbody",{children:[...Re].sort((t,s)=>String(t?.name??"").localeCompare(String(s?.name??""))).map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("div",{className:"font-medium",children:t.name})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200 font-mono",children:t.stock_quantity??0}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:D(Ws[t.id])})]},t.id))})]})})]}),e.jsxs("div",{className:"card p-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:a("ppe.workerTab.title")}),Va?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(j,{className:"w-5 h-5 animate-spin text-hse-primary"})}):me.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2",children:a("ppe.workerTab.empty")}):e.jsx("div",{className:"overflow-x-auto mt-2",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.item")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.quantity")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.receivedAt")})]})}),e.jsx("tbody",{children:me.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("div",{className:"font-medium",children:t.ppe_item?.name??t.ppeItem?.name??"-"})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200 font-mono",children:t.quantity??1}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:D(t.received_at)})]},t.id))})]})})]})]})]})]})]})}),Pt&&o&&e.jsx(O,{isOpen:Pt,onClose:()=>X(!1),title:a("ppe.issue.title"),size:"lg",children:e.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),!!o?.id){if(!v.ppe_item_id&&!String(v.ppe_other??"").trim()){n.error(a("ppe.issue.chooseItem"));return}try{Kt(!0),await dt.issueToWorker({worker_id:Number(o.id),ppe_item_id:v.ppe_item_id?Number(v.ppe_item_id):void 0,ppe_name:v.ppe_item_id?void 0:String(v.ppe_other??"").trim(),quantity:Number(v.quantity??1),received_at:v.received_at}),n.success(a("ppe.issue.success")),X(!1),await Promise.all([qa(o.id),Wa(o.project_id??o.project?.id)])}catch(s){n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Kt(!1)}}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("ppe.issue.item")}),e.jsxs(g,{value:v.ppe_item_id,onChange:t=>z(s=>({...s,ppe_item_id:t.target.value,ppe_other:""})),children:[e.jsx("option",{value:"",children:a("ppe.issue.other")}),[...Re].sort((t,s)=>String(t?.name??"").localeCompare(String(s?.name??""))).map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.stock_quantity??0,")"]},t.id))]}),!v.ppe_item_id&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"label text-xs",children:a("ppe.issue.otherSpecify")}),e.jsx("input",{className:"input",value:v.ppe_other,onChange:t=>z(s=>({...s,ppe_other:t.target.value})),placeholder:a("ppe.issue.otherPlaceholder")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("ppe.issue.quantity")}),e.jsx("input",{type:"number",min:1,className:"input",value:v.quantity,onChange:t=>z(s=>({...s,quantity:t.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("ppe.issue.receivedAt")}),e.jsx(I,{value:v.received_at,onChange:t=>z(s=>({...s,received_at:t})),required:!0})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>X(!1),className:"btn-outline btn-sm",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:At,className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[At&&e.jsx(j,{className:"w-4 h-4 animate-spin"}),a("ppe.issue.submit")]})]})]})}),Rt&&e.jsx(O,{isOpen:Rt,onClose:nt,title:a($e?"common.edit":"workers.details.qualifications.addTitle"),size:"lg",children:e.jsxs("form",{onSubmit:Is,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.qualifications.type")}),e.jsxs(g,{value:c.qualification_type,onChange:t=>{const s=t.target.value;P(r=>({...r,qualification_type:s}))},children:[e.jsx("option",{value:"",children:a("common.select")}),ft.map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),c.qualification_type==="habilitation_electrique"&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.qualifications.level")}),e.jsx("input",{className:"input",value:c.qualification_level,onChange:t=>P(s=>({...s,qualification_level:t.target.value})),placeholder:a("workers.details.qualifications.levelPlaceholder")})]}),c.qualification_type==="other"&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.qualifications.otherLabel")}),e.jsx("input",{className:"input",value:c.qualification_label,onChange:t=>P(s=>({...s,qualification_label:t.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.startDate")}),e.jsx(I,{value:c.start_date,onChange:t=>{P(s=>{const r={...s,start_date:t};return Xa||(r.expiry_date=t?et(t,1):""),r})},placeholder:a("workers.details.common.startDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.endDate")}),e.jsx(I,{value:c.expiry_date,onChange:t=>{Qe(!0),P(s=>({...s,expiry_date:t}))},placeholder:a("workers.details.common.endDate")}),e.jsx("div",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDateAutoHelp")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.file")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:c.certificate?c.certificate.name:a("workers.details.common.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:Ks,className:"hidden"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:nt,className:"btn-outline btn-sm",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:Ft||!c.qualification_type||!c.start_date||c.qualification_type==="other"&&!String(c.qualification_label??"").trim()||c.qualification_type==="habilitation_electrique"&&!String(c.qualification_level??"").trim(),className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[Ft&&e.jsx(j,{className:"w-4 h-4 animate-spin"}),a("common.save")]})]})]})}),Bt&&e.jsx(O,{isOpen:Bt,onClose:ot,title:a(Be?"common.edit":"workers.details.medical.addTitle"),size:"lg",children:e.jsxs("form",{onSubmit:Os,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("div",{children:e.jsx("label",{className:"font-medium text-gray-900 dark:text-white text-sm",children:a("workers.details.medical.status")})}),e.jsx("button",{type:"button",onClick:()=>A(t=>({...t,aptitude_status:t.aptitude_status==="apte"?"inapte":"apte"})),className:`relative inline-flex h-6 w-14 items-center rounded-full transition-colors ${p.aptitude_status==="apte"?"bg-green-500":"bg-red-500"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${p.aptitude_status==="apte"?"translate-x-8":"translate-x-1"}`})})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:p.aptitude_status==="apte"?a("workers.details.medical.apte"):a("workers.details.medical.inapte")}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.medical.examNature")}),e.jsxs(g,{value:p.exam_nature,onChange:t=>A(s=>({...s,exam_nature:t.target.value})),children:[e.jsx("option",{value:"",children:a("common.select")}),Ra.map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.medical.ableTo")}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:xr.map(t=>e.jsxs("label",{className:"flex items-center gap-2 p-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900",children:[e.jsx("input",{type:"checkbox",checked:Array.isArray(p.able_to)&&p.able_to.includes(t.value),onChange:()=>Ls(t.value),className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-hse-primary focus:ring-hse-primary"}),e.jsx("span",{className:"text-xs text-gray-700 dark:text-gray-200",children:a(t.labelKey)})]},t.value))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.startDate")}),e.jsx(I,{value:p.exam_date,onChange:t=>{A(s=>{const r={...s,exam_date:t};return Za||(r.expiry_date=t?et(t,1):""),r})},placeholder:a("workers.details.common.startDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.endDate")}),e.jsx(I,{value:p.expiry_date,onChange:t=>{ze(!0),A(s=>({...s,expiry_date:t}))},placeholder:a("workers.details.common.endDate")}),e.jsx("div",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDateAutoHelp")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.file")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:p.certificate?p.certificate.name:a("workers.details.common.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:Es,className:"hidden"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:ot,className:"btn-outline btn-sm",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:Ht||!p.exam_nature||!p.exam_date,className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[Ht&&e.jsx(j,{className:"w-4 h-4 animate-spin"}),a("common.save")]})]})]})}),It&&e.jsx(O,{isOpen:It,onClose:lt,title:a(Ue?"common.edit":"workers.details.trainings.addTitle"),size:"lg",children:e.jsxs("form",{onSubmit:Us,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.trainings.type")}),e.jsxs(g,{value:u.training_type,onChange:t=>{const s=t.target.value;E(r=>({...r,training_type:s}))},children:[e.jsx("option",{value:"",children:a("common.select")}),yt.map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),u.training_type==="other"&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.trainings.otherLabel")}),e.jsx("input",{className:"input",value:u.training_label,onChange:t=>E(s=>({...s,training_label:t.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.startDate")}),e.jsx(I,{value:u.training_date,onChange:t=>{E(s=>{const r={...s,training_date:t};return Ja||(r.expiry_date=t?et(t,1):""),r})},placeholder:a("workers.details.common.startDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.endDate")}),e.jsx(I,{value:u.expiry_date,onChange:t=>{Fe(!0),E(s=>({...s,expiry_date:t}))},placeholder:a("workers.details.common.endDate")}),e.jsx("div",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDateAutoHelp")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.file")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:u.certificate?u.certificate.name:a("workers.details.common.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:As,className:"hidden"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:lt,className:"btn-outline btn-sm",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:Et||!u.training_type||!u.training_date||u.training_type==="other"&&!String(u.training_label??"").trim(),className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[Et&&e.jsx(j,{className:"w-4 h-4 animate-spin"}),a("common.save")]})]})]})}),ee&&e.jsx(O,{isOpen:!!ee,onClose:Ca,title:a("common.view"),size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[70vh]",children:ts?e.jsx("div",{className:"w-full h-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 flex items-center justify-center",children:e.jsx(j,{className:"w-6 h-6 animate-spin text-hse-primary"})}):K?e.jsx("iframe",{src:K,title:a("common.view"),className:"w-full h-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white"}):e.jsx("div",{className:"w-full h-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 flex items-center justify-center text-sm text-gray-500 dark:text-gray-400",children:a("errors.somethingWentWrong")})}),typeof ee?.certificate_url=="string"&&ee.certificate_url&&e.jsx("div",{className:"flex justify-end",children:e.jsxs("a",{href:ee.certificate_url,download:!0,className:"btn-primary inline-flex items-center gap-2 text-sm",children:[e.jsx(ce,{className:"w-4 h-4"}),a("common.download")]})})]})}),e.jsx(O,{isOpen:gs,onClose:()=>ve(!1),title:a("workers.importTitle"),size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a("workers.importHelp")}),e.jsxs("button",{onClick:Na,className:"w-full btn-outline flex items-center justify-center gap-2",children:[e.jsx(ut,{className:"w-4 h-4"}),a("workers.downloadTemplate")]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center",children:[e.jsx("input",{ref:bt,type:"file",accept:".xlsx,.xls,.csv",onChange:t=>ke(t.target.files[0]),className:"hidden"}),re?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(ut,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:re.name}),e.jsx("button",{type:"button",onClick:()=>ke(null),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:e.jsx(pr,{className:"w-4 h-4"})})]}):e.jsx("button",{type:"button",onClick:()=>bt.current?.click(),className:"text-hse-primary hover:underline",children:a("workers.selectFile")})]}),e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg text-sm text-amber-700 dark:text-amber-300",children:e.jsx("p",{children:a("workers.cinInfo")})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>{ve(!1),ke(null)},className:"btn-outline",children:a("common.cancel")}),e.jsxs("button",{type:"button",onClick:Cs,disabled:!re||va,className:"btn-primary flex items-center gap-2",children:[va&&e.jsx(j,{className:"w-4 h-4 animate-spin"}),a("workers.import")]})]})]})}),e.jsx(Ma,{isOpen:!!G,title:a("common.confirm"),message:G?a("workers.confirmDeactivate",{name:`${G.prenom} ${G.nom}`}):"",confirmLabel:a("workers.deactivate"),cancelLabel:a("common.cancel"),variant:"danger",onConfirm:_s,onCancel:()=>Xe(null)}),e.jsx(Ma,{isOpen:hs,title:a("common.confirm"),message:a("workers.confirmBulkDeactivate",{count:$.length}),confirmLabel:a("workers.bulkDeactivate"),cancelLabel:a("common.cancel"),variant:"danger",onConfirm:Ns,onCancel:()=>_e(!1)})]})}export{Cr as default};
