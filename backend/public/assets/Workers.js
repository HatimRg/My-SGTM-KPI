import{a as Vn,u as Gn,w as D,g as fr,j as e,y as Ve,p as qs,z as _e,A as Ne,B as Se,o as X}from"./index.js";import{b as Xn,u as Jn,r as n}from"./vendor-react.js";import{D as O}from"./DatePicker.js";import{C as br}from"./ConfirmDialog.js";import{M as K}from"./Modal.js";import{S as b}from"./Select.js";import{A as jr}from"./AutocompleteInput.js";import{s as ei,g as wr}from"./projectList.js";import{z as o,ao as Ce,aC as ti,C as vr,U as kr,i as Is,q as As,ag as si,aK as ai,al as We,v as f,aD as ri,aF as ni,B as ii,P as Ge,az as li,h as De,c as oi,j as ci,I as Tt,aL as Ps,aM as Xe,ab as $,k as Z,ae as Mt}from"./vendor-ui.js";import"./vendor-utils.js";const qt=()=>{try{if(typeof crypto<"u"&&typeof crypto.randomUUID=="function")return crypto.randomUUID()}catch{}return`${Date.now()}-${Math.random().toString(16).slice(2)}`},Es=[{value:"bypassing_safety_controls",labelKey:"workers.details.trainings.types.bypassing_safety_controls"},{value:"formation_coactivite",labelKey:"workers.details.trainings.types.formation_coactivite"},{value:"formation_coffrage_decoffrage",labelKey:"workers.details.trainings.types.formation_coffrage_decoffrage"},{value:"formation_conduite_defensive",labelKey:"workers.details.trainings.types.formation_conduite_defensive"},{value:"formation_analyse_des_risques",labelKey:"workers.details.trainings.types.formation_analyse_des_risques"},{value:"formation_elingage_manutention",labelKey:"workers.details.trainings.types.formation_elingage_manutention"},{value:"formation_ergonomie",labelKey:"workers.details.trainings.types.formation_ergonomie"},{value:"formation_excavations",labelKey:"workers.details.trainings.types.formation_excavations"},{value:"formation_outils_electroportatifs",labelKey:"workers.details.trainings.types.formation_outils_electroportatifs"},{value:"formation_epi",labelKey:"workers.details.trainings.types.formation_epi"},{value:"formation_environnement",labelKey:"workers.details.trainings.types.formation_environnement"},{value:"formation_espaces_confines",labelKey:"workers.details.trainings.types.formation_espaces_confines"},{value:"formation_flagman",labelKey:"workers.details.trainings.types.formation_flagman"},{value:"formation_jha",labelKey:"workers.details.trainings.types.formation_jha"},{value:"formation_line_of_fire",labelKey:"workers.details.trainings.types.formation_line_of_fire"},{value:"formation_manutention_manuelle",labelKey:"workers.details.trainings.types.formation_manutention_manuelle"},{value:"formation_manutention_mecanique",labelKey:"workers.details.trainings.types.formation_manutention_mecanique"},{value:"formation_point_chaud",labelKey:"workers.details.trainings.types.formation_point_chaud"},{value:"formation_produits_chimiques",labelKey:"workers.details.trainings.types.formation_produits_chimiques"},{value:"formation_risques_electriques",labelKey:"workers.details.trainings.types.formation_risques_electriques"},{value:"induction_hse",labelKey:"workers.details.trainings.types.induction_hse"},{value:"travail_en_hauteur",labelKey:"workers.details.trainings.types.travail_en_hauteur"},{value:"other",labelKey:"workers.details.trainings.types.other"}],Rs=[{value:"elingueur",labelKey:"workers.details.qualifications.types.elingueur"},{value:"equipier_premiere_intervention",labelKey:"workers.details.qualifications.types.equipier_premiere_intervention"},{value:"habilitation_electrique",labelKey:"workers.details.qualifications.types.habilitation_electrique"},{value:"inspecteur_echafaudage",labelKey:"workers.details.qualifications.types.inspecteur_echafaudage"},{value:"monteur_echafaudage",labelKey:"workers.details.qualifications.types.monteur_echafaudage"},{value:"monteur_grue_a_tour",labelKey:"workers.details.qualifications.types.monteur_grue_a_tour"},{value:"operateur_bulldozer",labelKey:"workers.details.qualifications.types.operateur_bulldozer"},{value:"operateur_chargeuse",labelKey:"workers.details.qualifications.types.operateur_chargeuse"},{value:"operateur_chariot_elevateur",labelKey:"workers.details.qualifications.types.operateur_chariot_elevateur"},{value:"operateur_compacteur",labelKey:"workers.details.qualifications.types.operateur_compacteur"},{value:"operateur_dumper",labelKey:"workers.details.qualifications.types.operateur_dumper"},{value:"operateur_grue_a_tour",labelKey:"workers.details.qualifications.types.operateur_grue_a_tour"},{value:"operateur_grue_mobile",labelKey:"workers.details.qualifications.types.operateur_grue_mobile"},{value:"operateur_niveleuse",labelKey:"workers.details.qualifications.types.operateur_niveleuse"},{value:"operateur_nacelle",labelKey:"workers.details.qualifications.types.operateur_nacelle"},{value:"operateur_pelle",labelKey:"workers.details.qualifications.types.operateur_pelle"},{value:"sst",labelKey:"workers.details.qualifications.types.sst"},{value:"soudeur",labelKey:"workers.details.qualifications.types.soudeur"},{value:"utilisation_meule",labelKey:"workers.details.qualifications.types.utilisation_meule"},{value:"other",labelKey:"workers.details.qualifications.types.other"}],_r=[{value:"embauche_reintegration",labelKey:"workers.details.medical.examNatures.embauche_reintegration"},{value:"visite_systematique",labelKey:"workers.details.medical.examNatures.visite_systematique"},{value:"surveillance_medical_special",labelKey:"workers.details.medical.examNatures.surveillance_medical_special"},{value:"visite_de_reprise",labelKey:"workers.details.medical.examNatures.visite_de_reprise"},{value:"visite_spontanee",labelKey:"workers.details.medical.examNatures.visite_spontanee"}],di=[{value:"travaux_en_hauteur",labelKey:"workers.details.medical.ableToOptions.travaux_en_hauteur"},{value:"travaux_electrique",labelKey:"workers.details.medical.ableToOptions.travaux_electrique"},{value:"travaux_en_espace_confine",labelKey:"workers.details.medical.ableToOptions.travaux_en_espace_confine"},{value:"operateur",labelKey:"workers.details.medical.ableToOptions.operateur"},{value:"travaux_point_chaud",labelKey:"workers.details.medical.ableToOptions.travaux_point_chaud"}];function ki(){const{t:s}=Vn(),{user:Te}=Gn(),It=Xn(),Nr=Jn(),Ls=n.useRef(null),ne=n.useRef(null),ie=n.useRef(null),le=n.useRef(null),oe=n.useRef(null),ce=n.useRef(null),de=n.useRef(null),me=n.useRef(null),ue=n.useRef(null),N=Te?.role==="hr"||Te?.role==="hr_director",Me=["hse_manager","responsable","supervisor","user"].includes(Te?.role),Sr=Te?.role==="hse_manager",At=n.useRef(0),Pt=n.useRef(null),Et=n.useRef(null),Us=n.useRef(null),Cr=t=>{const a=t?.training_type;if(!a)return"-";if(a==="other")return String(t?.training_label??"").trim()||s("workers.details.trainings.types.other");const r=Es.find(i=>i.value===a);return r?.labelKey?s(r.labelKey):String(a)},Wr=t=>{const a=t?.qualification_type;if(!a)return"-";if(a==="other")return String(t?.qualification_label??"").trim()||s("workers.details.qualifications.types.other");const r=Rs.find(i=>i.value===a);return r?.labelKey?s(r.labelKey):String(a)},Dr=t=>{const a=t?.exam_nature;if(!a)return"-";const r=_r.find(i=>i.value===a);return r?.labelKey?s(r.labelKey):String(a)},Tr=t=>{const a=t?.sanction_type;return a?s(`workers.details.sanctions.types.${a}`):"-"},[Os,Ks]=n.useState(!1),[d,$s]=n.useState(null),[U,J]=n.useState("trainings"),[Fs,Rt]=n.useState([]),[Mr,zs]=n.useState(!1),[Qs,Lt]=n.useState([]),[qr,Bs]=n.useState(!1),[Zs,Ut]=n.useState([]),[Ir,Hs]=n.useState(!1),[Je,Ot]=n.useState([]),[Ar,Ys]=n.useState(!1),[et,Kt]=n.useState([]),[Pr,Vs]=n.useState(!1),[$t,tt]=n.useState([]),[Er,Gs]=n.useState(!1),[Xs,qe]=n.useState(!1),[Js,ea]=n.useState(!1),[S,pe]=n.useState({ppe_item_id:"",ppe_other:"",quantity:1,received_at:""}),[ta,Ie]=n.useState(!1),[sa,aa]=n.useState(!1),[u,H]=n.useState({sanction_date:"",sanction_type:"",reason:"",mise_a_pied_days:"",document:null}),[ra,na]=n.useState(!1),[ia,la]=n.useState(!1),[Ft,oa]=n.useState(null),[Rr,zt]=n.useState(!1),[g,Y]=n.useState({training_type:"",training_label:"",training_date:"",expiry_date:"",certificate:null}),[ca,da]=n.useState(!1),[ma,ua]=n.useState(!1),[Qt,pa]=n.useState(null),[Lr,Bt]=n.useState(!1),[m,F]=n.useState({qualification_type:"",qualification_level:"",qualification_label:"",start_date:"",expiry_date:"",certificate:null}),[xa,ga]=n.useState(!1),[ha,ya]=n.useState(!1),[Zt,fa]=n.useState(null),[Ur,Ht]=n.useState(!1),[h,z]=n.useState({aptitude_status:"apte",exam_nature:"",able_to:[],exam_date:"",expiry_date:"",certificate:null}),[xe,st]=n.useState(null),[Or,ba]=n.useState(!1),[ja,wa]=n.useState(!1),Ae=n.useRef(!1),[T,Yt]=n.useState(null),[Q,at]=n.useState(null),[Kr,Vt]=n.useState(!1),ge=n.useRef(!1),[ee,va]=n.useState([]),[Pe,$r]=n.useState([]),[ka,Fr]=n.useState([]),[_a,zr]=n.useState([]),[he,Qr]=n.useState(null),[Br,Na]=n.useState(!0),[Gt,j]=n.useState(1),[mi,Zr]=n.useState(1),[Xt,Hr]=n.useState(0),[Yr]=n.useState(50),[Ee,Vr]=n.useState(""),[V,Gr]=n.useState(""),[v,Sa]=n.useState(""),[w,rt]=n.useState(""),[M,Ca]=n.useState(""),[q,Wa]=n.useState(""),[nt,it]=n.useState(!1),Da=n.useRef(null),Ta=n.useRef(null),[Jt,ye]=n.useState(!1),Ma=n.useRef(null),qa=n.useRef(null),[k,Ia]=n.useState(""),[te,Aa]=n.useState("has"),[_,Pa]=n.useState(""),[se,Ea]=n.useState("has"),[C,Ra]=n.useState(""),[I,La]=n.useState(""),[A,Ua]=n.useState(""),[P,Oa]=n.useState(""),[Xr,Ka]=n.useState([]),$a=Te?.project_list_preference??"code",lt=n.useMemo(()=>ei(Pe,$a),[Pe,$a]),Jr=n.useMemo(()=>{const t=Array.isArray(lt)?lt:[];return v?t.filter(a=>a?.pole===v):t},[lt,v]),[ae,ot]=n.useState([]),[ct,Fa]=n.useState(!1),[en,za]=n.useState(!1),[tn,dt]=n.useState(!1),[sn,Qa]=n.useState(!1),[G,fe]=n.useState("trainings"),[Re,es]=n.useState(null),[Ba,Za]=n.useState(!1),[Ha,Ya]=n.useState(!1),[Le,mt]=n.useState(null),[Ue,ts]=n.useState(null),[Oe,ss]=n.useState(null),[ut,as]=n.useState(!1),[be,rs]=n.useState(null),[ns,Va]=n.useState(null),[pt,xt]=n.useState(null),[Ke,is]=n.useState(null),[$e,ls]=n.useState(null),[gt,os]=n.useState(!1),[je,cs]=n.useState(null),[ds,Ga]=n.useState(null),[ht,yt]=n.useState(null),[Fe,ms]=n.useState(null),[ze,us]=n.useState(null),[ft,ps]=n.useState(!1),[we,xs]=n.useState(null),[gs,Xa]=n.useState(null),[bt,jt]=n.useState(null),[Qe,hs]=n.useState(null),[Be,ys]=n.useState(null),[wt,fs]=n.useState(!1),[ve,bs]=n.useState(null),[js,Ja]=n.useState(null),[vt,kt]=n.useState(null),[ke,ws]=n.useState(null),[an,_t]=n.useState(!1),[p,E]=n.useState({nom:"",prenom:"",fonction:"",cin:"",date_naissance:"",entreprise:"",project_id:"",date_entree:"",is_active:!0});n.useEffect(()=>{er(),re()},[]),n.useEffect(()=>{const a=new URLSearchParams(It.search).get("worker_id"),r=a?String(a).trim():"";r&&(async()=>{try{const i=await D.getById(r),l=i.data?.data??i.data;l&&await Ws(l)}catch{}finally{const i=new URLSearchParams(It.search);i.delete("worker_id"),Nr({pathname:It.pathname,search:i.toString()?`?${i.toString()}`:""},{replace:!0})}})()},[]),n.useEffect(()=>{Nt()},[Gt,V,w,M,q,v,k,te,_,se,C,I,A,P]),n.useEffect(()=>{re()},[V,w,M,q,v,k,te,_,se,C,I,A,P]),n.useEffect(()=>{if(!nt)return;const t=r=>{r.key==="Escape"&&it(!1)},a=r=>{const i=Da.current,l=Ta.current,c=r.target;i&&i.contains(c)||l&&l.contains(c)||it(!1)};return document.addEventListener("keydown",t),document.addEventListener("mousedown",a),()=>{document.removeEventListener("keydown",t),document.removeEventListener("mousedown",a)}},[nt]),n.useEffect(()=>{if(!Jt)return;const t=r=>{r.key==="Escape"&&ye(!1)},a=r=>{const i=Ma.current,l=qa.current,c=r.target;i&&i.contains(c)||l&&l.contains(c)||ye(!1)};return document.addEventListener("keydown",t),document.addEventListener("mousedown",a),()=>{document.removeEventListener("keydown",t),document.removeEventListener("mousedown",a)}},[Jt]),n.useEffect(()=>{(async()=>{try{const a=await fr.getPoles(),r=a.data?.data?.poles??a.data?.poles??[];Ka(Array.isArray(r)?r:[])}catch{Ka([])}})()},[]),n.useEffect(()=>{if(!v)return;!Pe.some(a=>String(a.id)===String(w)&&a?.pole===v)&&w&&rt("")},[v,w,Pe]),n.useEffect(()=>{const t=setTimeout(()=>{Gr(Ee)},300);return()=>clearTimeout(t)},[Ee]);const er=async()=>{try{const[t,a,r]=await Promise.all([fr.getAllList({status:"active"}),D.getEntreprises(),D.getFonctions()]);$r(Array.isArray(t)?t:[]),Fr(a.data.data??[]),zr(r.data.data??[])}catch(t){console.error("Failed to load initial data:",t)}},re=async()=>{try{Et.current&&Et.current.abort();const t=new AbortController;Et.current=t;const a={search:V||void 0,pole:v||void 0,project_id:w||void 0,entreprise:M||void 0,fonction:q||void 0,sanction:P||void 0,training_type:k||void 0,training_presence:k?te:void 0,qualification_type:_||void 0,qualification_presence:_?se:void 0,medical_presence:C||void 0,medical_status:I||void 0,expired_filter:A||void 0,is_active:!0},r=await D.getStatistics(a,{signal:t.signal});Qr(r.data.data)}catch(t){if(t?.name==="CanceledError"||t?.name==="AbortError"||t?.code==="ERR_CANCELED")return}},Nt=async()=>{try{Na(!0),Pt.current&&Pt.current.abort();const t=new AbortController;Pt.current=t;const a=At.current+1;At.current=a;const r={page:Gt,per_page:Yr,search:V||void 0,pole:v||void 0,project_id:w||void 0,entreprise:M||void 0,fonction:q||void 0,sanction:P||void 0,training_type:k||void 0,training_presence:k?te:void 0,qualification_type:_||void 0,qualification_presence:_?se:void 0,medical_presence:C||void 0,medical_status:I||void 0,expired_filter:A||void 0,is_active:!0},i=await D.getAll(r,{signal:t.signal});if(a!==At.current)return;const l=i.data,c=l.data??l,y=Array.isArray(c)?c:c?.data??[],L=l.meta??c.meta??c;va(W=>{if(Gt===1)return y;const x=[...W,...y],Wt=new Set;return x.filter(Ze=>{const He=Ze?.id;if(He==null)return!0;const Dt=String(He);return Wt.has(Dt)?!1:(Wt.add(Dt),!0)})}),Zr(L.last_page??1),Hr(L.total??y.length)}catch(t){if(t?.name==="CanceledError"||t?.name==="AbortError"||t?.code==="ERR_CANCELED")return;o.error(s("errors.somethingWentWrong"))}finally{Na(!1)}},rn=he?.hse_team??ee.filter(t=>{const a=String(t?.fonction??"").toLowerCase();return a?["animateur","animatrice","hse","coordinateur","coordinatrice"].some(i=>a.includes(i)):!1}).length,nn=he?.induction_hse??0,ln=he?.travail_en_hauteur??0,on=he?.medical_aptitude??0,tr=(t=null)=>{t?(es(t),E({nom:t.nom??"",prenom:t.prenom??"",fonction:t.fonction??"",cin:t.cin?.toUpperCase()??"",date_naissance:t.date_naissance?.split("T")[0]??"",entreprise:t.entreprise??"",project_id:t.project_id??"",date_entree:t.date_entree?.split("T")[0]??"",is_active:t.is_active??!0})):(es(null),E({nom:"",prenom:"",fonction:"",cin:"",date_naissance:"",entreprise:"",project_id:"",date_entree:"",is_active:!0})),za(!0)},vs=()=>{za(!1),es(null)},cn=async t=>{t.preventDefault(),Za(!0);const a={...p,cin:p.cin?.toUpperCase()};try{Re?(await D.update(Re.id,a),o.success(s("workers.updated"))):(await D.create(a)).data.data?.merged?o.success(s("workers.merged")):o.success(s("workers.created")),vs(),Nt(),re()}catch(r){o.error(r.response?.data?.message??s("errors.somethingWentWrong"))}finally{Za(!1)}},dn=t=>{ws(t)},mn=async()=>{if(ke)try{await D.delete(ke.id),o.success(s("workers.deactivated")),Nt(),re()}catch{o.error(s("errors.somethingWentWrong"))}finally{ws(null)}},un=()=>{ae.length!==0&&_t(!0)},pn=async()=>{if(ae.length===0){_t(!1);return}try{const t=await D.bulkDeactivate(ae);o.success(s("workers.bulkDeactivated",{count:t.data.data.deactivated_count})),ot([]),Fa(!1),Nt(),re()}catch{o.error(s("errors.somethingWentWrong"))}finally{_t(!1)}},xn=async()=>{try{const t=await D.downloadTemplate(),a=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=a,r.setAttribute("download","workers_template.xlsx"),document.body.appendChild(r),r.click(),r.remove()}catch{o.error(s("errors.somethingWentWrong"))}},gn=async()=>{try{const t=await _e.downloadMassTemplate(),a=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=a,r.setAttribute("download","worker_trainings_mass_template.xlsx"),document.body.appendChild(r),r.click(),r.remove()}catch(t){o.error(t.response?.data?.message??s("errors.somethingWentWrong"))}},hn=async()=>{try{const t=await Ne.downloadMassTemplate(),a=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=a,r.setAttribute("download","worker_qualifications_mass_template.xlsx"),document.body.appendChild(r),r.click(),r.remove()}catch(t){o.error(t.response?.data?.message??s("errors.somethingWentWrong"))}},yn=async()=>{try{const t=await Se.downloadMassTemplate(),a=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=a,r.setAttribute("download","worker_medical_aptitudes_mass_template.xlsx"),document.body.appendChild(r),r.click(),r.remove()}catch(t){o.error(t.response?.data?.message??s("errors.somethingWentWrong"))}},fn=async()=>{try{const t=await Ve.downloadMassTemplate(),a=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=a,r.setAttribute("download","worker_sanctions_mass_template.xlsx"),document.body.appendChild(r),r.click(),r.remove()}catch(t){o.error(t.response?.data?.message??s("errors.somethingWentWrong"))}},sr=()=>{Qa(!1),fe("trainings"),ts(null),ss(null),rs(null),as(!1),Va(null),xt(null),ne.current&&(ne.current.value=""),ie.current&&(ie.current.value=""),is(null),ls(null),cs(null),os(!1),Ga(null),yt(null),le.current&&(le.current.value=""),oe.current&&(oe.current.value=""),ms(null),us(null),xs(null),ps(!1),Xa(null),jt(null),ce.current&&(ce.current.value=""),de.current&&(de.current.value=""),hs(null),ys(null),bs(null),fs(!1),Ja(null),kt(null),me.current&&(me.current.value=""),ue.current&&(ue.current.value="")},St=t=>{if(!t)return null;const a=Number(t?.processed??0),r=Number(t?.total??0),i=Number(t?.imported??0),l=Number(t?.failed??0),c=r>0?r:0,y=c>0?Math.min(100,Math.round(a/c*100)):0,L=t?.status==="failed",W=t?.status==="completed";return e.jsxs("div",{className:"p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("div",{className:"text-gray-700 dark:text-gray-200 font-medium",children:s("common.progress")}),e.jsx("div",{className:L?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400",children:W?"100%":`${y}%`})]}),e.jsx("div",{className:"w-full h-2 rounded bg-gray-200 dark:bg-gray-700 overflow-hidden",children:e.jsx("div",{className:"h-2 bg-hse-primary",style:{width:`${W?100:y}%`}})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-600 dark:text-gray-300",children:[e.jsxs("div",{children:[s("common.processed"),": ",a," / ",c]}),e.jsxs("div",{children:[s("common.imported"),": ",i]}),e.jsxs("div",{children:[s("common.failed"),": ",l]}),e.jsx("div",{className:"text-right",children:String(t?.status??"")})]}),L&&t?.error?e.jsx("div",{className:"text-xs text-red-600 dark:text-red-400",children:String(t.error)}):null]})};n.useEffect(()=>{if(!ut||!ns||pt?.status==="completed"||pt?.status==="failed")return;let t=!1,a=null,r=null,i=0;const l=async()=>{try{const c=await X.get(`/mass-import/progress/${ns}`,{silent:!0}),y=c.data?.data??c.data;if(t)return;i=0,xt(y)}catch(c){c?.response?.status===404&&(i+=1,i>=5&&(t=!0,r&&window.clearTimeout(r),a&&window.clearInterval(a)))}};return r=window.setTimeout(l,1e3),a=window.setInterval(l,2e3),()=>{t=!0,r&&window.clearTimeout(r),a&&window.clearInterval(a)}},[ut,ns,pt?.status]),n.useEffect(()=>{if(!gt||!ds||ht?.status==="completed"||ht?.status==="failed")return;let t=!1,a=null,r=null,i=0;const l=async()=>{try{const c=await X.get(`/mass-import/progress/${ds}`,{silent:!0}),y=c.data?.data??c.data;if(t)return;i=0,yt(y)}catch(c){c?.response?.status===404&&(i+=1,i>=5&&(t=!0,r&&window.clearTimeout(r),a&&window.clearInterval(a)))}};return r=window.setTimeout(l,1e3),a=window.setInterval(l,2e3),()=>{t=!0,r&&window.clearTimeout(r),a&&window.clearInterval(a)}},[gt,ds,ht?.status]),n.useEffect(()=>{if(!ft||!gs||bt?.status==="completed"||bt?.status==="failed")return;let t=!1,a=null,r=null,i=0;const l=async()=>{try{const c=await X.get(`/mass-import/progress/${gs}`,{silent:!0}),y=c.data?.data??c.data;if(t)return;i=0,jt(y)}catch(c){c?.response?.status===404&&(i+=1,i>=5&&(t=!0,r&&window.clearTimeout(r),a&&window.clearInterval(a)))}};return r=window.setTimeout(l,1e3),a=window.setInterval(l,2e3),()=>{t=!0,r&&window.clearTimeout(r),a&&window.clearInterval(a)}},[ft,gs,bt?.status]),n.useEffect(()=>{if(!wt||!js||vt?.status==="completed"||vt?.status==="failed")return;let t=!1,a=null,r=null,i=0;const l=async()=>{try{const c=await X.get(`/mass-import/progress/${js}`,{silent:!0}),y=c.data?.data??c.data;if(t)return;i=0,kt(y)}catch(c){c?.response?.status===404&&(i+=1,i>=5&&(t=!0,r&&window.clearTimeout(r),a&&window.clearInterval(a)))}};return r=window.setTimeout(l,1e3),a=window.setInterval(l,2e3),()=>{t=!0,r&&window.clearTimeout(r),a&&window.clearInterval(a)}},[wt,js,vt?.status]);const bn=async()=>{if(!Ue||!Oe)return;as(!0),rs(null);const t=qt();Va(t),xt({id:t,status:"running",processed:0,total:0,failed:0,imported:0});try{const a=await _e.massImport({excel:Ue,zip:Oe,progressId:t}),r=a.data?.data??a.data;rs(r);const i=r?.imported??0,l=r?.failed_count??0;o.success(s("workers.massDocs.trainings.importSuccess",{imported:i,failed:l})),r?.failed_rows_url&&await B(r.failed_rows_url,"worker_trainings_failed_rows.xlsx")}catch(a){xt(r=>r&&{...r,status:"failed",error:a.response?.data?.message??s("errors.somethingWentWrong")}),o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}finally{as(!1)}},jn=async()=>{if(!Ke||!$e)return;os(!0),cs(null);const t=qt();Ga(t),yt({id:t,status:"running",processed:0,total:0,failed:0,imported:0});try{const a=await Ne.massImport({excel:Ke,zip:$e,progressId:t}),r=a.data?.data??a.data;cs(r);const i=r?.imported??0,l=r?.failed_count??0;o.success(s("workers.massDocs.qualifications.importSuccess",{imported:i,failed:l})),r?.failed_rows_url&&await B(r.failed_rows_url,"worker_qualifications_failed_rows.xlsx")}catch(a){yt(r=>r&&{...r,status:"failed",error:a.response?.data?.message??s("errors.somethingWentWrong")}),o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}finally{os(!1)}},wn=async()=>{if(!Fe||!ze)return;ps(!0),xs(null);const t=qt();Xa(t),jt({id:t,status:"running",processed:0,total:0,failed:0,imported:0});try{const a=await Se.massImport({excel:Fe,zip:ze,progressId:t}),r=a.data?.data??a.data;xs(r);const i=r?.imported??0,l=r?.failed_count??0;o.success(s("workers.massDocs.medical.importSuccess",{imported:i,failed:l})),r?.failed_rows_url&&await B(r.failed_rows_url,"worker_medical_aptitudes_failed_rows.xlsx")}catch(a){jt(r=>r&&{...r,status:"failed",error:a.response?.data?.message??s("errors.somethingWentWrong")}),o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}finally{ps(!1)}},vn=async()=>{if(!Qe||!Be)return;fs(!0),bs(null);const t=qt();Ja(t),kt({id:t,status:"running",processed:0,total:0,failed:0,imported:0});try{const a=await Ve.massImport({excel:Qe,zip:Be,progressId:t}),r=a.data?.data??a.data;bs(r);const i=r?.imported??0,l=r?.failed_count??0;o.success(s("workers.massDocs.sanctions.importSuccess",{imported:i,failed:l})),r?.failed_rows_url&&await B(r.failed_rows_url,"worker_sanctions_failed_rows.xlsx")}catch(a){kt(r=>r&&{...r,status:"failed",error:a.response?.data?.message??s("errors.somethingWentWrong")}),o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}finally{fs(!1)}},kn=async()=>{try{const a={pole:v||void 0,project_id:w||void 0,entreprise:M||void 0,fonction:q||void 0,sanction:P||void 0,training_type:k||void 0,training_presence:k?te:void 0,qualification_type:_||void 0,qualification_presence:_?se:void 0,medical_presence:C||void 0,medical_status:I||void 0,expired_filter:A||void 0,is_active:!0,search:V||Ee||void 0},r=await D.export(a),i=r.data instanceof Blob?r.data:new Blob([r.data]),l=window.URL.createObjectURL(i),y=(r.headers?.["content-disposition"]??r.headers?.["Content-Disposition"])?.match(/filename\*=UTF-8''([^;]+)|filename="?([^";]+)"?/i),L=y?.[1]??y?.[2],W=L?decodeURIComponent(L):null,x=[];if(w){const yr=Pe.find(Yn=>String(Yn.id)===String(w))?.name;yr&&x.push(yr)}M&&x.push(M),q&&x.push(q),k&&x.push(`training:${k}-${te}`),_&&x.push(`qualification:${_}-${se}`),C&&x.push(`medical:${C}${I?`-${I}`:""}`),A&&x.push(`expired:${A}`),P&&x.push(`sanction:${P}`);const Wt=x.length?x.join(", "):"active",Ze=new Date,He=String(Ze.getDate()).padStart(2,"0"),Dt=String(Ze.getMonth()+1).padStart(2,"0"),Fn=String(Ze.getFullYear()),zn=`${He}-${Dt}-${Fn}`,Qn=Wt.replace(/[\\/:*?"<>|]/g,"-").replace(/\s+/g," ").trim(),Bn=(i.type?.includes("csv")?!0:!!i.type?.includes("text/plain"))?"csv":"xlsx",Zn=`Workers_export_(${Qn})_date(${zn}).${Bn}`,Hn=W??Zn,Ye=document.createElement("a");Ye.href=l,Ye.setAttribute("download",Hn),document.body.appendChild(Ye),Ye.click(),Ye.remove(),o.success(s("common.exportSuccess"))}catch(t){try{const a=t?.response?.data;if(a instanceof Blob&&a.type?.includes("application/json")){const r=await a.text(),i=JSON.parse(r);o.error(i?.message??s("errors.somethingWentWrong"));return}}catch{}o.error(t.response?.data?.message??s("errors.somethingWentWrong"))}},_n=async()=>{if(Le){Ya(!0);try{const t=new FormData;t.append("file",Le),w&&t.append("project_id",w);const a=await D.import(t);o.success(s("workers.importSuccess",{imported:a.data.data.imported_count,merged:a.data.data.merged_count})),dt(!1),mt(null),j(1),va([]),er()}catch(t){o.error(t.response?.data?.message??s("errors.somethingWentWrong"))}finally{Ya(!1)}}},Nn=t=>{ot(a=>a.includes(t)?a.filter(r=>r!==t):[...a,t])},ar=()=>{ot(ct?[]:ee.map(t=>t.id)),Fa(!ct)},R=t=>t?new Date(t).toLocaleDateString("fr-FR"):"-",Sn=n.useMemo(()=>{const t={};for(const a of Je){const r=a?.ppe_item_id??a?.ppe_item?.id??a?.ppeItem?.id,i=a?.received_at;!r||!i||(!t[r]||new Date(i)>new Date(t[r]))&&(t[r]=i)}return t},[Je]),rr=n.useMemo(()=>{const t=[...et].sort((i,l)=>{const c=i?.sanction_date?new Date(`${i.sanction_date}T00:00:00`).getTime():0,y=l?.sanction_date?new Date(`${l.sanction_date}T00:00:00`).getTime():0;return c!==y?c-y:Number(i?.id??0)-Number(l?.id??0)});let a=0;const r={};for(const i of t){if(i?.sanction_type==="mise_a_pied"){a=0;continue}i?.sanction_type==="avertissement"&&(a+=1,r[i.id]=a)}return r},[et]),ks=(t,a)=>{if(!t)return"";const r=new Date(`${t}T00:00:00`);if(Number.isNaN(r.getTime()))return"";r.setFullYear(r.getFullYear()+a);const i=r.getFullYear(),l=String(r.getMonth()+1).padStart(2,"0"),c=String(r.getDate()).padStart(2,"0");return`${i}-${l}-${c}`},Cn=t=>t?.id?`/api/worker-trainings/${t.id}/certificate/view`:null,nr=t=>t?.id?`/api/worker-trainings/${t.id}/certificate/download`:null,Wn=t=>t?.id?`/api/worker-qualifications/${t.id}/certificate/view`:null,ir=t=>t?.id?`/api/worker-qualifications/${t.id}/certificate/download`:null,Dn=t=>t?.id?`/api/worker-medical-aptitudes/${t.id}/certificate/view`:null,lr=t=>t?.id?`/api/worker-medical-aptitudes/${t.id}/certificate/download`:null,Tn=t=>t?.id?`/api/worker-sanctions/${t.id}/document/view`:null,or=t=>t?.id?`/api/worker-sanctions/${t.id}/document/download`:null,cr=t=>{if(!t||typeof t!="string")return null;if(t.startsWith("/api/"))return t.slice(4);if(t.startsWith("api/"))return t.slice(3);if(t.startsWith("/storage/"))return t;if(t.startsWith("storage/"))return`/${t}`;if(t.startsWith("http://")||t.startsWith("https://"))try{const a=new URL(t);if(a.pathname.startsWith("/storage/"))return`${a.pathname}${a.search}`}catch{}return t},B=async(t,a="document.pdf")=>{if(t)try{const r=cr(t);let i,l=null;if(typeof r=="string"&&r.startsWith("/storage/")){const x=await fetch(r);if(!x.ok)throw new Error(`Failed to fetch: ${x.status}`);i=await x.blob(),l={"content-disposition":x.headers.get("content-disposition")}}else{const x=await X.get(r,{responseType:"blob"});i=x.data,l=x.headers}let c=a;const y=l?.["content-disposition"];if(typeof y=="string"){const x=/filename="?([^";]+)"?/i.exec(y);x&&x[1]&&(c=x[1])}const L=URL.createObjectURL(i),W=document.createElement("a");W.href=L,W.download=c,document.body.appendChild(W),W.click(),W.remove(),setTimeout(()=>URL.revokeObjectURL(L),1e3)}catch(r){o.error(r.response?.data?.message??s("errors.somethingWentWrong"))}},dr=()=>{Yt(null),Vt(!1),Q&&ge.current&&URL.revokeObjectURL(Q),ge.current=!1,at(null)},Ct=async(t,a)=>{if(t)try{if(Yt(a??{}),Vt(!0),Q&&ge.current&&URL.revokeObjectURL(Q),ge.current=!1,at(null),typeof t=="string"&&t.startsWith("blob:")){at(t);return}const r=cr(t);let i;if(typeof r=="string"&&r.startsWith("/storage/")){const c=await fetch(r);if(!c.ok)throw new Error(`Failed to fetch: ${c.status}`);i=await c.blob()}else i=(await X.get(r,{responseType:"blob"})).data;const l=URL.createObjectURL(i);ge.current=!0,at(l)}catch(r){o.error(r.response?.data?.message??s("errors.somethingWentWrong")),Yt(null)}finally{Vt(!1)}};n.useEffect(()=>()=>{Q&&ge.current&&URL.revokeObjectURL(Q)},[Q]);const _s=async t=>{if(t)try{zs(!0);const r=(await _e.getAll({worker_id:t,per_page:100})).data,i=r.data??r,l=Array.isArray(i)?i:i.data??[];Rt(Array.isArray(l)?l:[])}catch(a){Rt([]),o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}finally{zs(!1)}},Ns=async t=>{if(t)try{Bs(!0);const r=(await Ne.getAll({worker_id:t,per_page:100})).data,i=r.data??r,l=Array.isArray(i)?i:i.data??[];Lt(Array.isArray(l)?l:[])}catch(a){Lt([]),o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}finally{Bs(!1)}},Ss=async t=>{if(t)try{Hs(!0);const r=(await Se.getAll({worker_id:t,per_page:100})).data,i=r.data??r,l=Array.isArray(i)?i:i.data??[];Ut(Array.isArray(l)?l:[])}catch(a){Ut([]),o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}finally{Hs(!1)}},mr=async t=>{if(t)try{Ys(!0);const r=(await qs.getWorkerIssues(t)).data,i=r.data??r,l=Array.isArray(i)?i:i.data??[];Ot(Array.isArray(l)?l:[])}catch(a){Ot([]),o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}finally{Ys(!1)}},Cs=async t=>{if(t)try{Vs(!0);const r=(await Ve.getAll({worker_id:t,per_page:100})).data,i=r.data??r,l=Array.isArray(i)?i:i.data??[];Kt(Array.isArray(l)?l:[])}catch(a){Kt([]),o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}finally{Vs(!1)}},ur=async t=>{if(!t){tt([]);return}try{Gs(!0);const a=await qs.getItems({project_id:Number(t)});tt(a.data?.data??[])}catch(a){tt([]),o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}finally{Gs(!1)}},pr=async t=>{if(t)try{ba(!0),xe&&Ae.current&&(URL.revokeObjectURL(xe),Ae.current=!1),st(null);const a=await X.get(`/workers/${t}/image`,{responseType:"blob"}),r=URL.createObjectURL(a.data);Ae.current=!0,st(r)}catch{st(null)}finally{ba(!1)}},Mn=async t=>{if(!(!d?.id||!t))try{wa(!0);const a=new FormData;a.append("image",t),await X.post(`/workers/${d.id}/image`,a,{headers:{"Content-Type":"multipart/form-data"}}),await pr(d.id),o.success(s("success.saved"))}catch(a){o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}finally{wa(!1)}},Ws=async t=>{t&&($s(t),Ks(!0),J("trainings"),await Promise.all([_s(t.id),Ns(t.id),Ss(t.id),N?null:mr(t.id),Cs(t.id),N?null:ur(t.project_id??t.project?.id),pr(t.id)].filter(Boolean)))},qn=()=>{Ks(!1),$s(null),J("trainings"),Rt([]),Lt([]),Ut([]),Ot([]),Kt([]),tt([]),qe(!1),pe({ppe_item_id:"",ppe_other:"",quantity:1,received_at:""}),Ie(!1),H({sanction_date:"",sanction_type:"",reason:"",mise_a_pied_days:"",document:null}),xe&&Ae.current&&URL.revokeObjectURL(xe),Ae.current=!1,st(null),dr()},xr=(t=null)=>{oa(t),zt(!1),Y(t?{training_type:t.training_type??"",training_label:t.training_label??"",training_date:t.training_date??"",expiry_date:t.expiry_date??"",certificate:null}:{training_type:"",training_label:"",training_date:"",expiry_date:"",certificate:null}),na(!0)},Ds=()=>{na(!1),oa(null),zt(!1),Y({training_type:"",training_label:"",training_date:"",expiry_date:"",certificate:null})},In=t=>{const a=t.target.files?.[0];if(a&&a.type!=="application/pdf"){o.error(s("workers.details.common.pdfOnly"));return}Y(r=>({...r,certificate:a??null}))},gr=(t=null)=>{pa(t),Bt(!1),F(t?{qualification_type:t.qualification_type??"",qualification_level:t.qualification_level??"",qualification_label:t.qualification_label??"",start_date:t.start_date??"",expiry_date:t.expiry_date??"",certificate:null}:{qualification_type:"",qualification_level:"",qualification_label:"",start_date:"",expiry_date:"",certificate:null}),da(!0)},Ts=()=>{da(!1),pa(null),Bt(!1),F({qualification_type:"",qualification_level:"",qualification_label:"",start_date:"",expiry_date:"",certificate:null})},An=t=>{const a=t.target.files?.[0];if(a&&a.type!=="application/pdf"){o.error(s("workers.details.common.pdfOnly"));return}F(r=>({...r,certificate:a??null}))},Pn=async t=>{if(t.preventDefault(),!!d?.id&&!(!m.qualification_type||!m.start_date)&&!(m.qualification_type==="other"&&!String(m.qualification_label??"").trim())&&!(m.qualification_type==="habilitation_electrique"&&!String(m.qualification_level??"").trim())){ua(!0);try{const a={worker_id:d.id,qualification_type:m.qualification_type,qualification_level:m.qualification_type==="habilitation_electrique"?String(m.qualification_level??"").trim():void 0,qualification_label:m.qualification_type==="other"?String(m.qualification_label??"").trim():void 0,start_date:m.start_date,expiry_date:m.expiry_date?m.expiry_date:void 0,certificate:m.certificate?m.certificate:void 0};Qt?.id?await Ne.update(Qt.id,a):await Ne.create(a),o.success(s("success.saved")),Ts(),await Ns(d.id)}catch(a){o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}finally{ua(!1)}}},En=async t=>{if(t?.id)try{await Ne.delete(t.id),o.success(s("success.deleted")),d?.id&&await Ns(d.id)}catch(a){o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}},hr=(t=null)=>{fa(t),Ht(!1),z(t?{aptitude_status:t.aptitude_status??"apte",exam_nature:t.exam_nature??"",able_to:Array.isArray(t.able_to)?t.able_to:[],exam_date:t.exam_date??"",expiry_date:t.expiry_date??"",certificate:null}:{aptitude_status:"apte",exam_nature:"",able_to:[],exam_date:"",expiry_date:"",certificate:null}),ga(!0)},Ms=()=>{ga(!1),fa(null),Ht(!1),z({aptitude_status:"apte",exam_nature:"",able_to:[],exam_date:"",expiry_date:"",certificate:null})},Rn=t=>{const a=t.target.files?.[0];if(a&&a.type!=="application/pdf"){o.error(s("workers.details.common.pdfOnly"));return}z(r=>({...r,certificate:a??null}))},Ln=t=>{z(a=>{const r=Array.isArray(a.able_to)?a.able_to:[];return r.includes(t)?{...a,able_to:r.filter(i=>i!==t)}:{...a,able_to:[...r,t]}})},Un=async t=>{if(t.preventDefault(),!!d?.id&&!(!h.exam_nature||!h.exam_date)){ya(!0);try{const a={worker_id:d.id,aptitude_status:h.aptitude_status,exam_nature:h.exam_nature,able_to:Array.isArray(h.able_to)?h.able_to:[],exam_date:h.exam_date,expiry_date:h.expiry_date?h.expiry_date:void 0,certificate:h.certificate?h.certificate:void 0};Zt?.id?await Se.update(Zt.id,a):await Se.create(a),o.success(s("success.saved")),Ms(),await Ss(d.id),re()}catch(a){o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}finally{ya(!1)}}},On=async t=>{if(t?.id)try{await Se.delete(t.id),o.success(s("success.deleted")),d?.id&&await Ss(d.id),re()}catch(a){o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}},Kn=async t=>{if(t.preventDefault(),!!d?.id&&!(!g.training_type||!g.training_date)&&!(g.training_type==="other"&&!String(g.training_label??"").trim())){la(!0);try{const a={worker_id:d.id,training_type:g.training_type,training_label:g.training_type==="other"?String(g.training_label??"").trim():void 0,training_date:g.training_date,expiry_date:g.expiry_date?g.expiry_date:void 0,certificate:g.certificate?g.certificate:void 0};Ft?.id?(await _e.update(Ft.id,a),o.success(s("success.saved"))):(await _e.create(a),o.success(s("success.saved"))),Ds(),await _s(d.id)}catch(a){o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}finally{la(!1)}}},$n=async t=>{if(t?.id)try{await _e.delete(t.id),o.success(s("success.deleted")),d?.id&&await _s(d.id)}catch(a){o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:s("workers.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:s("workers.subtitle")})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:kn,className:"btn-outline btn-sm flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),s("workers.export")]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:Ma,type:"button",onClick:()=>ye(t=>!t),className:"btn-primary btn-sm flex items-center gap-2",children:[e.jsx(ti,{className:"w-4 h-4"}),s("workers.addWorker"),e.jsx(vr,{className:"w-4 h-4"})]}),Jt&&e.jsxs("div",{ref:qa,role:"menu",className:"absolute right-0 mt-2 w-56 z-[70] rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 shadow-lg overflow-hidden",children:[e.jsx("button",{type:"button",className:"w-full px-3 py-2 text-sm text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>{ye(!1),tr()},children:s("workers.addOneWorker")}),e.jsx("button",{type:"button",className:"w-full px-3 py-2 text-sm text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>{ye(!1),dt(!0)},children:s("workers.massAdd")}),!N&&e.jsx("button",{type:"button",className:"w-full px-3 py-2 text-sm text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>{ye(!1),fe("trainings"),Qa(!0)},children:s("workers.massDocs.open")})]})]})]})]}),he&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(kr,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("workers.totalWorkers")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:he.active})]})]}),e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-orange-100 dark:bg-orange-900/50 rounded-lg",children:e.jsx(Is,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("workers.hseTeam")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:rn})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-emerald-100 dark:bg-emerald-900/50 rounded-lg",children:e.jsx(As,{className:"w-5 h-5 text-emerald-600 dark:text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("workers.stats.inductionHse")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:nn})]})]}),e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-purple-100 dark:bg-purple-900/50 rounded-lg",children:e.jsx(Is,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("workers.stats.workAtHeight")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:ln})]})]}),e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-sky-100 dark:bg-sky-900/50 rounded-lg",children:e.jsx(As,{className:"w-5 h-5 text-sky-600 dark:text-sky-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("workers.stats.medicalAptitude")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:on})]})]})]})]}),e.jsx("div",{className:"card p-3 overflow-visible",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:max-w-md",children:[e.jsx(si,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:Ee,onChange:t=>{Vr(t.target.value),j(1)},placeholder:s("common.search"),className:"input pl-9 py-1.5 text-sm"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:Da,type:"button",onClick:()=>it(t=>!t),className:"btn-outline btn-sm flex items-center gap-2","aria-haspopup":"menu","aria-expanded":nt,children:[e.jsx(ai,{className:"w-4 h-4"}),s("common.filter"),e.jsx(vr,{className:"w-4 h-4"})]}),nt&&e.jsxs("div",{ref:Ta,role:"menu",className:"absolute right-0 mt-2 w-[min(28rem,calc(100vw-2rem))] z-[60] card overflow-visible p-3 shadow-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.filters.pole")}),e.jsxs(b,{value:v,onChange:t=>{Sa(t.target.value),rt(""),j(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:s("common.allPoles")}),Xr.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.filters.project")}),e.jsxs(b,{value:w,onChange:t=>{rt(t.target.value),j(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:s("workers.allProjects")}),Jr.map(t=>e.jsx("option",{value:t.id,children:wr(t)},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.filters.entreprise")}),e.jsxs(b,{value:M,onChange:t=>{Ca(t.target.value),j(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:s("workers.allEntreprises")}),ka.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.filters.fonction")}),e.jsxs(b,{value:q,onChange:t=>{Wa(t.target.value),j(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:s("workers.allFonctions")}),_a.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsx("div",{className:"md:col-span-2 border-t border-gray-200 dark:border-gray-700 pt-3"}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.filters.training")}),e.jsxs(b,{value:k,onChange:t=>{Ia(t.target.value),j(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:s("common.all")}),Es.filter(t=>t.value!=="other").map(t=>e.jsx("option",{value:t.value,children:s(t.labelKey)},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.filters.presence")}),e.jsxs(b,{value:te,onChange:t=>{Aa(t.target.value),j(1)},className:"py-1.5 text-sm",disabled:!k,children:[e.jsx("option",{value:"has",children:s("workers.filters.with")}),e.jsx("option",{value:"missing",children:s("workers.filters.without")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.filters.qualification")}),e.jsxs(b,{value:_,onChange:t=>{Pa(t.target.value),j(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:s("common.all")}),Rs.filter(t=>t.value!=="other").map(t=>e.jsx("option",{value:t.value,children:s(t.labelKey)},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.filters.presence")}),e.jsxs(b,{value:se,onChange:t=>{Ea(t.target.value),j(1)},className:"py-1.5 text-sm",disabled:!_,children:[e.jsx("option",{value:"has",children:s("workers.filters.with")}),e.jsx("option",{value:"missing",children:s("workers.filters.without")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.filters.medical")}),e.jsxs(b,{value:C,onChange:t=>{Ra(t.target.value),j(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:s("common.all")}),e.jsx("option",{value:"has",children:s("workers.filters.with")}),e.jsx("option",{value:"missing",children:s("workers.filters.without")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.filters.medicalStatus")}),e.jsxs(b,{value:I,onChange:t=>{La(t.target.value),j(1)},className:"py-1.5 text-sm",disabled:!C||C==="missing",children:[e.jsx("option",{value:"",children:s("common.all")}),e.jsx("option",{value:"apte",children:s("workers.details.medical.apte")}),e.jsx("option",{value:"inapte",children:s("workers.details.medical.inapte")})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label text-xs",children:s("workers.filters.expired")}),e.jsxs(b,{value:A,onChange:t=>{Ua(t.target.value),j(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:s("workers.filters.expiredAny")}),e.jsx("option",{value:"only_expired",children:s("workers.filters.expiredOnly")}),e.jsx("option",{value:"without_expired",children:s("workers.filters.expiredWithout")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.filters.sanctions")}),e.jsxs(b,{value:P,onChange:t=>{Oa(t.target.value),j(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:s("common.all")}),e.jsx("option",{value:"any",children:s("workers.filters.sanctionsAny")}),e.jsx("option",{value:"none",children:s("workers.filters.sanctionsNone")}),e.jsx("option",{value:"mise_a_pied",children:s("workers.details.sanctions.types.mise_a_pied")}),e.jsx("option",{value:"avertissement",children:s("workers.details.sanctions.types.avertissement")}),e.jsx("option",{value:"rappel_a_lordre",children:s("workers.details.sanctions.types.rappel_a_lordre")}),e.jsx("option",{value:"blame",children:s("workers.details.sanctions.types.blame")})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3 border-t border-gray-200 dark:border-gray-700 pt-3",children:[e.jsx("button",{type:"button",onClick:()=>{Sa(""),rt(""),Ca(""),Wa(""),Ia(""),Aa("has"),Pa(""),Ea("has"),Ra(""),La(""),Ua(""),Oa(""),j(1)},className:"btn-outline btn-sm",children:s("common.reset")}),e.jsx("button",{type:"button",onClick:()=>it(!1),className:"btn-primary btn-sm",children:s("common.apply")})]})]})]})]})}),ae.length>0&&e.jsxs("div",{className:"card p-2.5 flex items-center justify-between bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:ct,onChange:ar,className:"rounded border-red-300 text-red-600 focus:ring-red-500"}),e.jsxs("span",{className:"text-sm font-medium text-red-700 dark:text-red-300",children:[ae.length," ",s("common.selected")]})]}),e.jsxs("button",{onClick:un,className:"btn-danger btn-sm flex items-center gap-1.5 text-xs",children:[e.jsx(We,{className:"w-3.5 h-3.5"}),s("workers.bulkDeactivate")]})]}),e.jsxs("div",{className:"card overflow-hidden",children:[Br?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(f,{className:"w-6 h-6 animate-spin text-hse-primary"})}):ee.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-[14px]",children:[e.jsx("thead",{className:"text-[11px] uppercase tracking-wider text-gray-500 dark:text-gray-400",children:e.jsxs("tr",{className:"sticky top-0 z-10 bg-white/95 dark:bg-gray-900/95 backdrop-blur border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"w-12 px-3 py-3",children:e.jsx("input",{type:"checkbox",checked:ct,onChange:ar,className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-hse-primary focus:ring-hse-primary"})}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:s("workers.nom")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:s("workers.prenom")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:s("workers.cin")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:s("workers.fonction")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:s("workers.entreprise")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:s("workers.projet")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold whitespace-nowrap",children:s("workers.dateEntree")}),e.jsx("th",{className:"px-3 py-3 text-center font-semibold w-24",children:s("common.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-800",children:ee.map((t,a)=>e.jsxs("tr",{role:"button",tabIndex:0,onClick:r=>{const i=r.target;i instanceof Element&&(i.closest("button")||i.closest("a")||i.closest("input"))||Ws(t)},onKeyDown:r=>{r.key==="Enter"&&Ws(t)},className:`${a%2===0?"bg-white dark:bg-gray-900":"bg-gray-50/60 dark:bg-gray-800/30"} hover:bg-hse-primary/5 dark:hover:bg-hse-primary/10 transition-colors cursor-pointer`,children:[e.jsx("td",{className:"px-3 py-2.5 align-middle",children:e.jsx("input",{type:"checkbox",checked:ae.includes(t.id),onChange:r=>{r.stopPropagation(),Nn(t.id)},className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-hse-primary focus:ring-hse-primary"})}),e.jsx("td",{className:"px-3 py-2.5 font-medium text-gray-900 dark:text-gray-100 whitespace-nowrap",children:t.nom}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200 whitespace-nowrap",children:t.prenom}),e.jsx("td",{className:"px-3 py-2.5 font-mono text-gray-600 dark:text-gray-300 whitespace-nowrap",children:t.cin?.toUpperCase()}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200",children:t.fonction??""}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200",children:t.entreprise??""}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200",children:t.project?.name??""}),e.jsx("td",{className:"px-3 py-2.5 text-gray-600 dark:text-gray-300 whitespace-nowrap",children:R(t.date_entree)}),e.jsx("td",{className:"px-3 py-2.5 align-middle",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:r=>{r.stopPropagation(),tr(t)},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 border border-transparent hover:border-gray-200 dark:hover:border-gray-600",title:s("common.edit"),children:e.jsx(ri,{className:"w-4 h-4 text-gray-600 dark:text-gray-300"})}),e.jsx("button",{onClick:r=>{r.stopPropagation(),dn(t)},className:"p-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 border border-transparent hover:border-red-200 dark:hover:border-red-800",title:s("workers.deactivate"),children:e.jsx(We,{className:"w-4 h-4 text-red-600 dark:text-red-400"})})]})})]},t.id))})]})}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(kr,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:s("workers.noWorkers")})]}),(ee.length>0?!0:Xt>0)&&e.jsxs("div",{className:"px-3 py-2 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[s("pagination.showing")," ",ee.length," ",s("pagination.of")," ",Xt," ",s("pagination.results")]}),ee.length<Xt&&e.jsx("button",{onClick:()=>j(t=>t+1),className:"px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300",children:s("common.showMore")})]})]}),e.jsx(K,{isOpen:en,onClose:vs,title:s(Re?"workers.editWorker":"workers.newWorker"),size:"lg",children:e.jsxs("form",{onSubmit:cn,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[s("workers.nom")," *"]}),e.jsx("input",{type:"text",value:p.nom,onChange:t=>E({...p,nom:t.target.value}),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[s("workers.prenom")," *"]}),e.jsx("input",{type:"text",value:p.prenom,onChange:t=>E({...p,prenom:t.target.value}),className:"input",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[s("workers.cin")," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx(ni,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:p.cin,onChange:t=>E({...p,cin:t.target.value.toUpperCase()}),className:"input pl-10 uppercase",placeholder:"AB123456",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("workers.fonction")}),e.jsx(jr,{value:p.fonction,onChange:t=>E({...p,fonction:t}),suggestions:_a,placeholder:s("workers.fonctionPlaceholder"),icon:e.jsx(Is,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("workers.dateNaissance")}),e.jsx(O,{value:p.date_naissance,onChange:t=>E({...p,date_naissance:t}),placeholder:s("workers.selectDate")}),p.date_naissance&&(()=>{const t=new Date(p.date_naissance),a=new Date,r=a.getFullYear()-t.getFullYear(),i=a.getMonth()-t.getMonth();return(i<0||i===0&&a.getDate()<t.getDate()?r-1:r)<18?e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 font-semibold mt-1 flex items-center gap-1",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-red-500 rounded-full animate-pulse"}),s("workers.minAge")]}):null})()]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("workers.dateEntree")}),e.jsx(O,{value:p.date_entree,onChange:t=>E({...p,date_entree:t}),placeholder:s("workers.selectDate")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("workers.entreprise")}),e.jsx(jr,{value:p.entreprise,onChange:t=>E({...p,entreprise:t}),suggestions:ka,placeholder:s("workers.entreprisePlaceholder"),defaultValue:"SGTM",icon:e.jsx(ii,{className:"w-4 h-4"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("workers.projet")}),e.jsxs(b,{value:p.project_id,onChange:t=>E({...p,project_id:t.target.value}),children:[e.jsx("option",{value:"",children:s("common.select")}),lt.map(t=>e.jsx("option",{value:t.id,children:wr(t)},t.id))]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white text-sm",children:s("workers.status")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s("workers.statusHelp")})]}),e.jsx("button",{type:"button",onClick:()=>E({...p,is_active:!p.is_active}),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${p.is_active?"bg-green-500":"bg-gray-300 dark:bg-gray-600"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${p.is_active?"translate-x-6":"translate-x-1"}`})})]}),!Re&&e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg text-sm text-blue-700 dark:text-blue-300",children:e.jsx("p",{children:s("workers.cinInfo")})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:vs,className:"btn-outline",children:s("common.cancel")}),e.jsxs("button",{type:"submit",disabled:Ba,className:"btn-primary flex items-center gap-2",children:[Ba&&e.jsx(f,{className:"w-4 h-4 animate-spin"}),s(Re?"common.save":"workers.addWorker")]})]})]})}),Os&&d&&e.jsx(K,{isOpen:Os,onClose:qn,title:s("workers.details.title"),size:"full",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"min-w-0 flex flex-col justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:d.project?.name??"-"}),e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 truncate",children:[d.prenom," ",d.nom]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:d.fonction??"-"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 font-mono",children:d.cin?.toUpperCase()??"-"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:s("workers.entreprise")}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-medium",children:d.entreprise??"-"})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:s("workers.dateEntree")}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-medium",children:R(d.date_entree)})]})]})]}),e.jsxs("div",{className:"w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 overflow-hidden relative",children:[e.jsxs("div",{className:"absolute top-3 right-3 z-10 flex items-center gap-2",children:[e.jsx("input",{ref:Us,type:"file",accept:"image/*",className:"hidden",onChange:t=>{const a=t.target.files?.[0];a&&(Mn(a),t.target.value="")}}),e.jsxs("button",{type:"button",onClick:()=>Us.current?.click(),className:"btn-outline btn-sm flex items-center gap-2",disabled:ja,children:[ja?e.jsx(f,{className:"w-4 h-4 animate-spin"}):e.jsx(Ge,{className:"w-4 h-4"}),s("workers.details.image.add")]})]}),Or?e.jsx("div",{className:"w-full h-72 flex items-center justify-center",children:e.jsx(f,{className:"w-6 h-6 animate-spin text-hse-primary"})}):xe?e.jsx("div",{className:"w-full h-72 flex items-center justify-center p-2",children:e.jsx("img",{src:xe,alt:"",className:"max-w-full max-h-full object-contain"})}):e.jsxs("div",{className:"w-full h-72 flex flex-col items-center justify-center text-sm text-gray-500 dark:text-gray-400 gap-2",children:[e.jsx(li,{className:"w-8 h-8"}),e.jsx("span",{children:s("workers.details.noImage")})]})]})]}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{className:"px-4 pt-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex gap-2 -mb-px flex-wrap",children:[e.jsxs("button",{type:"button",onClick:()=>J("trainings"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${U==="trainings"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(De,{className:"w-4 h-4"}),s("workers.details.tabs.trainings")]}),e.jsxs("button",{type:"button",onClick:()=>J("qualifications"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${U==="qualifications"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(oi,{className:"w-4 h-4"}),s("workers.details.tabs.qualifications")]}),e.jsxs("button",{type:"button",onClick:()=>J("medical"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${U==="medical"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(As,{className:"w-4 h-4"}),s("workers.details.tabs.medical")]}),!N&&e.jsxs("button",{type:"button",onClick:()=>J("ppe"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${U==="ppe"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(ci,{className:"w-4 h-4"}),s("ppe.workerTab.title")]}),e.jsxs("button",{type:"button",onClick:()=>J("sanctions"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${U==="sanctions"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(De,{className:"w-4 h-4"}),s("workers.details.tabs.sanctions")]})]})}),e.jsxs("div",{className:"p-4",children:[U==="trainings"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:!N&&e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>xr(null),children:[e.jsx(Ge,{className:"w-4 h-4"}),s("common.add")]})}),Mr?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(f,{className:"w-6 h-6 animate-spin text-hse-primary"})}):Fs.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:s("workers.details.trainings.empty")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("workers.details.trainings.type")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("workers.details.common.startDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("workers.details.common.endDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("common.actions")})]})}),e.jsx("tbody",{children:Fs.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("div",{className:"font-medium",children:Cr(t)})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:R(t.training_date)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:R(t.expiry_date)}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Ct(Cn(t),{...t,download_url:nr(t)}),children:[e.jsx(Tt,{className:"w-4 h-4"}),s("common.view")]}),t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:a=>{a.stopPropagation(),B(nr(t),"certificate.pdf")},children:[e.jsx(Ce,{className:"w-4 h-4"}),s("common.download")]}),!N&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>xr(t),children:[e.jsx(Ps,{className:"w-4 h-4"}),s("common.edit")]}),!N&&e.jsxs("button",{type:"button",className:"btn-danger btn-sm flex items-center gap-2",onClick:()=>$n(t),children:[e.jsx(We,{className:"w-4 h-4"}),s("common.delete")]})]})})]},t.id))})]})})]}),U==="qualifications"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:!N&&e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>gr(null),children:[e.jsx(Ge,{className:"w-4 h-4"}),s("common.add")]})}),qr?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(f,{className:"w-6 h-6 animate-spin text-hse-primary"})}):Qs.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:s("workers.details.qualifications.empty")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("workers.details.qualifications.type")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("workers.details.common.startDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("workers.details.common.endDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("common.actions")})]})}),e.jsx("tbody",{children:Qs.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[e.jsx("span",{children:Wr(t)}),t.qualification_type==="habilitation_electrique"&&t.qualification_level?e.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200",children:t.qualification_level}):null]})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:R(t.start_date)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:R(t.expiry_date)}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Ct(Wn(t),{...t,download_url:ir(t)}),children:[e.jsx(Tt,{className:"w-4 h-4"}),s("common.view")]}),t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:a=>{a.stopPropagation(),B(ir(t),"certificate.pdf")},children:[e.jsx(Ce,{className:"w-4 h-4"}),s("common.download")]}),!N&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>gr(t),children:[e.jsx(Ps,{className:"w-4 h-4"}),s("common.edit")]}),!N&&e.jsxs("button",{type:"button",className:"btn-danger btn-sm flex items-center gap-2",onClick:()=>En(t),children:[e.jsx(We,{className:"w-4 h-4"}),s("common.delete")]})]})})]},t.id))})]})})]}),U==="medical"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:!N&&e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>hr(null),children:[e.jsx(Ge,{className:"w-4 h-4"}),s("common.add")]})}),Ir?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(f,{className:"w-6 h-6 animate-spin text-hse-primary"})}):Zs.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:s("workers.details.medical.empty")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("workers.details.medical.status")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("workers.details.medical.examNature")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("workers.details.common.startDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("workers.details.common.endDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("common.actions")})]})}),e.jsx("tbody",{children:Zs.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-semibold ${t.aptitude_status==="apte"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300"}`,children:t.aptitude_status==="apte"?s("workers.details.medical.apte"):s("workers.details.medical.inapte")})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:Dr(t)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:R(t.exam_date)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:R(t.expiry_date)}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Ct(Dn(t),{...t,download_url:lr(t)}),children:[e.jsx(Tt,{className:"w-4 h-4"}),s("common.view")]}),t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:a=>{a.stopPropagation(),B(lr(t),"certificate.pdf")},children:[e.jsx(Ce,{className:"w-4 h-4"}),s("common.download")]}),!N&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>hr(t),children:[e.jsx(Ps,{className:"w-4 h-4"}),s("common.edit")]}),!N&&e.jsxs("button",{type:"button",className:"btn-danger btn-sm flex items-center gap-2",onClick:()=>On(t),children:[e.jsx(We,{className:"w-4 h-4"}),s("common.delete")]})]})})]},t.id))})]})})]}),!N&&U==="ppe"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>{d?.id&&(pe({ppe_item_id:"",ppe_other:"",quantity:1,received_at:new Date().toISOString().slice(0,10)}),qe(!0))},children:[e.jsx(Xe,{className:"w-4 h-4"}),s("ppe.workerTab.issueButton")]})}),e.jsxs("div",{className:"card p-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:s("ppe.workerTab.lastIssuedTitle")}),Er?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(f,{className:"w-5 h-5 animate-spin text-hse-primary"})}):$t.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2",children:s("common.noData")}):e.jsx("div",{className:"overflow-x-auto mt-2",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("ppe.workerTab.columns.item")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("ppe.items.stock")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("ppe.workerTab.columns.receivedAt")})]})}),e.jsx("tbody",{children:[...$t].sort((t,a)=>String(t?.name??"").localeCompare(String(a?.name??""))).map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("div",{className:"font-medium",children:t.name})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200 font-mono",children:t.stock_quantity??0}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:R(Sn[t.id])})]},t.id))})]})})]}),e.jsxs("div",{className:"card p-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:s("ppe.workerTab.title")}),Ar?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(f,{className:"w-5 h-5 animate-spin text-hse-primary"})}):Je.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2",children:s("ppe.workerTab.empty")}):e.jsx("div",{className:"overflow-x-auto mt-2",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("ppe.workerTab.columns.item")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("ppe.workerTab.columns.quantity")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("ppe.workerTab.columns.receivedAt")})]})}),e.jsx("tbody",{children:Je.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("div",{className:"font-medium",children:t.ppe_item?.name??t.ppeItem?.name??"-"})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200 font-mono",children:t.quantity??1}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:R(t.received_at)})]},t.id))})]})})]})]}),U==="sanctions"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:Me&&e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>{H({sanction_date:new Date().toISOString().slice(0,10),sanction_type:"",reason:"",mise_a_pied_days:"",document:null}),Ie(!0)},children:[e.jsx(Ge,{className:"w-4 h-4"}),s("common.add")]})}),Pr?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(f,{className:"w-6 h-6 animate-spin text-hse-primary"})}):et.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:s("workers.details.sanctions.empty")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("workers.details.sanctions.date")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("workers.details.sanctions.type")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("common.project")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("workers.details.sanctions.reason")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("common.actions")})]})}),e.jsx("tbody",{children:[...et].sort((t,a)=>{const r=t?.sanction_date?new Date(`${t.sanction_date}T00:00:00`).getTime():0,i=a?.sanction_date?new Date(`${a.sanction_date}T00:00:00`).getTime():0;return r!==i?i-r:Number(a?.id??0)-Number(t?.id??0)}).map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200 whitespace-nowrap",children:R(t.sanction_date)}),e.jsxs("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:[e.jsx("div",{className:"font-medium",children:Tr(t)}),t.sanction_type==="mise_a_pied"&&t.mise_a_pied_days?e.jsxs("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:[t.mise_a_pied_days,"j"]}):null,t.sanction_type==="avertissement"&&rr[t.id]?e.jsxs("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:[s("workers.details.sanctions.successiveAvertissement")," ",rr[t.id]]}):null]}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:t.project?.name??"-"}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:t.reason??""}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.document_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Ct(Tn(t),{...t,download_url:or(t)}),children:[e.jsx(Tt,{className:"w-4 h-4"}),s("common.view")]}),t.document_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:a=>{a.stopPropagation(),B(or(t),"document.pdf")},children:[e.jsx(Ce,{className:"w-4 h-4"}),s("common.download")]}),Sr&&e.jsxs("button",{type:"button",className:"btn-danger btn-sm flex items-center gap-2",onClick:async()=>{if(!(!t?.id||!d?.id))try{await Ve.delete(t.id),o.success(s("success.deleted")),await Cs(d.id)}catch(a){o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}},children:[e.jsx(We,{className:"w-4 h-4"}),s("common.delete")]})]})})]},t.id))})]})})]})]})]})]})}),Xs&&d&&e.jsx(K,{isOpen:Xs,onClose:()=>qe(!1),title:s("ppe.issue.title"),size:"lg",children:e.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),!!d?.id){if(!S.ppe_item_id&&!String(S.ppe_other??"").trim()){o.error(s("ppe.issue.chooseItem"));return}try{ea(!0),await qs.issueToWorker({worker_id:Number(d.id),ppe_item_id:S.ppe_item_id?Number(S.ppe_item_id):void 0,ppe_name:S.ppe_item_id?void 0:String(S.ppe_other??"").trim(),quantity:Number(S.quantity??1),received_at:S.received_at}),o.success(s("ppe.issue.success")),qe(!1),await Promise.all([mr(d.id),ur(d.project_id??d.project?.id)])}catch(a){o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}finally{ea(!1)}}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("ppe.issue.item")}),e.jsxs(b,{value:S.ppe_item_id,onChange:t=>pe(a=>({...a,ppe_item_id:t.target.value,ppe_other:""})),children:[e.jsx("option",{value:"",children:s("ppe.issue.other")}),[...$t].sort((t,a)=>String(t?.name??"").localeCompare(String(a?.name??""))).map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.stock_quantity??0,")"]},t.id))]}),!S.ppe_item_id&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"label text-xs",children:s("ppe.issue.otherSpecify")}),e.jsx("input",{className:"input",value:S.ppe_other,onChange:t=>pe(a=>({...a,ppe_other:t.target.value})),placeholder:s("ppe.issue.otherPlaceholder")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("ppe.issue.quantity")}),e.jsx("input",{type:"number",min:1,className:"input",value:S.quantity,onChange:t=>pe(a=>({...a,quantity:t.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("ppe.issue.receivedAt")}),e.jsx(O,{value:S.received_at,onChange:t=>pe(a=>({...a,received_at:t})),required:!0})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>qe(!1),className:"btn-outline btn-sm",children:s("common.cancel")}),e.jsxs("button",{type:"submit",disabled:Js,className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[Js&&e.jsx(f,{className:"w-4 h-4 animate-spin"}),s("ppe.issue.submit")]})]})]})}),ta&&d&&Me&&e.jsx(K,{isOpen:ta,onClose:()=>Ie(!1),title:s("workers.details.sanctions.addTitle"),size:"lg",children:e.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),!!d?.id&&!(!u.sanction_date||!u.sanction_type||!String(u.reason??"").trim())&&!(u.sanction_type==="mise_a_pied"&&!Number(u.mise_a_pied_days))&&u.document)try{aa(!0),await Ve.create({worker_id:d.id,sanction_date:u.sanction_date,sanction_type:u.sanction_type,reason:String(u.reason??"").trim(),mise_a_pied_days:u.sanction_type==="mise_a_pied"?Number(u.mise_a_pied_days):void 0,document:u.document}),o.success(s("success.saved")),Ie(!1),H({sanction_date:"",sanction_type:"",reason:"",mise_a_pied_days:"",document:null}),await Cs(d.id)}catch(a){o.error(a.response?.data?.message??s("errors.somethingWentWrong"))}finally{aa(!1)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.sanctions.date")}),e.jsx(O,{value:u.sanction_date,onChange:t=>H(a=>({...a,sanction_date:t})),placeholder:s("workers.selectDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.sanctions.type")}),e.jsxs(b,{value:u.sanction_type,onChange:t=>H(a=>({...a,sanction_type:t.target.value})),children:[e.jsx("option",{value:"",children:s("common.select")}),e.jsx("option",{value:"mise_a_pied",children:s("workers.details.sanctions.types.mise_a_pied")}),e.jsx("option",{value:"avertissement",children:s("workers.details.sanctions.types.avertissement")}),e.jsx("option",{value:"rappel_a_lordre",children:s("workers.details.sanctions.types.rappel_a_lordre")}),e.jsx("option",{value:"blame",children:s("workers.details.sanctions.types.blame")})]})]}),u.sanction_type==="mise_a_pied"&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.sanctions.miseAPiedDays")}),e.jsx("input",{type:"number",min:1,className:"input",value:u.mise_a_pied_days,onChange:t=>H(a=>({...a,mise_a_pied_days:t.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.sanctions.reason")}),e.jsx("textarea",{className:"input min-h-[96px]",value:u.reason,onChange:t=>H(a=>({...a,reason:t.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.sanctions.document")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:u.document?u.document.name:s("workers.details.common.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",className:"hidden",onChange:t=>{const a=t.target.files?.[0];if(a&&a.type!=="application/pdf"){o.error(s("workers.details.common.pdfOnly"));return}H(r=>({...r,document:a??null}))}})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>Ie(!1),className:"btn-outline btn-sm",children:s("common.cancel")}),e.jsxs("button",{type:"submit",disabled:sa||!u.sanction_date||!u.sanction_type||!String(u.reason??"").trim()||u.sanction_type==="mise_a_pied"&&!Number(u.mise_a_pied_days)||!u.document,className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[sa&&e.jsx(f,{className:"w-4 h-4 animate-spin"}),s("common.save")]})]})]})}),ca&&e.jsx(K,{isOpen:ca,onClose:Ts,title:s(Qt?"common.edit":"workers.details.qualifications.addTitle"),size:"lg",children:e.jsxs("form",{onSubmit:Pn,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.qualifications.type")}),e.jsxs(b,{value:m.qualification_type,onChange:t=>{const a=t.target.value;F(r=>({...r,qualification_type:a}))},children:[e.jsx("option",{value:"",children:s("common.select")}),Rs.map(t=>e.jsx("option",{value:t.value,children:s(t.labelKey)},t.value))]})]}),m.qualification_type==="habilitation_electrique"&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.qualifications.level")}),e.jsx("input",{className:"input",value:m.qualification_level,onChange:t=>F(a=>({...a,qualification_level:t.target.value})),placeholder:s("workers.details.qualifications.levelPlaceholder")})]}),m.qualification_type==="other"&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.qualifications.otherLabel")}),e.jsx("input",{className:"input",value:m.qualification_label,onChange:t=>F(a=>({...a,qualification_label:t.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.common.startDate")}),e.jsx(O,{value:m.start_date,onChange:t=>{F(a=>{const r={...a,start_date:t};return Lr||(r.expiry_date=t?ks(t,1):""),r})},placeholder:s("workers.details.common.startDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.common.endDate")}),e.jsx(O,{value:m.expiry_date,onChange:t=>{Bt(!0),F(a=>({...a,expiry_date:t}))},placeholder:s("workers.details.common.endDate")}),e.jsx("div",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400",children:s("workers.details.common.endDateAutoHelp")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.common.file")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:m.certificate?m.certificate.name:s("workers.details.common.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:An,className:"hidden"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:Ts,className:"btn-outline btn-sm",children:s("common.cancel")}),e.jsxs("button",{type:"submit",disabled:ma||!m.qualification_type||!m.start_date||m.qualification_type==="other"&&!String(m.qualification_label??"").trim()||m.qualification_type==="habilitation_electrique"&&!String(m.qualification_level??"").trim(),className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[ma&&e.jsx(f,{className:"w-4 h-4 animate-spin"}),s("common.save")]})]})]})}),xa&&e.jsx(K,{isOpen:xa,onClose:Ms,title:s(Zt?"common.edit":"workers.details.medical.addTitle"),size:"lg",children:e.jsxs("form",{onSubmit:Un,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("div",{children:e.jsx("label",{className:"font-medium text-gray-900 dark:text-white text-sm",children:s("workers.details.medical.status")})}),e.jsx("button",{type:"button",onClick:()=>z(t=>({...t,aptitude_status:t.aptitude_status==="apte"?"inapte":"apte"})),className:`relative inline-flex h-6 w-14 items-center rounded-full transition-colors ${h.aptitude_status==="apte"?"bg-green-500":"bg-red-500"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${h.aptitude_status==="apte"?"translate-x-8":"translate-x-1"}`})})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:h.aptitude_status==="apte"?s("workers.details.medical.apte"):s("workers.details.medical.inapte")}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.medical.examNature")}),e.jsxs(b,{value:h.exam_nature,onChange:t=>z(a=>({...a,exam_nature:t.target.value})),children:[e.jsx("option",{value:"",children:s("common.select")}),_r.map(t=>e.jsx("option",{value:t.value,children:s(t.labelKey)},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.medical.ableTo")}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:di.map(t=>e.jsxs("label",{className:"flex items-center gap-2 p-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900",children:[e.jsx("input",{type:"checkbox",checked:Array.isArray(h.able_to)&&h.able_to.includes(t.value),onChange:()=>Ln(t.value),className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-hse-primary focus:ring-hse-primary"}),e.jsx("span",{className:"text-xs text-gray-700 dark:text-gray-200",children:s(t.labelKey)})]},t.value))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.common.startDate")}),e.jsx(O,{value:h.exam_date,onChange:t=>{z(a=>{const r={...a,exam_date:t};return Ur||(r.expiry_date=t?ks(t,1):""),r})},placeholder:s("workers.details.common.startDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.common.endDate")}),e.jsx(O,{value:h.expiry_date,onChange:t=>{Ht(!0),z(a=>({...a,expiry_date:t}))},placeholder:s("workers.details.common.endDate")}),e.jsx("div",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400",children:s("workers.details.common.endDateAutoHelp")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.common.file")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:h.certificate?h.certificate.name:s("workers.details.common.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:Rn,className:"hidden"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:Ms,className:"btn-outline btn-sm",children:s("common.cancel")}),e.jsxs("button",{type:"submit",disabled:ha||!h.exam_nature||!h.exam_date,className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[ha&&e.jsx(f,{className:"w-4 h-4 animate-spin"}),s("common.save")]})]})]})}),ra&&e.jsx(K,{isOpen:ra,onClose:Ds,title:s(Ft?"common.edit":"workers.details.trainings.addTitle"),size:"lg",children:e.jsxs("form",{onSubmit:Kn,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.trainings.type")}),e.jsxs(b,{value:g.training_type,onChange:t=>{const a=t.target.value;Y(r=>({...r,training_type:a}))},children:[e.jsx("option",{value:"",children:s("common.select")}),Es.map(t=>e.jsx("option",{value:t.value,children:s(t.labelKey)},t.value))]})]}),g.training_type==="other"&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.trainings.otherLabel")}),e.jsx("input",{className:"input",value:g.training_label,onChange:t=>Y(a=>({...a,training_label:t.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.common.startDate")}),e.jsx(O,{value:g.training_date,onChange:t=>{Y(a=>{const r={...a,training_date:t};return Rr||(r.expiry_date=t?ks(t,1):""),r})},placeholder:s("workers.details.common.startDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.common.endDate")}),e.jsx(O,{value:g.expiry_date,onChange:t=>{zt(!0),Y(a=>({...a,expiry_date:t}))},placeholder:s("workers.details.common.endDate")}),e.jsx("div",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400",children:s("workers.details.common.endDateAutoHelp")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("workers.details.common.file")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:g.certificate?g.certificate.name:s("workers.details.common.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:In,className:"hidden"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:Ds,className:"btn-outline btn-sm",children:s("common.cancel")}),e.jsxs("button",{type:"submit",disabled:ia||!g.training_type||!g.training_date||g.training_type==="other"&&!String(g.training_label??"").trim(),className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[ia&&e.jsx(f,{className:"w-4 h-4 animate-spin"}),s("common.save")]})]})]})}),T&&e.jsx(K,{isOpen:!!T,onClose:dr,title:s("common.view"),size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[70vh]",children:Kr?e.jsx("div",{className:"w-full h-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 flex items-center justify-center",children:e.jsx(f,{className:"w-6 h-6 animate-spin text-hse-primary"})}):Q?e.jsx("iframe",{src:Q,title:s("common.view"),className:"w-full h-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white"}):e.jsx("div",{className:"w-full h-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 flex items-center justify-center text-sm text-gray-500 dark:text-gray-400",children:s("errors.somethingWentWrong")})}),typeof T?.download_url=="string"&&T.download_url||typeof T?.certificate_url=="string"&&T.certificate_url||typeof T?.document_url=="string"&&T.document_url?e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn-primary inline-flex items-center gap-2 text-sm",onClick:()=>B(T.download_url??T.certificate_url??T.document_url,"document.pdf"),children:[e.jsx(Ce,{className:"w-4 h-4"}),s("common.download")]})}):null]})}),e.jsx(K,{isOpen:sn,onClose:sr,title:s("workers.massDocs.title"),size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s("workers.massDocs.help")}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>fe("trainings"),className:G==="trainings"?"btn-primary btn-sm":"btn-outline btn-sm",children:s("workers.massDocs.categories.trainings")}),e.jsx("button",{type:"button",onClick:()=>fe("qualifications"),className:G==="qualifications"?"btn-primary btn-sm":"btn-outline btn-sm",children:s("workers.massDocs.categories.qualifications")}),e.jsx("button",{type:"button",onClick:()=>fe("medical"),className:G==="medical"?"btn-primary btn-sm":"btn-outline btn-sm",children:s("workers.massDocs.categories.medical")}),e.jsx("button",{type:"button",onClick:()=>{Me&&fe("sanctions")},disabled:!Me,className:G==="sanctions"?"btn-primary btn-sm":Me?"btn-outline btn-sm":"btn-outline btn-sm opacity-50 cursor-not-allowed",children:s("workers.massDocs.categories.sanctions")})]}),G==="trainings"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{type:"button",onClick:gn,className:"w-full btn-outline flex items-center justify-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),s("workers.massDocs.trainings.downloadTemplate")]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center",children:[e.jsx("input",{ref:ne,type:"file",accept:".xlsx,.xls,.csv",onChange:t=>ts(t.target.files?.[0]??null),className:"hidden"}),Ue?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:Ue.name}),e.jsx("button",{type:"button",onClick:()=>{ts(null),ne.current&&(ne.current.value="")},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:e.jsx(Z,{className:"w-4 h-4"})})]}):e.jsx("button",{type:"button",onClick:()=>ne.current?.click(),className:"text-hse-primary hover:underline",children:s("workers.massDocs.trainings.chooseExcel")})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center",children:[e.jsx("input",{ref:ie,type:"file",accept:".zip,application/zip",onChange:t=>ss(t.target.files?.[0]??null),className:"hidden"}),Oe?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:Oe.name}),e.jsx("button",{type:"button",onClick:()=>{ss(null),ie.current&&(ie.current.value="")},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:e.jsx(Z,{className:"w-4 h-4"})})]}):e.jsx("button",{type:"button",onClick:()=>ie.current?.click(),className:"text-hse-primary hover:underline",children:s("workers.massDocs.trainings.chooseZip")})]}),St(pt),e.jsxs("button",{type:"button",onClick:bn,disabled:!Ue||!Oe||ut,className:"w-full btn-primary flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[ut&&e.jsx(f,{className:"w-4 h-4 animate-spin"}),e.jsx(Mt,{className:"w-4 h-4"}),s("workers.massDocs.trainings.import")]}),be&&e.jsx("div",{className:"p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"text-gray-700 dark:text-gray-200",children:s("workers.massDocs.trainings.result",{imported:be?.imported??0,failed:be?.failed_count??0})}),Array.isArray(be?.zip_errors)&&be.zip_errors.length>0?e.jsx("div",{className:"text-xs text-amber-700 dark:text-amber-300",children:s("workers.massDocs.trainings.zipErrorsCount",{count:be.zip_errors.length})}):null]})})]}),G==="qualifications"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{type:"button",onClick:hn,className:"w-full btn-outline flex items-center justify-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),s("workers.massDocs.qualifications.downloadTemplate")]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center",children:[e.jsx("input",{ref:le,type:"file",accept:".xlsx,.xls,.csv",onChange:t=>is(t.target.files?.[0]??null),className:"hidden"}),Ke?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:Ke.name}),e.jsx("button",{type:"button",onClick:()=>{is(null),le.current&&(le.current.value="")},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:e.jsx(Z,{className:"w-4 h-4"})})]}):e.jsx("button",{type:"button",onClick:()=>le.current?.click(),className:"text-hse-primary hover:underline",children:s("workers.massDocs.qualifications.chooseExcel")})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center",children:[e.jsx("input",{ref:oe,type:"file",accept:".zip,application/zip",onChange:t=>ls(t.target.files?.[0]??null),className:"hidden"}),$e?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:$e.name}),e.jsx("button",{type:"button",onClick:()=>{ls(null),oe.current&&(oe.current.value="")},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:e.jsx(Z,{className:"w-4 h-4"})})]}):e.jsx("button",{type:"button",onClick:()=>oe.current?.click(),className:"text-hse-primary hover:underline",children:s("workers.massDocs.qualifications.chooseZip")})]}),St(ht),e.jsxs("button",{type:"button",onClick:jn,disabled:!Ke||!$e||gt,className:"w-full btn-primary flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[gt&&e.jsx(f,{className:"w-4 h-4 animate-spin"}),e.jsx(Mt,{className:"w-4 h-4"}),s("workers.massDocs.qualifications.import")]}),je&&e.jsx("div",{className:"p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"text-gray-700 dark:text-gray-200",children:s("workers.massDocs.qualifications.result",{imported:je?.imported??0,failed:je?.failed_count??0})}),Array.isArray(je?.zip_errors)&&je.zip_errors.length>0?e.jsx("div",{className:"text-xs text-amber-700 dark:text-amber-300",children:s("workers.massDocs.qualifications.zipErrorsCount",{count:je.zip_errors.length})}):null]})})]}),G==="medical"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{type:"button",onClick:yn,className:"w-full btn-outline flex items-center justify-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),s("workers.massDocs.medical.downloadTemplate")]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center",children:[e.jsx("input",{ref:ce,type:"file",accept:".xlsx,.xls,.csv",onChange:t=>ms(t.target.files?.[0]??null),className:"hidden"}),Fe?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:Fe.name}),e.jsx("button",{type:"button",onClick:()=>{ms(null),ce.current&&(ce.current.value="")},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:e.jsx(Z,{className:"w-4 h-4"})})]}):e.jsx("button",{type:"button",onClick:()=>ce.current?.click(),className:"text-hse-primary hover:underline",children:s("workers.massDocs.medical.chooseExcel")})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center",children:[e.jsx("input",{ref:de,type:"file",accept:".zip,application/zip",onChange:t=>us(t.target.files?.[0]??null),className:"hidden"}),ze?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:ze.name}),e.jsx("button",{type:"button",onClick:()=>{us(null),de.current&&(de.current.value="")},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:e.jsx(Z,{className:"w-4 h-4"})})]}):e.jsx("button",{type:"button",onClick:()=>de.current?.click(),className:"text-hse-primary hover:underline",children:s("workers.massDocs.medical.chooseZip")})]}),St(bt),e.jsxs("button",{type:"button",onClick:wn,disabled:!Fe||!ze||ft,className:"w-full btn-primary flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[ft&&e.jsx(f,{className:"w-4 h-4 animate-spin"}),e.jsx(Mt,{className:"w-4 h-4"}),s("workers.massDocs.medical.import")]}),we&&e.jsx("div",{className:"p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"text-gray-700 dark:text-gray-200",children:s("workers.massDocs.medical.result",{imported:we?.imported??0,failed:we?.failed_count??0})}),Array.isArray(we?.zip_errors)&&we.zip_errors.length>0?e.jsx("div",{className:"text-xs text-amber-700 dark:text-amber-300",children:s("workers.massDocs.medical.zipErrorsCount",{count:we.zip_errors.length})}):null]})})]}),G==="sanctions"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{type:"button",onClick:fn,className:"w-full btn-outline flex items-center justify-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),s("workers.massDocs.sanctions.downloadTemplate")]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center",children:[e.jsx("input",{ref:me,type:"file",accept:".xlsx,.xls,.csv",onChange:t=>hs(t.target.files?.[0]??null),className:"hidden"}),Qe?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:Qe.name}),e.jsx("button",{type:"button",onClick:()=>{hs(null),me.current&&(me.current.value="")},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:e.jsx(Z,{className:"w-4 h-4"})})]}):e.jsx("button",{type:"button",onClick:()=>me.current?.click(),className:"text-hse-primary hover:underline",children:s("workers.massDocs.sanctions.chooseExcel")})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center",children:[e.jsx("input",{ref:ue,type:"file",accept:".zip,application/zip",onChange:t=>ys(t.target.files?.[0]??null),className:"hidden"}),Be?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:Be.name}),e.jsx("button",{type:"button",onClick:()=>{ys(null),ue.current&&(ue.current.value="")},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:e.jsx(Z,{className:"w-4 h-4"})})]}):e.jsx("button",{type:"button",onClick:()=>ue.current?.click(),className:"text-hse-primary hover:underline",children:s("workers.massDocs.sanctions.chooseZip")})]}),St(vt),e.jsxs("button",{type:"button",onClick:vn,disabled:!Qe||!Be||wt,className:"w-full btn-primary flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[wt&&e.jsx(f,{className:"w-4 h-4 animate-spin"}),e.jsx(Mt,{className:"w-4 h-4"}),s("workers.massDocs.sanctions.import")]}),ve&&e.jsx("div",{className:"p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"text-gray-700 dark:text-gray-200",children:s("workers.massDocs.sanctions.result",{imported:ve?.imported??0,failed:ve?.failed_count??0})}),Array.isArray(ve?.zip_errors)&&ve.zip_errors.length>0?e.jsx("div",{className:"text-xs text-amber-700 dark:text-amber-300",children:s("workers.massDocs.sanctions.zipErrorsCount",{count:ve.zip_errors.length})}):null]})})]}),e.jsx("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:e.jsx("button",{type:"button",onClick:sr,className:"btn-outline",children:s("common.cancel")})})]})}),e.jsx(K,{isOpen:tn,onClose:()=>dt(!1),title:s("workers.importTitle"),size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s("workers.importHelp")}),e.jsxs("button",{onClick:xn,className:"w-full btn-outline flex items-center justify-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),s("workers.downloadTemplate")]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center",children:[e.jsx("input",{ref:Ls,type:"file",accept:".xlsx,.xls,.csv",onChange:t=>mt(t.target.files[0]),className:"hidden"}),Le?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:Le.name}),e.jsx("button",{type:"button",onClick:()=>mt(null),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:e.jsx(Z,{className:"w-4 h-4"})})]}):e.jsx("button",{type:"button",onClick:()=>Ls.current?.click(),className:"text-hse-primary hover:underline",children:s("workers.selectFile")})]}),e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg text-sm text-amber-700 dark:text-amber-300",children:e.jsx("p",{children:s("workers.cinInfo")})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>{dt(!1),mt(null)},className:"btn-outline",children:s("common.cancel")}),e.jsxs("button",{type:"button",onClick:_n,disabled:!Le||Ha,className:"btn-primary flex items-center gap-2",children:[Ha&&e.jsx(f,{className:"w-4 h-4 animate-spin"}),s("workers.import")]})]})]})}),e.jsx(br,{isOpen:!!ke,title:s("common.confirm"),message:ke?s("workers.confirmDeactivate",{name:`${ke.prenom} ${ke.nom}`}):"",confirmLabel:s("workers.deactivate"),cancelLabel:s("common.cancel"),variant:"danger",onConfirm:mn,onCancel:()=>ws(null)}),e.jsx(br,{isOpen:an,title:s("common.confirm"),message:s("workers.confirmBulkDeactivate",{count:ae.length}),confirmLabel:s("workers.bulkDeactivate"),cancelLabel:s("common.cancel"),variant:"danger",onConfirm:pn,onCancel:()=>_t(!1)})]})}export{ki as default};
