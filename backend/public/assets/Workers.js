import{a as Yr,u as Vr,w as W,p as ks,j as e,x as Et,y as Lt,z as de,n as Be,A as He,B as Ye}from"./index.js";import{b as Zr,u as Gr,r as i}from"./vendor-react.js";import{D as K}from"./DatePicker.js";import{C as _s}from"./ConfirmDialog.js";import{M as R}from"./Modal.js";import{S as h}from"./Select.js";import{A as ws}from"./AutocompleteInput.js";import{s as Jr,g as Ns}from"./projectList.js";import{z as l,am as me,aA as Xr,C as Ss,U as Cs,i as It,q as Kt,ae as ei,aI as ti,aj as ue,v as y,aB as ai,aD as si,B as ri,P as Ce,ax as ii,h as pe,c as ni,j as li,I as Ve,aJ as Rt,aK as Ws,a9 as Ze,k as Ot,ac as oi}from"./vendor-ui.js";import"./vendor-utils.js";const Ut=[{value:"bypassing_safety_controls",labelKey:"workers.details.trainings.types.bypassing_safety_controls"},{value:"formation_coactivite",labelKey:"workers.details.trainings.types.formation_coactivite"},{value:"formation_coffrage_decoffrage",labelKey:"workers.details.trainings.types.formation_coffrage_decoffrage"},{value:"formation_conduite_defensive",labelKey:"workers.details.trainings.types.formation_conduite_defensive"},{value:"formation_analyse_des_risques",labelKey:"workers.details.trainings.types.formation_analyse_des_risques"},{value:"formation_elingage_manutention",labelKey:"workers.details.trainings.types.formation_elingage_manutention"},{value:"formation_ergonomie",labelKey:"workers.details.trainings.types.formation_ergonomie"},{value:"formation_excavations",labelKey:"workers.details.trainings.types.formation_excavations"},{value:"formation_outils_electroportatifs",labelKey:"workers.details.trainings.types.formation_outils_electroportatifs"},{value:"formation_epi",labelKey:"workers.details.trainings.types.formation_epi"},{value:"formation_environnement",labelKey:"workers.details.trainings.types.formation_environnement"},{value:"formation_espaces_confines",labelKey:"workers.details.trainings.types.formation_espaces_confines"},{value:"formation_flagman",labelKey:"workers.details.trainings.types.formation_flagman"},{value:"formation_jha",labelKey:"workers.details.trainings.types.formation_jha"},{value:"formation_line_of_fire",labelKey:"workers.details.trainings.types.formation_line_of_fire"},{value:"formation_manutention_manuelle",labelKey:"workers.details.trainings.types.formation_manutention_manuelle"},{value:"formation_manutention_mecanique",labelKey:"workers.details.trainings.types.formation_manutention_mecanique"},{value:"formation_point_chaud",labelKey:"workers.details.trainings.types.formation_point_chaud"},{value:"formation_produits_chimiques",labelKey:"workers.details.trainings.types.formation_produits_chimiques"},{value:"formation_risques_electriques",labelKey:"workers.details.trainings.types.formation_risques_electriques"},{value:"induction_hse",labelKey:"workers.details.trainings.types.induction_hse"},{value:"travail_en_hauteur",labelKey:"workers.details.trainings.types.travail_en_hauteur"},{value:"other",labelKey:"workers.details.trainings.types.other"}],$t=[{value:"elingueur",labelKey:"workers.details.qualifications.types.elingueur"},{value:"equipier_premiere_intervention",labelKey:"workers.details.qualifications.types.equipier_premiere_intervention"},{value:"habilitation_electrique",labelKey:"workers.details.qualifications.types.habilitation_electrique"},{value:"inspecteur_echafaudage",labelKey:"workers.details.qualifications.types.inspecteur_echafaudage"},{value:"monteur_echafaudage",labelKey:"workers.details.qualifications.types.monteur_echafaudage"},{value:"monteur_grue_a_tour",labelKey:"workers.details.qualifications.types.monteur_grue_a_tour"},{value:"operateur_bulldozer",labelKey:"workers.details.qualifications.types.operateur_bulldozer"},{value:"operateur_chargeuse",labelKey:"workers.details.qualifications.types.operateur_chargeuse"},{value:"operateur_chariot_elevateur",labelKey:"workers.details.qualifications.types.operateur_chariot_elevateur"},{value:"operateur_compacteur",labelKey:"workers.details.qualifications.types.operateur_compacteur"},{value:"operateur_dumper",labelKey:"workers.details.qualifications.types.operateur_dumper"},{value:"operateur_grue_a_tour",labelKey:"workers.details.qualifications.types.operateur_grue_a_tour"},{value:"operateur_grue_mobile",labelKey:"workers.details.qualifications.types.operateur_grue_mobile"},{value:"operateur_niveleuse",labelKey:"workers.details.qualifications.types.operateur_niveleuse"},{value:"operateur_nacelle",labelKey:"workers.details.qualifications.types.operateur_nacelle"},{value:"operateur_pelle",labelKey:"workers.details.qualifications.types.operateur_pelle"},{value:"sst",labelKey:"workers.details.qualifications.types.sst"},{value:"soudeur",labelKey:"workers.details.qualifications.types.soudeur"},{value:"utilisation_meule",labelKey:"workers.details.qualifications.types.utilisation_meule"},{value:"other",labelKey:"workers.details.qualifications.types.other"}],Ds=[{value:"embauche_reintegration",labelKey:"workers.details.medical.examNatures.embauche_reintegration"},{value:"visite_systematique",labelKey:"workers.details.medical.examNatures.visite_systematique"},{value:"surveillance_medical_special",labelKey:"workers.details.medical.examNatures.surveillance_medical_special"},{value:"visite_de_reprise",labelKey:"workers.details.medical.examNatures.visite_de_reprise"},{value:"visite_spontanee",labelKey:"workers.details.medical.examNatures.visite_spontanee"}],ci=[{value:"travaux_en_hauteur",labelKey:"workers.details.medical.ableToOptions.travaux_en_hauteur"},{value:"travaux_electrique",labelKey:"workers.details.medical.ableToOptions.travaux_electrique"},{value:"travaux_en_espace_confine",labelKey:"workers.details.medical.ableToOptions.travaux_en_espace_confine"},{value:"operateur",labelKey:"workers.details.medical.ableToOptions.operateur"},{value:"travaux_point_chaud",labelKey:"workers.details.medical.ableToOptions.travaux_point_chaud"}];function ki(){const{t:a}=Yr(),{user:xe}=Vr(),Ge=Zr(),Ts=Gr(),Ft=i.useRef(null),ee=i.useRef(null),te=i.useRef(null),w=xe?.role==="hr"||xe?.role==="hr_director",zt=["hse_manager","responsable","supervisor","user"].includes(xe?.role),qs=xe?.role==="hse_manager",Je=i.useRef(0),Xe=i.useRef(null),et=i.useRef(null),Qt=i.useRef(null),As=t=>{const s=t?.training_type;if(!s)return"-";if(s==="other")return String(t?.training_label??"").trim()||a("workers.details.trainings.types.other");const r=Ut.find(n=>n.value===s);return r?.labelKey?a(r.labelKey):String(s)},Ps=t=>{const s=t?.qualification_type;if(!s)return"-";if(s==="other")return String(t?.qualification_label??"").trim()||a("workers.details.qualifications.types.other");const r=$t.find(n=>n.value===s);return r?.labelKey?a(r.labelKey):String(s)},Ms=t=>{const s=t?.exam_nature;if(!s)return"-";const r=Ds.find(n=>n.value===s);return r?.labelKey?a(r.labelKey):String(s)},Es=t=>{const s=t?.sanction_type;return s?a(`workers.details.sanctions.types.${s}`):"-"},[Bt,Ht]=i.useState(!1),[c,Yt]=i.useState(null),[I,Y]=i.useState("trainings"),[Vt,tt]=i.useState([]),[Ls,Zt]=i.useState(!1),[Gt,at]=i.useState([]),[Is,Jt]=i.useState(!1),[Xt,st]=i.useState([]),[Ks,ea]=i.useState(!1),[We,rt]=i.useState([]),[Rs,ta]=i.useState(!1),[De,it]=i.useState([]),[Os,aa]=i.useState(!1),[nt,Te]=i.useState([]),[Us,sa]=i.useState(!1),[ra,ge]=i.useState(!1),[ia,na]=i.useState(!1),[N,ae]=i.useState({ppe_item_id:"",ppe_other:"",quantity:1,received_at:""}),[la,he]=i.useState(!1),[oa,ca]=i.useState(!1),[u,z]=i.useState({sanction_date:"",sanction_type:"",reason:"",mise_a_pied_days:"",document:null}),[da,ma]=i.useState(!1),[ua,pa]=i.useState(!1),[lt,xa]=i.useState(null),[$s,ot]=i.useState(!1),[x,Q]=i.useState({training_type:"",training_label:"",training_date:"",expiry_date:"",certificate:null}),[ga,ha]=i.useState(!1),[ya,fa]=i.useState(!1),[ct,ba]=i.useState(null),[Fs,dt]=i.useState(!1),[d,O]=i.useState({qualification_type:"",qualification_level:"",qualification_label:"",start_date:"",expiry_date:"",certificate:null}),[ja,va]=i.useState(!1),[ka,_a]=i.useState(!1),[mt,wa]=i.useState(null),[zs,ut]=i.useState(!1),[g,U]=i.useState({aptitude_status:"apte",exam_nature:"",able_to:[],exam_date:"",expiry_date:"",certificate:null}),[se,qe]=i.useState(null),[Qs,Na]=i.useState(!1),[Sa,Ca]=i.useState(!1),ye=i.useRef(!1),[D,pt]=i.useState(null),[$,Ae]=i.useState(null),[Bs,xt]=i.useState(!1),re=i.useRef(!1),[V,Wa]=i.useState([]),[fe,Hs]=i.useState([]),[Da,Ys]=i.useState([]),[Ta,Vs]=i.useState([]),[ie,Zs]=i.useState(null),[Gs,qa]=i.useState(!0),[gt,f]=i.useState(1),[di,Js]=i.useState(1),[ht,Xs]=i.useState(0),[er]=i.useState(50),[be,tr]=i.useState(""),[B,ar]=i.useState(""),[v,Aa]=i.useState(""),[b,Pe]=i.useState(""),[T,Pa]=i.useState(""),[q,Ma]=i.useState(""),[Me,Ee]=i.useState(!1),Ea=i.useRef(null),La=i.useRef(null),[yt,ne]=i.useState(!1),Ia=i.useRef(null),Ka=i.useRef(null),[k,Ra]=i.useState(""),[Z,Oa]=i.useState("has"),[_,Ua]=i.useState(""),[G,$a]=i.useState("has"),[S,Fa]=i.useState(""),[A,za]=i.useState(""),[P,Qa]=i.useState(""),[M,Ba]=i.useState(""),[sr,Ha]=i.useState([]),Ya=xe?.project_list_preference??"code",Le=i.useMemo(()=>Jr(fe,Ya),[fe,Ya]),rr=i.useMemo(()=>{const t=Array.isArray(Le)?Le:[];return v?t.filter(s=>s?.pole===v):t},[Le,v]),[J,Ie]=i.useState([]),[Ke,Va]=i.useState(!1),[ir,Za]=i.useState(!1),[nr,Re]=i.useState(!1),[lr,Ga]=i.useState(!1),[Ja,ft]=i.useState("trainings"),[je,bt]=i.useState(null),[Xa,es]=i.useState(!1),[ts,as]=i.useState(!1),[ve,Oe]=i.useState(null),[ke,jt]=i.useState(null),[_e,vt]=i.useState(null),[ss,kt]=i.useState(!1),[le,_t]=i.useState(null),[oe,wt]=i.useState(null),[or,Ue]=i.useState(!1),[p,E]=i.useState({nom:"",prenom:"",fonction:"",cin:"",date_naissance:"",entreprise:"",project_id:"",date_entree:"",is_active:!0});i.useEffect(()=>{rs(),X()},[]),i.useEffect(()=>{const s=new URLSearchParams(Ge.search).get("worker_id"),r=s?String(s).trim():"";r&&(async()=>{try{const n=await W.getById(r),o=n.data?.data??n.data;o&&await qt(o)}catch{}finally{const n=new URLSearchParams(Ge.search);n.delete("worker_id"),Ts({pathname:Ge.pathname,search:n.toString()?`?${n.toString()}`:""},{replace:!0})}})()},[]),i.useEffect(()=>{$e()},[gt,B,b,T,q,v,k,Z,_,G,S,A,P,M]),i.useEffect(()=>{X()},[B,b,T,q,v,k,Z,_,G,S,A,P,M]),i.useEffect(()=>{if(!Me)return;const t=r=>{r.key==="Escape"&&Ee(!1)},s=r=>{const n=Ea.current,o=La.current,m=r.target;n&&n.contains(m)||o&&o.contains(m)||Ee(!1)};return document.addEventListener("keydown",t),document.addEventListener("mousedown",s),()=>{document.removeEventListener("keydown",t),document.removeEventListener("mousedown",s)}},[Me]),i.useEffect(()=>{if(!yt)return;const t=r=>{r.key==="Escape"&&ne(!1)},s=r=>{const n=Ia.current,o=Ka.current,m=r.target;n&&n.contains(m)||o&&o.contains(m)||ne(!1)};return document.addEventListener("keydown",t),document.addEventListener("mousedown",s),()=>{document.removeEventListener("keydown",t),document.removeEventListener("mousedown",s)}},[yt]),i.useEffect(()=>{(async()=>{try{const s=await ks.getPoles(),r=s.data?.data?.poles??s.data?.poles??[];Ha(Array.isArray(r)?r:[])}catch{Ha([])}})()},[]),i.useEffect(()=>{if(!v)return;!fe.some(s=>String(s.id)===String(b)&&s?.pole===v)&&b&&Pe("")},[v,b,fe]),i.useEffect(()=>{const t=setTimeout(()=>{ar(be)},300);return()=>clearTimeout(t)},[be]);const rs=async()=>{try{const[t,s,r]=await Promise.all([ks.getAllList({status:"active"}),W.getEntreprises(),W.getFonctions()]);Hs(Array.isArray(t)?t:[]),Ys(s.data.data??[]),Vs(r.data.data??[])}catch(t){console.error("Failed to load initial data:",t)}},X=async()=>{try{et.current&&et.current.abort();const t=new AbortController;et.current=t;const s={search:B||void 0,pole:v||void 0,project_id:b||void 0,entreprise:T||void 0,fonction:q||void 0,sanction:M||void 0,training_type:k||void 0,training_presence:k?Z:void 0,qualification_type:_||void 0,qualification_presence:_?G:void 0,medical_presence:S||void 0,medical_status:A||void 0,expired_filter:P||void 0,is_active:!0},r=await W.getStatistics(s,{signal:t.signal});Zs(r.data.data)}catch(t){if(t?.name==="CanceledError"||t?.name==="AbortError"||t?.code==="ERR_CANCELED")return}},$e=async()=>{try{qa(!0),Xe.current&&Xe.current.abort();const t=new AbortController;Xe.current=t;const s=Je.current+1;Je.current=s;const r={page:gt,per_page:er,search:B||void 0,pole:v||void 0,project_id:b||void 0,entreprise:T||void 0,fonction:q||void 0,sanction:M||void 0,training_type:k||void 0,training_presence:k?Z:void 0,qualification_type:_||void 0,qualification_presence:_?G:void 0,medical_presence:S||void 0,medical_status:A||void 0,expired_filter:P||void 0,is_active:!0},n=await W.getAll(r,{signal:t.signal});if(s!==Je.current)return;const o=n.data,m=o.data??o,C=Array.isArray(m)?m:m?.data??[],H=o.meta??m.meta??m;Wa(F=>{if(gt===1)return C;const j=[...F,...C],ze=new Set;return j.filter(we=>{const Ne=we?.id;if(Ne==null)return!0;const Qe=String(Ne);return ze.has(Qe)?!1:(ze.add(Qe),!0)})}),Js(H.last_page??1),Xs(H.total??C.length)}catch(t){if(t?.name==="CanceledError"||t?.name==="AbortError"||t?.code==="ERR_CANCELED")return;l.error(a("errors.somethingWentWrong"))}finally{qa(!1)}},cr=ie?.hse_team??V.filter(t=>{const s=String(t?.fonction??"").toLowerCase();return s?["animateur","animatrice","hse","coordinateur","coordinatrice"].some(n=>s.includes(n)):!1}).length,dr=ie?.induction_hse??0,mr=ie?.travail_en_hauteur??0,ur=ie?.medical_aptitude??0,is=(t=null)=>{t?(bt(t),E({nom:t.nom??"",prenom:t.prenom??"",fonction:t.fonction??"",cin:t.cin?.toUpperCase()??"",date_naissance:t.date_naissance?.split("T")[0]??"",entreprise:t.entreprise??"",project_id:t.project_id??"",date_entree:t.date_entree?.split("T")[0]??"",is_active:t.is_active??!0})):(bt(null),E({nom:"",prenom:"",fonction:"",cin:"",date_naissance:"",entreprise:"",project_id:"",date_entree:"",is_active:!0})),Za(!0)},Nt=()=>{Za(!1),bt(null)},pr=async t=>{t.preventDefault(),es(!0);const s={...p,cin:p.cin?.toUpperCase()};try{je?(await W.update(je.id,s),l.success(a("workers.updated"))):(await W.create(s)).data.data?.merged?l.success(a("workers.merged")):l.success(a("workers.created")),Nt(),$e(),X()}catch(r){l.error(r.response?.data?.message??a("errors.somethingWentWrong"))}finally{es(!1)}},xr=t=>{wt(t)},gr=async()=>{if(oe)try{await W.delete(oe.id),l.success(a("workers.deactivated")),$e(),X()}catch{l.error(a("errors.somethingWentWrong"))}finally{wt(null)}},hr=()=>{J.length!==0&&Ue(!0)},yr=async()=>{if(J.length===0){Ue(!1);return}try{const t=await W.bulkDeactivate(J);l.success(a("workers.bulkDeactivated",{count:t.data.data.deactivated_count})),Ie([]),Va(!1),$e(),X()}catch{l.error(a("errors.somethingWentWrong"))}finally{Ue(!1)}},fr=async()=>{try{const t=await W.downloadTemplate(),s=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=s,r.setAttribute("download","workers_template.xlsx"),document.body.appendChild(r),r.click(),r.remove()}catch{l.error(a("errors.somethingWentWrong"))}},br=async()=>{try{const t=await de.downloadMassTemplate(),s=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=s,r.setAttribute("download","worker_trainings_mass_template.xlsx"),document.body.appendChild(r),r.click(),r.remove()}catch(t){l.error(t.response?.data?.message??a("errors.somethingWentWrong"))}},ns=()=>{Ga(!1),ft("trainings"),jt(null),vt(null),_t(null),kt(!1),ee.current&&(ee.current.value=""),te.current&&(te.current.value="")},jr=async()=>{if(!(!ke||!_e)){kt(!0),_t(null);try{const t=await de.massImport({excel:ke,zip:_e}),s=t.data?.data??t.data;_t(s);const r=s?.imported??0,n=s?.failed_count??0;l.success(a("workers.massDocs.trainings.importSuccess",{imported:r,failed:n})),s?.failed_rows_url&&await ce(s.failed_rows_url,"worker_trainings_failed_rows.xlsx")}catch(t){l.error(t.response?.data?.message??a("errors.somethingWentWrong"))}finally{kt(!1)}}},vr=async()=>{try{const s={pole:v||void 0,project_id:b||void 0,entreprise:T||void 0,fonction:q||void 0,sanction:M||void 0,training_type:k||void 0,training_presence:k?Z:void 0,qualification_type:_||void 0,qualification_presence:_?G:void 0,medical_presence:S||void 0,medical_status:A||void 0,expired_filter:P||void 0,is_active:!0,search:B||be||void 0},r=await W.export(s),n=r.data instanceof Blob?r.data:new Blob([r.data]),o=window.URL.createObjectURL(n),C=(r.headers?.["content-disposition"]??r.headers?.["Content-Disposition"])?.match(/filename\*=UTF-8''([^;]+)|filename="?([^";]+)"?/i),H=C?.[1]??C?.[2],F=H?decodeURIComponent(H):null,j=[];if(b){const vs=fe.find(Hr=>String(Hr.id)===String(b))?.name;vs&&j.push(vs)}T&&j.push(T),q&&j.push(q),k&&j.push(`training:${k}-${Z}`),_&&j.push(`qualification:${_}-${G}`),S&&j.push(`medical:${S}${A?`-${A}`:""}`),P&&j.push(`expired:${P}`),M&&j.push(`sanction:${M}`);const ze=j.length?j.join(", "):"active",we=new Date,Ne=String(we.getDate()).padStart(2,"0"),Qe=String(we.getMonth()+1).padStart(2,"0"),Ur=String(we.getFullYear()),$r=`${Ne}-${Qe}-${Ur}`,Fr=ze.replace(/[\\/:*?"<>|]/g,"-").replace(/\s+/g," ").trim(),zr=(n.type?.includes("csv")?!0:!!n.type?.includes("text/plain"))?"csv":"xlsx",Qr=`Workers_export_(${Fr})_date(${$r}).${zr}`,Br=F??Qr,Se=document.createElement("a");Se.href=o,Se.setAttribute("download",Br),document.body.appendChild(Se),Se.click(),Se.remove(),l.success(a("common.exportSuccess"))}catch(t){try{const s=t?.response?.data;if(s instanceof Blob&&s.type?.includes("application/json")){const r=await s.text(),n=JSON.parse(r);l.error(n?.message??a("errors.somethingWentWrong"));return}}catch{}l.error(t.response?.data?.message??a("errors.somethingWentWrong"))}},kr=async()=>{if(ve){as(!0);try{const t=new FormData;t.append("file",ve),b&&t.append("project_id",b);const s=await W.import(t);l.success(a("workers.importSuccess",{imported:s.data.data.imported_count,merged:s.data.data.merged_count})),Re(!1),Oe(null),f(1),Wa([]),rs()}catch(t){l.error(t.response?.data?.message??a("errors.somethingWentWrong"))}finally{as(!1)}}},_r=t=>{Ie(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},ls=()=>{Ie(Ke?[]:V.map(t=>t.id)),Va(!Ke)},L=t=>t?new Date(t).toLocaleDateString("fr-FR"):"-",wr=i.useMemo(()=>{const t={};for(const s of We){const r=s?.ppe_item_id??s?.ppe_item?.id??s?.ppeItem?.id,n=s?.received_at;!r||!n||(!t[r]||new Date(n)>new Date(t[r]))&&(t[r]=n)}return t},[We]),os=i.useMemo(()=>{const t=[...De].sort((n,o)=>{const m=n?.sanction_date?new Date(`${n.sanction_date}T00:00:00`).getTime():0,C=o?.sanction_date?new Date(`${o.sanction_date}T00:00:00`).getTime():0;return m!==C?m-C:Number(n?.id??0)-Number(o?.id??0)});let s=0;const r={};for(const n of t){if(n?.sanction_type==="mise_a_pied"){s=0;continue}n?.sanction_type==="avertissement"&&(s+=1,r[n.id]=s)}return r},[De]),St=(t,s)=>{if(!t)return"";const r=new Date(`${t}T00:00:00`);if(Number.isNaN(r.getTime()))return"";r.setFullYear(r.getFullYear()+s);const n=r.getFullYear(),o=String(r.getMonth()+1).padStart(2,"0"),m=String(r.getDate()).padStart(2,"0");return`${n}-${o}-${m}`},Nr=t=>t?.id?`/api/worker-trainings/${t.id}/certificate/view`:null,cs=t=>t?.id?`/api/worker-trainings/${t.id}/certificate/download`:null,Sr=t=>t?.id?`/api/worker-qualifications/${t.id}/certificate/view`:null,ds=t=>t?.id?`/api/worker-qualifications/${t.id}/certificate/download`:null,Cr=t=>t?.id?`/api/worker-medical-aptitudes/${t.id}/certificate/view`:null,ms=t=>t?.id?`/api/worker-medical-aptitudes/${t.id}/certificate/download`:null,Wr=t=>t?.id?`/api/worker-sanctions/${t.id}/document/view`:null,us=t=>t?.id?`/api/worker-sanctions/${t.id}/document/download`:null,ps=t=>{if(!t||typeof t!="string")return null;if(t.startsWith("/api/"))return t.slice(4);if(t.startsWith("api/"))return t.slice(3);if(t.startsWith("/storage/"))return t;if(t.startsWith("storage/"))return`/${t}`;if(t.startsWith("http://")||t.startsWith("https://"))try{const s=new URL(t);if(s.pathname.startsWith("/storage/"))return`${s.pathname}${s.search}`}catch{}return t},ce=async(t,s="document.pdf")=>{if(t)try{const r=ps(t),n=await Be.get(r,{responseType:"blob"}),o=n.data;let m=s;const C=n.headers?.["content-disposition"];if(typeof C=="string"){const j=/filename="?([^";]+)"?/i.exec(C);j&&j[1]&&(m=j[1])}const H=URL.createObjectURL(o),F=document.createElement("a");F.href=H,F.download=m,document.body.appendChild(F),F.click(),F.remove(),setTimeout(()=>URL.revokeObjectURL(H),1e3)}catch(r){l.error(r.response?.data?.message??a("errors.somethingWentWrong"))}},xs=()=>{pt(null),xt(!1),$&&re.current&&URL.revokeObjectURL($),re.current=!1,Ae(null)},Fe=async(t,s)=>{if(t)try{if(pt(s??{}),xt(!0),$&&re.current&&URL.revokeObjectURL($),re.current=!1,Ae(null),typeof t=="string"&&t.startsWith("blob:")){Ae(t);return}const r=ps(t);let n;if(typeof r=="string"&&r.startsWith("/storage/")){const m=await fetch(r);if(!m.ok)throw new Error(`Failed to fetch: ${m.status}`);n=await m.blob()}else n=(await Be.get(r,{responseType:"blob"})).data;const o=URL.createObjectURL(n);re.current=!0,Ae(o)}catch(r){l.error(r.response?.data?.message??a("errors.somethingWentWrong")),pt(null)}finally{xt(!1)}};i.useEffect(()=>()=>{$&&re.current&&URL.revokeObjectURL($)},[$]);const Ct=async t=>{if(t)try{Zt(!0);const r=(await de.getAll({worker_id:t,per_page:100})).data,n=r.data??r,o=Array.isArray(n)?n:n.data??[];tt(Array.isArray(o)?o:[])}catch(s){tt([]),l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Zt(!1)}},Wt=async t=>{if(t)try{Jt(!0);const r=(await He.getAll({worker_id:t,per_page:100})).data,n=r.data??r,o=Array.isArray(n)?n:n.data??[];at(Array.isArray(o)?o:[])}catch(s){at([]),l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Jt(!1)}},Dt=async t=>{if(t)try{ea(!0);const r=(await Ye.getAll({worker_id:t,per_page:100})).data,n=r.data??r,o=Array.isArray(n)?n:n.data??[];st(Array.isArray(o)?o:[])}catch(s){st([]),l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{ea(!1)}},gs=async t=>{if(t)try{ta(!0);const r=(await Lt.getWorkerIssues(t)).data,n=r.data??r,o=Array.isArray(n)?n:n.data??[];rt(Array.isArray(o)?o:[])}catch(s){rt([]),l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{ta(!1)}},Tt=async t=>{if(t)try{aa(!0);const r=(await Et.getAll({worker_id:t,per_page:100})).data,n=r.data??r,o=Array.isArray(n)?n:n.data??[];it(Array.isArray(o)?o:[])}catch(s){it([]),l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{aa(!1)}},hs=async t=>{if(!t){Te([]);return}try{sa(!0);const s=await Lt.getItems({project_id:Number(t)});Te(s.data?.data??[])}catch(s){Te([]),l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{sa(!1)}},ys=async t=>{if(t)try{Na(!0),se&&ye.current&&(URL.revokeObjectURL(se),ye.current=!1),qe(null);const s=await Be.get(`/workers/${t}/image`,{responseType:"blob"}),r=URL.createObjectURL(s.data);ye.current=!0,qe(r)}catch{qe(null)}finally{Na(!1)}},Dr=async t=>{if(!(!c?.id||!t))try{Ca(!0);const s=new FormData;s.append("image",t),await Be.post(`/workers/${c.id}/image`,s,{headers:{"Content-Type":"multipart/form-data"}}),await ys(c.id),l.success(a("success.saved"))}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Ca(!1)}},qt=async t=>{t&&(Yt(t),Ht(!0),Y("trainings"),await Promise.all([Ct(t.id),Wt(t.id),Dt(t.id),w?null:gs(t.id),Tt(t.id),w?null:hs(t.project_id??t.project?.id),ys(t.id)].filter(Boolean)))},Tr=()=>{Ht(!1),Yt(null),Y("trainings"),tt([]),at([]),st([]),rt([]),it([]),Te([]),ge(!1),ae({ppe_item_id:"",ppe_other:"",quantity:1,received_at:""}),he(!1),z({sanction_date:"",sanction_type:"",reason:"",mise_a_pied_days:"",document:null}),se&&ye.current&&URL.revokeObjectURL(se),ye.current=!1,qe(null),xs()},fs=(t=null)=>{xa(t),ot(!1),Q(t?{training_type:t.training_type??"",training_label:t.training_label??"",training_date:t.training_date??"",expiry_date:t.expiry_date??"",certificate:null}:{training_type:"",training_label:"",training_date:"",expiry_date:"",certificate:null}),ma(!0)},At=()=>{ma(!1),xa(null),ot(!1),Q({training_type:"",training_label:"",training_date:"",expiry_date:"",certificate:null})},qr=t=>{const s=t.target.files?.[0];if(s&&s.type!=="application/pdf"){l.error(a("workers.details.common.pdfOnly"));return}Q(r=>({...r,certificate:s??null}))},bs=(t=null)=>{ba(t),dt(!1),O(t?{qualification_type:t.qualification_type??"",qualification_level:t.qualification_level??"",qualification_label:t.qualification_label??"",start_date:t.start_date??"",expiry_date:t.expiry_date??"",certificate:null}:{qualification_type:"",qualification_level:"",qualification_label:"",start_date:"",expiry_date:"",certificate:null}),ha(!0)},Pt=()=>{ha(!1),ba(null),dt(!1),O({qualification_type:"",qualification_level:"",qualification_label:"",start_date:"",expiry_date:"",certificate:null})},Ar=t=>{const s=t.target.files?.[0];if(s&&s.type!=="application/pdf"){l.error(a("workers.details.common.pdfOnly"));return}O(r=>({...r,certificate:s??null}))},Pr=async t=>{if(t.preventDefault(),!!c?.id&&!(!d.qualification_type||!d.start_date)&&!(d.qualification_type==="other"&&!String(d.qualification_label??"").trim())&&!(d.qualification_type==="habilitation_electrique"&&!String(d.qualification_level??"").trim())){fa(!0);try{const s={worker_id:c.id,qualification_type:d.qualification_type,qualification_level:d.qualification_type==="habilitation_electrique"?String(d.qualification_level??"").trim():void 0,qualification_label:d.qualification_type==="other"?String(d.qualification_label??"").trim():void 0,start_date:d.start_date,expiry_date:d.expiry_date?d.expiry_date:void 0,certificate:d.certificate?d.certificate:void 0};ct?.id?await He.update(ct.id,s):await He.create(s),l.success(a("success.saved")),Pt(),await Wt(c.id)}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{fa(!1)}}},Mr=async t=>{if(t?.id)try{await He.delete(t.id),l.success(a("success.deleted")),c?.id&&await Wt(c.id)}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}},js=(t=null)=>{wa(t),ut(!1),U(t?{aptitude_status:t.aptitude_status??"apte",exam_nature:t.exam_nature??"",able_to:Array.isArray(t.able_to)?t.able_to:[],exam_date:t.exam_date??"",expiry_date:t.expiry_date??"",certificate:null}:{aptitude_status:"apte",exam_nature:"",able_to:[],exam_date:"",expiry_date:"",certificate:null}),va(!0)},Mt=()=>{va(!1),wa(null),ut(!1),U({aptitude_status:"apte",exam_nature:"",able_to:[],exam_date:"",expiry_date:"",certificate:null})},Er=t=>{const s=t.target.files?.[0];if(s&&s.type!=="application/pdf"){l.error(a("workers.details.common.pdfOnly"));return}U(r=>({...r,certificate:s??null}))},Lr=t=>{U(s=>{const r=Array.isArray(s.able_to)?s.able_to:[];return r.includes(t)?{...s,able_to:r.filter(n=>n!==t)}:{...s,able_to:[...r,t]}})},Ir=async t=>{if(t.preventDefault(),!!c?.id&&!(!g.exam_nature||!g.exam_date)){_a(!0);try{const s={worker_id:c.id,aptitude_status:g.aptitude_status,exam_nature:g.exam_nature,able_to:Array.isArray(g.able_to)?g.able_to:[],exam_date:g.exam_date,expiry_date:g.expiry_date?g.expiry_date:void 0,certificate:g.certificate?g.certificate:void 0};mt?.id?await Ye.update(mt.id,s):await Ye.create(s),l.success(a("success.saved")),Mt(),await Dt(c.id),X()}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{_a(!1)}}},Kr=async t=>{if(t?.id)try{await Ye.delete(t.id),l.success(a("success.deleted")),c?.id&&await Dt(c.id),X()}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}},Rr=async t=>{if(t.preventDefault(),!!c?.id&&!(!x.training_type||!x.training_date)&&!(x.training_type==="other"&&!String(x.training_label??"").trim())){pa(!0);try{const s={worker_id:c.id,training_type:x.training_type,training_label:x.training_type==="other"?String(x.training_label??"").trim():void 0,training_date:x.training_date,expiry_date:x.expiry_date?x.expiry_date:void 0,certificate:x.certificate?x.certificate:void 0};lt?.id?(await de.update(lt.id,s),l.success(a("success.saved"))):(await de.create(s),l.success(a("success.saved"))),At(),await Ct(c.id)}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{pa(!1)}}},Or=async t=>{if(t?.id)try{await de.delete(t.id),l.success(a("success.deleted")),c?.id&&await Ct(c.id)}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:a("workers.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:a("workers.subtitle")})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:vr,className:"btn-outline btn-sm flex items-center gap-2",children:[e.jsx(me,{className:"w-4 h-4"}),a("workers.export")]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:Ia,type:"button",onClick:()=>ne(t=>!t),className:"btn-primary btn-sm flex items-center gap-2",children:[e.jsx(Xr,{className:"w-4 h-4"}),a("workers.addWorker"),e.jsx(Ss,{className:"w-4 h-4"})]}),yt&&e.jsxs("div",{ref:Ka,role:"menu",className:"absolute right-0 mt-2 w-56 z-[70] rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 shadow-lg overflow-hidden",children:[e.jsx("button",{type:"button",className:"w-full px-3 py-2 text-sm text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>{ne(!1),is()},children:a("workers.addOneWorker")}),e.jsx("button",{type:"button",className:"w-full px-3 py-2 text-sm text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>{ne(!1),Re(!0)},children:a("workers.massAdd")}),!w&&e.jsx("button",{type:"button",className:"w-full px-3 py-2 text-sm text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>{ne(!1),ft("trainings"),Ga(!0)},children:a("workers.massDocs.open")})]})]})]})]}),ie&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(Cs,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.totalWorkers")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:ie.active})]})]}),e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-orange-100 dark:bg-orange-900/50 rounded-lg",children:e.jsx(It,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.hseTeam")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:cr})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-emerald-100 dark:bg-emerald-900/50 rounded-lg",children:e.jsx(Kt,{className:"w-5 h-5 text-emerald-600 dark:text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.stats.inductionHse")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:dr})]})]}),e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-purple-100 dark:bg-purple-900/50 rounded-lg",children:e.jsx(It,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.stats.workAtHeight")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:mr})]})]}),e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-sky-100 dark:bg-sky-900/50 rounded-lg",children:e.jsx(Kt,{className:"w-5 h-5 text-sky-600 dark:text-sky-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.stats.medicalAptitude")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:ur})]})]})]})]}),e.jsx("div",{className:"card p-3 overflow-visible",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:max-w-md",children:[e.jsx(ei,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:be,onChange:t=>{tr(t.target.value),f(1)},placeholder:a("common.search"),className:"input pl-9 py-1.5 text-sm"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:Ea,type:"button",onClick:()=>Ee(t=>!t),className:"btn-outline btn-sm flex items-center gap-2","aria-haspopup":"menu","aria-expanded":Me,children:[e.jsx(ti,{className:"w-4 h-4"}),a("common.filter"),e.jsx(Ss,{className:"w-4 h-4"})]}),Me&&e.jsxs("div",{ref:La,role:"menu",className:"absolute right-0 mt-2 w-[min(28rem,calc(100vw-2rem))] z-[60] card overflow-visible p-3 shadow-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.pole")}),e.jsxs(h,{value:v,onChange:t=>{Aa(t.target.value),Pe(""),f(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("common.allPoles")}),sr.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.project")}),e.jsxs(h,{value:b,onChange:t=>{Pe(t.target.value),f(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("workers.allProjects")}),rr.map(t=>e.jsx("option",{value:t.id,children:Ns(t)},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.entreprise")}),e.jsxs(h,{value:T,onChange:t=>{Pa(t.target.value),f(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("workers.allEntreprises")}),Da.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.fonction")}),e.jsxs(h,{value:q,onChange:t=>{Ma(t.target.value),f(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("workers.allFonctions")}),Ta.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsx("div",{className:"md:col-span-2 border-t border-gray-200 dark:border-gray-700 pt-3"}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.training")}),e.jsxs(h,{value:k,onChange:t=>{Ra(t.target.value),f(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("common.all")}),Ut.filter(t=>t.value!=="other").map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.presence")}),e.jsxs(h,{value:Z,onChange:t=>{Oa(t.target.value),f(1)},className:"py-1.5 text-sm",disabled:!k,children:[e.jsx("option",{value:"has",children:a("workers.filters.with")}),e.jsx("option",{value:"missing",children:a("workers.filters.without")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.qualification")}),e.jsxs(h,{value:_,onChange:t=>{Ua(t.target.value),f(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("common.all")}),$t.filter(t=>t.value!=="other").map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.presence")}),e.jsxs(h,{value:G,onChange:t=>{$a(t.target.value),f(1)},className:"py-1.5 text-sm",disabled:!_,children:[e.jsx("option",{value:"has",children:a("workers.filters.with")}),e.jsx("option",{value:"missing",children:a("workers.filters.without")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.medical")}),e.jsxs(h,{value:S,onChange:t=>{Fa(t.target.value),f(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("common.all")}),e.jsx("option",{value:"has",children:a("workers.filters.with")}),e.jsx("option",{value:"missing",children:a("workers.filters.without")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.medicalStatus")}),e.jsxs(h,{value:A,onChange:t=>{za(t.target.value),f(1)},className:"py-1.5 text-sm",disabled:!S||S==="missing",children:[e.jsx("option",{value:"",children:a("common.all")}),e.jsx("option",{value:"apte",children:a("workers.details.medical.apte")}),e.jsx("option",{value:"inapte",children:a("workers.details.medical.inapte")})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.expired")}),e.jsxs(h,{value:P,onChange:t=>{Qa(t.target.value),f(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("workers.filters.expiredAny")}),e.jsx("option",{value:"only_expired",children:a("workers.filters.expiredOnly")}),e.jsx("option",{value:"without_expired",children:a("workers.filters.expiredWithout")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.sanctions")}),e.jsxs(h,{value:M,onChange:t=>{Ba(t.target.value),f(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("common.all")}),e.jsx("option",{value:"any",children:a("workers.filters.sanctionsAny")}),e.jsx("option",{value:"none",children:a("workers.filters.sanctionsNone")}),e.jsx("option",{value:"mise_a_pied",children:a("workers.details.sanctions.types.mise_a_pied")}),e.jsx("option",{value:"avertissement",children:a("workers.details.sanctions.types.avertissement")}),e.jsx("option",{value:"rappel_a_lordre",children:a("workers.details.sanctions.types.rappel_a_lordre")}),e.jsx("option",{value:"blame",children:a("workers.details.sanctions.types.blame")})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3 border-t border-gray-200 dark:border-gray-700 pt-3",children:[e.jsx("button",{type:"button",onClick:()=>{Aa(""),Pe(""),Pa(""),Ma(""),Ra(""),Oa("has"),Ua(""),$a("has"),Fa(""),za(""),Qa(""),Ba(""),f(1)},className:"btn-outline btn-sm",children:a("common.reset")}),e.jsx("button",{type:"button",onClick:()=>Ee(!1),className:"btn-primary btn-sm",children:a("common.apply")})]})]})]})]})}),J.length>0&&e.jsxs("div",{className:"card p-2.5 flex items-center justify-between bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:Ke,onChange:ls,className:"rounded border-red-300 text-red-600 focus:ring-red-500"}),e.jsxs("span",{className:"text-sm font-medium text-red-700 dark:text-red-300",children:[J.length," ",a("common.selected")]})]}),e.jsxs("button",{onClick:hr,className:"btn-danger btn-sm flex items-center gap-1.5 text-xs",children:[e.jsx(ue,{className:"w-3.5 h-3.5"}),a("workers.bulkDeactivate")]})]}),e.jsxs("div",{className:"card overflow-hidden",children:[Gs?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(y,{className:"w-6 h-6 animate-spin text-hse-primary"})}):V.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-[14px]",children:[e.jsx("thead",{className:"text-[11px] uppercase tracking-wider text-gray-500 dark:text-gray-400",children:e.jsxs("tr",{className:"sticky top-0 z-10 bg-white/95 dark:bg-gray-900/95 backdrop-blur border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"w-12 px-3 py-3",children:e.jsx("input",{type:"checkbox",checked:Ke,onChange:ls,className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-hse-primary focus:ring-hse-primary"})}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.nom")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.prenom")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.cin")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.fonction")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.entreprise")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.projet")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold whitespace-nowrap",children:a("workers.dateEntree")}),e.jsx("th",{className:"px-3 py-3 text-center font-semibold w-24",children:a("common.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-800",children:V.map((t,s)=>e.jsxs("tr",{role:"button",tabIndex:0,onClick:r=>{const n=r.target;n instanceof Element&&(n.closest("button")||n.closest("a")||n.closest("input"))||qt(t)},onKeyDown:r=>{r.key==="Enter"&&qt(t)},className:`${s%2===0?"bg-white dark:bg-gray-900":"bg-gray-50/60 dark:bg-gray-800/30"} hover:bg-hse-primary/5 dark:hover:bg-hse-primary/10 transition-colors cursor-pointer`,children:[e.jsx("td",{className:"px-3 py-2.5 align-middle",children:e.jsx("input",{type:"checkbox",checked:J.includes(t.id),onChange:r=>{r.stopPropagation(),_r(t.id)},className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-hse-primary focus:ring-hse-primary"})}),e.jsx("td",{className:"px-3 py-2.5 font-medium text-gray-900 dark:text-gray-100 whitespace-nowrap",children:t.nom}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200 whitespace-nowrap",children:t.prenom}),e.jsx("td",{className:"px-3 py-2.5 font-mono text-gray-600 dark:text-gray-300 whitespace-nowrap",children:t.cin?.toUpperCase()}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200",children:t.fonction??""}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200",children:t.entreprise??""}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200",children:t.project?.name??""}),e.jsx("td",{className:"px-3 py-2.5 text-gray-600 dark:text-gray-300 whitespace-nowrap",children:L(t.date_entree)}),e.jsx("td",{className:"px-3 py-2.5 align-middle",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:r=>{r.stopPropagation(),is(t)},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 border border-transparent hover:border-gray-200 dark:hover:border-gray-600",title:a("common.edit"),children:e.jsx(ai,{className:"w-4 h-4 text-gray-600 dark:text-gray-300"})}),e.jsx("button",{onClick:r=>{r.stopPropagation(),xr(t)},className:"p-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 border border-transparent hover:border-red-200 dark:hover:border-red-800",title:a("workers.deactivate"),children:e.jsx(ue,{className:"w-4 h-4 text-red-600 dark:text-red-400"})})]})})]},t.id))})]})}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Cs,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:a("workers.noWorkers")})]}),(V.length>0?!0:ht>0)&&e.jsxs("div",{className:"px-3 py-2 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[a("pagination.showing")," ",V.length," ",a("pagination.of")," ",ht," ",a("pagination.results")]}),V.length<ht&&e.jsx("button",{onClick:()=>f(t=>t+1),className:"px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300",children:a("common.showMore")})]})]}),e.jsx(R,{isOpen:ir,onClose:Nt,title:a(je?"workers.editWorker":"workers.newWorker"),size:"lg",children:e.jsxs("form",{onSubmit:pr,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("workers.nom")," *"]}),e.jsx("input",{type:"text",value:p.nom,onChange:t=>E({...p,nom:t.target.value}),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("workers.prenom")," *"]}),e.jsx("input",{type:"text",value:p.prenom,onChange:t=>E({...p,prenom:t.target.value}),className:"input",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("workers.cin")," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx(si,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:p.cin,onChange:t=>E({...p,cin:t.target.value.toUpperCase()}),className:"input pl-10 uppercase",placeholder:"AB123456",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.fonction")}),e.jsx(ws,{value:p.fonction,onChange:t=>E({...p,fonction:t}),suggestions:Ta,placeholder:a("workers.fonctionPlaceholder"),icon:e.jsx(It,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.dateNaissance")}),e.jsx(K,{value:p.date_naissance,onChange:t=>E({...p,date_naissance:t}),placeholder:a("workers.selectDate")}),p.date_naissance&&(()=>{const t=new Date(p.date_naissance),s=new Date,r=s.getFullYear()-t.getFullYear(),n=s.getMonth()-t.getMonth();return(n<0||n===0&&s.getDate()<t.getDate()?r-1:r)<18?e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 font-semibold mt-1 flex items-center gap-1",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-red-500 rounded-full animate-pulse"}),a("workers.minAge")]}):null})()]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.dateEntree")}),e.jsx(K,{value:p.date_entree,onChange:t=>E({...p,date_entree:t}),placeholder:a("workers.selectDate")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.entreprise")}),e.jsx(ws,{value:p.entreprise,onChange:t=>E({...p,entreprise:t}),suggestions:Da,placeholder:a("workers.entreprisePlaceholder"),defaultValue:"SGTM",icon:e.jsx(ri,{className:"w-4 h-4"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.projet")}),e.jsxs(h,{value:p.project_id,onChange:t=>E({...p,project_id:t.target.value}),children:[e.jsx("option",{value:"",children:a("common.select")}),Le.map(t=>e.jsx("option",{value:t.id,children:Ns(t)},t.id))]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white text-sm",children:a("workers.status")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.statusHelp")})]}),e.jsx("button",{type:"button",onClick:()=>E({...p,is_active:!p.is_active}),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${p.is_active?"bg-green-500":"bg-gray-300 dark:bg-gray-600"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${p.is_active?"translate-x-6":"translate-x-1"}`})})]}),!je&&e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg text-sm text-blue-700 dark:text-blue-300",children:e.jsx("p",{children:a("workers.cinInfo")})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:Nt,className:"btn-outline",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:Xa,className:"btn-primary flex items-center gap-2",children:[Xa&&e.jsx(y,{className:"w-4 h-4 animate-spin"}),a(je?"common.save":"workers.addWorker")]})]})]})}),Bt&&c&&e.jsx(R,{isOpen:Bt,onClose:Tr,title:a("workers.details.title"),size:"full",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"min-w-0 flex flex-col justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:c.project?.name??"-"}),e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 truncate",children:[c.prenom," ",c.nom]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:c.fonction??"-"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 font-mono",children:c.cin?.toUpperCase()??"-"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:a("workers.entreprise")}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-medium",children:c.entreprise??"-"})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:a("workers.dateEntree")}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-medium",children:L(c.date_entree)})]})]})]}),e.jsxs("div",{className:"w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 overflow-hidden relative",children:[e.jsxs("div",{className:"absolute top-3 right-3 z-10 flex items-center gap-2",children:[e.jsx("input",{ref:Qt,type:"file",accept:"image/*",className:"hidden",onChange:t=>{const s=t.target.files?.[0];s&&(Dr(s),t.target.value="")}}),e.jsxs("button",{type:"button",onClick:()=>Qt.current?.click(),className:"btn-outline btn-sm flex items-center gap-2",disabled:Sa,children:[Sa?e.jsx(y,{className:"w-4 h-4 animate-spin"}):e.jsx(Ce,{className:"w-4 h-4"}),a("workers.details.image.add")]})]}),Qs?e.jsx("div",{className:"w-full h-72 flex items-center justify-center",children:e.jsx(y,{className:"w-6 h-6 animate-spin text-hse-primary"})}):se?e.jsx("div",{className:"w-full h-72 flex items-center justify-center p-2",children:e.jsx("img",{src:se,alt:"",className:"max-w-full max-h-full object-contain"})}):e.jsxs("div",{className:"w-full h-72 flex flex-col items-center justify-center text-sm text-gray-500 dark:text-gray-400 gap-2",children:[e.jsx(ii,{className:"w-8 h-8"}),e.jsx("span",{children:a("workers.details.noImage")})]})]})]}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{className:"px-4 pt-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex gap-2 -mb-px flex-wrap",children:[e.jsxs("button",{type:"button",onClick:()=>Y("trainings"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${I==="trainings"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(pe,{className:"w-4 h-4"}),a("workers.details.tabs.trainings")]}),e.jsxs("button",{type:"button",onClick:()=>Y("qualifications"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${I==="qualifications"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(ni,{className:"w-4 h-4"}),a("workers.details.tabs.qualifications")]}),e.jsxs("button",{type:"button",onClick:()=>Y("medical"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${I==="medical"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(Kt,{className:"w-4 h-4"}),a("workers.details.tabs.medical")]}),!w&&e.jsxs("button",{type:"button",onClick:()=>Y("ppe"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${I==="ppe"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(li,{className:"w-4 h-4"}),a("ppe.workerTab.title")]}),e.jsxs("button",{type:"button",onClick:()=>Y("sanctions"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${I==="sanctions"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(pe,{className:"w-4 h-4"}),a("workers.details.tabs.sanctions")]})]})}),e.jsxs("div",{className:"p-4",children:[I==="trainings"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:!w&&e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>fs(null),children:[e.jsx(Ce,{className:"w-4 h-4"}),a("common.add")]})}),Ls?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(y,{className:"w-6 h-6 animate-spin text-hse-primary"})}):Vt.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:a("workers.details.trainings.empty")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.trainings.type")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.startDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("common.actions")})]})}),e.jsx("tbody",{children:Vt.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("div",{className:"font-medium",children:As(t)})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:L(t.training_date)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:L(t.expiry_date)}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Fe(Nr(t),{...t,download_url:cs(t)}),children:[e.jsx(Ve,{className:"w-4 h-4"}),a("common.view")]}),t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:s=>{s.stopPropagation(),ce(cs(t),"certificate.pdf")},children:[e.jsx(me,{className:"w-4 h-4"}),a("common.download")]}),!w&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>fs(t),children:[e.jsx(Rt,{className:"w-4 h-4"}),a("common.edit")]}),!w&&e.jsxs("button",{type:"button",className:"btn-danger btn-sm flex items-center gap-2",onClick:()=>Or(t),children:[e.jsx(ue,{className:"w-4 h-4"}),a("common.delete")]})]})})]},t.id))})]})})]}),I==="qualifications"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:!w&&e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>bs(null),children:[e.jsx(Ce,{className:"w-4 h-4"}),a("common.add")]})}),Is?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(y,{className:"w-6 h-6 animate-spin text-hse-primary"})}):Gt.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:a("workers.details.qualifications.empty")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.qualifications.type")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.startDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("common.actions")})]})}),e.jsx("tbody",{children:Gt.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[e.jsx("span",{children:Ps(t)}),t.qualification_type==="habilitation_electrique"&&t.qualification_level?e.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200",children:t.qualification_level}):null]})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:L(t.start_date)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:L(t.expiry_date)}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Fe(Sr(t),{...t,download_url:ds(t)}),children:[e.jsx(Ve,{className:"w-4 h-4"}),a("common.view")]}),t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:s=>{s.stopPropagation(),ce(ds(t),"certificate.pdf")},children:[e.jsx(me,{className:"w-4 h-4"}),a("common.download")]}),!w&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>bs(t),children:[e.jsx(Rt,{className:"w-4 h-4"}),a("common.edit")]}),!w&&e.jsxs("button",{type:"button",className:"btn-danger btn-sm flex items-center gap-2",onClick:()=>Mr(t),children:[e.jsx(ue,{className:"w-4 h-4"}),a("common.delete")]})]})})]},t.id))})]})})]}),I==="medical"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:!w&&e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>js(null),children:[e.jsx(Ce,{className:"w-4 h-4"}),a("common.add")]})}),Ks?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(y,{className:"w-6 h-6 animate-spin text-hse-primary"})}):Xt.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:a("workers.details.medical.empty")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.medical.status")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.medical.examNature")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.startDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("common.actions")})]})}),e.jsx("tbody",{children:Xt.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-semibold ${t.aptitude_status==="apte"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300"}`,children:t.aptitude_status==="apte"?a("workers.details.medical.apte"):a("workers.details.medical.inapte")})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:Ms(t)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:L(t.exam_date)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:L(t.expiry_date)}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Fe(Cr(t),{...t,download_url:ms(t)}),children:[e.jsx(Ve,{className:"w-4 h-4"}),a("common.view")]}),t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:s=>{s.stopPropagation(),ce(ms(t),"certificate.pdf")},children:[e.jsx(me,{className:"w-4 h-4"}),a("common.download")]}),!w&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>js(t),children:[e.jsx(Rt,{className:"w-4 h-4"}),a("common.edit")]}),!w&&e.jsxs("button",{type:"button",className:"btn-danger btn-sm flex items-center gap-2",onClick:()=>Kr(t),children:[e.jsx(ue,{className:"w-4 h-4"}),a("common.delete")]})]})})]},t.id))})]})})]}),!w&&I==="ppe"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>{c?.id&&(ae({ppe_item_id:"",ppe_other:"",quantity:1,received_at:new Date().toISOString().slice(0,10)}),ge(!0))},children:[e.jsx(Ws,{className:"w-4 h-4"}),a("ppe.workerTab.issueButton")]})}),e.jsxs("div",{className:"card p-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:a("ppe.workerTab.lastIssuedTitle")}),Us?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(y,{className:"w-5 h-5 animate-spin text-hse-primary"})}):nt.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2",children:a("common.noData")}):e.jsx("div",{className:"overflow-x-auto mt-2",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.item")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.items.stock")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.receivedAt")})]})}),e.jsx("tbody",{children:[...nt].sort((t,s)=>String(t?.name??"").localeCompare(String(s?.name??""))).map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("div",{className:"font-medium",children:t.name})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200 font-mono",children:t.stock_quantity??0}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:L(wr[t.id])})]},t.id))})]})})]}),e.jsxs("div",{className:"card p-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:a("ppe.workerTab.title")}),Rs?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(y,{className:"w-5 h-5 animate-spin text-hse-primary"})}):We.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2",children:a("ppe.workerTab.empty")}):e.jsx("div",{className:"overflow-x-auto mt-2",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.item")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.quantity")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.receivedAt")})]})}),e.jsx("tbody",{children:We.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("div",{className:"font-medium",children:t.ppe_item?.name??t.ppeItem?.name??"-"})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200 font-mono",children:t.quantity??1}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:L(t.received_at)})]},t.id))})]})})]})]}),I==="sanctions"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:zt&&e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>{z({sanction_date:new Date().toISOString().slice(0,10),sanction_type:"",reason:"",mise_a_pied_days:"",document:null}),he(!0)},children:[e.jsx(Ce,{className:"w-4 h-4"}),a("common.add")]})}),Os?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(y,{className:"w-6 h-6 animate-spin text-hse-primary"})}):De.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:a("workers.details.sanctions.empty")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.sanctions.date")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.sanctions.type")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("common.project")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.sanctions.reason")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("common.actions")})]})}),e.jsx("tbody",{children:[...De].sort((t,s)=>{const r=t?.sanction_date?new Date(`${t.sanction_date}T00:00:00`).getTime():0,n=s?.sanction_date?new Date(`${s.sanction_date}T00:00:00`).getTime():0;return r!==n?n-r:Number(s?.id??0)-Number(t?.id??0)}).map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200 whitespace-nowrap",children:L(t.sanction_date)}),e.jsxs("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:[e.jsx("div",{className:"font-medium",children:Es(t)}),t.sanction_type==="mise_a_pied"&&t.mise_a_pied_days?e.jsxs("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:[t.mise_a_pied_days,"j"]}):null,t.sanction_type==="avertissement"&&os[t.id]?e.jsxs("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:[a("workers.details.sanctions.successiveAvertissement")," ",os[t.id]]}):null]}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:t.project?.name??"-"}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:t.reason??""}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.document_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Fe(Wr(t),{...t,download_url:us(t)}),children:[e.jsx(Ve,{className:"w-4 h-4"}),a("common.view")]}),t.document_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:s=>{s.stopPropagation(),ce(us(t),"document.pdf")},children:[e.jsx(me,{className:"w-4 h-4"}),a("common.download")]}),qs&&e.jsxs("button",{type:"button",className:"btn-danger btn-sm flex items-center gap-2",onClick:async()=>{if(!(!t?.id||!c?.id))try{await Et.delete(t.id),l.success(a("success.deleted")),await Tt(c.id)}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}},children:[e.jsx(ue,{className:"w-4 h-4"}),a("common.delete")]})]})})]},t.id))})]})})]})]})]})]})}),ra&&c&&e.jsx(R,{isOpen:ra,onClose:()=>ge(!1),title:a("ppe.issue.title"),size:"lg",children:e.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),!!c?.id){if(!N.ppe_item_id&&!String(N.ppe_other??"").trim()){l.error(a("ppe.issue.chooseItem"));return}try{na(!0),await Lt.issueToWorker({worker_id:Number(c.id),ppe_item_id:N.ppe_item_id?Number(N.ppe_item_id):void 0,ppe_name:N.ppe_item_id?void 0:String(N.ppe_other??"").trim(),quantity:Number(N.quantity??1),received_at:N.received_at}),l.success(a("ppe.issue.success")),ge(!1),await Promise.all([gs(c.id),hs(c.project_id??c.project?.id)])}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{na(!1)}}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("ppe.issue.item")}),e.jsxs(h,{value:N.ppe_item_id,onChange:t=>ae(s=>({...s,ppe_item_id:t.target.value,ppe_other:""})),children:[e.jsx("option",{value:"",children:a("ppe.issue.other")}),[...nt].sort((t,s)=>String(t?.name??"").localeCompare(String(s?.name??""))).map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.stock_quantity??0,")"]},t.id))]}),!N.ppe_item_id&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"label text-xs",children:a("ppe.issue.otherSpecify")}),e.jsx("input",{className:"input",value:N.ppe_other,onChange:t=>ae(s=>({...s,ppe_other:t.target.value})),placeholder:a("ppe.issue.otherPlaceholder")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("ppe.issue.quantity")}),e.jsx("input",{type:"number",min:1,className:"input",value:N.quantity,onChange:t=>ae(s=>({...s,quantity:t.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("ppe.issue.receivedAt")}),e.jsx(K,{value:N.received_at,onChange:t=>ae(s=>({...s,received_at:t})),required:!0})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>ge(!1),className:"btn-outline btn-sm",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:ia,className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[ia&&e.jsx(y,{className:"w-4 h-4 animate-spin"}),a("ppe.issue.submit")]})]})]})}),la&&c&&zt&&e.jsx(R,{isOpen:la,onClose:()=>he(!1),title:a("workers.details.sanctions.addTitle"),size:"lg",children:e.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),!!c?.id&&!(!u.sanction_date||!u.sanction_type||!String(u.reason??"").trim())&&!(u.sanction_type==="mise_a_pied"&&!Number(u.mise_a_pied_days))&&u.document)try{ca(!0),await Et.create({worker_id:c.id,sanction_date:u.sanction_date,sanction_type:u.sanction_type,reason:String(u.reason??"").trim(),mise_a_pied_days:u.sanction_type==="mise_a_pied"?Number(u.mise_a_pied_days):void 0,document:u.document}),l.success(a("success.saved")),he(!1),z({sanction_date:"",sanction_type:"",reason:"",mise_a_pied_days:"",document:null}),await Tt(c.id)}catch(s){l.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{ca(!1)}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.sanctions.date")}),e.jsx(K,{value:u.sanction_date,onChange:t=>z(s=>({...s,sanction_date:t})),placeholder:a("workers.selectDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.sanctions.type")}),e.jsxs(h,{value:u.sanction_type,onChange:t=>z(s=>({...s,sanction_type:t.target.value})),children:[e.jsx("option",{value:"",children:a("common.select")}),e.jsx("option",{value:"mise_a_pied",children:a("workers.details.sanctions.types.mise_a_pied")}),e.jsx("option",{value:"avertissement",children:a("workers.details.sanctions.types.avertissement")}),e.jsx("option",{value:"rappel_a_lordre",children:a("workers.details.sanctions.types.rappel_a_lordre")}),e.jsx("option",{value:"blame",children:a("workers.details.sanctions.types.blame")})]})]}),u.sanction_type==="mise_a_pied"&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.sanctions.miseAPiedDays")}),e.jsx("input",{type:"number",min:1,className:"input",value:u.mise_a_pied_days,onChange:t=>z(s=>({...s,mise_a_pied_days:t.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.sanctions.reason")}),e.jsx("textarea",{className:"input min-h-[96px]",value:u.reason,onChange:t=>z(s=>({...s,reason:t.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.sanctions.document")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:u.document?u.document.name:a("workers.details.common.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",className:"hidden",onChange:t=>{const s=t.target.files?.[0];if(s&&s.type!=="application/pdf"){l.error(a("workers.details.common.pdfOnly"));return}z(r=>({...r,document:s??null}))}})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>he(!1),className:"btn-outline btn-sm",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:oa||!u.sanction_date||!u.sanction_type||!String(u.reason??"").trim()||u.sanction_type==="mise_a_pied"&&!Number(u.mise_a_pied_days)||!u.document,className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[oa&&e.jsx(y,{className:"w-4 h-4 animate-spin"}),a("common.save")]})]})]})}),ga&&e.jsx(R,{isOpen:ga,onClose:Pt,title:a(ct?"common.edit":"workers.details.qualifications.addTitle"),size:"lg",children:e.jsxs("form",{onSubmit:Pr,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.qualifications.type")}),e.jsxs(h,{value:d.qualification_type,onChange:t=>{const s=t.target.value;O(r=>({...r,qualification_type:s}))},children:[e.jsx("option",{value:"",children:a("common.select")}),$t.map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),d.qualification_type==="habilitation_electrique"&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.qualifications.level")}),e.jsx("input",{className:"input",value:d.qualification_level,onChange:t=>O(s=>({...s,qualification_level:t.target.value})),placeholder:a("workers.details.qualifications.levelPlaceholder")})]}),d.qualification_type==="other"&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.qualifications.otherLabel")}),e.jsx("input",{className:"input",value:d.qualification_label,onChange:t=>O(s=>({...s,qualification_label:t.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.startDate")}),e.jsx(K,{value:d.start_date,onChange:t=>{O(s=>{const r={...s,start_date:t};return Fs||(r.expiry_date=t?St(t,1):""),r})},placeholder:a("workers.details.common.startDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.endDate")}),e.jsx(K,{value:d.expiry_date,onChange:t=>{dt(!0),O(s=>({...s,expiry_date:t}))},placeholder:a("workers.details.common.endDate")}),e.jsx("div",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDateAutoHelp")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.file")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:d.certificate?d.certificate.name:a("workers.details.common.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:Ar,className:"hidden"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:Pt,className:"btn-outline btn-sm",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:ya||!d.qualification_type||!d.start_date||d.qualification_type==="other"&&!String(d.qualification_label??"").trim()||d.qualification_type==="habilitation_electrique"&&!String(d.qualification_level??"").trim(),className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[ya&&e.jsx(y,{className:"w-4 h-4 animate-spin"}),a("common.save")]})]})]})}),ja&&e.jsx(R,{isOpen:ja,onClose:Mt,title:a(mt?"common.edit":"workers.details.medical.addTitle"),size:"lg",children:e.jsxs("form",{onSubmit:Ir,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("div",{children:e.jsx("label",{className:"font-medium text-gray-900 dark:text-white text-sm",children:a("workers.details.medical.status")})}),e.jsx("button",{type:"button",onClick:()=>U(t=>({...t,aptitude_status:t.aptitude_status==="apte"?"inapte":"apte"})),className:`relative inline-flex h-6 w-14 items-center rounded-full transition-colors ${g.aptitude_status==="apte"?"bg-green-500":"bg-red-500"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${g.aptitude_status==="apte"?"translate-x-8":"translate-x-1"}`})})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:g.aptitude_status==="apte"?a("workers.details.medical.apte"):a("workers.details.medical.inapte")}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.medical.examNature")}),e.jsxs(h,{value:g.exam_nature,onChange:t=>U(s=>({...s,exam_nature:t.target.value})),children:[e.jsx("option",{value:"",children:a("common.select")}),Ds.map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.medical.ableTo")}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:ci.map(t=>e.jsxs("label",{className:"flex items-center gap-2 p-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900",children:[e.jsx("input",{type:"checkbox",checked:Array.isArray(g.able_to)&&g.able_to.includes(t.value),onChange:()=>Lr(t.value),className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-hse-primary focus:ring-hse-primary"}),e.jsx("span",{className:"text-xs text-gray-700 dark:text-gray-200",children:a(t.labelKey)})]},t.value))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.startDate")}),e.jsx(K,{value:g.exam_date,onChange:t=>{U(s=>{const r={...s,exam_date:t};return zs||(r.expiry_date=t?St(t,1):""),r})},placeholder:a("workers.details.common.startDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.endDate")}),e.jsx(K,{value:g.expiry_date,onChange:t=>{ut(!0),U(s=>({...s,expiry_date:t}))},placeholder:a("workers.details.common.endDate")}),e.jsx("div",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDateAutoHelp")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.file")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:g.certificate?g.certificate.name:a("workers.details.common.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:Er,className:"hidden"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:Mt,className:"btn-outline btn-sm",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:ka||!g.exam_nature||!g.exam_date,className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[ka&&e.jsx(y,{className:"w-4 h-4 animate-spin"}),a("common.save")]})]})]})}),da&&e.jsx(R,{isOpen:da,onClose:At,title:a(lt?"common.edit":"workers.details.trainings.addTitle"),size:"lg",children:e.jsxs("form",{onSubmit:Rr,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.trainings.type")}),e.jsxs(h,{value:x.training_type,onChange:t=>{const s=t.target.value;Q(r=>({...r,training_type:s}))},children:[e.jsx("option",{value:"",children:a("common.select")}),Ut.map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),x.training_type==="other"&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.trainings.otherLabel")}),e.jsx("input",{className:"input",value:x.training_label,onChange:t=>Q(s=>({...s,training_label:t.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.startDate")}),e.jsx(K,{value:x.training_date,onChange:t=>{Q(s=>{const r={...s,training_date:t};return $s||(r.expiry_date=t?St(t,1):""),r})},placeholder:a("workers.details.common.startDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.endDate")}),e.jsx(K,{value:x.expiry_date,onChange:t=>{ot(!0),Q(s=>({...s,expiry_date:t}))},placeholder:a("workers.details.common.endDate")}),e.jsx("div",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDateAutoHelp")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.file")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:x.certificate?x.certificate.name:a("workers.details.common.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:qr,className:"hidden"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:At,className:"btn-outline btn-sm",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:ua||!x.training_type||!x.training_date||x.training_type==="other"&&!String(x.training_label??"").trim(),className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[ua&&e.jsx(y,{className:"w-4 h-4 animate-spin"}),a("common.save")]})]})]})}),D&&e.jsx(R,{isOpen:!!D,onClose:xs,title:a("common.view"),size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[70vh]",children:Bs?e.jsx("div",{className:"w-full h-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 flex items-center justify-center",children:e.jsx(y,{className:"w-6 h-6 animate-spin text-hse-primary"})}):$?e.jsx("iframe",{src:$,title:a("common.view"),className:"w-full h-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white"}):e.jsx("div",{className:"w-full h-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 flex items-center justify-center text-sm text-gray-500 dark:text-gray-400",children:a("errors.somethingWentWrong")})}),typeof D?.download_url=="string"&&D.download_url||typeof D?.certificate_url=="string"&&D.certificate_url||typeof D?.document_url=="string"&&D.document_url?e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn-primary inline-flex items-center gap-2 text-sm",onClick:()=>ce(D.download_url??D.certificate_url??D.document_url,"document.pdf"),children:[e.jsx(me,{className:"w-4 h-4"}),a("common.download")]})}):null]})}),e.jsx(R,{isOpen:lr,onClose:ns,title:a("workers.massDocs.title"),size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a("workers.massDocs.help")}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{type:"button",onClick:()=>ft("trainings"),className:Ja==="trainings"?"btn-primary btn-sm":"btn-outline btn-sm",children:a("workers.massDocs.categories.trainings")}),e.jsx("button",{type:"button",disabled:!0,className:"btn-outline btn-sm opacity-50 cursor-not-allowed",children:a("workers.massDocs.categories.qualifications")}),e.jsx("button",{type:"button",disabled:!0,className:"btn-outline btn-sm opacity-50 cursor-not-allowed",children:a("workers.massDocs.categories.medical")}),e.jsx("button",{type:"button",disabled:!0,className:"btn-outline btn-sm opacity-50 cursor-not-allowed",children:a("workers.massDocs.categories.sanctions")})]}),Ja==="trainings"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{type:"button",onClick:br,className:"w-full btn-outline flex items-center justify-center gap-2",children:[e.jsx(Ze,{className:"w-4 h-4"}),a("workers.massDocs.trainings.downloadTemplate")]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center",children:[e.jsx("input",{ref:ee,type:"file",accept:".xlsx,.xls,.csv",onChange:t=>jt(t.target.files?.[0]??null),className:"hidden"}),ke?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ze,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:ke.name}),e.jsx("button",{type:"button",onClick:()=>{jt(null),ee.current&&(ee.current.value="")},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:e.jsx(Ot,{className:"w-4 h-4"})})]}):e.jsx("button",{type:"button",onClick:()=>ee.current?.click(),className:"text-hse-primary hover:underline",children:a("workers.massDocs.trainings.chooseExcel")})]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center",children:[e.jsx("input",{ref:te,type:"file",accept:".zip,application/zip",onChange:t=>vt(t.target.files?.[0]??null),className:"hidden"}),_e?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ws,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:_e.name}),e.jsx("button",{type:"button",onClick:()=>{vt(null),te.current&&(te.current.value="")},className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:e.jsx(Ot,{className:"w-4 h-4"})})]}):e.jsx("button",{type:"button",onClick:()=>te.current?.click(),className:"text-hse-primary hover:underline",children:a("workers.massDocs.trainings.chooseZip")})]}),e.jsxs("button",{type:"button",onClick:jr,disabled:!ke||!_e||ss,className:"w-full btn-primary flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[ss&&e.jsx(y,{className:"w-4 h-4 animate-spin"}),e.jsx(oi,{className:"w-4 h-4"}),a("workers.massDocs.trainings.import")]}),le&&e.jsx("div",{className:"p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"text-gray-700 dark:text-gray-200",children:a("workers.massDocs.trainings.result",{imported:le?.imported??0,failed:le?.failed_count??0})}),Array.isArray(le?.zip_errors)&&le.zip_errors.length>0?e.jsx("div",{className:"text-xs text-amber-700 dark:text-amber-300",children:a("workers.massDocs.trainings.zipErrorsCount",{count:le.zip_errors.length})}):null]})})]}),e.jsx("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:e.jsx("button",{type:"button",onClick:ns,className:"btn-outline",children:a("common.cancel")})})]})}),e.jsx(R,{isOpen:nr,onClose:()=>Re(!1),title:a("workers.importTitle"),size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a("workers.importHelp")}),e.jsxs("button",{onClick:fr,className:"w-full btn-outline flex items-center justify-center gap-2",children:[e.jsx(Ze,{className:"w-4 h-4"}),a("workers.downloadTemplate")]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center",children:[e.jsx("input",{ref:Ft,type:"file",accept:".xlsx,.xls,.csv",onChange:t=>Oe(t.target.files[0]),className:"hidden"}),ve?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ze,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:ve.name}),e.jsx("button",{type:"button",onClick:()=>Oe(null),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:e.jsx(Ot,{className:"w-4 h-4"})})]}):e.jsx("button",{type:"button",onClick:()=>Ft.current?.click(),className:"text-hse-primary hover:underline",children:a("workers.selectFile")})]}),e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg text-sm text-amber-700 dark:text-amber-300",children:e.jsx("p",{children:a("workers.cinInfo")})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>{Re(!1),Oe(null)},className:"btn-outline",children:a("common.cancel")}),e.jsxs("button",{type:"button",onClick:kr,disabled:!ve||ts,className:"btn-primary flex items-center gap-2",children:[ts&&e.jsx(y,{className:"w-4 h-4 animate-spin"}),a("workers.import")]})]})]})}),e.jsx(_s,{isOpen:!!oe,title:a("common.confirm"),message:oe?a("workers.confirmDeactivate",{name:`${oe.prenom} ${oe.nom}`}):"",confirmLabel:a("workers.deactivate"),cancelLabel:a("common.cancel"),variant:"danger",onConfirm:gr,onCancel:()=>wt(null)}),e.jsx(_s,{isOpen:or,title:a("common.confirm"),message:a("workers.confirmBulkDeactivate",{count:J.length}),confirmLabel:a("workers.bulkDeactivate"),cancelLabel:a("common.cancel"),variant:"danger",onConfirm:yr,onCancel:()=>Ue(!1)})]})}export{ki as default};
