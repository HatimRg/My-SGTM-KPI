import{a as Ys,u as Vs,w,p as Pa,j as e,v as nt,m as ot,x as Ne,y as Se,z as Ce}from"./index.js";import{b as Gs,u as Js,r as i}from"./vendor-react.js";import{D as I}from"./DatePicker.js";import{C as Aa}from"./ConfirmDialog.js";import{M as E}from"./Modal.js";import{S as g}from"./Select.js";import{A as Ka}from"./AutocompleteInput.js";import{s as Xs,g as Ia}from"./projectList.js";import{z as n,a9 as ct,ac as Zs,am as ne,aA as er,U as Ma,i as dt,q as mt,ae as tr,aI as ar,C as sr,aj as oe,v as j,aB as rr,aD as ir,B as lr,P as qe,ax as nr,h as We,c as or,j as cr,I as ut,aJ as pt,aK as dr,k as mr}from"./vendor-ui.js";import"./vendor-utils.js";const xt=[{value:"bypassing_safety_controls",labelKey:"workers.details.trainings.types.bypassing_safety_controls"},{value:"formation_coactivite",labelKey:"workers.details.trainings.types.formation_coactivite"},{value:"formation_coffrage_decoffrage",labelKey:"workers.details.trainings.types.formation_coffrage_decoffrage"},{value:"formation_conduite_defensive",labelKey:"workers.details.trainings.types.formation_conduite_defensive"},{value:"formation_analyse_des_risques",labelKey:"workers.details.trainings.types.formation_analyse_des_risques"},{value:"formation_elingage_manutention",labelKey:"workers.details.trainings.types.formation_elingage_manutention"},{value:"formation_ergonomie",labelKey:"workers.details.trainings.types.formation_ergonomie"},{value:"formation_excavations",labelKey:"workers.details.trainings.types.formation_excavations"},{value:"formation_outils_electroportatifs",labelKey:"workers.details.trainings.types.formation_outils_electroportatifs"},{value:"formation_epi",labelKey:"workers.details.trainings.types.formation_epi"},{value:"formation_environnement",labelKey:"workers.details.trainings.types.formation_environnement"},{value:"formation_espaces_confines",labelKey:"workers.details.trainings.types.formation_espaces_confines"},{value:"formation_flagman",labelKey:"workers.details.trainings.types.formation_flagman"},{value:"formation_jha",labelKey:"workers.details.trainings.types.formation_jha"},{value:"formation_line_of_fire",labelKey:"workers.details.trainings.types.formation_line_of_fire"},{value:"formation_manutention_manuelle",labelKey:"workers.details.trainings.types.formation_manutention_manuelle"},{value:"formation_manutention_mecanique",labelKey:"workers.details.trainings.types.formation_manutention_mecanique"},{value:"formation_point_chaud",labelKey:"workers.details.trainings.types.formation_point_chaud"},{value:"formation_produits_chimiques",labelKey:"workers.details.trainings.types.formation_produits_chimiques"},{value:"formation_risques_electriques",labelKey:"workers.details.trainings.types.formation_risques_electriques"},{value:"induction_hse",labelKey:"workers.details.trainings.types.induction_hse"},{value:"travail_en_hauteur",labelKey:"workers.details.trainings.types.travail_en_hauteur"},{value:"other",labelKey:"workers.details.trainings.types.other"}],gt=[{value:"elingueur",labelKey:"workers.details.qualifications.types.elingueur"},{value:"equipier_premiere_intervention",labelKey:"workers.details.qualifications.types.equipier_premiere_intervention"},{value:"habilitation_electrique",labelKey:"workers.details.qualifications.types.habilitation_electrique"},{value:"inspecteur_echafaudage",labelKey:"workers.details.qualifications.types.inspecteur_echafaudage"},{value:"monteur_echafaudage",labelKey:"workers.details.qualifications.types.monteur_echafaudage"},{value:"monteur_grue_a_tour",labelKey:"workers.details.qualifications.types.monteur_grue_a_tour"},{value:"operateur_bulldozer",labelKey:"workers.details.qualifications.types.operateur_bulldozer"},{value:"operateur_chargeuse",labelKey:"workers.details.qualifications.types.operateur_chargeuse"},{value:"operateur_chariot_elevateur",labelKey:"workers.details.qualifications.types.operateur_chariot_elevateur"},{value:"operateur_compacteur",labelKey:"workers.details.qualifications.types.operateur_compacteur"},{value:"operateur_dumper",labelKey:"workers.details.qualifications.types.operateur_dumper"},{value:"operateur_grue_a_tour",labelKey:"workers.details.qualifications.types.operateur_grue_a_tour"},{value:"operateur_grue_mobile",labelKey:"workers.details.qualifications.types.operateur_grue_mobile"},{value:"operateur_niveleuse",labelKey:"workers.details.qualifications.types.operateur_niveleuse"},{value:"operateur_nacelle",labelKey:"workers.details.qualifications.types.operateur_nacelle"},{value:"operateur_pelle",labelKey:"workers.details.qualifications.types.operateur_pelle"},{value:"sst",labelKey:"workers.details.qualifications.types.sst"},{value:"soudeur",labelKey:"workers.details.qualifications.types.soudeur"},{value:"utilisation_meule",labelKey:"workers.details.qualifications.types.utilisation_meule"},{value:"other",labelKey:"workers.details.qualifications.types.other"}],La=[{value:"embauche_reintegration",labelKey:"workers.details.medical.examNatures.embauche_reintegration"},{value:"visite_systematique",labelKey:"workers.details.medical.examNatures.visite_systematique"},{value:"surveillance_medical_special",labelKey:"workers.details.medical.examNatures.surveillance_medical_special"},{value:"visite_de_reprise",labelKey:"workers.details.medical.examNatures.visite_de_reprise"},{value:"visite_spontanee",labelKey:"workers.details.medical.examNatures.visite_spontanee"}],ur=[{value:"travaux_en_hauteur",labelKey:"workers.details.medical.ableToOptions.travaux_en_hauteur"},{value:"travaux_electrique",labelKey:"workers.details.medical.ableToOptions.travaux_electrique"},{value:"travaux_en_espace_confine",labelKey:"workers.details.medical.ableToOptions.travaux_en_espace_confine"},{value:"operateur",labelKey:"workers.details.medical.ableToOptions.operateur"},{value:"travaux_point_chaud",labelKey:"workers.details.medical.ableToOptions.travaux_point_chaud"}];function Nr(){const{t:a}=Ys(),{user:Oa}=Vs(),Te=Gs(),Ea=Js(),ht=i.useRef(null),De=i.useRef(0),yt=i.useRef(null),Ua=t=>{const s=t?.training_type;if(!s)return"-";if(s==="other")return String(t?.training_label??"").trim()||a("workers.details.trainings.types.other");const r=xt.find(l=>l.value===s);return r?.labelKey?a(r.labelKey):String(s)},Fa=t=>{const s=t?.qualification_type;if(!s)return"-";if(s==="other")return String(t?.qualification_label??"").trim()||a("workers.details.qualifications.types.other");const r=gt.find(l=>l.value===s);return r?.labelKey?a(r.labelKey):String(s)},Ra=t=>{const s=t?.exam_nature;if(!s)return"-";const r=La.find(l=>l.value===s);return r?.labelKey?a(r.labelKey):String(s)},[ft,bt]=i.useState(!1),[o,jt]=i.useState(null),[M,z]=i.useState("trainings"),[vt,Pe]=i.useState([]),[$a,kt]=i.useState(!1),[_t,Ae]=i.useState([]),[Qa,wt]=i.useState(!1),[Nt,Ke]=i.useState([]),[Ba,St]=i.useState(!1),[ce,Ie]=i.useState([]),[za,Ct]=i.useState(!1),[Me,de]=i.useState([]),[Ha,qt]=i.useState(!1),[Wt,X]=i.useState(!1),[Tt,Dt]=i.useState(!1),[v,H]=i.useState({ppe_item_id:"",ppe_other:"",quantity:1,received_at:""}),[Pt,At]=i.useState(!1),[Kt,It]=i.useState(!1),[Le,Mt]=i.useState(null),[Ya,Oe]=i.useState(!1),[u,L]=i.useState({training_type:"",training_label:"",training_date:"",expiry_date:"",certificate:null}),[Lt,Ot]=i.useState(!1),[Et,Ut]=i.useState(!1),[Ee,Ft]=i.useState(null),[Va,Ue]=i.useState(!1),[c,P]=i.useState({qualification_type:"",qualification_level:"",qualification_label:"",start_date:"",expiry_date:"",certificate:null}),[Rt,$t]=i.useState(!1),[Qt,Bt]=i.useState(!1),[Fe,zt]=i.useState(null),[Ga,Re]=i.useState(!1),[p,A]=i.useState({aptitude_status:"apte",exam_nature:"",able_to:[],exam_date:"",expiry_date:"",certificate:null}),[Y,me]=i.useState(null),[Ja,Ht]=i.useState(!1),[Yt,Vt]=i.useState(!1),Z=i.useRef(!1),[ee,$e]=i.useState(null),[K,ue]=i.useState(null),[Xa,Qe]=i.useState(!1),V=i.useRef(!1),[U,Gt]=i.useState([]),[te,Za]=i.useState([]),[Jt,es]=i.useState([]),[Xt,ts]=i.useState([]),[G,as]=i.useState(null),[ss,Zt]=i.useState(!0),[Be,h]=i.useState(1),[pr,rs]=i.useState(1),[ze,is]=i.useState(0),[ls]=i.useState(50),[ae,ns]=i.useState(""),[O,os]=i.useState(""),[y,ea]=i.useState(""),[x,pe]=i.useState(""),[N,ta]=i.useState(""),[S,aa]=i.useState(""),[xe,ge]=i.useState(!1),sa=i.useRef(null),ra=i.useRef(null),[f,ia]=i.useState(""),[F,la]=i.useState("has"),[b,na]=i.useState(""),[R,oa]=i.useState("has"),[k,ca]=i.useState(""),[C,da]=i.useState(""),[q,ma]=i.useState(""),[cs,ua]=i.useState([]),pa=Oa?.project_list_preference??"code",he=i.useMemo(()=>Xs(te,pa),[te,pa]),ds=i.useMemo(()=>{const t=Array.isArray(he)?he:[];return y?t.filter(s=>s?.pole===y):t},[he,y]),[$,ye]=i.useState([]),[fe,xa]=i.useState(!1),[ms,ga]=i.useState(!1),[us,be]=i.useState(!1),[se,He]=i.useState(null),[ha,ya]=i.useState(!1),[fa,ba]=i.useState(!1),[re,je]=i.useState(null),[J,Ye]=i.useState(null),[ps,ve]=i.useState(!1),[m,W]=i.useState({nom:"",prenom:"",fonction:"",cin:"",date_naissance:"",entreprise:"",project_id:"",date_entree:"",is_active:!0});i.useEffect(()=>{ja(),Q()},[]),i.useEffect(()=>{const s=new URLSearchParams(Te.search).get("worker_id"),r=s?String(s).trim():"";r&&(async()=>{try{const l=await w.getById(r),d=l.data?.data??l.data;d&&await tt(d)}catch{}finally{const l=new URLSearchParams(Te.search);l.delete("worker_id"),Ea({pathname:Te.pathname,search:l.toString()?`?${l.toString()}`:""},{replace:!0})}})()},[]),i.useEffect(()=>{ke()},[Be,O,x,N,S,y,f,F,b,R,k,C,q]),i.useEffect(()=>{Q()},[O,x,N,S,y,f,F,b,R,k,C,q]),i.useEffect(()=>{if(!xe)return;const t=r=>{r.key==="Escape"&&ge(!1)},s=r=>{const l=sa.current,d=ra.current,D=r.target;l&&l.contains(D)||d&&d.contains(D)||ge(!1)};return document.addEventListener("keydown",t),document.addEventListener("mousedown",s),()=>{document.removeEventListener("keydown",t),document.removeEventListener("mousedown",s)}},[xe]),i.useEffect(()=>{(async()=>{try{const s=await Pa.getPoles(),r=s.data?.data?.poles??s.data?.poles??[];ua(Array.isArray(r)?r:[])}catch{ua([])}})()},[]),i.useEffect(()=>{if(!y)return;!te.some(s=>String(s.id)===String(x)&&s?.pole===y)&&x&&pe("")},[y,x,te]),i.useEffect(()=>{const t=setTimeout(()=>{os(ae)},300);return()=>clearTimeout(t)},[ae]);const ja=async()=>{try{const[t,s,r]=await Promise.all([Pa.getAllList({status:"active"}),w.getEntreprises(),w.getFonctions()]);Za(Array.isArray(t)?t:[]),es(s.data.data??[]),ts(r.data.data??[])}catch(t){console.error("Failed to load initial data:",t)}},Q=async()=>{try{const t={search:O||void 0,pole:y||void 0,project_id:x||void 0,entreprise:N||void 0,fonction:S||void 0,training_type:f||void 0,training_presence:f?F:void 0,qualification_type:b||void 0,qualification_presence:b?R:void 0,medical_presence:k||void 0,medical_status:C||void 0,expired_filter:q||void 0,is_active:!0},s=await w.getStatistics(t);as(s.data.data)}catch{}},ke=async()=>{try{Zt(!0);const t=De.current+1;De.current=t;const s={page:Be,per_page:ls,search:O||void 0,pole:y||void 0,project_id:x||void 0,entreprise:N||void 0,fonction:S||void 0,training_type:f||void 0,training_presence:f?F:void 0,qualification_type:b||void 0,qualification_presence:b?R:void 0,medical_presence:k||void 0,medical_status:C||void 0,expired_filter:q||void 0,is_active:!0},r=await w.getAll(s);if(t!==De.current)return;const l=r.data,d=l.data??l,D=Array.isArray(d)?d:d?.data??[],ie=l.meta??d.meta??d;Gt(_e=>{if(Be===1)return D;const it=[..._e,...D],_=new Set;return it.filter(lt=>{const B=lt?.id;if(B==null)return!0;const we=String(B);return _.has(we)?!1:(_.add(we),!0)})}),rs(ie.last_page??1),is(ie.total??D.length)}catch{n.error(a("errors.somethingWentWrong"))}finally{Zt(!1)}},xs=G?.hse_team??U.filter(t=>t.fonction?.toLowerCase().includes("hse")).length,gs=G?.induction_hse??0,hs=G?.travail_en_hauteur??0,ys=G?.medical_aptitude??0,va=(t=null)=>{t?(He(t),W({nom:t.nom??"",prenom:t.prenom??"",fonction:t.fonction??"",cin:t.cin?.toUpperCase()??"",date_naissance:t.date_naissance?.split("T")[0]??"",entreprise:t.entreprise??"",project_id:t.project_id??"",date_entree:t.date_entree?.split("T")[0]??"",is_active:t.is_active??!0})):(He(null),W({nom:"",prenom:"",fonction:"",cin:"",date_naissance:"",entreprise:"",project_id:"",date_entree:"",is_active:!0})),ga(!0)},Ve=()=>{ga(!1),He(null)},fs=async t=>{t.preventDefault(),ya(!0);const s={...m,cin:m.cin?.toUpperCase()};try{se?(await w.update(se.id,s),n.success(a("workers.updated"))):(await w.create(s)).data.data?.merged?n.success(a("workers.merged")):n.success(a("workers.created")),Ve(),ke(),Q()}catch(r){n.error(r.response?.data?.message??a("errors.somethingWentWrong"))}finally{ya(!1)}},bs=t=>{Ye(t)},js=async()=>{if(J)try{await w.delete(J.id),n.success(a("workers.deactivated")),ke(),Q()}catch{n.error(a("errors.somethingWentWrong"))}finally{Ye(null)}},vs=()=>{$.length!==0&&ve(!0)},ks=async()=>{if($.length===0){ve(!1);return}try{const t=await w.bulkDeactivate($);n.success(a("workers.bulkDeactivated",{count:t.data.data.deactivated_count})),ye([]),xa(!1),ke(),Q()}catch{n.error(a("errors.somethingWentWrong"))}finally{ve(!1)}},ka=async()=>{try{const t=await w.downloadTemplate(),s=window.URL.createObjectURL(new Blob([t.data])),r=document.createElement("a");r.href=s,r.setAttribute("download","workers_template.xlsx"),document.body.appendChild(r),r.click(),r.remove()}catch{n.error(a("errors.somethingWentWrong"))}},_s=async()=>{try{const s={pole:y||void 0,project_id:x||void 0,entreprise:N||void 0,fonction:S||void 0,training_type:f||void 0,training_presence:f?F:void 0,qualification_type:b||void 0,qualification_presence:b?R:void 0,medical_presence:k||void 0,medical_status:C||void 0,expired_filter:q||void 0,is_active:!0,search:O||ae||void 0},r=await w.export(s),l=r.data instanceof Blob?r.data:new Blob([r.data]),d=window.URL.createObjectURL(l),ie=(r.headers?.["content-disposition"]??r.headers?.["Content-Disposition"])?.match(/filename\*=UTF-8''([^;]+)|filename="?([^";]+)"?/i),_e=ie?.[1]??ie?.[2],it=_e?decodeURIComponent(_e):null,_=[];if(x){const Da=te.find(Hs=>String(Hs.id)===String(x))?.name;Da&&_.push(Da)}N&&_.push(N),S&&_.push(S),f&&_.push(`training:${f}-${F}`),b&&_.push(`qualification:${b}-${R}`),k&&_.push(`medical:${k}${C?`-${C}`:""}`),q&&_.push(`expired:${q}`);const lt=_.length?_.join(", "):"active",B=new Date,we=String(B.getDate()).padStart(2,"0"),Us=String(B.getMonth()+1).padStart(2,"0"),Fs=String(B.getFullYear()),Rs=`${we}-${Us}-${Fs}`,$s=lt.replace(/[\\/:*?"<>|]/g,"-").replace(/\s+/g," ").trim(),Qs=(l.type?.includes("csv")?!0:!!l.type?.includes("text/plain"))?"csv":"xlsx",Bs=`Workers_export_(${$s})_date(${Rs}).${Qs}`,zs=it??Bs,le=document.createElement("a");le.href=d,le.setAttribute("download",zs),document.body.appendChild(le),le.click(),le.remove(),n.success(a("common.exportSuccess"))}catch(t){try{const s=t?.response?.data;if(s instanceof Blob&&s.type?.includes("application/json")){const r=await s.text(),l=JSON.parse(r);n.error(l?.message??a("errors.somethingWentWrong"));return}}catch{}n.error(t.response?.data?.message??a("errors.somethingWentWrong"))}},ws=async()=>{if(re){ba(!0);try{const t=new FormData;t.append("file",re),x&&t.append("project_id",x);const s=await w.import(t);n.success(a("workers.importSuccess",{imported:s.data.data.imported_count,merged:s.data.data.merged_count})),be(!1),je(null),h(1),Gt([]),ja()}catch(t){n.error(t.response?.data?.message??a("errors.somethingWentWrong"))}finally{ba(!1)}}},Ns=t=>{ye(s=>s.includes(t)?s.filter(r=>r!==t):[...s,t])},_a=()=>{ye(fe?[]:U.map(t=>t.id)),xa(!fe)},T=t=>t?new Date(t).toLocaleDateString("fr-FR"):"-",Ss=i.useMemo(()=>{const t={};for(const s of ce){const r=s?.ppe_item_id??s?.ppe_item?.id??s?.ppeItem?.id,l=s?.received_at;!r||!l||(!t[r]||new Date(l)>new Date(t[r]))&&(t[r]=l)}return t},[ce]),Ge=(t,s)=>{if(!t)return"";const r=new Date(`${t}T00:00:00`);if(Number.isNaN(r.getTime()))return"";r.setFullYear(r.getFullYear()+s);const l=r.getFullYear(),d=String(r.getMonth()+1).padStart(2,"0"),D=String(r.getDate()).padStart(2,"0");return`${l}-${d}-${D}`},Cs=t=>!t||typeof t!="string"?null:t.startsWith("/api/")?t.slice(4):t.startsWith("api/")?t.slice(3):t,wa=()=>{$e(null),Qe(!1),K&&V.current&&URL.revokeObjectURL(K),V.current=!1,ue(null)},Je=async(t,s)=>{if(t)try{if($e(s??{}),Qe(!0),K&&V.current&&URL.revokeObjectURL(K),V.current=!1,ue(null),typeof t=="string"&&(t.startsWith("http://")||t.startsWith("https://")||t.startsWith("/storage/"))){ue(t);return}const r=Cs(t),l=await ot.get(r,{responseType:"blob"}),d=URL.createObjectURL(l.data);V.current=!0,ue(d)}catch(r){n.error(r.response?.data?.message??a("errors.somethingWentWrong")),$e(null)}finally{Qe(!1)}};i.useEffect(()=>()=>{K&&V.current&&URL.revokeObjectURL(K)},[K]);const Xe=async t=>{if(t)try{kt(!0);const r=(await Ne.getAll({worker_id:t,per_page:100})).data,l=r.data??r,d=Array.isArray(l)?l:l.data??[];Pe(Array.isArray(d)?d:[])}catch(s){Pe([]),n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{kt(!1)}},Ze=async t=>{if(t)try{wt(!0);const r=(await Se.getAll({worker_id:t,per_page:100})).data,l=r.data??r,d=Array.isArray(l)?l:l.data??[];Ae(Array.isArray(d)?d:[])}catch(s){Ae([]),n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{wt(!1)}},et=async t=>{if(t)try{St(!0);const r=(await Ce.getAll({worker_id:t,per_page:100})).data,l=r.data??r,d=Array.isArray(l)?l:l.data??[];Ke(Array.isArray(d)?d:[])}catch(s){Ke([]),n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{St(!1)}},Na=async t=>{if(t)try{Ct(!0);const r=(await nt.getWorkerIssues(t)).data,l=r.data??r,d=Array.isArray(l)?l:l.data??[];Ie(Array.isArray(d)?d:[])}catch(s){Ie([]),n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Ct(!1)}},Sa=async t=>{if(!t){de([]);return}try{qt(!0);const s=await nt.getItems({project_id:Number(t)});de(s.data?.data??[])}catch(s){de([]),n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{qt(!1)}},Ca=async t=>{if(t)try{Ht(!0),Y&&Z.current&&(URL.revokeObjectURL(Y),Z.current=!1),me(null);const s=await ot.get(`/workers/${t}/image`,{responseType:"blob"}),r=URL.createObjectURL(s.data);Z.current=!0,me(r)}catch{me(null)}finally{Ht(!1)}},qs=async t=>{if(!(!o?.id||!t))try{Vt(!0);const s=new FormData;s.append("image",t),await ot.post(`/workers/${o.id}/image`,s,{headers:{"Content-Type":"multipart/form-data"}}),await Ca(o.id),n.success(a("success.saved"))}catch(s){n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Vt(!1)}},tt=async t=>{t&&(jt(t),bt(!0),z("trainings"),await Promise.all([Xe(t.id),Ze(t.id),et(t.id),Na(t.id),Sa(t.project_id??t.project?.id),Ca(t.id)]))},Ws=()=>{bt(!1),jt(null),z("trainings"),Pe([]),Ae([]),Ke([]),Ie([]),de([]),X(!1),H({ppe_item_id:"",ppe_other:"",quantity:1,received_at:""}),Y&&Z.current&&URL.revokeObjectURL(Y),Z.current=!1,me(null),wa()},qa=(t=null)=>{Mt(t),Oe(!1),L(t?{training_type:t.training_type??"",training_label:t.training_label??"",training_date:t.training_date??"",expiry_date:t.expiry_date??"",certificate:null}:{training_type:"",training_label:"",training_date:"",expiry_date:"",certificate:null}),At(!0)},at=()=>{At(!1),Mt(null),Oe(!1),L({training_type:"",training_label:"",training_date:"",expiry_date:"",certificate:null})},Ts=t=>{const s=t.target.files?.[0];if(s&&s.type!=="application/pdf"){n.error(a("workers.details.common.pdfOnly"));return}L(r=>({...r,certificate:s??null}))},Wa=(t=null)=>{Ft(t),Ue(!1),P(t?{qualification_type:t.qualification_type??"",qualification_level:t.qualification_level??"",qualification_label:t.qualification_label??"",start_date:t.start_date??"",expiry_date:t.expiry_date??"",certificate:null}:{qualification_type:"",qualification_level:"",qualification_label:"",start_date:"",expiry_date:"",certificate:null}),Ot(!0)},st=()=>{Ot(!1),Ft(null),Ue(!1),P({qualification_type:"",qualification_level:"",qualification_label:"",start_date:"",expiry_date:"",certificate:null})},Ds=t=>{const s=t.target.files?.[0];if(s&&s.type!=="application/pdf"){n.error(a("workers.details.common.pdfOnly"));return}P(r=>({...r,certificate:s??null}))},Ps=async t=>{if(t.preventDefault(),!!o?.id&&!(!c.qualification_type||!c.start_date)&&!(c.qualification_type==="other"&&!String(c.qualification_label??"").trim())&&!(c.qualification_type==="habilitation_electrique"&&!String(c.qualification_level??"").trim())){Ut(!0);try{const s={worker_id:o.id,qualification_type:c.qualification_type,qualification_level:c.qualification_type==="habilitation_electrique"?String(c.qualification_level??"").trim():void 0,qualification_label:c.qualification_type==="other"?String(c.qualification_label??"").trim():void 0,start_date:c.start_date,expiry_date:c.expiry_date?c.expiry_date:void 0,certificate:c.certificate?c.certificate:void 0};Ee?.id?await Se.update(Ee.id,s):await Se.create(s),n.success(a("success.saved")),st(),await Ze(o.id)}catch(s){n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Ut(!1)}}},As=async t=>{if(t?.id)try{await Se.delete(t.id),n.success(a("success.deleted")),o?.id&&await Ze(o.id)}catch(s){n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}},Ta=(t=null)=>{zt(t),Re(!1),A(t?{aptitude_status:t.aptitude_status??"apte",exam_nature:t.exam_nature??"",able_to:Array.isArray(t.able_to)?t.able_to:[],exam_date:t.exam_date??"",expiry_date:t.expiry_date??"",certificate:null}:{aptitude_status:"apte",exam_nature:"",able_to:[],exam_date:"",expiry_date:"",certificate:null}),$t(!0)},rt=()=>{$t(!1),zt(null),Re(!1),A({aptitude_status:"apte",exam_nature:"",able_to:[],exam_date:"",expiry_date:"",certificate:null})},Ks=t=>{const s=t.target.files?.[0];if(s&&s.type!=="application/pdf"){n.error(a("workers.details.common.pdfOnly"));return}A(r=>({...r,certificate:s??null}))},Is=t=>{A(s=>{const r=Array.isArray(s.able_to)?s.able_to:[];return r.includes(t)?{...s,able_to:r.filter(l=>l!==t)}:{...s,able_to:[...r,t]}})},Ms=async t=>{if(t.preventDefault(),!!o?.id&&!(!p.exam_nature||!p.exam_date)){Bt(!0);try{const s={worker_id:o.id,aptitude_status:p.aptitude_status,exam_nature:p.exam_nature,able_to:Array.isArray(p.able_to)?p.able_to:[],exam_date:p.exam_date,expiry_date:p.expiry_date?p.expiry_date:void 0,certificate:p.certificate?p.certificate:void 0};Fe?.id?await Ce.update(Fe.id,s):await Ce.create(s),n.success(a("success.saved")),rt(),await et(o.id),Q()}catch(s){n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Bt(!1)}}},Ls=async t=>{if(t?.id)try{await Ce.delete(t.id),n.success(a("success.deleted")),o?.id&&await et(o.id),Q()}catch(s){n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}},Os=async t=>{if(t.preventDefault(),!!o?.id&&!(!u.training_type||!u.training_date)&&!(u.training_type==="other"&&!String(u.training_label??"").trim())){It(!0);try{const s={worker_id:o.id,training_type:u.training_type,training_label:u.training_type==="other"?String(u.training_label??"").trim():void 0,training_date:u.training_date,expiry_date:u.expiry_date?u.expiry_date:void 0,certificate:u.certificate?u.certificate:void 0};Le?.id?(await Ne.update(Le.id,s),n.success(a("success.saved"))):(await Ne.create(s),n.success(a("success.saved"))),at(),await Xe(o.id)}catch(s){n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{It(!1)}}},Es=async t=>{if(t?.id)try{await Ne.delete(t.id),n.success(a("success.deleted")),o?.id&&await Xe(o.id)}catch(s){n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:a("workers.title")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:a("workers.subtitle")})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:ka,className:"btn-outline btn-sm flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4"}),a("workers.downloadTemplate")]}),e.jsxs("button",{onClick:()=>be(!0),className:"btn-outline btn-sm flex items-center gap-2",children:[e.jsx(Zs,{className:"w-4 h-4"}),a("workers.import")]}),e.jsxs("button",{onClick:_s,className:"btn-outline btn-sm flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),a("workers.export")]}),e.jsxs("button",{onClick:()=>va(),className:"btn-primary btn-sm flex items-center gap-2",children:[e.jsx(er,{className:"w-4 h-4"}),a("workers.addWorker")]})]})]}),G&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-blue-100 dark:bg-blue-900/50 rounded-lg",children:e.jsx(Ma,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.totalWorkers")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:G.active})]})]}),e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-orange-100 dark:bg-orange-900/50 rounded-lg",children:e.jsx(dt,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.hseTeam")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:xs})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-emerald-100 dark:bg-emerald-900/50 rounded-lg",children:e.jsx(mt,{className:"w-5 h-5 text-emerald-600 dark:text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.stats.inductionHse")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:gs})]})]}),e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-purple-100 dark:bg-purple-900/50 rounded-lg",children:e.jsx(dt,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.stats.workAtHeight")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:hs})]})]}),e.jsxs("div",{className:"card p-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-sky-100 dark:bg-sky-900/50 rounded-lg",children:e.jsx(mt,{className:"w-5 h-5 text-sky-600 dark:text-sky-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.stats.medicalAptitude")}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:ys})]})]})]})]}),e.jsx("div",{className:"card p-3 overflow-visible",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2",children:[e.jsxs("div",{className:"relative w-full md:max-w-md",children:[e.jsx(tr,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:ae,onChange:t=>{ns(t.target.value),h(1)},placeholder:a("common.search"),className:"input pl-9 py-1.5 text-sm"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{ref:sa,type:"button",onClick:()=>ge(t=>!t),className:"btn-outline btn-sm flex items-center gap-2","aria-haspopup":"menu","aria-expanded":xe,children:[e.jsx(ar,{className:"w-4 h-4"}),a("common.filter"),e.jsx(sr,{className:"w-4 h-4"})]}),xe&&e.jsxs("div",{ref:ra,role:"menu",className:"absolute right-0 mt-2 w-[min(28rem,calc(100vw-2rem))] z-[60] card overflow-visible p-3 shadow-lg",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.pole")}),e.jsxs(g,{value:y,onChange:t=>{ea(t.target.value),pe(""),h(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("common.allPoles")}),cs.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.project")}),e.jsxs(g,{value:x,onChange:t=>{pe(t.target.value),h(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("workers.allProjects")}),ds.map(t=>e.jsx("option",{value:t.id,children:Ia(t)},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.entreprise")}),e.jsxs(g,{value:N,onChange:t=>{ta(t.target.value),h(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("workers.allEntreprises")}),Jt.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.fonction")}),e.jsxs(g,{value:S,onChange:t=>{aa(t.target.value),h(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("workers.allFonctions")}),Xt.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsx("div",{className:"md:col-span-2 border-t border-gray-200 dark:border-gray-700 pt-3"}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.training")}),e.jsxs(g,{value:f,onChange:t=>{ia(t.target.value),h(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("common.all")}),xt.filter(t=>t.value!=="other").map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.presence")}),e.jsxs(g,{value:F,onChange:t=>{la(t.target.value),h(1)},className:"py-1.5 text-sm",disabled:!f,children:[e.jsx("option",{value:"has",children:a("workers.filters.with")}),e.jsx("option",{value:"missing",children:a("workers.filters.without")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.qualification")}),e.jsxs(g,{value:b,onChange:t=>{na(t.target.value),h(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("common.all")}),gt.filter(t=>t.value!=="other").map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.presence")}),e.jsxs(g,{value:R,onChange:t=>{oa(t.target.value),h(1)},className:"py-1.5 text-sm",disabled:!b,children:[e.jsx("option",{value:"has",children:a("workers.filters.with")}),e.jsx("option",{value:"missing",children:a("workers.filters.without")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.medical")}),e.jsxs(g,{value:k,onChange:t=>{ca(t.target.value),h(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("common.all")}),e.jsx("option",{value:"has",children:a("workers.filters.with")}),e.jsx("option",{value:"missing",children:a("workers.filters.without")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.medicalStatus")}),e.jsxs(g,{value:C,onChange:t=>{da(t.target.value),h(1)},className:"py-1.5 text-sm",disabled:!k||k==="missing",children:[e.jsx("option",{value:"",children:a("common.all")}),e.jsx("option",{value:"apte",children:a("workers.details.medical.apte")}),e.jsx("option",{value:"inapte",children:a("workers.details.medical.inapte")})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label text-xs",children:a("workers.filters.expired")}),e.jsxs(g,{value:q,onChange:t=>{ma(t.target.value),h(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:a("workers.filters.expiredAny")}),e.jsx("option",{value:"only_expired",children:a("workers.filters.expiredOnly")}),e.jsx("option",{value:"without_expired",children:a("workers.filters.expiredWithout")})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3 border-t border-gray-200 dark:border-gray-700 pt-3",children:[e.jsx("button",{type:"button",onClick:()=>{ea(""),pe(""),ta(""),aa(""),ia(""),la("has"),na(""),oa("has"),ca(""),da(""),ma(""),h(1)},className:"btn-outline btn-sm",children:a("common.reset")}),e.jsx("button",{type:"button",onClick:()=>ge(!1),className:"btn-primary btn-sm",children:a("common.apply")})]})]})]})]})}),$.length>0&&e.jsxs("div",{className:"card p-2.5 flex items-center justify-between bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:fe,onChange:_a,className:"rounded border-red-300 text-red-600 focus:ring-red-500"}),e.jsxs("span",{className:"text-sm font-medium text-red-700 dark:text-red-300",children:[$.length," ",a("common.selected")]})]}),e.jsxs("button",{onClick:vs,className:"btn-danger btn-sm flex items-center gap-1.5 text-xs",children:[e.jsx(oe,{className:"w-3.5 h-3.5"}),a("workers.bulkDeactivate")]})]}),e.jsxs("div",{className:"card overflow-hidden",children:[ss?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(j,{className:"w-6 h-6 animate-spin text-hse-primary"})}):U.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-[14px]",children:[e.jsx("thead",{className:"text-[11px] uppercase tracking-wider text-gray-500 dark:text-gray-400",children:e.jsxs("tr",{className:"sticky top-0 z-10 bg-white/95 dark:bg-gray-900/95 backdrop-blur border-b border-gray-200 dark:border-gray-700",children:[e.jsx("th",{className:"w-12 px-3 py-3",children:e.jsx("input",{type:"checkbox",checked:fe,onChange:_a,className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-hse-primary focus:ring-hse-primary"})}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.nom")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.prenom")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.cin")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.fonction")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.entreprise")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold",children:a("workers.projet")}),e.jsx("th",{className:"px-3 py-3 text-left font-semibold whitespace-nowrap",children:a("workers.dateEntree")}),e.jsx("th",{className:"px-3 py-3 text-center font-semibold w-24",children:a("common.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-800",children:U.map((t,s)=>e.jsxs("tr",{role:"button",tabIndex:0,onClick:r=>{const l=r.target;l instanceof Element&&(l.closest("button")||l.closest("a")||l.closest("input"))||tt(t)},onKeyDown:r=>{r.key==="Enter"&&tt(t)},className:`${s%2===0?"bg-white dark:bg-gray-900":"bg-gray-50/60 dark:bg-gray-800/30"} hover:bg-hse-primary/5 dark:hover:bg-hse-primary/10 transition-colors cursor-pointer`,children:[e.jsx("td",{className:"px-3 py-2.5 align-middle",children:e.jsx("input",{type:"checkbox",checked:$.includes(t.id),onChange:r=>{r.stopPropagation(),Ns(t.id)},className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-hse-primary focus:ring-hse-primary"})}),e.jsx("td",{className:"px-3 py-2.5 font-medium text-gray-900 dark:text-gray-100 whitespace-nowrap",children:t.nom}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200 whitespace-nowrap",children:t.prenom}),e.jsx("td",{className:"px-3 py-2.5 font-mono text-gray-600 dark:text-gray-300 whitespace-nowrap",children:t.cin?.toUpperCase()}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200",children:t.fonction??""}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200",children:t.entreprise??""}),e.jsx("td",{className:"px-3 py-2.5 text-gray-700 dark:text-gray-200",children:t.project?.name??""}),e.jsx("td",{className:"px-3 py-2.5 text-gray-600 dark:text-gray-300 whitespace-nowrap",children:T(t.date_entree)}),e.jsx("td",{className:"px-3 py-2.5 align-middle",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:r=>{r.stopPropagation(),va(t)},className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 border border-transparent hover:border-gray-200 dark:hover:border-gray-600",title:a("common.edit"),children:e.jsx(rr,{className:"w-4 h-4 text-gray-600 dark:text-gray-300"})}),e.jsx("button",{onClick:r=>{r.stopPropagation(),bs(t)},className:"p-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 border border-transparent hover:border-red-200 dark:hover:border-red-800",title:a("workers.deactivate"),children:e.jsx(oe,{className:"w-4 h-4 text-red-600 dark:text-red-400"})})]})})]},t.id))})]})}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(Ma,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:a("workers.noWorkers")})]}),(U.length>0?!0:ze>0)&&e.jsxs("div",{className:"px-3 py-2 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between bg-gray-50 dark:bg-gray-800/50",children:[e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[a("pagination.showing")," ",U.length," ",a("pagination.of")," ",ze," ",a("pagination.results")]}),U.length<ze&&e.jsx("button",{onClick:()=>h(t=>t+1),className:"px-2 py-1 text-xs rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300",children:a("common.showMore")})]})]}),e.jsx(E,{isOpen:ms,onClose:Ve,title:a(se?"workers.editWorker":"workers.newWorker"),size:"lg",children:e.jsxs("form",{onSubmit:fs,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("workers.nom")," *"]}),e.jsx("input",{type:"text",value:m.nom,onChange:t=>W({...m,nom:t.target.value}),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("workers.prenom")," *"]}),e.jsx("input",{type:"text",value:m.prenom,onChange:t=>W({...m,prenom:t.target.value}),className:"input",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("workers.cin")," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx(ir,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:m.cin,onChange:t=>W({...m,cin:t.target.value.toUpperCase()}),className:"input pl-10 uppercase",placeholder:"AB123456",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.fonction")}),e.jsx(Ka,{value:m.fonction,onChange:t=>W({...m,fonction:t}),suggestions:Xt,placeholder:a("workers.fonctionPlaceholder"),icon:e.jsx(dt,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.dateNaissance")}),e.jsx(I,{value:m.date_naissance,onChange:t=>W({...m,date_naissance:t}),placeholder:a("workers.selectDate")}),m.date_naissance&&(()=>{const t=new Date(m.date_naissance),s=new Date,r=s.getFullYear()-t.getFullYear(),l=s.getMonth()-t.getMonth();return(l<0||l===0&&s.getDate()<t.getDate()?r-1:r)<18?e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 font-semibold mt-1 flex items-center gap-1",children:[e.jsx("span",{className:"inline-block w-2 h-2 bg-red-500 rounded-full animate-pulse"}),a("workers.minAge")]}):null})()]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.dateEntree")}),e.jsx(I,{value:m.date_entree,onChange:t=>W({...m,date_entree:t}),placeholder:a("workers.selectDate")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.entreprise")}),e.jsx(Ka,{value:m.entreprise,onChange:t=>W({...m,entreprise:t}),suggestions:Jt,placeholder:a("workers.entreprisePlaceholder"),defaultValue:"SGTM",icon:e.jsx(lr,{className:"w-4 h-4"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("workers.projet")}),e.jsxs(g,{value:m.project_id,onChange:t=>W({...m,project_id:t.target.value}),children:[e.jsx("option",{value:"",children:a("common.select")}),he.map(t=>e.jsx("option",{value:t.id,children:Ia(t)},t.id))]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("label",{className:"font-medium text-gray-900 dark:text-white text-sm",children:a("workers.status")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("workers.statusHelp")})]}),e.jsx("button",{type:"button",onClick:()=>W({...m,is_active:!m.is_active}),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${m.is_active?"bg-green-500":"bg-gray-300 dark:bg-gray-600"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${m.is_active?"translate-x-6":"translate-x-1"}`})})]}),!se&&e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg text-sm text-blue-700 dark:text-blue-300",children:e.jsx("p",{children:a("workers.cinInfo")})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:Ve,className:"btn-outline",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:ha,className:"btn-primary flex items-center gap-2",children:[ha&&e.jsx(j,{className:"w-4 h-4 animate-spin"}),a(se?"common.save":"workers.addWorker")]})]})]})}),ft&&o&&e.jsx(E,{isOpen:ft,onClose:Ws,title:a("workers.details.title"),size:"full",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"min-w-0 flex flex-col justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:o.project?.name??"-"}),e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 truncate",children:[o.prenom," ",o.nom]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:o.fonction??"-"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 font-mono",children:o.cin?.toUpperCase()??"-"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:a("workers.entreprise")}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-medium",children:o.entreprise??"-"})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:a("workers.dateEntree")}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 font-medium",children:T(o.date_entree)})]})]})]}),e.jsxs("div",{className:"w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 overflow-hidden relative",children:[e.jsxs("div",{className:"absolute top-3 right-3 z-10 flex items-center gap-2",children:[e.jsx("input",{ref:yt,type:"file",accept:"image/*",className:"hidden",onChange:t=>{const s=t.target.files?.[0];s&&(qs(s),t.target.value="")}}),e.jsxs("button",{type:"button",onClick:()=>yt.current?.click(),className:"btn-outline btn-sm flex items-center gap-2",disabled:Yt,children:[Yt?e.jsx(j,{className:"w-4 h-4 animate-spin"}):e.jsx(qe,{className:"w-4 h-4"}),a("workers.details.image.add")]})]}),Ja?e.jsx("div",{className:"w-full h-72 flex items-center justify-center",children:e.jsx(j,{className:"w-6 h-6 animate-spin text-hse-primary"})}):Y?e.jsx("div",{className:"w-full h-72 flex items-center justify-center p-2",children:e.jsx("img",{src:Y,alt:"",className:"max-w-full max-h-full object-contain"})}):e.jsxs("div",{className:"w-full h-72 flex flex-col items-center justify-center text-sm text-gray-500 dark:text-gray-400 gap-2",children:[e.jsx(nr,{className:"w-8 h-8"}),e.jsx("span",{children:a("workers.details.noImage")})]})]})]}),e.jsxs("div",{className:"card overflow-hidden",children:[e.jsx("div",{className:"px-4 pt-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex gap-2 -mb-px flex-wrap",children:[e.jsxs("button",{type:"button",onClick:()=>z("trainings"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${M==="trainings"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(We,{className:"w-4 h-4"}),a("workers.details.tabs.trainings")]}),e.jsxs("button",{type:"button",onClick:()=>z("qualifications"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${M==="qualifications"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(or,{className:"w-4 h-4"}),a("workers.details.tabs.qualifications")]}),e.jsxs("button",{type:"button",onClick:()=>z("medical"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${M==="medical"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(mt,{className:"w-4 h-4"}),a("workers.details.tabs.medical")]}),e.jsxs("button",{type:"button",onClick:()=>z("ppe"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${M==="ppe"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(cr,{className:"w-4 h-4"}),a("ppe.workerTab.title")]})]})}),e.jsxs("div",{className:"p-4",children:[M==="trainings"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>qa(null),children:[e.jsx(qe,{className:"w-4 h-4"}),a("common.add")]})}),$a?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(j,{className:"w-6 h-6 animate-spin text-hse-primary"})}):vt.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:a("workers.details.trainings.empty")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.trainings.type")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.startDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("common.actions")})]})}),e.jsx("tbody",{children:vt.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("div",{className:"font-medium",children:Ua(t)})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:T(t.training_date)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:T(t.expiry_date)}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Je(t.certificate_url,t),children:[e.jsx(ut,{className:"w-4 h-4"}),a("common.view")]}),t.certificate_url&&e.jsxs("a",{href:t.certificate_url,download:!0,className:"btn-outline btn-sm flex items-center gap-2",onClick:s=>s.stopPropagation(),children:[e.jsx(ne,{className:"w-4 h-4"}),a("common.download")]}),e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>qa(t),children:[e.jsx(pt,{className:"w-4 h-4"}),a("common.edit")]}),e.jsxs("button",{type:"button",className:"btn-danger btn-sm flex items-center gap-2",onClick:()=>Es(t),children:[e.jsx(oe,{className:"w-4 h-4"}),a("common.delete")]})]})})]},t.id))})]})})]}),M==="qualifications"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>Wa(null),children:[e.jsx(qe,{className:"w-4 h-4"}),a("common.add")]})}),Qa?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(j,{className:"w-6 h-6 animate-spin text-hse-primary"})}):_t.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:a("workers.details.qualifications.empty")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.qualifications.type")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.startDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("common.actions")})]})}),e.jsx("tbody",{children:_t.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[e.jsx("span",{children:Fa(t)}),t.qualification_type==="habilitation_electrique"&&t.qualification_level?e.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200",children:t.qualification_level}):null]})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:T(t.start_date)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:T(t.expiry_date)}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Je(t.certificate_url,t),children:[e.jsx(ut,{className:"w-4 h-4"}),a("common.view")]}),t.certificate_url&&e.jsxs("a",{href:t.certificate_url,download:!0,className:"btn-outline btn-sm flex items-center gap-2",onClick:s=>s.stopPropagation(),children:[e.jsx(ne,{className:"w-4 h-4"}),a("common.download")]}),e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Wa(t),children:[e.jsx(pt,{className:"w-4 h-4"}),a("common.edit")]}),e.jsxs("button",{type:"button",className:"btn-danger btn-sm flex items-center gap-2",onClick:()=>As(t),children:[e.jsx(oe,{className:"w-4 h-4"}),a("common.delete")]})]})})]},t.id))})]})})]}),M==="medical"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>Ta(null),children:[e.jsx(qe,{className:"w-4 h-4"}),a("common.add")]})}),Ba?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(j,{className:"w-6 h-6 animate-spin text-hse-primary"})}):Nt.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:a("workers.details.medical.empty")}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.medical.status")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.medical.examNature")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.startDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("common.actions")})]})}),e.jsx("tbody",{children:Nt.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-semibold ${t.aptitude_status==="apte"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300"}`,children:t.aptitude_status==="apte"?a("workers.details.medical.apte"):a("workers.details.medical.inapte")})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:Ra(t)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:T(t.exam_date)}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:T(t.expiry_date)}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.certificate_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Je(t.certificate_url,t),children:[e.jsx(ut,{className:"w-4 h-4"}),a("common.view")]}),t.certificate_url&&e.jsxs("a",{href:t.certificate_url,download:!0,className:"btn-outline btn-sm flex items-center gap-2",onClick:s=>s.stopPropagation(),children:[e.jsx(ne,{className:"w-4 h-4"}),a("common.download")]}),e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Ta(t),children:[e.jsx(pt,{className:"w-4 h-4"}),a("common.edit")]}),e.jsxs("button",{type:"button",className:"btn-danger btn-sm flex items-center gap-2",onClick:()=>Ls(t),children:[e.jsx(oe,{className:"w-4 h-4"}),a("common.delete")]})]})})]},t.id))})]})})]}),M==="ppe"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>{o?.id&&(H({ppe_item_id:"",ppe_other:"",quantity:1,received_at:new Date().toISOString().slice(0,10)}),X(!0))},children:[e.jsx(dr,{className:"w-4 h-4"}),a("ppe.workerTab.issueButton")]})}),e.jsxs("div",{className:"card p-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:a("ppe.workerTab.lastIssuedTitle")}),Ha?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(j,{className:"w-5 h-5 animate-spin text-hse-primary"})}):Me.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2",children:a("common.noData")}):e.jsx("div",{className:"overflow-x-auto mt-2",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.item")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.items.stock")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.receivedAt")})]})}),e.jsx("tbody",{children:[...Me].sort((t,s)=>String(t?.name??"").localeCompare(String(s?.name??""))).map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("div",{className:"font-medium",children:t.name})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200 font-mono",children:t.stock_quantity??0}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:T(Ss[t.id])})]},t.id))})]})})]}),e.jsxs("div",{className:"card p-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:a("ppe.workerTab.title")}),za?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(j,{className:"w-5 h-5 animate-spin text-hse-primary"})}):ce.length===0?e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mt-2",children:a("ppe.workerTab.empty")}):e.jsx("div",{className:"overflow-x-auto mt-2",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.item")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.quantity")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:a("ppe.workerTab.columns.receivedAt")})]})}),e.jsx("tbody",{children:ce.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("div",{className:"font-medium",children:t.ppe_item?.name??t.ppeItem?.name??"-"})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200 font-mono",children:t.quantity??1}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:T(t.received_at)})]},t.id))})]})})]})]})]})]})]})}),Wt&&o&&e.jsx(E,{isOpen:Wt,onClose:()=>X(!1),title:a("ppe.issue.title"),size:"lg",children:e.jsxs("form",{onSubmit:async t=>{if(t.preventDefault(),!!o?.id){if(!v.ppe_item_id&&!String(v.ppe_other??"").trim()){n.error(a("ppe.issue.chooseItem"));return}try{Dt(!0),await nt.issueToWorker({worker_id:Number(o.id),ppe_item_id:v.ppe_item_id?Number(v.ppe_item_id):void 0,ppe_name:v.ppe_item_id?void 0:String(v.ppe_other??"").trim(),quantity:Number(v.quantity??1),received_at:v.received_at}),n.success(a("ppe.issue.success")),X(!1),await Promise.all([Na(o.id),Sa(o.project_id??o.project?.id)])}catch(s){n.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Dt(!1)}}},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("ppe.issue.item")}),e.jsxs(g,{value:v.ppe_item_id,onChange:t=>H(s=>({...s,ppe_item_id:t.target.value,ppe_other:""})),children:[e.jsx("option",{value:"",children:a("ppe.issue.other")}),[...Me].sort((t,s)=>String(t?.name??"").localeCompare(String(s?.name??""))).map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.stock_quantity??0,")"]},t.id))]}),!v.ppe_item_id&&e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{className:"label text-xs",children:a("ppe.issue.otherSpecify")}),e.jsx("input",{className:"input",value:v.ppe_other,onChange:t=>H(s=>({...s,ppe_other:t.target.value})),placeholder:a("ppe.issue.otherPlaceholder")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("ppe.issue.quantity")}),e.jsx("input",{type:"number",min:1,className:"input",value:v.quantity,onChange:t=>H(s=>({...s,quantity:t.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("ppe.issue.receivedAt")}),e.jsx(I,{value:v.received_at,onChange:t=>H(s=>({...s,received_at:t})),required:!0})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>X(!1),className:"btn-outline btn-sm",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:Tt,className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[Tt&&e.jsx(j,{className:"w-4 h-4 animate-spin"}),a("ppe.issue.submit")]})]})]})}),Lt&&e.jsx(E,{isOpen:Lt,onClose:st,title:a(Ee?"common.edit":"workers.details.qualifications.addTitle"),size:"lg",children:e.jsxs("form",{onSubmit:Ps,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.qualifications.type")}),e.jsxs(g,{value:c.qualification_type,onChange:t=>{const s=t.target.value;P(r=>({...r,qualification_type:s}))},children:[e.jsx("option",{value:"",children:a("common.select")}),gt.map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),c.qualification_type==="habilitation_electrique"&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.qualifications.level")}),e.jsx("input",{className:"input",value:c.qualification_level,onChange:t=>P(s=>({...s,qualification_level:t.target.value})),placeholder:a("workers.details.qualifications.levelPlaceholder")})]}),c.qualification_type==="other"&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.qualifications.otherLabel")}),e.jsx("input",{className:"input",value:c.qualification_label,onChange:t=>P(s=>({...s,qualification_label:t.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.startDate")}),e.jsx(I,{value:c.start_date,onChange:t=>{P(s=>{const r={...s,start_date:t};return Va||(r.expiry_date=t?Ge(t,1):""),r})},placeholder:a("workers.details.common.startDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.endDate")}),e.jsx(I,{value:c.expiry_date,onChange:t=>{Ue(!0),P(s=>({...s,expiry_date:t}))},placeholder:a("workers.details.common.endDate")}),e.jsx("div",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDateAutoHelp")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.file")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:c.certificate?c.certificate.name:a("workers.details.common.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:Ds,className:"hidden"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:st,className:"btn-outline btn-sm",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:Et||!c.qualification_type||!c.start_date||c.qualification_type==="other"&&!String(c.qualification_label??"").trim()||c.qualification_type==="habilitation_electrique"&&!String(c.qualification_level??"").trim(),className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[Et&&e.jsx(j,{className:"w-4 h-4 animate-spin"}),a("common.save")]})]})]})}),Rt&&e.jsx(E,{isOpen:Rt,onClose:rt,title:a(Fe?"common.edit":"workers.details.medical.addTitle"),size:"lg",children:e.jsxs("form",{onSubmit:Ms,className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("div",{children:e.jsx("label",{className:"font-medium text-gray-900 dark:text-white text-sm",children:a("workers.details.medical.status")})}),e.jsx("button",{type:"button",onClick:()=>A(t=>({...t,aptitude_status:t.aptitude_status==="apte"?"inapte":"apte"})),className:`relative inline-flex h-6 w-14 items-center rounded-full transition-colors ${p.aptitude_status==="apte"?"bg-green-500":"bg-red-500"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${p.aptitude_status==="apte"?"translate-x-8":"translate-x-1"}`})})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:p.aptitude_status==="apte"?a("workers.details.medical.apte"):a("workers.details.medical.inapte")}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.medical.examNature")}),e.jsxs(g,{value:p.exam_nature,onChange:t=>A(s=>({...s,exam_nature:t.target.value})),children:[e.jsx("option",{value:"",children:a("common.select")}),La.map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.medical.ableTo")}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:ur.map(t=>e.jsxs("label",{className:"flex items-center gap-2 p-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900",children:[e.jsx("input",{type:"checkbox",checked:Array.isArray(p.able_to)&&p.able_to.includes(t.value),onChange:()=>Is(t.value),className:"w-4 h-4 rounded border-gray-300 dark:border-gray-600 text-hse-primary focus:ring-hse-primary"}),e.jsx("span",{className:"text-xs text-gray-700 dark:text-gray-200",children:a(t.labelKey)})]},t.value))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.startDate")}),e.jsx(I,{value:p.exam_date,onChange:t=>{A(s=>{const r={...s,exam_date:t};return Ga||(r.expiry_date=t?Ge(t,1):""),r})},placeholder:a("workers.details.common.startDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.endDate")}),e.jsx(I,{value:p.expiry_date,onChange:t=>{Re(!0),A(s=>({...s,expiry_date:t}))},placeholder:a("workers.details.common.endDate")}),e.jsx("div",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDateAutoHelp")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.file")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:p.certificate?p.certificate.name:a("workers.details.common.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:Ks,className:"hidden"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:rt,className:"btn-outline btn-sm",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:Qt||!p.exam_nature||!p.exam_date,className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[Qt&&e.jsx(j,{className:"w-4 h-4 animate-spin"}),a("common.save")]})]})]})}),Pt&&e.jsx(E,{isOpen:Pt,onClose:at,title:a(Le?"common.edit":"workers.details.trainings.addTitle"),size:"lg",children:e.jsxs("form",{onSubmit:Os,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.trainings.type")}),e.jsxs(g,{value:u.training_type,onChange:t=>{const s=t.target.value;L(r=>({...r,training_type:s}))},children:[e.jsx("option",{value:"",children:a("common.select")}),xt.map(t=>e.jsx("option",{value:t.value,children:a(t.labelKey)},t.value))]})]}),u.training_type==="other"&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.trainings.otherLabel")}),e.jsx("input",{className:"input",value:u.training_label,onChange:t=>L(s=>({...s,training_label:t.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.startDate")}),e.jsx(I,{value:u.training_date,onChange:t=>{L(s=>{const r={...s,training_date:t};return Ya||(r.expiry_date=t?Ge(t,1):""),r})},placeholder:a("workers.details.common.startDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.endDate")}),e.jsx(I,{value:u.expiry_date,onChange:t=>{Oe(!0),L(s=>({...s,expiry_date:t}))},placeholder:a("workers.details.common.endDate")}),e.jsx("div",{className:"mt-1 text-[11px] text-gray-500 dark:text-gray-400",children:a("workers.details.common.endDateAutoHelp")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:a("workers.details.common.file")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:u.certificate?u.certificate.name:a("workers.details.common.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:Ts,className:"hidden"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:at,className:"btn-outline btn-sm",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:Kt||!u.training_type||!u.training_date||u.training_type==="other"&&!String(u.training_label??"").trim(),className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[Kt&&e.jsx(j,{className:"w-4 h-4 animate-spin"}),a("common.save")]})]})]})}),ee&&e.jsx(E,{isOpen:!!ee,onClose:wa,title:a("common.view"),size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[70vh]",children:Xa?e.jsx("div",{className:"w-full h-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 flex items-center justify-center",children:e.jsx(j,{className:"w-6 h-6 animate-spin text-hse-primary"})}):K?e.jsx("iframe",{src:K,title:a("common.view"),className:"w-full h-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white"}):e.jsx("div",{className:"w-full h-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 flex items-center justify-center text-sm text-gray-500 dark:text-gray-400",children:a("errors.somethingWentWrong")})}),typeof ee?.certificate_url=="string"&&ee.certificate_url&&e.jsx("div",{className:"flex justify-end",children:e.jsxs("a",{href:ee.certificate_url,download:!0,className:"btn-primary inline-flex items-center gap-2 text-sm",children:[e.jsx(ne,{className:"w-4 h-4"}),a("common.download")]})})]})}),e.jsx(E,{isOpen:us,onClose:()=>be(!1),title:a("workers.importTitle"),size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:a("workers.importHelp")}),e.jsxs("button",{onClick:ka,className:"w-full btn-outline flex items-center justify-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4"}),a("workers.downloadTemplate")]}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center",children:[e.jsx("input",{ref:ht,type:"file",accept:".xlsx,.xls,.csv",onChange:t=>je(t.target.files[0]),className:"hidden"}),re?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(ct,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:re.name}),e.jsx("button",{type:"button",onClick:()=>je(null),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:e.jsx(mr,{className:"w-4 h-4"})})]}):e.jsx("button",{type:"button",onClick:()=>ht.current?.click(),className:"text-hse-primary hover:underline",children:a("workers.selectFile")})]}),e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg text-sm text-amber-700 dark:text-amber-300",children:e.jsx("p",{children:a("workers.cinInfo")})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>{be(!1),je(null)},className:"btn-outline",children:a("common.cancel")}),e.jsxs("button",{type:"button",onClick:ws,disabled:!re||fa,className:"btn-primary flex items-center gap-2",children:[fa&&e.jsx(j,{className:"w-4 h-4 animate-spin"}),a("workers.import")]})]})]})}),e.jsx(Aa,{isOpen:!!J,title:a("common.confirm"),message:J?a("workers.confirmDeactivate",{name:`${J.prenom} ${J.nom}`}):"",confirmLabel:a("workers.deactivate"),cancelLabel:a("common.cancel"),variant:"danger",onConfirm:js,onCancel:()=>Ye(null)}),e.jsx(Aa,{isOpen:ps,title:a("common.confirm"),message:a("workers.confirmBulkDeactivate",{count:$.length}),confirmLabel:a("workers.bulkDeactivate"),cancelLabel:a("common.cancel"),variant:"danger",onConfirm:ks,onCancel:()=>ve(!1)})]})}export{Nr as default};
