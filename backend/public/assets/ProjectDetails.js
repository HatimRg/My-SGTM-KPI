import{a as be,u as je,p as m,j as e}from"./index.js";import{r as l,h as _e,b as Fe,L as K}from"./vendor-react.js";import{C as Oe}from"./ConfirmDialog.js";import{S as De}from"./Select.js";import{U as _,aw as Q,C as Ue,a8 as Pe,s as F,aa as ce,ax as Ee,ay as ze,i as ie,az as $e,v as We,aA as Ke,a as Be,z as c,D as Ge,F as Xe,ag as qe,a4 as He,A as Je,J as Ye,c as Qe,T as V}from"./vendor-ui.js";import{R as oe,d as me,C as xe,X as he,Y as ge,T as ue,L as pe,e as R}from"./vendor-charts.js";import"./vendor-utils.js";import"./Modal.js";const Ve=["responsable","supervisor","animateur"];function Ze({projectId:d,projectName:O}){const{t:a}=be(),{user:r}=je(),[N,b]=l.useState([]),[B,D]=l.useState(!0),[v,k]=l.useState(""),[U,S]=l.useState(!1),[x,M]=l.useState(null),[P,E]=l.useState(!1),[z,j]=l.useState(!1),[G,h]=l.useState([]),[t,T]=l.useState([]),[Z,I]=l.useState(!1),[X,ee]=l.useState(""),[se,A]=l.useState(!1),[ye,$]=l.useState(!1),[y,q]=l.useState(null),[ae,te]=l.useState(!1),H=l.useRef(null),W=l.useRef(null),[i,g]=l.useState({name:"",email:"",cin:"",role:"animateur",phone:"",password:""}),[u,J]=l.useState(null);l.useEffect(()=>{L()},[d]),l.useEffect(()=>{const s=n=>{H.current&&!H.current.contains(n.target)&&$(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const fe=s=>{if(!s)return null;const n=/filename\*=UTF-8''([^;]+)|filename="?([^";]+)"?/i.exec(s),o=decodeURIComponent(n?.[1]??n?.[2]??"");return o!==""?o:null},Ne=(s,n)=>{const o=URL.createObjectURL(s),p=document.createElement("a");p.href=o,p.download=n??"template.xlsx",document.body.appendChild(p),p.click(),p.remove(),setTimeout(()=>URL.revokeObjectURL(o),5e3)},ve=async()=>{try{const s=await m.downloadTeamTemplate(d),n=fe(s.headers?.["content-disposition"])??`SGTM-Project-Team-Template-${d}.xlsx`;Ne(s.data,n)}catch(s){c.error(s.response?.data?.message??a("errors.somethingWentWrong"))}},ke=async()=>{if(!y){c.error("Please choose a file");return}try{te(!0);const s=new FormData;s.append("file",y);const o=(await m.importTeam(d,s)).data?.data??{},p=o.added_count??0,f=o.errors??[];c.success(`Added: ${p}`),f.length>0&&c.error(`${f.length} row(s) had issues`),q(null),$(!1),L()}catch(s){c.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{te(!1)}},L=async()=>{try{D(!0);const[s,n]=await Promise.all([m.getMembers(d).catch(()=>({data:{data:[]}})),m.getTeam(d).catch(()=>({data:{data:[]}}))]),o=s.data.data??[],p=n.data.data??[],f=new Map;o.forEach(w=>{f.set(w.id,{...w,canEdit:!0,canRemove:!0})}),p.forEach(w=>{f.has(w.id)||f.set(w.id,{...w,isTeamMember:!0,canEdit:!1,canRemove:!0})}),b(Array.from(f.values()))}catch(s){console.error("Failed to load members:",s)}finally{D(!1)}},we=async()=>{try{const s=await m.getAvailableOfficers(d);h(s.data.data??[])}catch(s){console.error("Failed to load available officers:",s)}},re=(s=null)=>{A(!1),s&&s.canEdit?(M(s),g({name:s.name,email:s.email,cin:s.cin??"",role:s.role,phone:s.phone??"",password:""})):(M(null),g({name:"",email:"",cin:"",role:"animateur",phone:"",password:""})),S(!0)},Ce=async()=>{A(!1),T([]),ee(""),await we(),j(!0)},Y=()=>{S(!1),M(null),g({name:"",email:"",cin:"",role:"animateur",phone:"",password:""})},Se=async s=>{s.preventDefault(),E(!0);try{x?(await m.updateMember(d,x.id,i),c.success(a("members.updateSuccess"))):(await m.createMember(d,i)).data.data?.merged?c.success(a("members.createMerged")):c.success(a("members.createSuccess")),Y(),L()}catch(n){c.error(n.response?.data?.message??a("errors.somethingWentWrong"))}finally{E(!1)}},Me=async()=>{if(t.length!==0){I(!0);try{await m.addTeamMembers(d,t),c.success(a("projects.membersAdded",{count:t.length})),j(!1),T([]),L()}catch(s){c.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{I(!1)}}},Te=s=>{J(s)},Ae=async()=>{if(u)try{if(u.isTeamMember)await m.removeTeamMember(d,u.id),c.success(a("projects.memberRemoved"));else{const s=await m.removeMember(d,u.id);c.success(a("members.removeSuccess")),s.data.data?.deactivated&&c.info(a("members.removeWarning"))}L()}catch(s){c.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{J(null)}},Le=s=>{T(n=>n.includes(s)?n.filter(o=>o!==s):[...n,s])},le=N.filter(s=>{if(!v)return!0;const n=v.toLowerCase();return s.name?.toLowerCase().includes(n)||s.email?.toLowerCase().includes(n)||s.cin?.toLowerCase().includes(n)}),ne=G.filter(s=>s.name.toLowerCase().includes(X.toLowerCase())||s.email.toLowerCase().includes(X.toLowerCase())),Re=s=>{switch(s){case"responsable":return"badge-success";case"supervisor":return"badge-info";case"animateur":return"badge-warning";case"user":return"badge-secondary";default:return"badge-secondary"}},de=N.length;return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-hse-primary"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a("projects.teamMembers")}),e.jsx("span",{className:"badge badge-info",children:de})]}),e.jsxs("div",{ref:H,className:"relative",children:[e.jsxs("button",{onClick:()=>A(!se),className:"btn-primary btn-sm flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),a("members.addMember"),e.jsx(Ue,{className:"w-4 h-4"})]}),se&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>A(!1)}),e.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-20",children:[e.jsxs("button",{onClick:Ce,className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 rounded-t-lg flex items-center gap-3",children:[e.jsx(_,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:a("projects.addToTeam")}),e.jsx("p",{className:"text-xs text-gray-500",children:a("projects.selectOfficers")})]})]}),e.jsxs("button",{onClick:()=>{A(!1),$(!0)},className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(Pe,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Massive Add"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Import XLSX"})]})]}),e.jsxs("button",{onClick:()=>re(),className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 rounded-b-lg flex items-center gap-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(Q,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:a("members.newMember")}),e.jsx("p",{className:"text-xs text-gray-500",children:a("members.subtitle")})]})]})]})]}),ye&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>$(!1)}),e.jsx("div",{className:"absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-xl p-4 z-20",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{type:"button",onClick:ve,className:"btn-secondary w-full",children:"Download Template"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{ref:W,type:"file",accept:".xlsx,.xls",onChange:s=>q(s.target.files?.[0]??null),className:"hidden"}),e.jsx("button",{type:"button",onClick:()=>W.current?.click(),className:"w-full rounded-lg border border-dashed border-gray-300 dark:border-gray-600 px-3 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700/50 transition",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Select XLSX file"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:y?y.name:"Choose the filled template (.xlsx)"})]}),e.jsx("div",{className:"text-xs font-semibold px-2 py-1 rounded-md bg-orange-50 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",children:"Browse"})]})}),y&&e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-300 truncate",children:["Selected: ",e.jsx("span",{className:"font-semibold",children:y.name})]}),e.jsx("button",{type:"button",onClick:()=>{q(null),W.current&&(W.current.value="")},className:"text-xs font-semibold text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100",children:"Clear"})]})]}),e.jsx("button",{type:"button",onClick:ke,disabled:ae||!y,className:"btn-primary w-full",children:ae?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 animate-spin"}),"Uploading..."]}):"Upload"})]})})]})]})]}),e.jsxs("div",{className:"card-body",children:[de>0&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:v,onChange:s=>k(s.target.value),placeholder:a("common.search"),className:"input pl-10"})]})}),B?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(F,{className:"w-6 h-6 animate-spin text-hse-primary"})}):le.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:le.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 bg-teal-100 dark:bg-teal-900 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-teal-600 dark:text-teal-400 font-semibold",children:s.name?.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`badge badge-xs ${Re(s.role)}`,children:a(`users.roles.${s.role}`)}),s.cin&&e.jsx("span",{className:"text-xs text-gray-500 font-mono",children:s.cin})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[s.canEdit&&e.jsx("button",{onClick:()=>re(s),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",title:a("common.edit"),children:e.jsx(Ee,{className:"w-4 h-4 text-gray-500"})}),s.canRemove&&s.id!==r?.id&&e.jsx("button",{onClick:()=>Te(s),className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:a("projects.removeFromTeam"),children:e.jsx(ze,{className:"w-4 h-4 text-red-500"})})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(_,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:a("projects.noTeamMembers")})]})]}),U&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-lg max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-[200] p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between bg-white dark:bg-gray-800",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:a(x?"members.editMember":"members.newMember")}),e.jsx("button",{onClick:Y,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(ie,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:Se,className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("users.form.fullName")," *"]}),e.jsx("input",{type:"text",value:i.name,onChange:s=>g({...i,name:s.target.value}),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("users.form.cin")," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx($e,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:i.cin,onChange:s=>g({...i,cin:s.target.value}),className:"input pl-10",placeholder:a("users.form.cinPlaceholder"),required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("users.form.email")," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx(We,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"email",value:i.email,onChange:s=>g({...i,email:s.target.value}),className:"input pl-10",required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("users.form.role")," *"]}),e.jsx(De,{value:i.role,onChange:s=>g({...i,role:s.target.value}),required:!0,children:Ve.map(s=>e.jsx("option",{value:s,children:a(`users.roles.${s}`)},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("users.form.phone")}),e.jsxs("div",{className:"relative",children:[e.jsx(Ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"tel",value:i.phone,onChange:s=>g({...i,phone:s.target.value}),className:"input pl-10"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("users.form.password")," ",x&&`(${a("users.form.passwordHint")})`]}),e.jsx("input",{type:"password",value:i.password,onChange:s=>g({...i,password:s.target.value}),className:"input",...!x&&{required:!0},minLength:8})]}),!x&&e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-sm text-blue-700 dark:text-blue-300",children:e.jsx("p",{children:a("members.cinInfo")})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:Y,className:"btn-outline",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:P,className:"btn-primary flex items-center gap-2",children:[P&&e.jsx(F,{className:"w-4 h-4 animate-spin"}),a(x?"common.save":"members.addMember")]})]})]})]})}),z&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-lg max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-[200] p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between bg-white dark:bg-gray-800",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:a("projects.selectOfficers")}),e.jsx("button",{onClick:()=>j(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(ie,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:X,onChange:s=>ee(s.target.value),placeholder:a("common.search"),className:"input pl-10"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:ne.length>0?e.jsx("div",{className:"space-y-2",children:ne.map(s=>e.jsxs("div",{onClick:()=>Le(s.id),className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors ${t.includes(s.id)?"bg-hse-primary/10 border-2 border-hse-primary":"bg-gray-50 dark:bg-gray-700 border-2 border-transparent hover:border-gray-300"}`,children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center ${t.includes(s.id)?"bg-hse-primary border-hse-primary":"border-gray-300"}`,children:t.includes(s.id)&&e.jsx(Be,{className:"w-3 h-3 text-white"})}),e.jsx("div",{className:"w-10 h-10 bg-teal-100 dark:bg-teal-900 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-teal-600 dark:text-teal-400 font-semibold",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.email})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(_,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:a("projects.noAvailableOfficers")})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[t.length," ",a("common.selected")]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>j(!1),className:"btn-outline",children:a("common.cancel")}),e.jsxs("button",{onClick:Me,disabled:t.length===0||Z,className:"btn-primary flex items-center gap-2",children:[Z?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(Q,{className:"w-4 h-4"}),a("projects.addSelected")]})]})]})]})}),e.jsx(Oe,{isOpen:!!u,title:a("common.confirm"),message:u?u.isTeamMember?a("projects.confirmRemoveMember",{name:u.name}):a("members.removeConfirm",{name:u.name}):"",confirmLabel:a("projects.removeFromTeam"),cancelLabel:a("common.cancel"),variant:"danger",onConfirm:Ae,onCancel:()=>J(null)})]})}function ds(){const{id:d}=_e(),O=Fe(),{t:a}=be(),[r,N]=l.useState(null),[b,B]=l.useState([]),[D,v]=l.useState(!0),{isAdmin:k,user:U}=je(),S=O.pathname.startsWith("/sor"),x=U?.role==="user",M=U?.role==="responsable",P=k()||M;l.useEffect(()=>{E()},[d]);const E=async()=>{try{v(!0);const[t,T]=await Promise.all([m.getById(d),m.getKpiTrends(d,12)]);N(t.data.data),B(T.data.data||[])}catch{c.error("Failed to load project details")}finally{v(!1)}},z=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],j=()=>b.map(t=>({...t,month:z[t.report_month-1],tf:Number(t.tf_value).toFixed(2),tg:Number(t.tg_value).toFixed(2)})),G={active:"badge-success",completed:"badge-info",on_hold:"badge-warning",cancelled:"badge-danger"};if(D)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(F,{className:"w-8 h-8 animate-spin text-hse-primary"})});if(!r)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Project not found"}),e.jsx(K,{to:k()?"/admin/projects":"/my-projects",className:"btn-primary mt-4",children:"Back to Projects"})]});const h=r.kpi_summary||{};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs(K,{to:k()?"/admin/projects":S?"/sor/projects":"/my-projects",className:"inline-flex items-center gap-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100",children:[e.jsx(Ge,{className:"w-4 h-4"}),a("projects.backToProjects")]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-hse-primary/10 rounded-xl flex items-center justify-center",children:e.jsx(Xe,{className:"w-8 h-8 text-hse-primary"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:r.name}),e.jsx("span",{className:`badge ${G[r.status]}`,children:r.status.replace("_"," ")}),r.pole&&e.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-200",children:r.pole})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:r.code}),r.description&&e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2 max-w-2xl",children:r.description})]})]}),!k()&&(x||S?e.jsx(K,{to:"/sor",className:"btn-primary",children:a("sor.submitDeviation")}):e.jsx(K,{to:`/kpi/submit/${r.id}`,className:"btn-primary",children:a("kpi.submitKpi")}))]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t border-gray-100 dark:border-gray-700",children:[r.location&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-300",children:[e.jsx(qe,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:r.location})]}),r.start_date&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-300",children:[e.jsx(He,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-sm",children:[new Date(r.start_date).toLocaleDateString(),r.end_date&&` - ${new Date(r.end_date).toLocaleDateString()}`]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-300",children:[e.jsx(_,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-sm",children:[r.users?.length??0," assigned users"]})]}),r.client_name&&e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"text-gray-400",children:"Client:"})," ",r.client_name]})]})]}),P&&r&&e.jsx(Ze,{projectId:r.id,projectName:r.name}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsx(C,{title:"Accidents",value:h.total_accidents??0,icon:Je,color:h.total_accidents>0?"red":"green"}),e.jsx(C,{title:"Trainings",value:h.total_trainings??0,icon:Ye,color:"blue"}),e.jsx(C,{title:"Inspections",value:h.total_inspections??0,icon:Qe,color:"green"}),e.jsx(C,{title:"Hours Worked",value:Number(h.total_hours_worked??0).toLocaleString(),icon:V,color:"purple"}),e.jsx(C,{title:"Avg TF",value:Number(h.avg_tf??0).toFixed(2),icon:V,color:"amber"}),e.jsx(C,{title:"Avg TG",value:Number(h.avg_tg??0).toFixed(2),icon:V,color:"purple"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Monthly KPI Trends"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-80",children:b.length>0?e.jsx(oe,{width:"100%",height:"100%",children:e.jsxs(me,{data:j(),children:[e.jsx(xe,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(he,{dataKey:"month",tick:{fontSize:12}}),e.jsx(ge,{tick:{fontSize:12}}),e.jsx(ue,{}),e.jsx(pe,{}),e.jsx(R,{type:"monotone",dataKey:"accidents",stroke:"#dc2626",name:"Accidents"}),e.jsx(R,{type:"monotone",dataKey:"trainings_conducted",stroke:"#3b82f6",name:"Trainings"}),e.jsx(R,{type:"monotone",dataKey:"inspections_completed",stroke:"#16a34a",name:"Inspections"})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 dark:text-gray-400",children:"No data available"})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"TF & TG Rate Trends"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-80",children:b.length>0?e.jsx(oe,{width:"100%",height:"100%",children:e.jsxs(me,{data:j(),children:[e.jsx(xe,{strokeDasharray:"3 3",className:"dark:opacity-20"}),e.jsx(he,{dataKey:"month",tick:{fontSize:12},className:"dark:text-gray-400"}),e.jsx(ge,{tick:{fontSize:12},className:"dark:text-gray-400"}),e.jsx(ue,{}),e.jsx(pe,{}),e.jsx(R,{type:"monotone",dataKey:"tf",stroke:"#f59e0b",name:"TF Rate"}),e.jsx(R,{type:"monotone",dataKey:"tg",stroke:"#8b5cf6",name:"TG Rate"})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 dark:text-gray-400",children:"No data available"})})})]})]}),r.users&&r.users.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Assigned Team Members"})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:r.users.map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-hse-primary rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold",children:t.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 capitalize",children:t.role})]})]},t.id))})})]}),r.kpiReports&&r.kpiReports.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Recent KPI Reports"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Period"}),e.jsx("th",{children:"Accidents"}),e.jsx("th",{children:"Trainings"}),e.jsx("th",{children:"Inspections"}),e.jsx("th",{children:"TF"}),e.jsx("th",{children:"TG"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:r.kpiReports.map(t=>e.jsxs("tr",{children:[e.jsxs("td",{children:[z[t.report_month-1]," ",t.report_year]}),e.jsx("td",{className:t.accidents>0?"text-red-600 font-semibold":"",children:t.accidents}),e.jsx("td",{children:t.trainings_conducted}),e.jsx("td",{children:t.inspections_completed}),e.jsx("td",{children:Number(t.tf_value).toFixed(2)}),e.jsx("td",{children:Number(t.tg_value).toFixed(2)}),e.jsx("td",{children:e.jsx("span",{className:`badge ${t.status==="approved"?"badge-success":t.status==="submitted"?"badge-warning":t.status==="rejected"?"badge-danger":"badge-info"}`,children:t.status})})]},t.id))})]})})]})]})}function C({title:d,value:O,icon:a,color:r}){const N={red:"border-red-200 bg-red-50 dark:border-red-700 dark:bg-red-900/50",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50",blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50"},b={red:"text-red-600 dark:text-red-400",green:"text-green-600 dark:text-green-400",blue:"text-blue-600 dark:text-blue-400",amber:"text-amber-600 dark:text-amber-400",purple:"text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${N[r]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(a,{className:`w-4 h-4 ${b[r]}`}),e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-300",children:d})]}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:O})]})}export{ds as default};
