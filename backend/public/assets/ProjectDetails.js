import{a as je,u as ye,p as m,j as e}from"./index.js";import{r as l,h as Fe,b as Oe,L as K}from"./vendor-react.js";import{C as De}from"./ConfirmDialog.js";import{S as Ue}from"./Select.js";import{U as _,aw as V,C as Pe,a8 as ze,s as F,aa as ie,ax as Ee,ay as $e,i as oe,az as We,v as Ke,aA as Be,a as Ge,z as c,D as Xe,F as qe,ag as He,a4 as Je,A as Ye,J as Qe,c as Ve,T as Z}from"./vendor-ui.js";import{R as me,d as xe,C as he,X as ge,Y as ue,T as pe,L as be,e as R}from"./vendor-charts.js";import"./vendor-utils.js";import"./Modal.js";function Ze({projectId:d,projectName:O}){const{t:a}=je(),{user:t}=ye(),f=t?.role==="hse_manager"?["responsable","supervisor"]:t?.role==="responsable"?["supervisor"]:["supervisor"],[j,B]=l.useState([]),[G,S]=l.useState(!0),[y,D]=l.useState(""),[U,P]=l.useState(!1),[h,M]=l.useState(null),[z,T]=l.useState(!1),[E,k]=l.useState(!1),[g,r]=l.useState([]),[x,X]=l.useState([]),[I,ee]=l.useState(!1),[q,se]=l.useState(""),[ae,A]=l.useState(!1),[fe,$]=l.useState(!1),[v,H]=l.useState(null),[te,re]=l.useState(!1),J=l.useRef(null),W=l.useRef(null),[i,u]=l.useState({name:"",email:"",cin:"",role:"supervisor",phone:"",password:""}),[p,Y]=l.useState(null);l.useEffect(()=>{L()},[d]),l.useEffect(()=>{const s=n=>{J.current&&!J.current.contains(n.target)&&$(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const ve=s=>{if(!s)return null;const n=/filename\*=UTF-8''([^;]+)|filename="?([^";]+)"?/i.exec(s),o=decodeURIComponent(n?.[1]??n?.[2]??"");return o!==""?o:null},Ne=(s,n)=>{const o=URL.createObjectURL(s),b=document.createElement("a");b.href=o,b.download=n??"template.xlsx",document.body.appendChild(b),b.click(),b.remove(),setTimeout(()=>URL.revokeObjectURL(o),5e3)},ke=async()=>{try{const s=await m.downloadTeamTemplate(d),n=ve(s.headers?.["content-disposition"])??`SGTM-Project-Team-Template-${d}.xlsx`;Ne(s.data,n)}catch(s){c.error(s.response?.data?.message??a("errors.somethingWentWrong"))}},we=async()=>{if(!v){c.error("Please choose a file");return}try{re(!0);const s=new FormData;s.append("file",v);const o=(await m.importTeam(d,s)).data?.data??{},b=o.added_count??0,N=o.errors??[];c.success(`Added: ${b}`),N.length>0&&c.error(`${N.length} row(s) had issues`),H(null),$(!1),L()}catch(s){c.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{re(!1)}},L=async()=>{try{S(!0);const[s,n]=await Promise.all([m.getMembers(d).catch(()=>({data:{data:[]}})),m.getTeam(d).catch(()=>({data:{data:[]}}))]),o=s.data.data??[],b=n.data.data??[],N=new Map;o.forEach(w=>{N.set(w.id,{...w,canEdit:!0,canRemove:!0})}),b.forEach(w=>{N.has(w.id)||N.set(w.id,{...w,isTeamMember:!0,canEdit:!1,canRemove:!0})}),B(Array.from(N.values()))}catch(s){console.error("Failed to load members:",s)}finally{S(!1)}},Ce=async()=>{try{const s=await m.getAvailableOfficers(d);r(s.data.data??[])}catch(s){console.error("Failed to load available officers:",s)}},le=(s=null)=>{A(!1),s&&s.canEdit?(M(s),u({name:s.name,email:s.email,cin:s.cin??"",role:s.role,phone:s.phone??"",password:""})):(M(null),u({name:"",email:"",cin:"",role:f[0]??"supervisor",phone:"",password:""})),P(!0)},Se=async()=>{A(!1),X([]),se(""),await Ce(),k(!0)},Q=()=>{P(!1),M(null),u({name:"",email:"",cin:"",role:f[0]??"supervisor",phone:"",password:""})},Me=async s=>{s.preventDefault(),T(!0);try{h?(await m.updateMember(d,h.id,i),c.success(a("members.updateSuccess"))):(await m.createMember(d,i)).data.data?.merged?c.success(a("members.createMerged")):c.success(a("members.createSuccess")),Q(),L()}catch(n){c.error(n.response?.data?.message??a("errors.somethingWentWrong"))}finally{T(!1)}},Te=async()=>{if(x.length!==0){ee(!0);try{await m.addTeamMembers(d,x),c.success(a("projects.membersAdded",{count:x.length})),k(!1),X([]),L()}catch(s){c.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{ee(!1)}}},Ae=s=>{Y(s)},Le=async()=>{if(p)try{if(p.isTeamMember)await m.removeTeamMember(d,p.id),c.success(a("projects.memberRemoved"));else{const s=await m.removeMember(d,p.id);c.success(a("members.removeSuccess")),s.data.data?.deactivated&&c.info(a("members.removeWarning"))}L()}catch(s){c.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Y(null)}},Re=s=>{X(n=>n.includes(s)?n.filter(o=>o!==s):[...n,s])},ne=j.filter(s=>{if(!y)return!0;const n=y.toLowerCase();return s.name?.toLowerCase().includes(n)||s.email?.toLowerCase().includes(n)||s.cin?.toLowerCase().includes(n)}),de=g.filter(s=>s.name.toLowerCase().includes(q.toLowerCase())||s.email.toLowerCase().includes(q.toLowerCase())),_e=s=>{switch(s){case"responsable":return"badge-success";case"supervisor":return"badge-info";case"user":return"badge-secondary";default:return"badge-secondary"}},ce=j.length;return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-hse-primary"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a("projects.teamMembers")}),e.jsx("span",{className:"badge badge-info",children:ce})]}),e.jsxs("div",{ref:J,className:"relative",children:[e.jsxs("button",{onClick:()=>A(!ae),className:"btn-primary btn-sm flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"}),a("members.addMember"),e.jsx(Pe,{className:"w-4 h-4"})]}),ae&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>A(!1)}),e.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-20",children:[e.jsxs("button",{onClick:Se,className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 rounded-t-lg flex items-center gap-3",children:[e.jsx(_,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:a("projects.addToTeam")}),e.jsx("p",{className:"text-xs text-gray-500",children:a("projects.selectOfficers")})]})]}),e.jsxs("button",{onClick:()=>{A(!1),$(!0)},className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(ze,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Massive Add"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Import XLSX"})]})]}),e.jsxs("button",{onClick:()=>le(),className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 rounded-b-lg flex items-center gap-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(V,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:a("members.newMember")}),e.jsx("p",{className:"text-xs text-gray-500",children:a("members.subtitle")})]})]})]})]}),fe&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>$(!1)}),e.jsx("div",{className:"absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-xl p-4 z-20",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{type:"button",onClick:ke,className:"btn-secondary w-full",children:"Download Template"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{ref:W,type:"file",accept:".xlsx,.xls",onChange:s=>H(s.target.files?.[0]??null),className:"hidden"}),e.jsx("button",{type:"button",onClick:()=>W.current?.click(),className:"w-full rounded-lg border border-dashed border-gray-300 dark:border-gray-600 px-3 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700/50 transition",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Select XLSX file"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:v?v.name:"Choose the filled template (.xlsx)"})]}),e.jsx("div",{className:"text-xs font-semibold px-2 py-1 rounded-md bg-orange-50 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",children:"Browse"})]})}),v&&e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-300 truncate",children:["Selected: ",e.jsx("span",{className:"font-semibold",children:v.name})]}),e.jsx("button",{type:"button",onClick:()=>{H(null),W.current&&(W.current.value="")},className:"text-xs font-semibold text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100",children:"Clear"})]})]}),e.jsx("button",{type:"button",onClick:we,disabled:te||!v,className:"btn-primary w-full",children:te?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 animate-spin"}),"Uploading..."]}):"Upload"})]})})]})]})]}),e.jsxs("div",{className:"card-body",children:[ce>0&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:y,onChange:s=>D(s.target.value),placeholder:a("common.search"),className:"input pl-10"})]})}),G?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(F,{className:"w-6 h-6 animate-spin text-hse-primary"})}):ne.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:ne.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 bg-teal-100 dark:bg-teal-900 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-teal-600 dark:text-teal-400 font-semibold",children:s.name?.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`badge badge-xs ${_e(s.role)}`,children:a(`users.roles.${s.role}`)}),s.cin&&e.jsx("span",{className:"text-xs text-gray-500 font-mono",children:s.cin})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[s.canEdit&&e.jsx("button",{onClick:()=>le(s),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",title:a("common.edit"),children:e.jsx(Ee,{className:"w-4 h-4 text-gray-500"})}),s.canRemove&&s.id!==t?.id&&e.jsx("button",{onClick:()=>Ae(s),className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:a("projects.removeFromTeam"),children:e.jsx($e,{className:"w-4 h-4 text-red-500"})})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(_,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:a("projects.noTeamMembers")})]})]}),U&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-lg max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-[200] p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between bg-white dark:bg-gray-800",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:a(h?"members.editMember":"members.newMember")}),e.jsx("button",{onClick:Q,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(oe,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:Me,className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("users.form.fullName")," *"]}),e.jsx("input",{type:"text",value:i.name,onChange:s=>u({...i,name:s.target.value}),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("users.form.cin")," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx(We,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:i.cin,onChange:s=>u({...i,cin:s.target.value}),className:"input pl-10",placeholder:a("users.form.cinPlaceholder"),required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("users.form.email")," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"email",value:i.email,onChange:s=>u({...i,email:s.target.value}),className:"input pl-10",required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("users.form.role")," *"]}),e.jsx(Ue,{value:i.role,onChange:s=>u({...i,role:s.target.value}),required:!0,children:f.map(s=>e.jsx("option",{value:s,children:a(`users.roles.${s}`)},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("users.form.phone")}),e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"tel",value:i.phone,onChange:s=>u({...i,phone:s.target.value}),className:"input pl-10"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("users.form.password")," ",h&&`(${a("users.form.passwordHint")})`]}),e.jsx("input",{type:"password",value:i.password,onChange:s=>u({...i,password:s.target.value}),className:"input",...!h&&{required:!0},minLength:8})]}),!h&&e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-sm text-blue-700 dark:text-blue-300",children:e.jsx("p",{children:a("members.cinInfo")})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:Q,className:"btn-outline",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:z,className:"btn-primary flex items-center gap-2",children:[z&&e.jsx(F,{className:"w-4 h-4 animate-spin"}),a(h?"common.save":"members.addMember")]})]})]})]})}),E&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-lg max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-[200] p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between bg-white dark:bg-gray-800",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:a("projects.selectOfficers")}),e.jsx("button",{onClick:()=>k(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(oe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:q,onChange:s=>se(s.target.value),placeholder:a("common.search"),className:"input pl-10"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:de.length>0?e.jsx("div",{className:"space-y-2",children:de.map(s=>e.jsxs("div",{onClick:()=>Re(s.id),className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors ${x.includes(s.id)?"bg-hse-primary/10 border-2 border-hse-primary":"bg-gray-50 dark:bg-gray-700 border-2 border-transparent hover:border-gray-300"}`,children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center ${x.includes(s.id)?"bg-hse-primary border-hse-primary":"border-gray-300"}`,children:x.includes(s.id)&&e.jsx(Ge,{className:"w-3 h-3 text-white"})}),e.jsx("div",{className:"w-10 h-10 bg-teal-100 dark:bg-teal-900 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-teal-600 dark:text-teal-400 font-semibold",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.email})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(_,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:a("projects.noAvailableOfficers")})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[x.length," ",a("common.selected")]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>k(!1),className:"btn-outline",children:a("common.cancel")}),e.jsxs("button",{onClick:Te,disabled:x.length===0||I,className:"btn-primary flex items-center gap-2",children:[I?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(V,{className:"w-4 h-4"}),a("projects.addSelected")]})]})]})]})}),e.jsx(De,{isOpen:!!p,title:a("common.confirm"),message:p?p.isTeamMember?a("projects.confirmRemoveMember",{name:p.name}):a("members.removeConfirm",{name:p.name}):"",confirmLabel:a("projects.removeFromTeam"),cancelLabel:a("common.cancel"),variant:"danger",onConfirm:Le,onCancel:()=>Y(null)})]})}function ds(){const{id:d}=Fe(),O=Oe(),{t:a}=je(),[t,f]=l.useState(null),[j,B]=l.useState([]),[G,S]=l.useState(!0),{isAdmin:y,user:D}=ye(),U=O.pathname.startsWith("/sor"),P=D?.role==="user",h=D?.role==="responsable",M=y()||h;l.useEffect(()=>{z()},[d]);const z=async()=>{try{S(!0);const[r,x]=await Promise.all([m.getById(d),m.getKpiTrends(d,12)]);f(r.data.data),B(x.data.data||[])}catch{c.error("Failed to load project details")}finally{S(!1)}},T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],E=()=>j.map(r=>({...r,month:T[r.report_month-1],tf:Number(r.tf_value).toFixed(2),tg:Number(r.tg_value).toFixed(2)})),k={active:"badge-success",completed:"badge-info",on_hold:"badge-warning",cancelled:"badge-danger"};if(G)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(F,{className:"w-8 h-8 animate-spin text-hse-primary"})});if(!t)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Project not found"}),e.jsx(K,{to:y()?"/admin/projects":"/my-projects",className:"btn-primary mt-4",children:"Back to Projects"})]});const g=t.kpi_summary||{};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs(K,{to:y()?"/admin/projects":U?"/sor/projects":"/my-projects",className:"inline-flex items-center gap-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100",children:[e.jsx(Xe,{className:"w-4 h-4"}),a("projects.backToProjects")]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-hse-primary/10 rounded-xl flex items-center justify-center",children:e.jsx(qe,{className:"w-8 h-8 text-hse-primary"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("span",{className:`badge ${k[t.status]}`,children:t.status.replace("_"," ")}),t.pole&&e.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-200",children:t.pole})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:t.code}),t.description&&e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2 max-w-2xl",children:t.description})]})]}),!y()&&(P||U?e.jsx(K,{to:"/sor",className:"btn-primary",children:a("sor.submitDeviation")}):e.jsx(K,{to:`/kpi/submit/${t.id}`,className:"btn-primary",children:a("kpi.submitKpi")}))]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t border-gray-100 dark:border-gray-700",children:[t.location&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-300",children:[e.jsx(He,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:t.location})]}),t.start_date&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-300",children:[e.jsx(Je,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-sm",children:[new Date(t.start_date).toLocaleDateString(),t.end_date&&` - ${new Date(t.end_date).toLocaleDateString()}`]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-300",children:[e.jsx(_,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-sm",children:[t.users?.length??0," assigned users"]})]}),t.client_name&&e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"text-gray-400",children:"Client:"})," ",t.client_name]})]})]}),M&&t&&e.jsx(Ze,{projectId:t.id,projectName:t.name}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsx(C,{title:"Accidents",value:g.total_accidents??0,icon:Ye,color:g.total_accidents>0?"red":"green"}),e.jsx(C,{title:"Trainings",value:g.total_trainings??0,icon:Qe,color:"blue"}),e.jsx(C,{title:"Inspections",value:g.total_inspections??0,icon:Ve,color:"green"}),e.jsx(C,{title:"Hours Worked",value:Number(g.total_hours_worked??0).toLocaleString(),icon:Z,color:"purple"}),e.jsx(C,{title:"Avg TF",value:Number(g.avg_tf??0).toFixed(2),icon:Z,color:"amber"}),e.jsx(C,{title:"Avg TG",value:Number(g.avg_tg??0).toFixed(2),icon:Z,color:"purple"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Monthly KPI Trends"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-80",children:j.length>0?e.jsx(me,{width:"100%",height:"100%",children:e.jsxs(xe,{data:E(),children:[e.jsx(he,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(ge,{dataKey:"month",tick:{fontSize:12}}),e.jsx(ue,{tick:{fontSize:12}}),e.jsx(pe,{}),e.jsx(be,{}),e.jsx(R,{type:"monotone",dataKey:"accidents",stroke:"#dc2626",name:"Accidents"}),e.jsx(R,{type:"monotone",dataKey:"trainings_conducted",stroke:"#3b82f6",name:"Trainings"}),e.jsx(R,{type:"monotone",dataKey:"inspections_completed",stroke:"#16a34a",name:"Inspections"})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 dark:text-gray-400",children:"No data available"})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"TF & TG Rate Trends"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-80",children:j.length>0?e.jsx(me,{width:"100%",height:"100%",children:e.jsxs(xe,{data:E(),children:[e.jsx(he,{strokeDasharray:"3 3",className:"dark:opacity-20"}),e.jsx(ge,{dataKey:"month",tick:{fontSize:12},className:"dark:text-gray-400"}),e.jsx(ue,{tick:{fontSize:12},className:"dark:text-gray-400"}),e.jsx(pe,{}),e.jsx(be,{}),e.jsx(R,{type:"monotone",dataKey:"tf",stroke:"#f59e0b",name:"TF Rate"}),e.jsx(R,{type:"monotone",dataKey:"tg",stroke:"#8b5cf6",name:"TG Rate"})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 dark:text-gray-400",children:"No data available"})})})]})]}),t.users&&t.users.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Assigned Team Members"})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:t.users.map(r=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-hse-primary rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold",children:r.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 capitalize",children:r.role})]})]},r.id))})})]}),t.kpiReports&&t.kpiReports.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Recent KPI Reports"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Period"}),e.jsx("th",{children:"Accidents"}),e.jsx("th",{children:"Trainings"}),e.jsx("th",{children:"Inspections"}),e.jsx("th",{children:"TF"}),e.jsx("th",{children:"TG"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:t.kpiReports.map(r=>e.jsxs("tr",{children:[e.jsxs("td",{children:[T[r.report_month-1]," ",r.report_year]}),e.jsx("td",{className:r.accidents>0?"text-red-600 font-semibold":"",children:r.accidents}),e.jsx("td",{children:r.trainings_conducted}),e.jsx("td",{children:r.inspections_completed}),e.jsx("td",{children:Number(r.tf_value).toFixed(2)}),e.jsx("td",{children:Number(r.tg_value).toFixed(2)}),e.jsx("td",{children:e.jsx("span",{className:`badge ${r.status==="approved"?"badge-success":r.status==="submitted"?"badge-warning":r.status==="rejected"?"badge-danger":"badge-info"}`,children:r.status})})]},r.id))})]})})]})]})}function C({title:d,value:O,icon:a,color:t}){const f={red:"border-red-200 bg-red-50 dark:border-red-700 dark:bg-red-900/50",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50",blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50"},j={red:"text-red-600 dark:text-red-400",green:"text-green-600 dark:text-green-400",blue:"text-blue-600 dark:text-blue-400",amber:"text-amber-600 dark:text-amber-400",purple:"text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${f[t]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(a,{className:`w-4 h-4 ${j[t]}`}),e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-300",children:d})]}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:O})]})}export{ds as default};
