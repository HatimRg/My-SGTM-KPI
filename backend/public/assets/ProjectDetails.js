import{a as ye,u as fe,g as x,j as e}from"./index.js";import{r as l,h as Pe,b as Oe,L as K}from"./vendor-react.js";import{C as ze}from"./ConfirmDialog.js";import{S as De}from"./Select.js";import{g as ie,P as Ue,c as Ee}from"./PasswordStrength.js";import{U as _,aC as Q,C as $e,ae as We,v as F,ag as oe,aD as Ke,aE as Be,k as me,aF as Ge,x as Xe,aG as Ze,a as qe,z as i,J as Je,F as He,am as Ye,aa as Ie,A as Qe,f as Ve,c as es,Z as V}from"./vendor-ui.js";import{Z as ss}from"./ZonesManager.js";import{R as xe,d as he,C as ge,X as ue,Y as pe,T as be,L as je,e as R}from"./vendor-charts.js";import"./vendor-utils.js";import"./Modal.js";function as({projectId:c,projectName:P}){const{t:a}=ye(),{user:r}=fe(),y=r?.role==="hse_manager"?["responsable","supervisor","user"]:r?.role==="responsable"?["supervisor","user"]:["supervisor"],[b,B]=l.useState([]),[G,S]=l.useState(!0),[M,O]=l.useState(""),[f,j]=l.useState(!1),[h,T]=l.useState(null),[z,D]=l.useState(!1),[X,N]=l.useState(!1),[U,Z]=l.useState([]),[o,t]=l.useState([]),[E,ee]=l.useState(!1),[q,se]=l.useState(""),[ae,A]=l.useState(!1),[Ne,$]=l.useState(!1),[v,J]=l.useState(null),[re,te]=l.useState(!1),H=l.useRef(null),W=l.useRef(null),[d,g]=l.useState({name:"",email:"",cin:"",role:"supervisor",phone:"",password:""}),[u,Y]=l.useState(null);l.useEffect(()=>{L()},[c]),l.useEffect(()=>{const s=n=>{H.current&&!H.current.contains(n.target)&&$(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const ve=s=>{if(!s)return null;const n=/filename\*=UTF-8''([^;]+)|filename="?([^";]+)"?/i.exec(s),m=decodeURIComponent(n?.[1]??n?.[2]??"");return m!==""?m:null},ke=(s,n)=>{const m=URL.createObjectURL(s),p=document.createElement("a");p.href=m,p.download=n??"template.xlsx",document.body.appendChild(p),p.click(),p.remove(),setTimeout(()=>URL.revokeObjectURL(m),5e3)},we=async()=>{try{const s=await x.downloadTeamTemplate(c),n=ve(s.headers?.["content-disposition"])??`SGTM-Project-Team-Template-${c}.xlsx`;ke(s.data,n)}catch(s){i.error(s.response?.data?.message??a("errors.somethingWentWrong"))}},Ce=async()=>{if(!v){i.error("Please choose a file");return}try{te(!0);const s=new FormData;s.append("file",v);const m=(await x.importTeam(c,s)).data?.data??{},p=m.added_count??0,k=m.errors??[];i.success(`Added: ${p}`),k.length>0&&i.error(`${k.length} row(s) had issues`),J(null),$(!1),L()}catch(s){i.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{te(!1)}},L=async()=>{try{S(!0);const[s,n]=await Promise.all([x.getMembers(c).catch(()=>({data:{data:[]}})),x.getTeam(c).catch(()=>({data:{data:[]}}))]),m=s.data.data??[],p=n.data.data??[],k=new Map;m.forEach(w=>{k.set(w.id,{...w,canEdit:!0,canRemove:!0})}),p.forEach(w=>{k.has(w.id)||k.set(w.id,{...w,isTeamMember:!0,canEdit:!1,canRemove:!0})}),B(Array.from(k.values()))}catch(s){console.error("Failed to load members:",s)}finally{S(!1)}},Se=async()=>{try{const s=await x.getAvailableOfficers(c);Z(s.data.data??[])}catch(s){console.error("Failed to load available officers:",s)}},le=(s=null)=>{A(!1),s&&s.canEdit?(T(s),g({name:s.name,email:s.email,cin:s.cin??"",role:s.role,phone:s.phone??"",password:""})):(T(null),g({name:"",email:"",cin:"",role:y[0]??"supervisor",phone:"",password:""})),j(!0)},Me=async()=>{A(!1),t([]),se(""),await Se(),N(!0)},I=()=>{j(!1),T(null),g({name:"",email:"",cin:"",role:y[0]??"supervisor",phone:"",password:""})},Te=async s=>{if(s.preventDefault(),d.password){const n=ie(d.role);if(!Ee(d.password,n).ok){i.error(a("auth.passwordPolicy.invalid"));return}}D(!0);try{h?(await x.updateMember(c,h.id,d),i.success(a("members.updateSuccess"))):(await x.createMember(c,d)).data.data?.merged?i.success(a("members.createMerged")):i.success(a("members.createSuccess")),I(),L()}catch(n){i.error(n.response?.data?.message??a("errors.somethingWentWrong"))}finally{D(!1)}},Ae=async()=>{if(o.length!==0){ee(!0);try{await x.addTeamMembers(c,o),i.success(a("projects.membersAdded",{count:o.length})),N(!1),t([]),L()}catch(s){i.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{ee(!1)}}},Le=s=>{Y(s)},Re=async()=>{if(u)try{if(u.isTeamMember)await x.removeTeamMember(c,u.id),i.success(a("projects.memberRemoved"));else{const s=await x.removeMember(c,u.id);i.success(a("members.removeSuccess")),s.data.data?.deactivated&&i.info(a("members.removeWarning"))}L()}catch(s){i.error(s.response?.data?.message??a("errors.somethingWentWrong"))}finally{Y(null)}},_e=s=>{t(n=>n.includes(s)?n.filter(m=>m!==s):[...n,s])},ne=b.filter(s=>{if(!M)return!0;const n=M.toLowerCase();return s.name?.toLowerCase().includes(n)||s.email?.toLowerCase().includes(n)||s.cin?.toLowerCase().includes(n)}),de=U.filter(s=>s.name.toLowerCase().includes(q.toLowerCase())||s.email.toLowerCase().includes(q.toLowerCase())),Fe=s=>{switch(s){case"responsable":return"badge-success";case"supervisor":return"badge-info";case"user":return"badge-secondary";default:return"badge-secondary"}},ce=b.length;return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-hse-primary"}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a("projects.teamMembers")}),e.jsx("span",{className:"badge badge-info",children:ce})]}),e.jsxs("div",{ref:H,className:"relative",children:[e.jsxs("button",{onClick:()=>A(!ae),className:"btn-primary btn-sm flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),a("members.addMember"),e.jsx($e,{className:"w-4 h-4"})]}),ae&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>A(!1)}),e.jsxs("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-20",children:[e.jsxs("button",{onClick:Me,className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 rounded-t-lg flex items-center gap-3",children:[e.jsx(_,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:a("projects.addToTeam")}),e.jsx("p",{className:"text-xs text-gray-500",children:a("projects.selectOfficers")})]})]}),e.jsxs("button",{onClick:()=>{A(!1),$(!0)},className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 flex items-center gap-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(We,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Massive Add"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Import XLSX"})]})]}),e.jsxs("button",{onClick:()=>le(),className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 rounded-b-lg flex items-center gap-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(Q,{className:"w-4 h-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:a("members.newMember")}),e.jsx("p",{className:"text-xs text-gray-500",children:a("members.subtitle")})]})]})]})]}),Ne&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>$(!1)}),e.jsx("div",{className:"absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow-xl p-4 z-20",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{type:"button",onClick:we,className:"btn-secondary w-full",children:"Download Template"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{ref:W,type:"file",accept:".xlsx,.xls",onChange:s=>J(s.target.files?.[0]??null),className:"hidden"}),e.jsx("button",{type:"button",onClick:()=>W.current?.click(),className:"w-full rounded-lg border border-dashed border-gray-300 dark:border-gray-600 px-3 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700/50 transition",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:"Select XLSX file"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:v?v.name:"Choose the filled template (.xlsx)"})]}),e.jsx("div",{className:"text-xs font-semibold px-2 py-1 rounded-md bg-orange-50 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",children:"Browse"})]})}),v&&e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-300 truncate",children:["Selected: ",e.jsx("span",{className:"font-semibold",children:v.name})]}),e.jsx("button",{type:"button",onClick:()=>{J(null),W.current&&(W.current.value="")},className:"text-xs font-semibold text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100",children:"Clear"})]})]}),e.jsx("button",{type:"button",onClick:Ce,disabled:re||!v,className:"btn-primary w-full",children:re?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 animate-spin"}),"Uploading..."]}):"Upload"})]})})]})]})]}),e.jsxs("div",{className:"card-body",children:[ce>0&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:M,onChange:s=>O(s.target.value),placeholder:a("common.search"),className:"input pl-10"})]})}),G?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(F,{className:"w-6 h-6 animate-spin text-hse-primary"})}):ne.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:ne.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 bg-teal-100 dark:bg-teal-900 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-teal-600 dark:text-teal-400 font-semibold",children:s.name?.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`badge badge-xs ${Fe(s.role)}`,children:a(`users.roles.${s.role}`)}),s.cin&&e.jsx("span",{className:"text-xs text-gray-500 font-mono",children:s.cin})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[s.canEdit&&e.jsx("button",{onClick:()=>le(s),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",title:a("common.edit"),children:e.jsx(Ke,{className:"w-4 h-4 text-gray-500"})}),s.canRemove&&s.id!==r?.id&&e.jsx("button",{onClick:()=>Le(s),className:"p-2 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:a("projects.removeFromTeam"),children:e.jsx(Be,{className:"w-4 h-4 text-red-500"})})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(_,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:a("projects.noTeamMembers")})]})]}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-lg max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-[200] p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between bg-white dark:bg-gray-800",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:a(h?"members.editMember":"members.newMember")}),e.jsx("button",{onClick:I,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(me,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:Te,className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("users.form.fullName")," *"]}),e.jsx("input",{type:"text",value:d.name,onChange:s=>g({...d,name:s.target.value}),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("users.form.cin")," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:d.cin,onChange:s=>g({...d,cin:s.target.value}),className:"input pl-10",placeholder:a("users.form.cinPlaceholder"),required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("users.form.email")," *"]}),e.jsxs("div",{className:"relative",children:[e.jsx(Xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"email",value:d.email,onChange:s=>g({...d,email:s.target.value}),className:"input pl-10",required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("users.form.role")," *"]}),e.jsx(De,{value:d.role,onChange:s=>g({...d,role:s.target.value}),required:!0,children:y.map(s=>e.jsx("option",{value:s,children:a(`users.roles.${s}`)},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("users.form.phone")}),e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"tel",value:d.phone,onChange:s=>g({...d,phone:s.target.value}),className:"input pl-10"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("users.form.password")," ",h&&`(${a("users.form.passwordHint")})`]}),e.jsx("input",{type:"password",value:d.password,onChange:s=>g({...d,password:s.target.value}),className:"input",...!h&&{required:!0},minLength:ie(d.role).minLength}),e.jsx(Ue,{password:d.password,role:d.role})]}),!h&&e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-sm text-blue-700 dark:text-blue-300",children:e.jsx("p",{children:a("members.cinInfo")})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:I,className:"btn-outline",children:a("common.cancel")}),e.jsxs("button",{type:"submit",disabled:z,className:"btn-primary flex items-center gap-2",children:[z&&e.jsx(F,{className:"w-4 h-4 animate-spin"}),a(h?"common.save":"members.addMember")]})]})]})]})}),X&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-lg max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"sticky top-0 z-[200] p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between bg-white dark:bg-gray-800",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:a("projects.selectOfficers")}),e.jsx("button",{onClick:()=>N(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:e.jsx(me,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:q,onChange:s=>se(s.target.value),placeholder:a("common.search"),className:"input pl-10"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:de.length>0?e.jsx("div",{className:"space-y-2",children:de.map(s=>e.jsxs("div",{onClick:()=>_e(s.id),className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors ${o.includes(s.id)?"bg-hse-primary/10 border-2 border-hse-primary":"bg-gray-50 dark:bg-gray-700 border-2 border-transparent hover:border-gray-300"}`,children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center ${o.includes(s.id)?"bg-hse-primary border-hse-primary":"border-gray-300"}`,children:o.includes(s.id)&&e.jsx(qe,{className:"w-3 h-3 text-white"})}),e.jsx("div",{className:"w-10 h-10 bg-teal-100 dark:bg-teal-900 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-teal-600 dark:text-teal-400 font-semibold",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.email})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(_,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:a("projects.noAvailableOfficers")})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[o.length," ",a("common.selected")]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>N(!1),className:"btn-outline",children:a("common.cancel")}),e.jsxs("button",{onClick:Ae,disabled:o.length===0||E,className:"btn-primary flex items-center gap-2",children:[E?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(Q,{className:"w-4 h-4"}),a("projects.addSelected")]})]})]})]})}),e.jsx(ze,{isOpen:!!u,title:a("common.confirm"),message:u?u.isTeamMember?a("projects.confirmRemoveMember",{name:u.name}):a("members.removeConfirm",{name:u.name}):"",confirmLabel:a("projects.removeFromTeam"),cancelLabel:a("common.cancel"),variant:"danger",onConfirm:Re,onCancel:()=>Y(null)})]})}function hs(){const{id:c}=Pe(),P=Oe(),{t:a}=ye(),[r,y]=l.useState(null),[b,B]=l.useState([]),[G,S]=l.useState(!0),[M,O]=l.useState(!1),{isAdmin:f,user:j}=fe(),h=P.pathname.startsWith("/sor"),T=j?.role==="user",z=f()||j?.role==="hse_manager"||j?.role==="responsable",D=f()||j?.role==="hse_manager"||j?.role==="responsable";l.useEffect(()=>{X()},[c]);const X=async()=>{try{S(!0);const[t,E]=await Promise.all([x.getById(c),x.getKpiTrends(c,12)]);y(t.data.data),B(E.data.data||[])}catch{i.error("Failed to load project details")}finally{S(!1)}},N=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],U=()=>b.map(t=>({...t,month:N[t.report_month-1],tf:Number(t.tf_value).toFixed(2),tg:Number(t.tg_value).toFixed(2)})),Z={active:"badge-success",completed:"badge-info",on_hold:"badge-warning",cancelled:"badge-danger"};if(G)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(F,{className:"w-8 h-8 animate-spin text-hse-primary"})});if(!r)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Project not found"}),e.jsx(K,{to:f()?"/admin/projects":"/my-projects",className:"btn-primary mt-4",children:"Back to Projects"})]});const o=r.kpi_summary||{};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs(K,{to:f()?"/admin/projects":h?"/sor/projects":"/my-projects",className:"inline-flex items-center gap-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-100",children:[e.jsx(Je,{className:"w-4 h-4"}),a("projects.backToProjects")]}),e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-hse-primary/10 rounded-xl flex items-center justify-center",children:e.jsx(He,{className:"w-8 h-8 text-hse-primary"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:r.name}),e.jsx("span",{className:`badge ${Z[r.status]}`,children:r.status.replace("_"," ")}),r.pole&&e.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-200",children:r.pole})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:r.code}),r.description&&e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2 max-w-2xl",children:r.description})]})]}),!f()&&(T||h?e.jsx(K,{to:"/sor",className:"btn-primary",children:a("sor.submitDeviation")}):e.jsx(K,{to:`/kpi/submit/${r.id}`,className:"btn-primary",children:a("kpi.submitKpi")}))]}),e.jsxs("div",{className:"flex items-center justify-between gap-3 mt-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[(Array.isArray(r.zones)?r.zones:[]).slice(0,6).map(t=>e.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-amber-50 text-amber-800 dark:bg-amber-900/30 dark:text-amber-200",children:t},t)),(Array.isArray(r.zones)?r.zones:[]).length>6&&e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["+",(r.zones?.length??0)-6]}),(Array.isArray(r.zones)?r.zones:[]).length===0&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:a("common.noData")})]}),D&&e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>O(!0),children:a("projects.manageZones")})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6 pt-6 border-t border-gray-100 dark:border-gray-700",children:[r.location&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-300",children:[e.jsx(Ye,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm",children:r.location})]}),r.start_date&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-300",children:[e.jsx(Ie,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-sm",children:[new Date(r.start_date).toLocaleDateString(),r.end_date&&` - ${new Date(r.end_date).toLocaleDateString()}`]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 dark:text-gray-300",children:[e.jsx(_,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-sm",children:[r.users?.length??0," assigned users"]})]}),r.client_name&&e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"text-gray-400",children:"Client:"})," ",r.client_name]})]})]}),z&&r&&e.jsx(as,{projectId:r.id,projectName:r.name}),r&&e.jsx(ss,{projectId:r.id,projectName:r.name,isOpen:M,onClose:()=>O(!1)}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsx(C,{title:"Accidents",value:o.total_accidents??0,icon:Qe,color:o.total_accidents>0?"red":"green"}),e.jsx(C,{title:"Trainings",value:o.total_trainings??0,icon:Ve,color:"blue"}),e.jsx(C,{title:"Inspections",value:o.total_inspections??0,icon:es,color:"green"}),e.jsx(C,{title:"Hours Worked",value:Number(o.total_hours_worked??0).toLocaleString(),icon:V,color:"purple"}),e.jsx(C,{title:"Avg TF",value:Number(o.avg_tf??0).toFixed(2),icon:V,color:"amber"}),e.jsx(C,{title:"Avg TG",value:Number(o.avg_tg??0).toFixed(2),icon:V,color:"purple"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Monthly KPI Trends"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-80",children:b.length>0?e.jsx(xe,{width:"100%",height:"100%",children:e.jsxs(he,{data:U(),children:[e.jsx(ge,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(ue,{dataKey:"month",tick:{fontSize:12}}),e.jsx(pe,{tick:{fontSize:12}}),e.jsx(be,{}),e.jsx(je,{}),e.jsx(R,{type:"monotone",dataKey:"accidents",stroke:"#dc2626",name:"Accidents"}),e.jsx(R,{type:"monotone",dataKey:"trainings_conducted",stroke:"#3b82f6",name:"Trainings"}),e.jsx(R,{type:"monotone",dataKey:"inspections_completed",stroke:"#16a34a",name:"Inspections"})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 dark:text-gray-400",children:"No data available"})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"TF & TG Rate Trends"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-80",children:b.length>0?e.jsx(xe,{width:"100%",height:"100%",children:e.jsxs(he,{data:U(),children:[e.jsx(ge,{strokeDasharray:"3 3",className:"dark:opacity-20"}),e.jsx(ue,{dataKey:"month",tick:{fontSize:12},className:"dark:text-gray-400"}),e.jsx(pe,{tick:{fontSize:12},className:"dark:text-gray-400"}),e.jsx(be,{}),e.jsx(je,{}),e.jsx(R,{type:"monotone",dataKey:"tf",stroke:"#f59e0b",name:"TF Rate"}),e.jsx(R,{type:"monotone",dataKey:"tg",stroke:"#8b5cf6",name:"TG Rate"})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 dark:text-gray-400",children:"No data available"})})})]})]}),r.users&&r.users.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Assigned Team Members"})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:r.users.map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("div",{className:"w-10 h-10 bg-hse-primary rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold",children:t.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 capitalize",children:t.role})]})]},t.id))})})]}),r.kpiReports&&r.kpiReports.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Recent KPI Reports"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Period"}),e.jsx("th",{children:"Accidents"}),e.jsx("th",{children:"Trainings"}),e.jsx("th",{children:"Inspections"}),e.jsx("th",{children:"TF"}),e.jsx("th",{children:"TG"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:r.kpiReports.map(t=>e.jsxs("tr",{children:[e.jsxs("td",{children:[N[t.report_month-1]," ",t.report_year]}),e.jsx("td",{className:t.accidents>0?"text-red-600 font-semibold":"",children:t.accidents}),e.jsx("td",{children:t.trainings_conducted}),e.jsx("td",{children:t.inspections_completed}),e.jsx("td",{children:Number(t.tf_value).toFixed(2)}),e.jsx("td",{children:Number(t.tg_value).toFixed(2)}),e.jsx("td",{children:e.jsx("span",{className:`badge ${t.status==="approved"?"badge-success":t.status==="submitted"?"badge-warning":t.status==="rejected"?"badge-danger":"badge-info"}`,children:t.status})})]},t.id))})]})})]})]})}function C({title:c,value:P,icon:a,color:r}){const y={red:"border-red-200 bg-red-50 dark:border-red-700 dark:bg-red-900/50",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50",blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50"},b={red:"text-red-600 dark:text-red-400",green:"text-green-600 dark:text-green-400",blue:"text-blue-600 dark:text-blue-400",amber:"text-amber-600 dark:text-amber-400",purple:"text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${y[r]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(a,{className:`w-4 h-4 ${b[r]}`}),e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-300",children:c})]}),e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:P})]})}export{hs as default};
