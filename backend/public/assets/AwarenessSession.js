import{a as je,u as be,v as O,j as e,h as fe}from"./index.js";import{r as t}from"./vendor-react.js";import{u as Ne}from"./projectStore.js";import{D as I}from"./DatePicker.js";import{S as M}from"./Select.js";import{C as we}from"./ConfirmDialog.js";import{af as ve,av as ke,C as Se,ag as Ce,k as Pe,a as se,ah as ae,ab as De,al as te,z as g}from"./vendor-ui.js";import{c as _e}from"./weekHelper.js";import{s as Te,g as re}from"./projectList.js";import"./vendor-utils.js";import"./Modal.js";const Ee=[15,30,45,60],W=10;function $e(){const{t:a}=je(),{user:j}=be(),{projects:S,isLoading:R,fetchProjects:U}=Ne(),H=j?.project_list_preference??"code",q=t.useMemo(()=>Te(S,H),[S,H]),[o,ne]=t.useState([]),[B,$]=t.useState(!1),[b,z]=t.useState(""),[x,G]=t.useState(""),[X,le]=t.useState(""),[h,C]=t.useState(""),[n,P]=t.useState(""),[f,J]=t.useState(""),[p,K]=t.useState(15),[Q,V]=t.useState(""),[l,ie]=t.useState(""),[i,oe]=t.useState(""),[c,ce]=t.useState(""),[d,de]=t.useState(""),[D,me]=t.useState(!1),[u,y]=t.useState(1),[xe,Y]=t.useState(!1),[_,T]=t.useState(null);t.useEffect(()=>{j?.name&&le(j.name)},[j]),t.useEffect(()=>{(async()=>{try{const r=await U();r.length===1&&z(r[0].id)}catch(r){console.error("Failed to load projects",r)}})()},[U]),t.useEffect(()=>{E()},[l,i]);const E=async()=>{try{$(!0);const s={};l&&(s.project_id=l),i&&(s.week=i);const r=await O.getAll(s);ne(r.data?.data??r.data??[])}catch(s){console.error("Failed to load awareness sessions",s)}finally{$(!1)}},F=t.useMemo(()=>{const s=a("awareness.themes");return Array.isArray(s)?s:[]},[a]),he=t.useMemo(()=>{if(!h)return F;const s=h.toLowerCase();return F.filter(r=>r.toLowerCase().includes(s))},[F,h]),N=parseInt(Q,10),A=p/60*N,w=t.useMemo(()=>Array.isArray(o)?o.filter(s=>{const r=s.date?s.date.substring(0,10):"";return!(c&&(!r||r<c)||d&&(!r||r>d))}):[],[o,c,d]),v=Math.max(1,Math.ceil((w.length??0)/W)),Z=t.useMemo(()=>{if(!Array.isArray(w))return[];const s=(u-1)*W;return w.slice(s,s+W)},[w,u]);t.useEffect(()=>{y(1)},[l,i]);const pe=async()=>{try{Y(!0);const s={};l&&(s.project_id=l),i&&(s.week=i),c&&(s.from_date=c),d&&(s.to_date=d);const r=await fe.exportAwareness(s),L=new Blob([r.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),k=window.URL.createObjectURL(L),m=document.createElement("a");m.href=k,m.download="awareness_sessions.xlsx",m.click(),window.URL.revokeObjectURL(k)}catch(s){console.error("Error exporting awareness sessions:",s),g.error(a("errors.somethingWentWrong")??"Error while exporting")}finally{Y(!1)}},ue=s=>{if(s.preventDefault(),!b||!x||!n||!N||n==="Other"&&!f.trim())return;const{week:r,year:L}=_e(x),k={project_id:b,date:x,week_number:r,week_year:L,by_name:X,theme:n==="Other"?f:n,duration_minutes:p,participants:N,session_hours:A};O.create(k).then(()=>{g.success(a("awareness.created")??"Session saved"),G(""),C(""),P(""),J(""),K(15),V(""),E()}).catch(m=>{console.error("Failed to create awareness session",m);const ge=m.response?.data?.message??a("errors.somethingWentWrong")??"Failed to save session";g.error(ge)})},ee=s=>{T(s)},ye=async()=>{if(_?.id)try{await O.delete(_.id),g.success(a("common.saved")??"Saved"),E()}catch(s){console.error("Failed to delete awareness session",s),g.error(a("errors.failedToDelete")??a("common.error")??"Error")}finally{T(null)}};return e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6 animate-fade-in",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:[a("nav.dashboard")," / ",a("awareness.navLabel")]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:a("awareness.pageTitle")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:a("awareness.pageSubtitle")})]}),e.jsxs("div",{className:"card",children:[e.jsxs("button",{type:"button",onClick:()=>me(!D),className:"w-full p-4 flex items-center justify-between text-left hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-hse-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(ve,{className:"w-5 h-5 text-hse-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a("awareness.addSession")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a("awareness.clickToExpand")})]})]}),D?e.jsx(ke,{className:"w-5 h-5 text-gray-400"}):e.jsx(Se,{className:"w-5 h-5 text-gray-400"})]}),D&&e.jsxs("form",{onSubmit:ue,className:"p-6 pt-2 space-y-6 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("awareness.project")}),e.jsxs(M,{value:b,onChange:s=>z(s.target.value),disabled:R||S.length===1,required:!0,children:[e.jsx("option",{value:"",children:a(R?"common.loading":"awareness.selectProject")}),q.map(s=>e.jsx("option",{value:s.id,children:re(s)},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("awareness.date")}),e.jsx(I,{value:x,onChange:G,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("awareness.by")}),e.jsx("input",{type:"text",className:"input bg-gray-50 dark:bg-gray-800",value:X,readOnly:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"label",children:a("awareness.theme")}),e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",className:"input pl-9",placeholder:a("awareness.searchTheme"),value:h,onChange:s=>C(s.target.value)}),h&&e.jsx("button",{type:"button",onClick:()=>C(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:e.jsx(Pe,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"max-h-48 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg divide-y divide-gray-100 dark:divide-gray-700 bg-white dark:bg-gray-800",children:[he.map((s,r)=>e.jsxs("button",{type:"button",onClick:()=>P(s),className:`w-full text-left px-3 py-2.5 text-sm flex items-center justify-between gap-2 transition-colors ${n===s?"bg-hse-primary/10 text-hse-primary font-medium border-l-4 border-hse-primary":"text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700/50 border-l-4 border-transparent"}`,children:[e.jsx("span",{children:s}),n===s&&e.jsx(se,{className:"w-4 h-4 text-hse-primary flex-shrink-0"})]},r)),e.jsxs("button",{type:"button",onClick:()=>P("Other"),className:`w-full text-left px-3 py-2.5 text-sm flex items-center justify-between gap-2 transition-colors ${n==="Other"?"bg-hse-primary/10 text-hse-primary font-medium border-l-4 border-hse-primary":"text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700/50 border-l-4 border-transparent"}`,children:[e.jsx("span",{className:"font-medium",children:a("awareness.other")}),n==="Other"&&e.jsx(se,{className:"w-4 h-4 text-hse-primary flex-shrink-0"})]})]}),n==="Other"&&e.jsxs("div",{className:"pt-2",children:[e.jsx("label",{className:"label text-sm",children:a("awareness.otherTheme")}),e.jsx("input",{type:"text",placeholder:a("awareness.otherTheme"),className:"input",value:f,onChange:s=>J(s.target.value),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("awareness.duration")}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"range",min:"15",max:"60",step:"15",value:p,onChange:s=>K(parseInt(s.target.value,10)),className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-hse-primary"}),e.jsx("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400",children:Ee.map(s=>e.jsxs("span",{className:`${p===s?"text-hse-primary font-semibold":""}`,children:[s," min"]},s))}),e.jsx("div",{className:"text-center",children:e.jsxs("span",{className:"inline-block px-4 py-1 bg-hse-primary/10 text-hse-primary rounded-full text-sm font-medium",children:[p," ",a("awareness.minutes")]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("awareness.participants")}),e.jsx("input",{type:"number",min:"1",className:"input",value:Q,onChange:s=>V(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("awareness.sessionHours")}),e.jsxs("div",{className:"input bg-gray-50 dark:bg-gray-800 flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold text-hse-primary",children:Number.isFinite(A)?A.toFixed(2):0}),e.jsx("span",{className:"text-xs text-gray-400 ml-2",children:a("awareness.hoursUnit")})]})]})]}),e.jsx("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsx("button",{type:"submit",className:"btn-primary",disabled:!b||!x||!N||!n||n==="Other"&&!f,children:a("awareness.submit")})})]})]}),e.jsxs("div",{className:"card p-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-hse-primary"}),a("awareness.listTitle")]}),e.jsxs("div",{className:"flex flex-wrap md:flex-nowrap items-center gap-3",children:[e.jsxs(M,{value:l,onChange:s=>ie(s.target.value),className:"h-10 text-sm min-w-[140px]",children:[e.jsx("option",{value:"",children:a("awareness.allProjects")}),q.map(s=>e.jsx("option",{value:s.id,children:re(s)},s.id))]}),e.jsxs(M,{value:i,onChange:s=>oe(s.target.value),className:"h-10 text-sm min-w-[130px]",children:[e.jsx("option",{value:"",children:a("awareness.allWeeks")}),Array.from({length:52},(s,r)=>r+1).map(s=>e.jsx("option",{value:s,children:a("awareness.weekLabel").replace("{{week}}",s)},s))]}),e.jsx(I,{value:c,onChange:s=>{ce(s),y(1)},placeholder:"From date",className:"w-40 h-10"}),e.jsx(I,{value:d,onChange:s=>{de(s),y(1)},placeholder:"To date",className:"w-40 h-10"}),e.jsxs("button",{type:"button",onClick:pe,disabled:xe||o.length===0,className:"btn-secondary flex items-center gap-2 text-sm",children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{children:a("dashboard.exportExcel")})]})]})]}),B?e.jsxs("div",{className:"space-y-3 py-4",children:[e.jsx("div",{className:"hidden md:block space-y-2 animate-pulse",children:Array.from({length:4},(s,r)=>e.jsx("div",{className:"h-10 rounded-md bg-gray-100 dark:bg-gray-800"},r))}),e.jsx("div",{className:"md:hidden space-y-3 animate-pulse",children:Array.from({length:3},(s,r)=>e.jsx("div",{className:"h-24 rounded-lg bg-gray-100 dark:bg-gray-800"},r))})]}):o.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 rounded-full bg-hse-primary/10 mb-3",children:e.jsx(ae,{className:"w-5 h-5 text-hse-primary"})}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:a("awareness.noSessions")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 md:hidden",children:Z.map(s=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3 bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:s.project?.name??""}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:s.date?s.date.substring(0,10):""}),e.jsx("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-300",children:s.by_name??""})]}),e.jsxs("div",{className:"text-right text-xs text-gray-600 dark:text-gray-300 space-y-1",children:[e.jsx("p",{className:"font-medium truncate max-w-[140px]",children:s.theme}),e.jsxs("p",{children:[s.duration_minutes," min"]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:()=>ee(s),className:"p-1.5 rounded-md hover:bg-red-50 dark:hover:bg-red-900/30",title:a("common.delete")??"Delete",children:e.jsx(te,{className:"w-4 h-4 text-red-600"})})})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-[11px] text-gray-600 dark:text-gray-300",children:[e.jsxs("span",{className:"px-1.5 py-0.5 rounded-full bg-gray-50 dark:bg-gray-900",children:[a("awareness.participants"),": ",s.participants]}),e.jsxs("span",{className:"px-1.5 py-0.5 rounded-full bg-hse-primary/10 text-hse-primary",children:[a("awareness.sessionHours"),": ",s.session_hours]})]})]},s.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:a("awareness.colDate")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:a("awareness.colProject")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:a("awareness.colBy")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:a("awareness.colTheme")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:a("awareness.colDuration")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:a("awareness.colParticipants")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:a("awareness.colHours")}),e.jsx("th",{className:"py-2 pr-4 font-medium text-gray-500 dark:text-gray-400",children:a("common.actions")??"Actions"})]})}),e.jsx("tbody",{children:Z.map(s=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-4 text-gray-900 dark:text-gray-100 text-xs",children:s.date?s.date.substring(0,10):""}),e.jsx("td",{className:"py-2 pr-4 text-gray-900 dark:text-gray-100",children:s.project?.name??""}),e.jsx("td",{className:"py-2 pr-4 text-gray-700 dark:text-gray-200",children:s.by_name??""}),e.jsx("td",{className:"py-2 pr-4 text-gray-700 dark:text-gray-200 max-w-xs truncate",children:s.theme}),e.jsxs("td",{className:"py-2 pr-4 text-gray-700 dark:text-gray-200",children:[s.duration_minutes," min"]}),e.jsx("td",{className:"py-2 pr-4 text-gray-700 dark:text-gray-200",children:s.participants}),e.jsx("td",{className:"py-2 pr-4 text-gray-700 dark:text-gray-200",children:s.session_hours}),e.jsx("td",{className:"py-2 pr-4 text-gray-700 dark:text-gray-200",children:e.jsx("button",{type:"button",onClick:()=>ee(s),className:"p-1.5 rounded-md hover:bg-red-50 dark:hover:bg-red-900/30",title:a("common.delete")??"Delete",children:e.jsx(te,{className:"w-4 h-4 text-red-600"})})})]},s.id))})]})})]}),!B&&o.length>0&&v>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100 dark:border-gray-800",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a("common.page")," ",u," ",a("common.of")," ",v]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>y(s=>Math.max(1,s-1)),disabled:u===1,className:"btn-secondary text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:a("common.previous")??"Previous"}),e.jsx("button",{type:"button",onClick:()=>y(s=>Math.min(v,s+1)),disabled:u===v,className:"btn-secondary text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:a("common.next")??"Next"})]})]})]}),e.jsx(we,{isOpen:!!_,title:a("common.delete")??"Delete",message:a("common.confirmDelete")??"Are you sure you want to delete this record?",confirmLabel:a("common.delete")??"Delete",cancelLabel:a("common.cancel")??"Cancel",onConfirm:ye,onCancel:()=>T(null)})]})}export{$e as default};
