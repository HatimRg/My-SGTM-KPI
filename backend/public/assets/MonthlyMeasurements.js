import{a as J,u as Q,j as e,g as X,n as g}from"./index.js";import{r as n}from"./vendor-react.js";import{M as ee}from"./Modal.js";import{C as te}from"./ConfirmDialog.js";import{s as se}from"./projectList.js";import{aq as ae,a2 as ne,a3 as re,e as le,af as ie,v as Y,aD as ce,al as oe,z as p}from"./vendor-ui.js";import"./vendor-utils.js";const o=[{value:"noise_monitoring",unit:"dB",icon:ae,activeClass:"ring-2 ring-blue-500",iconClass:"text-blue-500",bgClass:"bg-blue-50 dark:bg-blue-900/30"},{value:"water_consumption",unit:"mÂ³",icon:ne,activeClass:"ring-2 ring-cyan-500",iconClass:"text-cyan-600",bgClass:"bg-cyan-50 dark:bg-cyan-900/30"},{value:"electricity_consumption",unit:"kWh",icon:re,activeClass:"ring-2 ring-amber-500",iconClass:"text-amber-600",bgClass:"bg-amber-50 dark:bg-amber-900/30"}];function pe(){const{t:s}=J(),{user:q}=Q(),[w,I]=n.useState([]),[R,A]=n.useState([]),[D,j]=n.useState(!0),[P,x]=n.useState(!1),[d,U]=n.useState(""),[m,O]=n.useState(String(new Date().getFullYear())),[u,V]=n.useState(String(new Date().getMonth()+1)),[y,$]=n.useState("noise_monitoring"),[z,v]=n.useState(!1),[c,b]=n.useState(null),[f,N]=n.useState(null),E=q?.project_list_preference??"code",F=n.useMemo(()=>se(w,E),[w,E]),M=()=>({project_id:"",year:String(new Date().getFullYear()),month:String(new Date().getMonth()+1),indicator:"noise_monitoring",value:"",method:""}),[r,i]=n.useState(M());n.useEffect(()=>{(async()=>{try{const l=(await X.getAll({per_page:200})).data?.data??[];I(Array.isArray(l)?l:[])}catch{I([])}finally{j(!1)}})()},[]);const S=async()=>{j(!0);try{const t={per_page:100};d&&(t.project_id=d),m&&(t.year=m),u&&(t.month=u);const l=(await g.getAll(t)).data,_=l?.data??l,H=Array.isArray(_)?_:_?.data??[];A(H)}catch{A([])}finally{j(!1)}};n.useEffect(()=>{S()},[d,m,u]);const W=()=>{b(null),i({...M(),project_id:d||"",year:m||String(new Date().getFullYear()),month:u||String(new Date().getMonth()+1),indicator:y}),v(!0)},B=t=>{b(t),t?.indicator&&$(t.indicator),i({project_id:String(t.project_id??""),year:String(t.year??""),month:String(t.month??""),indicator:t.indicator??"noise_monitoring",value:t.value??"",method:t.method??""}),v(!0)},C=()=>{v(!1),b(null),i(M())},K=async t=>{t.preventDefault(),x(!0);try{const a={project_id:parseInt(r.project_id),year:parseInt(r.year),month:parseInt(r.month),indicator:r.indicator,value:Number(r.value),method:r.method||null};c?.id?await g.update(c.id,{value:a.value,method:a.method}):await g.upsert(a),p.success(s("common.saved")??"Saved"),C(),S()}catch{p.error(s("common.error")??"Error")}finally{x(!1)}},Z=t=>N(t),G=async()=>{if(f?.id){x(!0);try{await g.delete(f.id),p.success(s("common.saved")??"Saved"),N(null),S()}catch{p.error(s("common.error")??"Error")}finally{x(!1)}}},h=t=>o.some(l=>l.value===t)?s(`monthlyMeasurements.indicators.${t}`)??t:t,k=t=>o.find(a=>a.value===t)?.unit??"",L=o.find(t=>t.value===y)??o[0],T=R.filter(t=>t.indicator===y);return e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 dark:bg-blue-900/30 rounded-xl flex items-center justify-center",children:e.jsx(le,{className:"w-6 h-6 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:s("monthlyMeasurements.pageTitle")??"Monthly Measurements"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s("monthlyMeasurements.pageSubtitle")??"Monthly-only environmental measurements (separated by indicator)"})]})]}),e.jsxs("button",{onClick:W,className:"btn-primary flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),s("common.new")??"New"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:o.map(t=>{const a=t.icon,l=y===t.value;return e.jsx("button",{type:"button",onClick:()=>$(t.value),className:`text-left border border-gray-200 dark:border-gray-700 rounded-2xl p-4 bg-white dark:bg-gray-800 transition ${l?t.activeClass:"hover:bg-gray-50 dark:hover:bg-gray-700/30"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${t.bgClass}`,children:e.jsx(a,{className:`w-5 h-5 ${t.iconClass}`})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:h(t.value)}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[s("monthlyMeasurements.unit")??"Unit",": ",t.unit]})]})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:l?s("monthlyMeasurements.selected")??"Selected":s("monthlyMeasurements.select")??"Select"})]})},t.value)})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("projects.title")??"Project"}),e.jsxs("select",{className:"input",value:d,onChange:t=>U(t.target.value),children:[e.jsx("option",{value:"",children:s("common.all")??"All"}),F.map(t=>e.jsx("option",{value:String(t.id),children:t.code?`${t.code} - ${t.name}`:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("monthlyMeasurements.filters.year")??"Year"}),e.jsx("input",{className:"input",type:"number",value:m,onChange:t=>O(t.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("monthlyMeasurements.filters.month")??"Month"}),e.jsx("input",{className:"input",type:"number",min:"1",max:"12",value:u,onChange:t=>V(t.target.value)})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:s("monthlyMeasurements.recordsTitle",{indicator:h(L.value)})??`Records: ${h(L.value)}`}),D&&e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 animate-spin"}),s("common.loading")??"Loading"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-2",children:s("monthlyMeasurements.table.project")??"Project"}),e.jsx("th",{className:"text-left px-4 py-2",children:s("monthlyMeasurements.table.year")??"Year"}),e.jsx("th",{className:"text-left px-4 py-2",children:s("monthlyMeasurements.table.month")??"Month"}),e.jsx("th",{className:"text-left px-4 py-2",children:s("monthlyMeasurements.table.indicator")??"Indicator"}),e.jsx("th",{className:"text-left px-4 py-2",children:s("monthlyMeasurements.table.value")??"Value"}),e.jsx("th",{className:"text-left px-4 py-2",children:s("monthlyMeasurements.table.unit")??"Unit"}),e.jsx("th",{className:"text-left px-4 py-2",children:s("monthlyMeasurements.table.method")??"Method"}),e.jsx("th",{className:"text-right px-4 py-2",children:s("common.actions")??"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:[T.map(t=>e.jsxs("tr",{className:t.deleted_at?"opacity-60":"",children:[e.jsx("td",{className:"px-4 py-2",children:t.project?.code?`${t.project.code} - ${t.project.name}`:t.project?.name??t.project_id}),e.jsx("td",{className:"px-4 py-2",children:t.year}),e.jsx("td",{className:"px-4 py-2",children:t.month}),e.jsx("td",{className:"px-4 py-2",children:h(t.indicator)}),e.jsx("td",{className:"px-4 py-2",children:t.value}),e.jsx("td",{className:"px-4 py-2",children:k(t.indicator)}),e.jsx("td",{className:"px-4 py-2",children:t.method??"-"}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>B(t),children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx("button",{className:"btn-secondary",onClick:()=>Z(t),children:e.jsx(oe,{className:"w-4 h-4"})})]})})]},t.id)),!D&&T.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"px-4 py-10 text-center text-gray-500",children:s("monthlyMeasurements.noRecords")??"No records"})})]})]})})]}),e.jsx(ee,{isOpen:z,onClose:C,title:c?s("monthlyMeasurements.modal.editTitle")??"Edit monthly measurement":s("monthlyMeasurements.modal.newTitle")??"New monthly measurement",children:e.jsxs("form",{onSubmit:K,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("monthlyMeasurements.fields.project")??"Project"}),e.jsxs("select",{className:"input",value:r.project_id,onChange:t=>i(a=>({...a,project_id:t.target.value})),required:!0,children:[e.jsx("option",{value:"",children:s("monthlyMeasurements.fields.selectProject")??"Select..."}),F.map(t=>e.jsx("option",{value:String(t.id),children:t.code?`${t.code} - ${t.name}`:t.name},t.id))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("monthlyMeasurements.fields.year")??"Year"}),e.jsx("input",{type:"number",className:"input",value:r.year,onChange:t=>i(a=>({...a,year:t.target.value})),required:!0,disabled:!!c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("monthlyMeasurements.fields.month")??"Month"}),e.jsx("input",{type:"number",min:"1",max:"12",className:"input",value:r.month,onChange:t=>i(a=>({...a,month:t.target.value})),required:!0,disabled:!!c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("monthlyMeasurements.fields.indicator")??"Indicator"}),e.jsx("select",{className:"input",value:r.indicator,onChange:t=>i(a=>({...a,indicator:t.target.value})),required:!0,disabled:!!c,children:o.map(t=>e.jsx("option",{value:t.value,children:h(t.value)},t.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("monthlyMeasurements.fields.valueWithUnit",{unit:k(r.indicator)})??`Value (${k(r.indicator)})`}),e.jsx("input",{type:"number",step:"0.01",className:"input",value:r.value,onChange:t=>i(a=>({...a,value:t.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("monthlyMeasurements.fields.method")??"Method"}),e.jsx("input",{className:"input",value:r.method,onChange:t=>i(a=>({...a,method:t.target.value}))})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:C,children:s("common.cancel")??"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:P,children:P?e.jsx(Y,{className:"w-4 h-4 animate-spin"}):s("common.save")??"Save"})]})]})}),e.jsx(te,{isOpen:!!f,title:s("monthlyMeasurements.archive.title")??"Archive record",message:s("monthlyMeasurements.archive.message")??"This will archive (soft-delete) the record. Continue?",confirmLabel:s("common.confirm")??"Confirm",cancelLabel:s("common.cancel")??"Cancel",onConfirm:G,onCancel:()=>N(null)})]})}export{pe as default};
