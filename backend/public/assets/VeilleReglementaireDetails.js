import{a as L,j as e,G as D}from"./index.js";import{u as F,b as z,h as E,r as x}from"./vendor-react.js";import{h as I,J as P,aN as R,v as M,z as X,a4 as _,aO as y,X as G}from"./vendor-ui.js";import{g as v,a as b,b as J,f as O}from"./veilleReglementaireSchema.js";import"./vendor-utils.js";const V=r=>{if(!r)return"-";const t=new Date(r);return Number.isNaN(t.getTime())?String(r):t.toLocaleString()},q=r=>r.startsWith("/admin/regulatory-watch")?"/admin/regulatory-watch":r.startsWith("/supervisor/regulatory-watch")?"/supervisor/regulatory-watch":"/regulatory-watch",w=({tone:r="gray",icon:t,children:c})=>{const d={green:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-200",red:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-200",gray:"bg-gray-100 text-gray-800 dark:bg-gray-700/40 dark:text-gray-200",blue:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200",amber:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-200"};return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-semibold ${d[r]??d.gray}`,children:[t?e.jsx(t,{className:"w-3.5 h-3.5"}):null,e.jsx("span",{children:c})]})},H=(r,t)=>t===!0?{tone:"blue",icon:_,label:r("regulatoryWatch.applicable")}:t===!1?{tone:"gray",icon:y,label:r("regulatoryWatch.notApplicable")}:{tone:"amber",icon:y,label:r("common.unknown")},K=(r,t,c)=>t===!1?{tone:"gray",icon:y,label:"N/A"}:c===!0?{tone:"green",icon:_,label:r("regulatoryWatch.conforme")}:c===!1?{tone:"red",icon:G,label:r("regulatoryWatch.nonConforme")}:{tone:"amber",icon:y,label:r("common.unknown")};function re(){const{t:r,language:t}=L(),c=F(),d=z(),W=E(),p=x.useMemo(()=>q(d.pathname),[d.pathname]),i=W?.id,[S,f]=x.useState(!0),[l,k]=x.useState(null);x.useEffect(()=>{(async()=>{if(i)try{f(!0);const o=await D.getById(i);k(o.data?.data??null)}catch(o){k(null),X.error(o.response?.data?.message??r("errors.somethingWentWrong"))}finally{f(!1)}})()},[i]);const A=l?.overall_score===null||l?.overall_score===void 0?"-":`${Number(l.overall_score).toFixed(2)}%`,j=l?.answers?.sections??[],N=l?.section_scores??[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 flex-col sm:flex-row",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-hse-primary/10 rounded-lg",children:e.jsx(I,{className:"w-5 h-5 text-hse-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:r("regulatoryWatch.detailsTitle")}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[l?.project?.name??r("common.unknown")," · ",r("regulatoryWatch.submittedAt"),": ",V(l?.submitted_at)]}),l?.week_year&&l?.week_number&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[r("regulatoryWatch.week"),": ",l.week_number," · ",r("regulatoryWatch.year"),": ",l.week_year]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsxs("button",{type:"button",className:"btn-secondary flex items-center gap-2 w-full sm:w-auto",onClick:()=>c(p),children:[e.jsx(P,{className:"w-4 h-4"}),r("common.back")]}),e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2 w-full sm:w-auto",onClick:()=>c(`${p}/${i}/resubmit`),disabled:!i,children:[e.jsx(R,{className:"w-4 h-4"}),r("regulatoryWatch.resubmit")]})]})]}),S?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(M,{className:"w-4 h-4 animate-spin"}),r("common.loading")]}):l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("regulatoryWatch.overallScore")}),e.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:A})]}),e.jsxs("div",{className:"md:col-span-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("regulatoryWatch.sectionScores")}),e.jsx("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2",children:(Array.isArray(N)?N:[]).map(s=>{const o=s?.score===null||s?.score===void 0?"-":`${Number(s.score).toFixed(2)}%`,n=`${s?.total_conforme??0} / ${s?.total_applicable??0}`,m=v(s.section_id),a=m?b(m.title,t):s.section_id;return e.jsxs("div",{className:"text-sm text-gray-900 dark:text-gray-100 flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:a}),e.jsxs("span",{className:"font-semibold",children:[n," (",o,")"]})]},s.section_id)})})]})]})}),(Array.isArray(j)?j:[]).map(s=>{const o=s?.articles??[],n=v(s.section_id),m=n?b(n.title,t):s.section_id;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:m})}),e.jsx("div",{className:"p-4 space-y-3",children:(Array.isArray(o)?o:[]).map(a=>{const g=J(a.article_id),$=g?b(g.code,t):a.code??a.article_id,B=g?b(g.text,t):typeof a.text=="string"?a.text:"",C=O(B),u=H(r,a.applicable),h=K(r,a.applicable,a.compliant),T=a.applicable===!1?"border-gray-200 dark:border-gray-700 bg-gray-50/70 dark:bg-gray-900/40":a.compliant===!1?"border-red-200 dark:border-red-900/40 bg-red-50/40 dark:bg-red-900/10":a.compliant===!0?"border-emerald-200 dark:border-emerald-900/40 bg-emerald-50/40 dark:bg-emerald-900/10":"border-amber-200 dark:border-amber-900/40 bg-amber-50/40 dark:bg-amber-900/10";return e.jsxs("div",{className:`rounded-xl border p-3 ${T} ${a.applicable===!1?"opacity-80":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:$}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsx(w,{tone:u.tone,icon:u.icon,children:u.label}),e.jsx(w,{tone:h.tone,icon:h.icon,children:h.label})]})]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1 whitespace-pre-line",children:C}),a.applicable&&a.compliant===!1&&a.corrective_action&&e.jsxs("div",{className:"mt-2 text-sm text-gray-900 dark:text-gray-100",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("regulatoryWatch.correctiveAction")}),e.jsx("div",{children:a.corrective_action})]}),a.comment&&e.jsxs("div",{className:"mt-2 text-sm text-gray-900 dark:text-gray-100",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("regulatoryWatch.comment")}),e.jsx("div",{children:a.comment})]})]},`${s.section_id}:${a.article_id}`)})})]},s.section_id)})]}):e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 text-sm text-gray-500 dark:text-gray-400",children:r("common.noData")})]})}export{re as default};
