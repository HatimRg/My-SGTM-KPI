import{a as E,j as e,I as _}from"./index.js";import{u as P,b as R,h as M,r as d}from"./vendor-react.js";import{C as X}from"./ConfirmDialog.js";import{ar as O,a7 as V,b2 as q,aA as G,a0 as H,z as k,aj as A,b3 as y,X as J}from"./vendor-ui.js";import{g as W,a as b,b as K,f as Q}from"./veilleReglementaireSchema.js";import"./vendor-utils.js";const U=r=>{if(!r)return"-";const s=new Date(r);return Number.isNaN(s.getTime())?String(r):s.toLocaleString()},Y=r=>r.startsWith("/admin/regulatory-watch")?"/admin/regulatory-watch":r.startsWith("/supervisor/regulatory-watch")?"/supervisor/regulatory-watch":"/regulatory-watch",C=({tone:r="gray",icon:s,children:l})=>{const i={green:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-200",red:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-200",gray:"bg-gray-100 text-gray-800 dark:bg-gray-700/40 dark:text-gray-200",blue:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-200",amber:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-200"};return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-semibold ${i[r]??i.gray}`,children:[s?e.jsx(s,{className:"w-3.5 h-3.5"}):null,e.jsx("span",{children:l})]})},Z=(r,s)=>s===!0?{tone:"blue",icon:A,label:r("regulatoryWatch.applicable")}:s===!1?{tone:"gray",icon:y,label:r("regulatoryWatch.notApplicable")}:{tone:"amber",icon:y,label:r("common.unknown")},ee=(r,s,l)=>s===!1?{tone:"gray",icon:y,label:"N/A"}:l===!0?{tone:"green",icon:A,label:r("regulatoryWatch.conforme")}:l===!1?{tone:"red",icon:J,label:r("regulatoryWatch.nonConforme")}:{tone:"amber",icon:y,label:r("common.unknown")};function ne(){const{t:r,language:s}=E(),l=P(),i=R(),S=M(),u=d.useMemo(()=>Y(i.pathname),[i.pathname]),n=S?.id,[D,j]=d.useState(!0),[o,N]=d.useState(null),[$,h]=d.useState(!1);d.useEffect(()=>{(async()=>{if(n)try{j(!0);const c=await _.getById(n);N(c.data?.data??null)}catch(c){N(null),k.error(c.response?.data?.message??r("errors.somethingWentWrong"))}finally{j(!1)}})()},[n]);const B=async()=>{if(n)try{await _.delete(n),k.success(r("common.deleted")??"Deleted"),l(u)}catch(t){k.error(t.response?.data?.message??r("errors.somethingWentWrong"))}finally{h(!1)}},L=o?.overall_score===null||o?.overall_score===void 0?"-":`${Number(o.overall_score).toFixed(2)}%`,w=o?.answers?.sections??[],v=o?.section_scores??[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 flex-col sm:flex-row",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-hse-primary/10 rounded-lg",children:e.jsx(O,{className:"w-5 h-5 text-hse-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:r("regulatoryWatch.detailsTitle")}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[o?.project?.name??r("common.unknown")," · ",r("regulatoryWatch.submittedAt"),": ",U(o?.submitted_at)]}),o?.week_year&&o?.week_number&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[r("regulatoryWatch.week"),": ",o.week_number," · ",r("regulatoryWatch.year"),": ",o.week_year]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsxs("button",{type:"button",className:"btn-secondary flex items-center gap-2 w-full sm:w-auto",onClick:()=>l(u),children:[e.jsx(V,{className:"w-4 h-4"}),r("common.back")]}),e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2 w-full sm:w-auto",onClick:()=>l(`${u}/${n}/resubmit`),disabled:!n,children:[e.jsx(q,{className:"w-4 h-4"}),r("regulatoryWatch.resubmit")]}),e.jsxs("button",{type:"button",className:"btn-danger flex items-center gap-2 w-full sm:w-auto",onClick:()=>h(!0),disabled:!n,children:[e.jsx(G,{className:"w-4 h-4"}),r("common.delete")??"Delete"]})]})]}),D?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(H,{className:"w-4 h-4 animate-spin"}),r("common.loading")]}):o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("regulatoryWatch.overallScore")}),e.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:L})]}),e.jsxs("div",{className:"md:col-span-2 p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("regulatoryWatch.sectionScores")}),e.jsx("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2",children:(Array.isArray(v)?v:[]).map(t=>{const c=t?.score===null||t?.score===void 0?"-":`${Number(t.score).toFixed(2)}%`,m=`${t?.total_conforme??0} / ${t?.total_applicable??0}`,g=W(t.section_id),a=g?b(g.title,s):t.section_id;return e.jsxs("div",{className:"text-sm text-gray-900 dark:text-gray-100 flex items-center justify-between gap-3",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:a}),e.jsxs("span",{className:"font-semibold",children:[m," (",c,")"]})]},t.section_id)})})]})]})}),(Array.isArray(w)?w:[]).map(t=>{const c=t?.articles??[],m=W(t.section_id),g=m?b(m.title,s):t.section_id;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:g})}),e.jsx("div",{className:"p-4 space-y-3",children:(Array.isArray(c)?c:[]).map(a=>{const x=K(a.article_id),T=x?b(x.code,s):a.code??a.article_id,F=x?b(x.text,s):typeof a.text=="string"?a.text:"",I=Q(F),p=Z(r,a.applicable),f=ee(r,a.applicable,a.compliant),z=a.applicable===!1?"border-gray-200 dark:border-gray-700 bg-gray-50/70 dark:bg-gray-900/40":a.compliant===!1?"border-red-200 dark:border-red-900/40 bg-red-50/40 dark:bg-red-900/10":a.compliant===!0?"border-emerald-200 dark:border-emerald-900/40 bg-emerald-50/40 dark:bg-emerald-900/10":"border-amber-200 dark:border-amber-900/40 bg-amber-50/40 dark:bg-amber-900/10";return e.jsxs("div",{className:`rounded-xl border p-3 ${z} ${a.applicable===!1?"opacity-80":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:T}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-end",children:[e.jsx(C,{tone:p.tone,icon:p.icon,children:p.label}),e.jsx(C,{tone:f.tone,icon:f.icon,children:f.label})]})]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1 whitespace-pre-line",children:I}),a.applicable&&a.compliant===!1&&a.corrective_action&&e.jsxs("div",{className:"mt-2 text-sm text-gray-900 dark:text-gray-100",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("regulatoryWatch.correctiveAction")}),e.jsx("div",{children:a.corrective_action})]}),a.comment&&e.jsxs("div",{className:"mt-2 text-sm text-gray-900 dark:text-gray-100",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:r("regulatoryWatch.comment")}),e.jsx("div",{children:a.comment})]})]},`${t.section_id}:${a.article_id}`)})})]},t.section_id)})]}):e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 text-sm text-gray-500 dark:text-gray-400",children:r("common.noData")}),e.jsx(X,{isOpen:$,title:r("common.confirm")??"Confirm",message:r("common.confirmDelete")??"Are you sure you want to delete this record?",confirmLabel:r("common.delete")??"Delete",cancelLabel:r("common.cancel")??"Cancel",variant:"danger",onConfirm:B,onCancel:()=>h(!1)})]})}export{ne as default};
