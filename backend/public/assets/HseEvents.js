import{j as e,M as re,J as C,a as pe,u as ye,g as ge}from"./index.js";import{r as v}from"./vendor-react.js";import{C as xe}from"./ConfirmDialog.js";import{s as _e}from"./projectList.js";import{z as f,A as je,av as fe,a0 as ie,aU as be,aA as Ne}from"./vendor-ui.js";import"./vendor-utils.js";const Ee=[{value:"near_miss"},{value:"work_accident"},{value:"incident"},{value:"road_accident"}],Ce=[{value:"day"},{value:"night"}],Se=[{value:"<25"},{value:"25-35"},{value:"36-45"},{value:"46-55"},{value:">55"}],ke=[{value:"<6_months"},{value:"6-12_months"},{value:"1-5_years"},{value:">5_years"}],Ae=[{value:"no_injury"},{value:"first_aid_only"},{value:"medical_treatment_no_lost_time"},{value:"lost_time_accident"},{value:"serious_hospitalization"},{value:"fatal"}],Fe=[{value:"head_neck"},{value:"upper_limb"},{value:"lower_limb"},{value:"trunk"},{value:"multiple"}],Te=[{value:"sprain"},{value:"cut_wound"},{value:"contusion"},{value:"fracture"},{value:"burn"},{value:"other"}],we=[{value:"walking_circulation"},{value:"manual_handling"},{value:"mechanical_handling"},{value:"machine_tool_use"},{value:"vehicle_mobile_equipment"},{value:"work_at_height"},{value:"electrical_work"},{value:"other"}],Ie=[{value:"dry"},{value:"wet"},{value:"slippery"},{value:"uneven"}],Oe=[{value:"adequate"},{value:"insufficient"},{value:"night_work"}],De=[{value:"clear"},{value:"rain"},{value:"wind"},{value:"heat"}],Pe=[{value:"pedestrian_zone"},{value:"shared_with_vehicles"},{value:"restricted_confined"}],Me=[{value:"safety_shoes"},{value:"helmet"},{value:"gloves"},{value:"hi_vis_vest"},{value:"eye_protection"},{value:"other"}],qe=[{value:"present"},{value:"absent"},{value:"not_applicable"}],Le=[{value:"slip_trip_fall"},{value:"loss_of_balance"},{value:"contact_with_object"},{value:"unsafe_movement"},{value:"vehicle_interaction"},{value:"other"}],Re=[{value:"human_factor"},{value:"method_procedure"},{value:"equipment_tools"},{value:"environment_conditions"},{value:"organization_planning"}],Ve=[{value:"conforming"},{value:"non_conforming"},{value:"not_defined"}],$e=[{value:"first_aid_provided"},{value:"evacuation_to_infirmary"},{value:"external_medical_care"},{value:"area_secured"},{value:"work_stopped"},{value:"authorities_notified"},{value:"crisis_committee_activated"}],Ge=[{value:"technical"},{value:"organizational"},{value:"training"},{value:"inspection"}],Ye=[{value:"open"},{value:"in_progress"},{value:"closed"}],ae=()=>({full_name:"",matricule:"",company:"sgtm",subcontractor_name:"",job_title:"",age_range:"",experience_range:"",outcome:"",body_part:"",injury_type:"",injury_type_other:"",death_timing:"",death_date:"",death_place:""}),We=r=>{switch(r){case"fatal":return 6;case"serious_hospitalization":return 5;case"lost_time_accident":return 4;case"medical_treatment_no_lost_time":return 3;case"first_aid_only":return 2;case"no_injury":return 1;default:return 0}},ze=r=>{const b=(r||[]).reduce((I,O)=>Math.max(I,We(O?.outcome)),0);return b>=6?"fatal":b>=5?"critical":b>=4?"major":b>=3?"moderate":b>=2?"minor":""},He=r=>(r||[]).some(b=>["lost_time_accident","serious_hospitalization","fatal"].includes(b?.outcome));function Ue({isOpen:r,onClose:b,onSubmit:I,projects:O,selectedProjectId:M,t:p,initial:y}){const[k,$]=v.useState(!1),[S,A]=v.useState(!1),[G,N]=v.useState([]),[q,E]=v.useState([]),l=(t,s,c)=>{try{return p?.(t,c)??s}catch{return s}},[i,m]=v.useState(()=>({project_id:M||"",category:"work_accident",location:"",event_date:new Date().toISOString().split("T")[0],event_time:"",shift:"day",victims_count:1,victims:[ae()],activity:"",activity_other:"",ground_condition:"",lighting:"",weather:"",work_area:"",ppe_worn:[],ppe_other:"",collective_protections:"not_applicable",immediate_cause:"",immediate_cause_other:"",root_causes:[],method_conformity:"",immediate_actions:[],corrective_actions:[],investigation_completed:!1,accident_closed:!1,closure_date:"",closed_by_role:"",description:"",lost_days:0}));v.useEffect(()=>{if(r){if(y){const t={...i,project_id:String(y.project_id??i.project_id??""),location:y.location??"",event_date:y.event_date?.substring(0,10)??i.event_date,description:y.description??"",lost_days:y.lost_days??0},s=y.details??null;s&&typeof s=="object"&&Object.assign(t,{category:s.category??t.category,event_time:s.event_time??t.event_time,shift:s.shift??t.shift,victims_count:s.victims_count??t.victims_count,victims:Array.isArray(s.victims)&&s.victims.length>0?s.victims:t.victims,activity:s.activity??t.activity,activity_other:s.activity_other??t.activity_other,ground_condition:s.ground_condition??t.ground_condition,lighting:s.lighting??t.lighting,weather:s.weather??t.weather,work_area:s.work_area??t.work_area,ppe_worn:Array.isArray(s.ppe_worn)?s.ppe_worn:t.ppe_worn,ppe_other:s.ppe_other??t.ppe_other,collective_protections:s.collective_protections??t.collective_protections,immediate_cause:s.immediate_cause??t.immediate_cause,immediate_cause_other:s.immediate_cause_other??t.immediate_cause_other,root_causes:Array.isArray(s.root_causes)?s.root_causes:t.root_causes,method_conformity:s.method_conformity??t.method_conformity,immediate_actions:Array.isArray(s.immediate_actions)?s.immediate_actions:t.immediate_actions,corrective_actions:Array.isArray(s.corrective_actions)?s.corrective_actions:t.corrective_actions,investigation_completed:!!s.investigation_completed,accident_closed:!!s.accident_closed,closure_date:s.closure_date??t.closure_date,closed_by_role:s.closed_by_role??t.closed_by_role}),m(t);const c=Array.isArray(s?.attachments)?s.attachments:[];N(c);return}m(t=>({...t,project_id:M||t.project_id})),N([]),E([])}},[r,y,M]),v.useEffect(()=>{(async()=>{if(r&&y?.id){A(!0);try{const s=await C.listAttachments(y.id),c=s?.data?.data??s?.data;N(Array.isArray(c)?c:[])}catch{}finally{A(!1)}}})()},[r,y?.id]);const D=v.useMemo(()=>{if(!i.event_date)return"";try{const t=new Date(i.event_date);return Number.isNaN(t.getTime())?"":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][t.getDay()]}catch{return""}},[i.event_date]),z=v.useMemo(()=>ze(i.victims),[i.victims]),L=v.useMemo(()=>He(i.victims),[i.victims]),X=t=>{const s=Math.max(1,Math.min(20,Number(t)||1));m(c=>{const u=Array.isArray(c.victims)?[...c.victims]:[];for(;u.length<s;)u.push(ae());for(;u.length>s;)u.pop();return{...c,victims_count:s,victims:u}})},F=(t,s)=>{m(c=>{const u=Array.isArray(c[t])?[...c[t]]:[],n=u.indexOf(s);return n>=0?u.splice(n,1):u.push(s),{...c,[t]:u}})},x=(t,s,c)=>{m(u=>{const n=Array.isArray(u.victims)?[...u.victims]:[],d=n[t]?{...n[t]}:ae();return d[s]=c,s==="company"&&c!=="subcontractor"&&(d.subcontractor_name=""),s==="outcome"&&(c==="no_injury"&&(d.body_part="",d.injury_type="",d.injury_type_other=""),c!=="fatal"&&(d.death_timing="",d.death_date="",d.death_place="")),s==="injury_type"&&c!=="other"&&(d.injury_type_other=""),s==="death_timing"&&c==="same_day"&&(d.death_date=""),n[t]=d,{...u,victims:n}})},R=()=>{m(t=>({...t,corrective_actions:[...Array.isArray(t.corrective_actions)?t.corrective_actions:[],{type:"",description:"",responsible_role:"",deadline:"",status:"open"}]}))},Q=t=>{m(s=>{const c=Array.isArray(s.corrective_actions)?[...s.corrective_actions]:[];return c.splice(t,1),{...s,corrective_actions:c}})},P=(t,s,c)=>{m(u=>{const n=Array.isArray(u.corrective_actions)?[...u.corrective_actions]:[],d=n[t]?{...n[t]}:{type:"",description:"",responsible_role:"",deadline:"",status:"open"};return d[s]=c,n[t]=d,{...u,corrective_actions:n}})},V=()=>{k||b()},Z=t=>{const s=Array.from(t.target.files||[]);E(s)},Y=async t=>{const s=Array.isArray(q)?q:[];if(!t||s.length===0)return;for(const n of s)await C.uploadAttachment(t,{file:n});E([]);const c=await C.listAttachments(t),u=c?.data?.data??c?.data;N(Array.isArray(u)?u:[])},T=async(t,s)=>{if(!(!t||!s)){A(!0);try{await C.deleteAttachment(t,s);const c=await C.listAttachments(t),u=c?.data?.data??c?.data;N(Array.isArray(u)?u:[]),f.success(p?.("common.saved")??"Saved")}catch{f.error(p?.("common.error")??"Error")}finally{A(!1)}}},w=async t=>{if(t.preventDefault(),k||!i.project_id||!i.category||!i.location||!i.event_date||!i.shift||!i.victims_count||i.victims_count<1)return;const s=Array.isArray(i.victims)?i.victims:[];if(s.length!==i.victims_count)return;for(const d of s)if(!d.full_name||!d.outcome||d.company==="subcontractor"&&!d.subcontractor_name||d.outcome!=="no_injury"&&(!d.body_part||!d.injury_type||d.injury_type==="other"&&!d.injury_type_other)||d.outcome==="fatal"&&(!d.death_timing||!d.death_place||d.death_timing==="later"&&!d.death_date))return;if(!i.activity||i.activity==="other"&&!i.activity_other||!i.ground_condition||!i.lighting||!i.weather||!i.work_area||!i.immediate_cause||i.immediate_cause==="other"&&!i.immediate_cause_other)return;const c=z,u=L,n=["major","critical","fatal"].includes(c);if(!(n&&!i.method_conformity)&&!(u&&Number(i.lost_days)<0)){$(!0);try{const d={project_id:parseInt(i.project_id),event_date:i.event_date,type:i.category,description:i.description||null,severity:c||null,lost_time:u,lost_days:u&&Number(i.lost_days)||0,location:i.location,details:{schema_version:"accident_v1",category:i.category,exact_location:i.location,event_time:i.event_time||null,shift:i.shift,day_of_week:D||null,victims_count:i.victims_count,victims:s,activity:i.activity,activity_other:i.activity==="other"?i.activity_other:null,ground_condition:i.ground_condition,lighting:i.lighting,weather:i.weather,work_area:i.work_area,ppe_worn:i.ppe_worn,ppe_other:i.ppe_worn.includes("other")&&i.ppe_other||null,collective_protections:i.collective_protections,immediate_cause:i.immediate_cause,immediate_cause_other:i.immediate_cause==="other"?i.immediate_cause_other:null,root_causes:i.root_causes,method_conformity:n?i.method_conformity:null,immediate_actions:i.immediate_actions,corrective_actions:i.corrective_actions,investigation_completed:!!i.investigation_completed,accident_closed:!!i.accident_closed,closure_date:i.accident_closed&&i.closure_date||null,closed_by_role:i.accident_closed&&i.closed_by_role||null}};try{const h=(await I(d))?.id??y?.id;try{await Y(h)}catch{f.error(p?.("common.error")??"Error")}b()}catch{}}finally{$(!1)}}};return e.jsx(re,{isOpen:r,onClose:V,title:y?p?.("hseEvents.modal.editTitle")??"Edit":p?.("hseEvents.modal.newTitle")??"New",children:e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/30 border border-gray-200 dark:border-gray-700 rounded-xl p-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:["1) ",l("hseEvents.accidentForm.sections.identification","Accident Identification")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.accidentId","Accident ID")}),e.jsx("input",{className:"input",value:y?.id?String(y.id):l("hseEvents.accidentForm.fields.autoGenerated","Auto-generated"),readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.accidentCategory","Accident category")}),e.jsx("select",{className:"input",value:i.category,onChange:t=>m(s=>({...s,category:t.target.value})),required:!0,children:Ee.map(t=>e.jsx("option",{value:t.value,children:t.value},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.siteProject","Site / Project")}),e.jsxs("select",{className:"input",value:i.project_id,onChange:t=>m(s=>({...s,project_id:t.target.value})),required:!0,children:[e.jsx("option",{value:"",children:p?.("common.select")??"Select"}),(O||[]).map(t=>e.jsx("option",{value:String(t.id),children:t.code?`${t.code} - ${t.name}`:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.exactLocation","Exact location on site")}),e.jsx("input",{className:"input",value:i.location,onChange:t=>m(s=>({...s,location:t.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.date","Date")}),e.jsx("input",{type:"date",className:"input",value:i.event_date,onChange:t=>m(s=>({...s,event_date:t.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.time","Time")}),e.jsx("input",{type:"time",className:"input",value:i.event_time,onChange:t=>m(s=>({...s,event_time:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.shift","Shift")}),e.jsx("select",{className:"input",value:i.shift,onChange:t=>m(s=>({...s,shift:t.target.value})),required:!0,children:Ce.map(t=>e.jsx("option",{value:t.value,children:t.value},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.dayOfWeek","Day of week")}),e.jsx("input",{className:"input",value:D,readOnly:!0})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/30 border border-gray-200 dark:border-gray-700 rounded-xl p-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:["2) ",l("hseEvents.accidentForm.sections.victimsOverview","Victims Overview")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.numberOfVictims","Number of victims")}),e.jsx("input",{type:"number",min:"1",max:"20",className:"input",value:i.victims_count,onChange:t=>X(t.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.derivedSeverity","Derived severity")}),e.jsx("input",{className:"input",value:z||"-",readOnly:!0})]})]})]}),e.jsx("div",{className:"space-y-3",children:i.victims.map((t,s)=>{const c=t.outcome&&t.outcome!=="no_injury",u=t.outcome==="fatal";return e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:["3) ",l("hseEvents.accidentForm.sections.victimDetails","Victim Details")," — ",l("hseEvents.accidentForm.fields.victim","Victim")," ",s+1]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.fullName","Full name")}),e.jsx("input",{className:"input",value:t.full_name,onChange:n=>x(s,"full_name",n.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.matricule","Matricule / Internal ID (optional)")}),e.jsx("input",{className:"input",value:t.matricule,onChange:n=>x(s,"matricule",n.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.company","Company")}),e.jsxs("select",{className:"input",value:t.company,onChange:n=>x(s,"company",n.target.value),children:[e.jsx("option",{value:"sgtm",children:l("hseEvents.accidentForm.fields.companySgtm","SGTM")}),e.jsx("option",{value:"subcontractor",children:l("hseEvents.accidentForm.fields.companySubcontractor","Subcontractor")})]})]}),t.company==="subcontractor"&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.subcontractorName","Subcontractor name")}),e.jsx("input",{className:"input",value:t.subcontractor_name,onChange:n=>x(s,"subcontractor_name",n.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.jobTitle","Job title / Role")}),e.jsx("input",{className:"input",value:t.job_title,onChange:n=>x(s,"job_title",n.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.ageRange","Age range")}),e.jsxs("select",{className:"input",value:t.age_range,onChange:n=>x(s,"age_range",n.target.value),children:[e.jsx("option",{value:"",children:p?.("common.select")??"Select"}),Se.map(n=>e.jsx("option",{value:n.value,children:n.value},n.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.experience","Experience in current role")}),e.jsxs("select",{className:"input",value:t.experience_range,onChange:n=>x(s,"experience_range",n.target.value),children:[e.jsx("option",{value:"",children:p?.("common.select")??"Select"}),ke.map(n=>e.jsx("option",{value:n.value,children:n.value},n.value))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.injuryOutcome","Injury outcome")}),e.jsxs("select",{className:"input",value:t.outcome,onChange:n=>x(s,"outcome",n.target.value),required:!0,children:[e.jsx("option",{value:"",children:p?.("common.select")??"Select"}),Ae.map(n=>e.jsx("option",{value:n.value,children:n.value},n.value))]})]}),c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.bodyPart","Body part affected")}),e.jsxs("select",{className:"input",value:t.body_part,onChange:n=>x(s,"body_part",n.target.value),required:!0,children:[e.jsx("option",{value:"",children:p?.("common.select")??"Select"}),Fe.map(n=>e.jsx("option",{value:n.value,children:n.value},n.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.injuryType","Injury type")}),e.jsxs("select",{className:"input",value:t.injury_type,onChange:n=>x(s,"injury_type",n.target.value),required:!0,children:[e.jsx("option",{value:"",children:p?.("common.select")??"Select"}),Te.map(n=>e.jsx("option",{value:n.value,children:n.value},n.value))]})]}),t.injury_type==="other"&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.specifyInjuryType","Specify injury type")}),e.jsx("input",{className:"input",value:t.injury_type_other,onChange:n=>x(s,"injury_type_other",n.target.value),required:!0})]})]}),u&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.dateOfDeath","Date of death")}),e.jsxs("select",{className:"input",value:t.death_timing,onChange:n=>x(s,"death_timing",n.target.value),required:!0,children:[e.jsx("option",{value:"",children:p?.("common.select")??"Select"}),e.jsx("option",{value:"same_day",children:l("hseEvents.accidentForm.fields.deathTimingSameDay","Same day")}),e.jsx("option",{value:"later",children:l("hseEvents.accidentForm.fields.deathTimingLater","Later")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.placeOfDeath","Place of death")}),e.jsxs("select",{className:"input",value:t.death_place,onChange:n=>x(s,"death_place",n.target.value),required:!0,children:[e.jsx("option",{value:"",children:p?.("common.select")??"Select"}),e.jsx("option",{value:"on_site",children:l("hseEvents.accidentForm.fields.deathPlaceOnSite","On site")}),e.jsx("option",{value:"during_evacuation",children:l("hseEvents.accidentForm.fields.deathPlaceDuringEvacuation","During evacuation")}),e.jsx("option",{value:"medical_facility",children:l("hseEvents.accidentForm.fields.deathPlaceMedicalFacility","Medical facility")})]})]}),t.death_timing==="later"&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.datePicker","Date picker")}),e.jsx("input",{type:"date",className:"input",value:t.death_date,onChange:n=>x(s,"death_date",n.target.value),required:!0})]})]})]})]},s)})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/30 border border-gray-200 dark:border-gray-700 rounded-xl p-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:["4) ",l("hseEvents.accidentForm.sections.activity","Activity at Time of Accident")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.activity","Activity")}),e.jsxs("select",{className:"input",value:i.activity,onChange:t=>m(s=>({...s,activity:t.target.value})),required:!0,children:[e.jsx("option",{value:"",children:p?.("common.select")??"Select"}),we.map(t=>e.jsx("option",{value:t.value,children:t.value},t.value))]})]}),i.activity==="other"&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.other","Other")}),e.jsx("input",{className:"input",value:i.activity_other,onChange:t=>m(s=>({...s,activity_other:t.target.value})),required:!0})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/30 border border-gray-200 dark:border-gray-700 rounded-xl p-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:["5) ",l("hseEvents.accidentForm.sections.environment","Work Environment & Conditions")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.groundCondition","Ground condition")}),e.jsxs("select",{className:"input",value:i.ground_condition,onChange:t=>m(s=>({...s,ground_condition:t.target.value})),required:!0,children:[e.jsx("option",{value:"",children:p?.("common.select")??"Select"}),Ie.map(t=>e.jsx("option",{value:t.value,children:t.value},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.lighting","Lighting")}),e.jsxs("select",{className:"input",value:i.lighting,onChange:t=>m(s=>({...s,lighting:t.target.value})),required:!0,children:[e.jsx("option",{value:"",children:p?.("common.select")??"Select"}),Oe.map(t=>e.jsx("option",{value:t.value,children:t.value},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.weather","Weather")}),e.jsxs("select",{className:"input",value:i.weather,onChange:t=>m(s=>({...s,weather:t.target.value})),required:!0,children:[e.jsx("option",{value:"",children:p?.("common.select")??"Select"}),De.map(t=>e.jsx("option",{value:t.value,children:t.value},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.workArea","Work area")}),e.jsxs("select",{className:"input",value:i.work_area,onChange:t=>m(s=>({...s,work_area:t.target.value})),required:!0,children:[e.jsx("option",{value:"",children:p?.("common.select")??"Select"}),Pe.map(t=>e.jsx("option",{value:t.value,children:t.value},t.value))]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/30 border border-gray-200 dark:border-gray-700 rounded-xl p-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:["6) ",l("hseEvents.accidentForm.sections.ppe","PPE & Protections")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:l("hseEvents.accidentForm.fields.ppeWorn","PPE worn")}),e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Me.map(t=>e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:i.ppe_worn.includes(t.value),onChange:()=>F("ppe_worn",t.value)}),t.value]},t.value))}),i.ppe_worn.includes("other")&&e.jsx("input",{className:"input",placeholder:l("hseEvents.accidentForm.fields.otherPpe","Other PPE"),value:i.ppe_other,onChange:t=>m(s=>({...s,ppe_other:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.collectiveProtections","Collective protections")}),e.jsx("select",{className:"input",value:i.collective_protections,onChange:t=>m(s=>({...s,collective_protections:t.target.value})),children:qe.map(t=>e.jsx("option",{value:t.value,children:t.value},t.value))})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/30 border border-gray-200 dark:border-gray-700 rounded-xl p-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:["7) ",l("hseEvents.accidentForm.sections.immediateCause","Immediate Cause")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.primaryImmediateCause","Primary immediate cause")}),e.jsxs("select",{className:"input",value:i.immediate_cause,onChange:t=>m(s=>({...s,immediate_cause:t.target.value})),required:!0,children:[e.jsx("option",{value:"",children:p?.("common.select")??"Select"}),Le.map(t=>e.jsx("option",{value:t.value,children:t.value},t.value))]})]}),i.immediate_cause==="other"&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.other","Other")}),e.jsx("input",{className:"input",value:i.immediate_cause_other,onChange:t=>m(s=>({...s,immediate_cause_other:t.target.value})),required:!0})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/30 border border-gray-200 dark:border-gray-700 rounded-xl p-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:["8) ",l("hseEvents.accidentForm.sections.rootCause","Root Cause Analysis")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:l("hseEvents.accidentForm.fields.rootCauseCategories","Root cause categories")}),e.jsx("div",{className:"grid grid-cols-1 gap-1",children:Re.map(t=>e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:i.root_causes.includes(t.value),onChange:()=>F("root_causes",t.value)}),t.value]},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.methodConformity","Method conformity (required if severity ≥ LTA)")}),e.jsxs("select",{className:"input",value:i.method_conformity,onChange:t=>m(s=>({...s,method_conformity:t.target.value})),children:[e.jsx("option",{value:"",children:p?.("common.select")??"Select"}),Ve.map(t=>e.jsx("option",{value:t.value,children:t.value},t.value))]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/30 border border-gray-200 dark:border-gray-700 rounded-xl p-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:["9) ",l("hseEvents.accidentForm.sections.immediateActions","Immediate Actions Taken")]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:$e.map(t=>e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:i.immediate_actions.includes(t.value),onChange:()=>F("immediate_actions",t.value)}),t.value]},t.value))})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/30 border border-gray-200 dark:border-gray-700 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:["10) ",l("hseEvents.accidentForm.sections.preventiveActions","Preventive & Corrective Actions")]}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:R,children:l("hseEvents.accidentForm.fields.addAction","Add action")})]}),e.jsxs("div",{className:"space-y-3 mt-3",children:[(i.corrective_actions||[]).map((t,s)=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3 bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-2",children:[e.jsxs("select",{className:"input",value:t.type,onChange:c=>P(s,"type",c.target.value),children:[e.jsx("option",{value:"",children:l("hseEvents.accidentForm.fields.actionType","Action type")}),Ge.map(c=>e.jsx("option",{value:c.value,children:c.value},c.value))]}),e.jsx("input",{className:"input md:col-span-2",placeholder:l("hseEvents.accidentForm.fields.actionDescription","Action description"),value:t.description,onChange:c=>P(s,"description",c.target.value)}),e.jsx("input",{className:"input",placeholder:l("hseEvents.accidentForm.fields.responsibleRole","Responsible role"),value:t.responsible_role,onChange:c=>P(s,"responsible_role",c.target.value)}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("input",{type:"date",className:"input",value:t.deadline,onChange:c=>P(s,"deadline",c.target.value)}),e.jsx("select",{className:"input",value:t.status,onChange:c=>P(s,"status",c.target.value),children:Ye.map(c=>e.jsx("option",{value:c.value,children:c.value},c.value))})]})]}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsx("button",{type:"button",className:"btn-secondary",onClick:()=>Q(s),children:l("hseEvents.accidentForm.fields.remove","Remove")})})]},s)),(i.corrective_actions||[]).length===0&&e.jsx("div",{className:"text-sm text-gray-500",children:l("hseEvents.accidentForm.fields.noActions","No actions")})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/30 border border-gray-200 dark:border-gray-700 rounded-xl p-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:["11) ",l("hseEvents.accidentForm.sections.attachments","Attachments")]}),!y?.id&&e.jsx("div",{className:"text-sm text-gray-500 mt-2",children:l("hseEvents.accidentForm.fields.filesUploadedAfterSaving","Files will be uploaded after saving.")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.addFiles","Add files")}),e.jsx("input",{type:"file",className:"input",multiple:!0,onChange:Z}),q.length>0&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:l("hseEvents.accidentForm.fields.selectedFiles","Selected: {files}",{files:q.map(t=>t.name).join(", ")})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.existingAttachments","Existing attachments")}),e.jsxs("div",{className:"space-y-2",children:[S&&e.jsx("div",{className:"text-sm text-gray-500",children:l("hseEvents.accidentForm.fields.loading","Loading...")}),!S&&(G||[]).length===0&&e.jsx("div",{className:"text-sm text-gray-500",children:l("hseEvents.accidentForm.fields.noAttachments","No attachments")}),(G||[]).map(t=>e.jsxs("div",{className:"flex items-center justify-between gap-2 border border-gray-200 dark:border-gray-700 rounded-lg p-2 bg-white dark:bg-gray-800",children:[e.jsx("a",{className:"text-sm text-blue-600 hover:underline",href:t.url||"#",target:"_blank",rel:"noreferrer",children:t.label||t.original_name||t.id}),e.jsx("button",{type:"button",className:"btn-secondary",disabled:!y?.id||S,onClick:()=>T(y?.id,t.id),children:p?.("common.delete")??"Delete"})]},t.id))]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/30 border border-gray-200 dark:border-gray-700 rounded-xl p-4",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:["12) ",l("hseEvents.accidentForm.sections.validationClosure","Validation & Closure")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:!!i.investigation_completed,onChange:t=>m(s=>({...s,investigation_completed:t.target.checked}))}),l("hseEvents.accidentForm.fields.investigationCompleted","Investigation completed")]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:!!i.accident_closed,onChange:t=>m(s=>({...s,accident_closed:t.target.checked}))}),l("hseEvents.accidentForm.fields.accidentClosed","Accident closed")]}),i.accident_closed&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.closureDate","Closure date")}),e.jsx("input",{type:"date",className:"input",value:i.closure_date,onChange:t=>m(s=>({...s,closure_date:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.closedByRole","Closed by (role)")}),e.jsx("input",{className:"input",value:i.closed_by_role,onChange:t=>m(s=>({...s,closed_by_role:t.target.value}))})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-4",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:l("hseEvents.accidentForm.sections.other","Other")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.description","Description")}),e.jsx("textarea",{className:"input",rows:"3",value:i.description,onChange:t=>m(s=>({...s,description:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:l("hseEvents.accidentForm.fields.lostWorkDays","Lost work days (if lost time)")}),e.jsx("input",{type:"number",min:"0",className:"input",value:i.lost_days,onChange:t=>m(s=>({...s,lost_days:t.target.value}))}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:l("hseEvents.accidentForm.fields.lostTimeAutoDerived","Lost time is auto-derived from victims outcomes.")})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:V,disabled:k,children:p?.("common.cancel")??"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:k,children:p?.("common.save")??"Save"})]})]})})}const W=[{value:"work_accident"},{value:"incident"},{value:"near_miss"},{value:"first_aid"},{value:"medical_consultation"},{value:"road_accident"},{value:"other"}],B=["work_accident","incident","near_miss","road_accident"],J=["medical_consultation","first_aid"],K=[{value:""},{value:"minor"},{value:"moderate"},{value:"major"},{value:"critical"},{value:"fatal"},{value:"other"}];function et(){const{t:r}=pe(),{user:b}=ye(),I=a=>r(`hseEvents.types.${a}`)??a,O=a=>a?r(`hseEvents.severities.${a}`)??a:r("common.all")??"All",[M,p]=v.useState([]),[y,k]=v.useState(!0),[$,S]=v.useState(!1),[A,G]=v.useState([]),[N,q]=v.useState(""),[E,l]=v.useState(""),[i,m]=v.useState(""),[D,z]=v.useState(""),[L,X]=v.useState(""),[F,x]=v.useState(""),[R,Q]=v.useState(""),[P,V]=v.useState(!1),[Z,Y]=v.useState(!1),[T,w]=v.useState(null),[t,s]=v.useState(null),[c,u]=v.useState("accidents"),n=b?.project_list_preference??"code",d=v.useMemo(()=>_e(M,n),[M,n]),H=()=>({project_id:"",event_date:new Date().toISOString().split("T")[0],type:"work_accident",type_other:"",description:"",severity:"",severity_other:"",lost_time:!1,lost_days:0,location:""}),[h,j]=v.useState(H());v.useEffect(()=>{(async()=>{try{const g=(await ge.getAll({per_page:200})).data?.data??[];p(Array.isArray(g)?g:[])}catch{p([])}finally{k(!1)}})()},[]);const U=async()=>{k(!0);try{const a={per_page:100};N&&(a.project_id=N),D&&(a.year=D),L&&(a.month=L),F&&(a.from_date=F),R&&(a.to_date=R);const g=(await C.getAll(a)).data,_=g?.data??g,te=Array.isArray(_)?_:_?.data??[];G(te)}catch{G([])}finally{k(!1)}},le=async a=>{S(!0);try{let o;return T?.id?o=await C.update(T.id,a):o=await C.create(a),f.success(r("common.saved")??"Saved"),U(),o?.data?.data??o?.data}catch(o){throw f.error(r("common.error")??"Error"),o}finally{S(!1)}};v.useEffect(()=>{U()},[N,D,L,F,R]);const ne=()=>{if(c==="accidents"){w(null),Y(!0);return}w(null),j({...H(),project_id:N||"",type:"medical_consultation"}),V(!0)},ce=a=>{if(B.includes(a.type)){w(a),Y(!0);return}const o=W.some(_=>_.value!=="other"&&_.value===a.type),g=K.some(_=>_.value&&_.value!=="other"&&_.value===a.severity);w(a),j({project_id:String(a.project_id??""),event_date:a.event_date?.substring(0,10)??new Date().toISOString().split("T")[0],type:o?a.type:"other",type_other:o?"":a.type??"",description:a.description??"",severity:g?a.severity:a.severity?"other":"",severity_other:g?"":a.severity??"",lost_time:!!a.lost_time,lost_days:a.lost_days??0,location:a.location??""}),V(!0)},ee=()=>{V(!1),w(null),j(H())},oe=()=>{Y(!1),w(null)},de=async a=>{a.preventDefault(),S(!0);try{const o=h.type==="other"?h.type_other||"":h.type,g=h.severity==="other"?h.severity_other||"":h.severity||"";if(!o){f.error(r("hseEvents.validation.typeRequired")??"Type is required");return}if(h.type==="other"&&!h.type_other){f.error(r("hseEvents.validation.specifyType")??"Please specify the type");return}if(h.severity==="other"&&!h.severity_other){f.error(r("hseEvents.validation.specifySeverity")??"Please specify the severity");return}const _={project_id:parseInt(h.project_id),event_date:h.event_date,type:o,description:h.description||null,severity:g||null,lost_time:!!h.lost_time,lost_days:Number(h.lost_days)||0,location:h.location||null};T?.id?(await C.update(T.id,_),f.success(r("common.saved")??"Saved")):(await C.create(_),f.success(r("common.saved")??"Saved")),ee(),U()}catch{f.error(r("common.error")??"Error")}finally{S(!1)}},me=a=>s(a),ue=async()=>{if(t?.id){S(!0);try{await C.delete(t.id),f.success(r("common.saved")??"Saved"),s(null),U()}catch{f.error(r("common.error")??"Error")}finally{S(!1)}}},ve=a=>{if(!a)return r("common.none")??"-";const o=a.substring(0,10),[g,_,te]=o.split("-");return`${te}/${_}/${g}`},se=v.useMemo(()=>{let a=Array.isArray(A)?A:[];return c==="accidents"?a=a.filter(o=>B.includes(o.type)):a=a.filter(o=>J.includes(o.type)),E&&(E==="other"?a=a.filter(o=>!W.some(g=>g.value!=="other"&&g.value===o.type)):a=a.filter(o=>o.type===E)),i&&(i==="other"?a=a.filter(o=>o.severity&&!K.some(g=>g.value&&g.value!=="other"&&g.value===o.severity)):a=a.filter(o=>(o.severity??"")===i)),a},[A,E,i,c]),he=v.useMemo(()=>{const a=c==="accidents"?B:J;return W.filter(o=>o.value==="other"||a.includes(o.value))},[c]);return v.useEffect(()=>{E&&E!=="other"&&!(c==="accidents"?B:J).includes(E)&&l("")},[c]),e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-50 rounded-lg",children:e.jsx(je,{className:"w-6 h-6 text-red-500"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:r("hseEvents.pageTitle")??"Accidents, Incidents & Medical Visits"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("hseEvents.pageSubtitle")??"Register and track HSE events (accidents, incidents, near misses, first aid, road accidents)"})]})]}),e.jsxs("button",{onClick:ne,className:"btn-primary flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),r("common.new")??"New"]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl p-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:c==="accidents"?"btn-primary":"btn-secondary",onClick:()=>u("accidents"),children:r("hseEvents.tabs.accidents")??"Accident / Incident"}),e.jsx("button",{type:"button",className:c==="medical"?"btn-primary":"btn-secondary",onClick:()=>u("medical"),children:r("hseEvents.tabs.medical")??"Medical Visits"})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-7 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:r("projects.title")??"Project"}),e.jsxs("select",{className:"input",value:N,onChange:a=>q(a.target.value),children:[e.jsx("option",{value:"",children:r("common.all")??"All"}),d.map(a=>e.jsx("option",{value:String(a.id),children:a.code?`${a.code} - ${a.name}`:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:r("hseEvents.filters.type")??"Type"}),e.jsxs("select",{className:"input",value:E,onChange:a=>l(a.target.value),children:[e.jsx("option",{value:"",children:r("common.all")??"All"}),he.map(a=>e.jsx("option",{value:a.value,children:I(a.value)},a.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:r("hseEvents.filters.severity")??"Severity"}),e.jsx("select",{className:"input",value:i,onChange:a=>m(a.target.value),children:K.map(a=>e.jsx("option",{value:a.value,children:O(a.value)},a.value||"all"))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:r("hseEvents.filters.year")??"Year"}),e.jsx("input",{className:"input",type:"number",value:D,onChange:a=>z(a.target.value),placeholder:r("hseEvents.placeholders.year")??"2026"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:r("hseEvents.filters.month")??"Month"}),e.jsx("input",{className:"input",type:"number",min:"1",max:"12",value:L,onChange:a=>X(a.target.value),placeholder:r("hseEvents.placeholders.month")??"1-12"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:r("hseEvents.filters.from")??"From"}),e.jsx("input",{className:"input",type:"date",value:F,onChange:a=>x(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:r("hseEvents.filters.to")??"To"}),e.jsx("input",{className:"input",type:"date",value:R,onChange:a=>Q(a.target.value)})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:r("hseEvents.recordsTitle")??"Records"}),y&&e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 animate-spin"}),r("common.loading")??"Loading"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-2",children:r("hseEvents.table.date")??"Date"}),e.jsx("th",{className:"text-left px-4 py-2",children:r("hseEvents.table.project")??"Project"}),e.jsx("th",{className:"text-left px-4 py-2",children:r("hseEvents.table.type")??"Type"}),e.jsx("th",{className:"text-left px-4 py-2",children:r("hseEvents.table.severity")??"Severity"}),e.jsx("th",{className:"text-left px-4 py-2",children:r("hseEvents.table.lostTime")??"Lost time"}),e.jsx("th",{className:"text-left px-4 py-2",children:r("hseEvents.table.lostDays")??"Lost days"}),e.jsx("th",{className:"text-left px-4 py-2",children:r("hseEvents.table.location")??"Location"}),e.jsx("th",{className:"text-left px-4 py-2",children:r("hseEvents.table.description")??"Description"}),e.jsx("th",{className:"text-right px-4 py-2",children:r("common.actions")??"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:[se.map(a=>e.jsxs("tr",{className:a.deleted_at?"opacity-60":"",children:[e.jsx("td",{className:"px-4 py-2",children:ve(a.event_date)}),e.jsx("td",{className:"px-4 py-2",children:a.project?.code?`${a.project.code} - ${a.project.name}`:a.project?.name??a.project_id}),e.jsx("td",{className:"px-4 py-2",children:I(a.type)}),e.jsx("td",{className:"px-4 py-2",children:a.severity?O(a.severity):r("common.none")??"-"}),e.jsx("td",{className:"px-4 py-2",children:a.lost_time?r("common.yes")??"Yes":r("common.no")??"No"}),e.jsx("td",{className:"px-4 py-2",children:a.lost_days??0}),e.jsx("td",{className:"px-4 py-2",children:a.location??r("common.none")??"-"}),e.jsx("td",{className:"px-4 py-2 max-w-xl",children:e.jsx("div",{className:"truncate",title:a.description??"",children:a.description??r("common.none")??"-"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>ce(a),children:e.jsx(be,{className:"w-4 h-4"})}),e.jsx("button",{className:"btn-secondary",onClick:()=>me(a),children:e.jsx(Ne,{className:"w-4 h-4"})})]})})]},a.id)),!y&&se.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"px-4 py-10 text-center text-gray-500",children:r("hseEvents.noRecords")??"No records"})})]})]})})]}),e.jsx(re,{isOpen:P,onClose:ee,title:T?r("hseEvents.modal.editTitle")??"Edit HSE Event":r("hseEvents.modal.newTitle")??"New HSE Event",children:e.jsxs("form",{onSubmit:de,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:r("hseEvents.fields.project")??"Project"}),e.jsxs("select",{className:"input",value:h.project_id,onChange:a=>j(o=>({...o,project_id:a.target.value})),required:!0,children:[e.jsx("option",{value:"",children:r("hseEvents.fields.selectProject")??"Select..."}),d.map(a=>e.jsx("option",{value:String(a.id),children:a.code?`${a.code} - ${a.name}`:a.name},a.id))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:r("hseEvents.fields.date")??"Date"}),e.jsx("input",{type:"date",className:"input",value:h.event_date,onChange:a=>j(o=>({...o,event_date:a.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:r("hseEvents.fields.type")??"Type"}),e.jsx("select",{className:"input",value:h.type,onChange:a=>j(o=>({...o,type:a.target.value})),required:!0,children:(c==="medical"?W.filter(a=>a.value==="other"||J.includes(a.value)):W).map(a=>e.jsx("option",{value:a.value,children:I(a.value)},a.value))})]})]}),h.type==="other"&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:r("hseEvents.fields.specifyType")??"Specify type"}),e.jsx("input",{className:"input",value:h.type_other,onChange:a=>j(o=>({...o,type_other:a.target.value})),placeholder:r("hseEvents.placeholders.typeOther")??"e.g. property damage",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:r("hseEvents.fields.description")??"Description"}),e.jsx("textarea",{className:"input",value:h.description,onChange:a=>j(o=>({...o,description:a.target.value})),rows:"3"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:r("hseEvents.fields.severity")??"Severity"}),e.jsxs("select",{className:"input",value:h.severity,onChange:a=>j(o=>({...o,severity:a.target.value})),children:[e.jsx("option",{value:"",children:r("common.select")??"Select"}),K.filter(a=>a.value!=="").map(a=>e.jsx("option",{value:a.value,children:O(a.value)},a.value))]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:!!h.lost_time,onChange:a=>j(o=>({...o,lost_time:a.target.checked}))}),r("hseEvents.fields.lostTime")??"Lost time"]})}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:r("hseEvents.fields.lostDays")??"Lost days"}),e.jsx("input",{type:"number",min:"0",className:"input",value:h.lost_days,onChange:a=>j(o=>({...o,lost_days:a.target.value}))})]})]}),h.severity==="other"&&e.jsxs("div",{children:[e.jsx("label",{className:"label",children:r("hseEvents.fields.specifySeverity")??"Specify severity"}),e.jsx("input",{className:"input",value:h.severity_other,onChange:a=>j(o=>({...o,severity_other:a.target.value})),placeholder:r("hseEvents.placeholders.severityOther")??"e.g. moderate",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:r("hseEvents.fields.location")??"Location"}),e.jsx("input",{className:"input",value:h.location,onChange:a=>j(o=>({...o,location:a.target.value}))})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:ee,children:r("common.cancel")??"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:$,children:$?e.jsx(ie,{className:"w-4 h-4 animate-spin"}):r("common.save")??"Save"})]})]})}),e.jsx(Ue,{isOpen:Z,onClose:oe,onSubmit:le,projects:d,selectedProjectId:N,t:r,initial:T}),e.jsx(xe,{isOpen:!!t,title:r("hseEvents.archive.title")??"Archive record",message:r("hseEvents.archive.message")??"This will archive (soft-delete) the record. Continue?",confirmLabel:r("common.confirm")??"Confirm",cancelLabel:r("common.cancel")??"Cancel",onConfirm:ue,onCancel:()=>s(null)})]})}export{et as default};
