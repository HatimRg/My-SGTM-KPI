import{a as G,u as H,j as e,g as K,J as x}from"./index.js";import{r as t}from"./vendor-react.js";import{M as Q}from"./Modal.js";import{C as U}from"./ConfirmDialog.js";import{s as V}from"./projectList.js";import{b as W,af as X,v as E,aD as Z,al as ee,z as h}from"./vendor-ui.js";import"./vendor-utils.js";function ie(){const{t:r}=G(),{user:$}=H(),[C,k]=t.useState([]),[L,P]=t.useState([]),[A,p]=t.useState(!0),[D,d]=t.useState(!1),[i,I]=t.useState(""),[m,F]=t.useState(""),[u,T]=t.useState(""),[q,j]=t.useState(!1),[g,y]=t.useState(null),[v,N]=t.useState(null),M=$?.project_list_preference??"code",w=t.useMemo(()=>V(C,M),[C,M]),f=()=>({project_id:"",measured_at:new Date().toISOString().split("T")[0],location:"",lux_value:"",threshold:"",notes:""}),[l,n]=t.useState(f());t.useEffect(()=>{(async()=>{try{const c=(await K.getAll({per_page:200})).data?.data??[];k(Array.isArray(c)?c:[])}catch{k([])}finally{p(!1)}})()},[]);const b=async()=>{p(!0);try{const s={per_page:100};i&&(s.project_id=i),m&&(s.year=m),u&&(s.month=u);const c=(await x.getAll(s)).data,o=c?.data??c,S=Array.isArray(o)?o:o?.data??[];P(S)}catch{P([])}finally{p(!1)}};t.useEffect(()=>{b()},[i,m,u]);const O=()=>{y(null),n({...f(),project_id:i||""}),j(!0)},Y=s=>{y(s),n({project_id:String(s.project_id??""),measured_at:s.measured_at?.substring(0,10)??new Date().toISOString().split("T")[0],location:s.location??"",lux_value:s.lux_value??"",threshold:s.threshold??"",notes:s.notes??""}),j(!0)},_=()=>{j(!1),y(null),n(f())},z=async s=>{s.preventDefault(),d(!0);try{const a={project_id:parseInt(l.project_id),measured_at:l.measured_at,location:l.location,lux_value:Number(l.lux_value),threshold:l.threshold===""?null:Number(l.threshold),notes:l.notes||null};g?.id?await x.update(g.id,a):await x.create(a),h.success(r("common.saved")??"Saved"),_(),b()}catch{h.error(r("common.error")??"Error")}finally{d(!1)}},R=s=>N(s),J=async()=>{if(v?.id){d(!0);try{await x.delete(v.id),h.success(r("common.saved")??"Saved"),N(null),b()}catch{h.error(r("common.error")??"Error")}finally{d(!1)}}},B=s=>{if(!s)return"-";const a=s.substring(0,10),[c,o,S]=a.split("-");return`${S}/${o}/${c}`};return e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-amber-50 dark:bg-amber-900/30 rounded-xl flex items-center justify-center",children:e.jsx(W,{className:"w-6 h-6 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:"Lighting (Lux) Measurements"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Location + lux value + optional threshold compliance"})]})]}),e.jsxs("button",{onClick:O,className:"btn-primary flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),r("common.new")??"New"]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:r("projects.title")??"Project"}),e.jsxs("select",{className:"input",value:i,onChange:s=>I(s.target.value),children:[e.jsx("option",{value:"",children:r("common.all")??"All"}),w.map(s=>e.jsx("option",{value:String(s.id),children:s.code?`${s.code} - ${s.name}`:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Year"}),e.jsx("input",{className:"input",type:"number",value:m,onChange:s=>F(s.target.value),placeholder:"2026"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Month"}),e.jsx("input",{className:"input",type:"number",min:"1",max:"12",value:u,onChange:s=>T(s.target.value),placeholder:"1-12"})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:"Records"}),A&&e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4 animate-spin"}),r("common.loading")??"Loading"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-2",children:"Date"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Project"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Location"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Lux"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Threshold"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Compliant"}),e.jsx("th",{className:"text-right px-4 py-2",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:[L.map(s=>e.jsxs("tr",{className:s.deleted_at?"opacity-60":"",children:[e.jsx("td",{className:"px-4 py-2",children:B(s.measured_at)}),e.jsx("td",{className:"px-4 py-2",children:s.project?.code?`${s.project.code} - ${s.project.name}`:s.project?.name??s.project_id}),e.jsx("td",{className:"px-4 py-2",children:s.location}),e.jsx("td",{className:"px-4 py-2",children:s.lux_value}),e.jsx("td",{className:"px-4 py-2",children:s.threshold??"-"}),e.jsx("td",{className:"px-4 py-2",children:s.is_compliant===null?"-":s.is_compliant?"Yes":"No"}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>Y(s),children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsx("button",{className:"btn-secondary",onClick:()=>R(s),children:e.jsx(ee,{className:"w-4 h-4"})})]})})]},s.id)),!A&&L.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-10 text-center text-gray-500",children:"No records"})})]})]})})]}),e.jsx(Q,{isOpen:q,onClose:_,title:g?"Edit lighting measurement":"New lighting measurement",children:e.jsxs("form",{onSubmit:z,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Project"}),e.jsxs("select",{className:"input",value:l.project_id,onChange:s=>n(a=>({...a,project_id:s.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Select..."}),w.map(s=>e.jsx("option",{value:String(s.id),children:s.code?`${s.code} - ${s.name}`:s.name},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Date"}),e.jsx("input",{type:"date",className:"input",value:l.measured_at,onChange:s=>n(a=>({...a,measured_at:s.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Location"}),e.jsx("input",{className:"input",value:l.location,onChange:s=>n(a=>({...a,location:s.target.value})),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Lux value"}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:"input",value:l.lux_value,onChange:s=>n(a=>({...a,lux_value:s.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Threshold (optional)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:"input",value:l.threshold,onChange:s=>n(a=>({...a,threshold:s.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes"}),e.jsx("textarea",{className:"input",rows:"3",value:l.notes,onChange:s=>n(a=>({...a,notes:s.target.value}))})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:_,children:r("common.cancel")??"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:D,children:D?e.jsx(E,{className:"w-4 h-4 animate-spin"}):r("common.save")??"Save"})]})]})}),e.jsx(U,{isOpen:!!v,title:"Archive record",message:"This will archive (soft-delete) the record. Continue?",confirmLabel:r("common.confirm")??"Confirm",cancelLabel:r("common.cancel")??"Cancel",onConfirm:J,onCancel:()=>N(null)})]})}export{ie as default};
