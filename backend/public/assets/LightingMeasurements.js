import{a as B,u as G,j as e,M as H,g as J,K as h}from"./index.js";import{r as l}from"./vendor-react.js";import{C as Q}from"./ConfirmDialog.js";import{s as V}from"./projectList.js";import{b as W,av as X,a0 as E,aU as Z,aA as ee,z as x}from"./vendor-ui.js";import"./vendor-utils.js";function ce(){const{t}=B(),{user:T}=G(),[C,M]=l.useState([]),[L,k]=l.useState([]),[A,p]=l.useState(!0),[P,d]=l.useState(!1),[i,$]=l.useState(""),[m,I]=l.useState(""),[u,F]=l.useState(""),[q,j]=l.useState(!1),[g,y]=l.useState(null),[v,N]=l.useState(null),D=T?.project_list_preference??"code",w=l.useMemo(()=>V(C,D),[C,D]),b=()=>({project_id:"",measured_at:new Date().toISOString().split("T")[0],location:"",lux_value:"",threshold:"",notes:""}),[r,n]=l.useState(b());l.useEffect(()=>{(async()=>{try{const c=(await J.getAll({per_page:200})).data?.data??[];M(Array.isArray(c)?c:[])}catch{M([])}finally{p(!1)}})()},[]);const f=async()=>{p(!0);try{const s={per_page:100};i&&(s.project_id=i),m&&(s.year=m),u&&(s.month=u);const c=(await h.getAll(s)).data,o=c?.data??c,S=Array.isArray(o)?o:o?.data??[];k(S)}catch{k([])}finally{p(!1)}};l.useEffect(()=>{f()},[i,m,u]);const O=()=>{y(null),n({...b(),project_id:i||""}),j(!0)},R=s=>{y(s),n({project_id:String(s.project_id??""),measured_at:s.measured_at?.substring(0,10)??new Date().toISOString().split("T")[0],location:s.location??"",lux_value:s.lux_value??"",threshold:s.threshold??"",notes:s.notes??""}),j(!0)},_=()=>{j(!1),y(null),n(b())},Y=async s=>{s.preventDefault(),d(!0);try{const a={project_id:parseInt(r.project_id),measured_at:r.measured_at,location:r.location,lux_value:Number(r.lux_value),threshold:r.threshold===""?null:Number(r.threshold),notes:r.notes||null};g?.id?await h.update(g.id,a):await h.create(a),x.success(t("common.saved")??"Saved"),_(),f()}catch{x.error(t("common.error")??"Error")}finally{d(!1)}},z=s=>N(s),K=async()=>{if(v?.id){d(!0);try{await h.delete(v.id),x.success(t("common.saved")??"Saved"),N(null),f()}catch{x.error(t("common.error")??"Error")}finally{d(!1)}}},U=s=>{if(!s)return"-";const a=s.substring(0,10),[c,o,S]=a.split("-");return`${S}/${o}/${c}`};return e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-50 rounded-lg",children:e.jsx(W,{className:"w-6 h-6 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:t("lightingMeasurements.pageTitle")??"Lighting Measurements (Lux)"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("lightingMeasurements.pageSubtitle")??"Location + lux value + optional threshold compliance"})]})]}),e.jsxs("button",{onClick:O,className:"btn-primary flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4"}),t("common.new")??"New"]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:t("projects.title")??"Project"}),e.jsxs("select",{className:"input",value:i,onChange:s=>$(s.target.value),children:[e.jsx("option",{value:"",children:t("common.all")??"All"}),w.map(s=>e.jsx("option",{value:String(s.id),children:s.code?`${s.code} - ${s.name}`:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Year"}),e.jsx("input",{className:"input",type:"number",value:m,onChange:s=>I(s.target.value),placeholder:"2026"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Month"}),e.jsx("input",{className:"input",type:"number",min:"1",max:"12",value:u,onChange:s=>F(s.target.value),placeholder:"1-12"})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200",children:t("lightingMeasurements.recordsTitle")??"Records"}),A&&e.jsxs("div",{className:"text-sm text-gray-500 flex items-center gap-2",children:[e.jsx(E,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:t("common.loading")??"Loading..."})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-2",children:"Date"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Project"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Location"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Lux"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Threshold"}),e.jsx("th",{className:"text-left px-4 py-2",children:"Compliant"}),e.jsx("th",{className:"text-right px-4 py-2",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:[L.map(s=>e.jsxs("tr",{className:s.deleted_at?"opacity-60":"",children:[e.jsx("td",{className:"px-4 py-2",children:U(s.measured_at)}),e.jsx("td",{className:"px-4 py-2",children:s.project?.code?`${s.project.code} - ${s.project.name}`:s.project?.name??s.project_id}),e.jsx("td",{className:"px-4 py-2",children:s.location}),e.jsx("td",{className:"px-4 py-2",children:s.lux_value}),e.jsx("td",{className:"px-4 py-2",children:s.threshold??"-"}),e.jsx("td",{className:"px-4 py-2",children:s.is_compliant===null?"-":s.is_compliant?"Yes":"No"}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>R(s),children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsx("button",{className:"btn-secondary",onClick:()=>z(s),children:e.jsx(ee,{className:"w-4 h-4"})})]})})]},s.id)),!A&&L.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-4 py-10 text-center text-gray-500",children:t("lightingMeasurements.noRecords")??"No records"})})]})]})})]}),e.jsx(H,{isOpen:q,onClose:_,title:g?t("lightingMeasurements.modal.editTitle")??"Edit lighting measurement":t("lightingMeasurements.modal.newTitle")??"New lighting measurement",children:e.jsxs("form",{onSubmit:Y,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Project"}),e.jsxs("select",{className:"input",value:r.project_id,onChange:s=>n(a=>({...a,project_id:s.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Select..."}),w.map(s=>e.jsx("option",{value:String(s.id),children:s.code?`${s.code} - ${s.name}`:s.name},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Date"}),e.jsx("input",{type:"date",className:"input",value:r.measured_at,onChange:s=>n(a=>({...a,measured_at:s.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Location"}),e.jsx("input",{className:"input",value:r.location,onChange:s=>n(a=>({...a,location:s.target.value})),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Lux value"}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:"input",value:r.lux_value,onChange:s=>n(a=>({...a,lux_value:s.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Threshold (optional)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:"input",value:r.threshold,onChange:s=>n(a=>({...a,threshold:s.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes"}),e.jsx("textarea",{className:"input",rows:"3",value:r.notes,onChange:s=>n(a=>({...a,notes:s.target.value}))})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:_,children:t("common.cancel")??"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:P,children:P?e.jsx(E,{className:"w-4 h-4 animate-spin"}):t("common.save")??"Save"})]})]})}),e.jsx(Q,{isOpen:!!v,title:"Archive record",message:"This will archive (soft-delete) the record. Continue?",confirmLabel:t("common.confirm")??"Confirm",cancelLabel:t("common.cancel")??"Cancel",onConfirm:K,onCancel:()=>N(null)})]})}export{ce as default};
