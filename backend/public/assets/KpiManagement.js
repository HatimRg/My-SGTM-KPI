import{a as Ne,u as fe,k as w,g as V,j as e,h as ve}from"./index.js";import{b as we,r as d}from"./vendor-react.js";import{M as I}from"./Modal.js";import{D as _e}from"./DailyKpiPreview.js";import{z as c,g as Y,ab as J,ag as Ee,ah as Se,aa as Q,v as j,I as Z,B as Ce,n as Re,a as ee,k as se,ao as Ae,X as Le,q as Pe,A as De,s as re}from"./vendor-ui.js";import{g as B}from"./weekHelper.js";import{s as $e,g as ae}from"./projectList.js";import"./vendor-utils.js";function He(){const{t:r,language:te}=Ne(),{user:F}=fe(),W=we(),[de,le]=d.useState([]),[_,ne]=d.useState([]),[ie,M]=d.useState(!0),[a,m]=d.useState(null),[ce,E]=d.useState([]),[oe,O]=d.useState(!1),[T,h]=d.useState(!1),[S,u]=d.useState(""),[o,y]=d.useState(null),[xe,k]=d.useState(!1),[C,U]=d.useState(!1),[n,R]=d.useState({project_id:"",week:B().week,year:B().year}),[i,g]=d.useState({status:"",project_id:"",pole:"",search:"",week:"",year:""}),[me,H]=d.useState([]),[N,ge]=d.useState(""),q=F?.project_list_preference??"code",A=d.useMemo(()=>$e(_,q),[_,q]),pe=te==="fr"?"fr-FR":"en-US",b=s=>s?new Date(s).toLocaleDateString(pe):r("common.unknown"),x=F?.role,he=x==="hse_manager"||x==="regional_hse_manager",be=x==="admin"||x==="consultation"||x==="dev"||x==="pole_director"||x==="works_director"||x==="hse_director"||x==="hr_director",L=s=>!s||s.status!=="submitted"?!1:!!(be||he&&s?.submitter?.role==="responsable"),P=de.filter(s=>s.status!=="draft");d.useEffect(()=>{const s=new URLSearchParams(W.search),t=s.get("week")??"",l=s.get("year")??"";(t||l)&&g(p=>({...p,week:t||p.week,year:l||p.year}))},[W.search]),d.useEffect(()=>{const s=setTimeout(()=>{g(t=>t.search===N?t:{...t,search:N})},300);return()=>clearTimeout(s)},[N]),d.useEffect(()=>{f()},[i]),d.useEffect(()=>{(async()=>{try{const t=await V.getPoles(),l=t.data?.data?.poles??t.data?.poles??[];H(Array.isArray(l)?l:[])}catch{H([])}})()},[]);const f=async()=>{try{M(!0);const[s,t]=await Promise.all([w.getAll(i),V.getAllList({status:"active"})]),l=s.data.data||s.data||[];le(Array.isArray(l)?l:[]),ne(Array.isArray(t)?t:[])}catch(s){console.error("Error loading KPI data:",s),c.error(r("errors.somethingWentWrong"))}finally{M(!1)}},D=async s=>{try{y(s),await w.approve(s),c.success(r("kpi.reportApproved")),f()}catch(t){console.error("Error approving report:",t),c.error(r("errors.somethingWentWrong"))}finally{y(null)}},je=async()=>{if(!a||!S.trim()){c.error(r("kpi.management.rejectReasonRequired"));return}try{y(a.id),await w.reject(a.id,S),c.success(r("kpi.reportRejected")),h(!1),u(""),m(null),f()}catch(s){console.error("Error rejecting report:",s),c.error(r("errors.somethingWentWrong"))}finally{y(null)}},z=async s=>{O(!0),m(s),E([]);try{const l=(await w.getById(s.id)).data.data;m(l.report??l),E(l.daily_snapshots??[])}catch(t){console.error("Failed to load report details:",t),c.error(r("kpi.management.loadDetailsFailed")??r("errors.failedToLoad"))}finally{O(!1)}},K=s=>{m(s),h(!0)},ue=async()=>{if(!n.project_id){c.error(r("hseExport.noProject"));return}if(!n.week||!n.year){c.error(r("hseExport.noWeek"));return}try{U(!0);const s=await ve.exportHseWeekly({project_id:n.project_id,week:n.week,year:n.year}),t=window.URL.createObjectURL(new Blob([s.data])),l=document.createElement("a");l.href=t;const ye=`HSE_Report_${_.find(ke=>ke.id==n.project_id)?.code||"project"}_S${String(n.week).padStart(2,"0")}_${n.year}.xlsx`;l.setAttribute("download",ye),document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(t),c.success(r("hseExport.success")),k(!1)}catch(s){console.error("Export error:",s),c.error(s.response?.data?.message||r("hseExport.error"))}finally{U(!1)}},X=Array.from({length:52},(s,t)=>t+1),v=B().year,G=[v-2,v-1,v,v+1],$=s=>{const t={draft:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-200",submitted:"bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-200",approved:"bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-200",rejected:"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-200"},p={draft:re,submitted:De,approved:Pe,rejected:Le}[s]||re;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${t[s]||t.draft}`,children:[e.jsx(p,{className:"w-3 h-3"}),r(`kpi.status.${s}`)]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(Y,{className:"w-7 h-7 text-hse-primary"}),r("kpi.management.title")]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:r("kpi.management.subtitle")})]}),e.jsxs("button",{onClick:()=>k(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),r("hseExport.exportButton")]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-7 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:r("kpi.management.searchPlaceholder"),value:N,onChange:s=>ge(s.target.value),className:"input pl-10"})]}),e.jsxs("select",{value:i.week,onChange:s=>g({...i,week:s.target.value}),className:"input",children:[e.jsx("option",{value:"",children:r("common.all")}),X.map(s=>e.jsxs("option",{value:s,children:[r("hseExport.week")," ",s]},s))]}),e.jsxs("select",{value:i.year,onChange:s=>g({...i,year:s.target.value}),className:"input",children:[e.jsx("option",{value:"",children:r("common.all")}),G.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:i.status,onChange:s=>g({...i,status:s.target.value}),className:"input",children:[e.jsx("option",{value:"",children:r("kpi.management.allStatuses")}),e.jsx("option",{value:"submitted",children:r("kpi.management.statusSubmitted")}),e.jsx("option",{value:"approved",children:r("kpi.status.approved")}),e.jsx("option",{value:"rejected",children:r("kpi.status.rejected")})]}),e.jsxs("select",{value:i.pole,onChange:s=>g({...i,pole:s.target.value,project_id:""}),className:"input",children:[e.jsx("option",{value:"",children:r("common.allPoles")}),me.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:i.project_id,onChange:s=>g({...i,project_id:s.target.value}),className:"input",children:[e.jsx("option",{value:"",children:r("common.allProjects")}),(i.pole?A.filter(s=>s?.pole===i.pole):A).map(s=>e.jsx("option",{value:s.id,children:ae(s)},s.id))]}),e.jsxs("button",{onClick:f,className:"btn-secondary flex items-center justify-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),r("common.refresh")]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:ie?e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"hidden md:block space-y-2 animate-pulse",children:Array.from({length:5},(s,t)=>e.jsx("div",{className:"h-10 rounded-md bg-gray-100 dark:bg-gray-800"},t))}),e.jsx("div",{className:"md:hidden space-y-3 animate-pulse",children:Array.from({length:3},(s,t)=>e.jsx("div",{className:"h-24 rounded-lg bg-gray-100 dark:bg-gray-800"},t))})]}):P.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Y,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:r("kpi.noReports")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 px-4 py-4 md:hidden",children:P.map(s=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3 bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:s.project?.name||r("common.unknown")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s.submitter?.name||r("common.unknown")}),e.jsxs("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-300 flex items-center gap-1",children:[e.jsx(Q,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{children:s.week_number?r("dashboard.weekLabel",{week:s.week_number,year:s.report_year}):`${s.report_month}/${s.report_year}`})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:b(s.created_at)})]}),e.jsx("div",{className:"text-right",children:$(s.status)})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2",children:[L(s)&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>D(s.id),disabled:o===s.id,className:"px-2 py-1 text-xs rounded-md bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300",children:o===s.id?e.jsx(j,{className:"w-4 h-4 animate-spin"}):e.jsx("span",{children:r("kpi.approve")})}),e.jsx("button",{onClick:()=>K(s),disabled:o===s.id,className:"px-2 py-1 text-xs rounded-md bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300",children:r("kpi.reject")})]}),e.jsxs("button",{onClick:()=>z(s),className:"px-2 py-1 text-xs rounded-md bg-gray-50 dark:bg-gray-900 text-gray-700 dark:text-gray-200 flex items-center gap-1",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:r("common.view")})]})]})]},s.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:r("common.project")}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:r("kpi.management.submittedBy")}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:r("kpi.management.period")}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:r("kpi.management.date")}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:r("common.status")}),e.jsx("th",{className:"text-right px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:r("common.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:P.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:s.project?.name||r("common.unknown")})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:s.submitter?.name||r("common.unknown")})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:s.week_number?r("dashboard.weekLabel",{week:s.week_number,year:s.report_year}):`${s.report_month}/${s.report_year}`})]})}),e.jsx("td",{className:"px-4 py-4 text-gray-500 dark:text-gray-400 text-sm",children:b(s.created_at)}),e.jsx("td",{className:"px-4 py-4",children:$(s.status)}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[L(s)&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>D(s.id),disabled:o===s.id,className:"p-2 text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/30 rounded-lg transition-colors",title:r("kpi.approve"),children:o===s.id?e.jsx(j,{className:"w-5 h-5 animate-spin"}):e.jsx(ee,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>K(s),disabled:o===s.id,className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors",title:r("kpi.reject"),children:e.jsx(se,{className:"w-5 h-5"})})]}),e.jsx("button",{onClick:()=>z(s),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:r("kpi.management.viewDetails"),children:e.jsx(Z,{className:"w-5 h-5"})})]})})]},s.id))})]})})]})}),e.jsx(I,{isOpen:T,onClose:()=>{h(!1),u(""),m(null)},title:r("kpi.management.rejectTitle"),size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:[r("common.project"),": ",e.jsx("strong",{children:a?.project?.name}),e.jsx("br",{}),r("kpi.management.period"),": ",e.jsx("strong",{children:a?.week_number?r("dashboard.weekLabel",{week:a.week_number,year:a.report_year}):`${a?.report_month}/${a?.report_year}`})]}),e.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-700 rounded-lg p-3",children:e.jsxs("p",{className:"text-amber-800 dark:text-amber-300 text-sm",children:[r("kpi.management.rejectWarningBefore")," ",e.jsx("strong",{children:r("kpi.status.draft")})," ",r("kpi.management.rejectWarningAfter")]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[r("kpi.rejectionReason")," *"]}),e.jsx("textarea",{value:S,onChange:s=>u(s.target.value),className:"input",rows:3,placeholder:r("kpi.management.rejectReasonPlaceholder")})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-3 justify-end pt-2",children:[e.jsx("button",{onClick:()=>{h(!1),u(""),m(null)},className:"btn-secondary w-full sm:w-auto",children:r("common.cancel")}),e.jsx("button",{onClick:je,disabled:o,className:"btn-primary bg-red-600 hover:bg-red-700 w-full sm:w-auto",children:o?e.jsx(j,{className:"w-4 h-4 animate-spin mx-auto"}):r("kpi.reject")})]})]})}),e.jsx(I,{isOpen:!!a&&!T,onClose:()=>{m(null),E([])},title:r("kpi.management.detailsTitle"),size:"lg",children:a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("common.project")}),e.jsx("p",{className:"font-medium dark:text-gray-100",children:a.project?.name??""})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("kpi.management.submittedBy")}),e.jsx("p",{className:"font-medium dark:text-gray-100",children:a.submitter?.name??""})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("kpi.management.period")}),e.jsx("p",{className:"font-medium",children:a.week_number?`${r("dashboard.weekLabel",{week:a.week_number,year:a.report_year})} (${b(a.start_date)} - ${b(a.end_date)})`:`${a.report_month}/${a.report_year}`})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("common.status")}),$(a.status)]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-3",children:r("kpi.management.sections.effectifInduction")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["1. ",r("kpi.weekly.effectif")]}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:a.hours_worked??0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["2. ",r("kpi.weekly.induction")]}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:a.employees_trained??0})]})]})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-amber-900 mb-3",children:r("kpi.management.sections.observationsAwareness")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-amber-200 dark:border-amber-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["3. ",r("kpi.weekly.ecarts")]}),e.jsx("p",{className:"text-lg font-bold text-amber-600",children:a.unsafe_conditions_reported??0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-amber-200 dark:border-amber-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["4. ",r("kpi.weekly.sensibilisation")]}),e.jsx("p",{className:"text-lg font-bold text-amber-600",children:a.toolbox_talks??0})]})]})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-red-900 mb-3",children:r("kpi.management.sections.accidentsIncidents")}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-amber-200 dark:border-amber-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["5. ",r("kpi.weekly.presquAccident")]}),e.jsx("p",{className:"text-lg font-bold text-amber-600",children:a.near_misses??0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-green-200 dark:border-green-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["6. ",r("kpi.weekly.premiersSoins")]}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:a.first_aid_cases??0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-red-300 dark:border-red-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["7. ",r("kpi.weekly.accident")]}),e.jsx("p",{className:"text-lg font-bold text-red-600",children:a.accidents??0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-orange-200 dark:border-orange-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["8. ",r("kpi.weekly.joursArret")]}),e.jsx("p",{className:"text-lg font-bold text-orange-600",children:a.lost_workdays??0})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:r("kpi.management.sections.inspectionsIndicators")}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["9. ",r("kpi.weekly.inspections")]}),e.jsx("p",{className:"text-lg font-bold text-gray-700 dark:text-gray-100",children:a.inspections_completed??0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["10. ",r("kpi.weekly.tauxGravite")]}),e.jsx("p",{className:"text-lg font-bold text-gray-700 dark:text-gray-100",children:a.tg_value??0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["11. ",r("kpi.weekly.tauxFrequence")]}),e.jsx("p",{className:"text-lg font-bold text-gray-700 dark:text-gray-100",children:a.tf_value??0})]})]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-purple-900 mb-3",children:r("kpi.management.sections.trainingPermitsDiscipline")}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-purple-200 dark:border-purple-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["12. ",r("kpi.weekly.heuresFormation")]}),e.jsxs("p",{className:"text-lg font-bold text-purple-600",children:[a.training_hours??0,"h"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-purple-200 dark:border-purple-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["13. ",r("kpi.weekly.permisTravail")]}),e.jsx("p",{className:"text-lg font-bold text-purple-600",children:a.work_permits??0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-purple-200 dark:border-purple-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["14. ",r("kpi.weekly.mesuresDisciplinaires")]}),e.jsx("p",{className:"text-lg font-bold text-purple-600",children:a.corrective_actions??0})]})]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-green-900 mb-3",children:r("kpi.management.sections.complianceMonitoring")}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-green-200 dark:border-green-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["15. ",r("kpi.weekly.conformiteHSE")]}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[a.ppe_compliance_rate??0,"%"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-green-200 dark:border-green-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["16. ",r("kpi.weekly.conformiteMedecine")]}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[a.medical_compliance_rate??0,"%"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-green-200 dark:border-green-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["17. ",r("kpi.weekly.suiviBruit")]}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[a.noise_monitoring??0," dB"]})]})]})]}),e.jsxs("div",{className:"bg-cyan-50 dark:bg-cyan-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-cyan-900 mb-3",children:r("kpi.management.sections.energyConsumption")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-cyan-200 dark:border-cyan-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["18. ",r("kpi.weekly.consoEau")]}),e.jsxs("p",{className:"text-lg font-bold text-cyan-600",children:[a.water_consumption??0," m³"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-cyan-200 dark:border-cyan-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["19. ",r("kpi.weekly.consoElectricite")]}),e.jsxs("p",{className:"text-lg font-bold text-cyan-600",children:[a.electricity_consumption??0," kWh"]})]})]})]}),a.rejection_reason&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-red-800 dark:text-red-200 mb-1",children:r("kpi.management.previouslyRejected")}),e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:a.rejection_reason}),a.rejected_at&&e.jsx("p",{className:"text-red-600 dark:text-red-300 text-xs mt-2",children:r("kpi.management.rejectedOn",{date:b(a.rejected_at)})})]}),a.notes&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:r("kpi.notes")}),e.jsx("p",{className:"bg-gray-50 dark:bg-gray-900 p-3 rounded-lg text-gray-700 dark:text-gray-100",children:a.notes})]}),oe?e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx(j,{className:"w-5 h-5 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500 dark:text-gray-400",children:r("kpi.dailyKpi.loadingDaily")})]}):e.jsx(_e,{dailySnapshots:ce}),L(a)&&e.jsxs("div",{className:"flex gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>D(a.id),disabled:o,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),r("kpi.approve")]}),e.jsxs("button",{onClick:()=>{h(!0)},className:"btn-secondary flex-1 flex items-center justify-center gap-2 text-red-600 dark:text-red-400 border-red-200 dark:border-red-700 hover:bg-red-50 dark:hover:bg-red-900/30",children:[e.jsx(se,{className:"w-4 h-4"}),r("kpi.reject")]})]})]})}),e.jsx(I,{isOpen:xe,onClose:()=>k(!1),title:r("hseExport.title"),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx(J,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:r("hseExport.exportButton")}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:r("hseExport.description")})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("hseExport.selectProject")," *"]}),e.jsxs("select",{value:n.project_id,onChange:s=>R({...n,project_id:s.target.value}),className:"input w-full",children:[e.jsx("option",{value:"",children:r("hseExport.selectProject")}),A.map(s=>e.jsx("option",{value:s.id,children:ae(s)},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("hseExport.week")," *"]}),e.jsx("select",{value:n.week,onChange:s=>R({...n,week:parseInt(s.target.value)}),className:"input w-full",children:X.map(s=>e.jsxs("option",{value:s,children:[r("hseExport.week")," ",s]},s))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("hseExport.year")," *"]}),e.jsx("select",{value:n.year,onChange:s=>R({...n,year:parseInt(s.target.value)}),className:"input w-full",children:G.map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 p-3 rounded-lg",children:[e.jsxs("p",{className:"font-medium mb-1",children:[r("hseExport.sheets.projectInfo"),":"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("span",{children:["• ",r("hseExport.sheets.projectInfo")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.hseReporting")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.incidents")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.deviationsSgtm")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.deviationsSt")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.categories")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.certifications")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.personnel")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.training")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.inspections")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.workPermits")]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{onClick:()=>k(!1),className:"btn-secondary flex-1",disabled:C,children:r("common.cancel")}),e.jsx("button",{onClick:ue,disabled:C||!n.project_id,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:C?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-4 h-4 animate-spin"}),r("hseExport.exporting")]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"w-4 h-4"}),r("hseExport.exportButton")]})})]})]})})]})}export{He as default};
