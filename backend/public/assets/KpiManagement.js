import{a as je,u as ye,k as v,p as K,j as e,f as ue}from"./index.js";import{b as ke,r as d}from"./vendor-react.js";import{M as D}from"./Modal.js";import{D as Ne}from"./DailyKpiPreview.js";import{z as c,f as X,a9 as G,ae as fe,af as ve,a8 as V,v as b,I as Y,B as we,n as _e,a as J,k as Q,am as Ee,X as Se,q as Ce,A as Re,s as Z}from"./vendor-ui.js";import{g as $}from"./weekHelper.js";import{s as Le,g as ee}from"./projectList.js";import"./vendor-utils.js";function Me(){const{t:r,language:se}=je(),{user:re}=ye(),I=ke(),[ae,te]=d.useState([]),[w,de]=d.useState([]),[le,B]=d.useState(!0),[a,x]=d.useState(null),[ne,_]=d.useState([]),[ie,F]=d.useState(!1),[W,p]=d.useState(!1),[E,j]=d.useState(""),[o,y]=d.useState(null),[ce,u]=d.useState(!1),[S,M]=d.useState(!1),[n,C]=d.useState({project_id:"",week:$().week,year:$().year}),[i,m]=d.useState({status:"",project_id:"",pole:"",search:"",week:"",year:""}),[oe,O]=d.useState([]),[k,xe]=d.useState(""),T=re?.project_list_preference??"code",R=d.useMemo(()=>Le(w,T),[w,T]),me=se==="fr"?"fr-FR":"en-US",h=s=>s?new Date(s).toLocaleDateString(me):r("common.unknown"),L=ae.filter(s=>s.status!=="draft");d.useEffect(()=>{const s=new URLSearchParams(I.search),t=s.get("week")??"",l=s.get("year")??"";(t||l)&&m(g=>({...g,week:t||g.week,year:l||g.year}))},[I.search]),d.useEffect(()=>{const s=setTimeout(()=>{m(t=>t.search===k?t:{...t,search:k})},300);return()=>clearTimeout(s)},[k]),d.useEffect(()=>{N()},[i]),d.useEffect(()=>{(async()=>{try{const t=await K.getPoles(),l=t.data?.data?.poles??t.data?.poles??[];O(Array.isArray(l)?l:[])}catch{O([])}})()},[]);const N=async()=>{try{B(!0);const[s,t]=await Promise.all([v.getAll(i),K.getAllList({status:"active"})]),l=s.data.data||s.data||[];te(Array.isArray(l)?l:[]),de(Array.isArray(t)?t:[])}catch(s){console.error("Error loading KPI data:",s),c.error(r("errors.somethingWentWrong"))}finally{B(!1)}},P=async s=>{try{y(s),await v.approve(s),c.success(r("kpi.reportApproved")),N()}catch(t){console.error("Error approving report:",t),c.error(r("errors.somethingWentWrong"))}finally{y(null)}},ge=async()=>{if(!a||!E.trim()){c.error(r("kpi.management.rejectReasonRequired"));return}try{y(a.id),await v.reject(a.id,E),c.success(r("kpi.reportRejected")),p(!1),j(""),x(null),N()}catch(s){console.error("Error rejecting report:",s),c.error(r("errors.somethingWentWrong"))}finally{y(null)}},U=async s=>{F(!0),x(s),_([]);try{const l=(await v.getById(s.id)).data.data;x(l.report??l),_(l.daily_snapshots??[])}catch(t){console.error("Failed to load report details:",t),c.error(r("kpi.management.loadDetailsFailed")??r("errors.failedToLoad"))}finally{F(!1)}},q=s=>{x(s),p(!0)},pe=async()=>{if(!n.project_id){c.error(r("hseExport.noProject"));return}if(!n.week||!n.year){c.error(r("hseExport.noWeek"));return}try{M(!0);const s=await ue.exportHseWeekly({project_id:n.project_id,week:n.week,year:n.year}),t=window.URL.createObjectURL(new Blob([s.data])),l=document.createElement("a");l.href=t;const he=`HSE_Report_${w.find(be=>be.id==n.project_id)?.code||"project"}_S${String(n.week).padStart(2,"0")}_${n.year}.xlsx`;l.setAttribute("download",he),document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(t),c.success(r("hseExport.success")),u(!1)}catch(s){console.error("Export error:",s),c.error(s.response?.data?.message||r("hseExport.error"))}finally{M(!1)}},z=Array.from({length:52},(s,t)=>t+1),f=$().year,H=[f-2,f-1,f,f+1],A=s=>{const t={draft:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-200",submitted:"bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-200",approved:"bg-green-100 text-green-700 dark:bg-green-900/40 dark:text-green-200",rejected:"bg-red-100 text-red-700 dark:bg-red-900/40 dark:text-red-200"},g={draft:Z,submitted:Re,approved:Ce,rejected:Se}[s]||Z;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${t[s]||t.draft}`,children:[e.jsx(g,{className:"w-3 h-3"}),r(`kpi.status.${s}`)]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx(X,{className:"w-7 h-7 text-hse-primary"}),r("kpi.management.title")]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:r("kpi.management.subtitle")})]}),e.jsxs("button",{onClick:()=>u(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),r("hseExport.exportButton")]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-7 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:r("kpi.management.searchPlaceholder"),value:k,onChange:s=>xe(s.target.value),className:"input pl-10"})]}),e.jsxs("select",{value:i.week,onChange:s=>m({...i,week:s.target.value}),className:"input",children:[e.jsx("option",{value:"",children:r("common.all")}),z.map(s=>e.jsxs("option",{value:s,children:[r("hseExport.week")," ",s]},s))]}),e.jsxs("select",{value:i.year,onChange:s=>m({...i,year:s.target.value}),className:"input",children:[e.jsx("option",{value:"",children:r("common.all")}),H.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:i.status,onChange:s=>m({...i,status:s.target.value}),className:"input",children:[e.jsx("option",{value:"",children:r("kpi.management.allStatuses")}),e.jsx("option",{value:"submitted",children:r("kpi.management.statusSubmitted")}),e.jsx("option",{value:"approved",children:r("kpi.status.approved")}),e.jsx("option",{value:"rejected",children:r("kpi.status.rejected")})]}),e.jsxs("select",{value:i.pole,onChange:s=>m({...i,pole:s.target.value,project_id:""}),className:"input",children:[e.jsx("option",{value:"",children:r("common.allPoles")}),oe.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:i.project_id,onChange:s=>m({...i,project_id:s.target.value}),className:"input",children:[e.jsx("option",{value:"",children:r("common.allProjects")}),(i.pole?R.filter(s=>s?.pole===i.pole):R).map(s=>e.jsx("option",{value:s.id,children:ee(s)},s.id))]}),e.jsxs("button",{onClick:N,className:"btn-secondary flex items-center justify-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"}),r("common.refresh")]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:le?e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"hidden md:block space-y-2 animate-pulse",children:Array.from({length:5},(s,t)=>e.jsx("div",{className:"h-10 rounded-md bg-gray-100 dark:bg-gray-800"},t))}),e.jsx("div",{className:"md:hidden space-y-3 animate-pulse",children:Array.from({length:3},(s,t)=>e.jsx("div",{className:"h-24 rounded-lg bg-gray-100 dark:bg-gray-800"},t))})]}):L.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(X,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:r("kpi.noReports")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 px-4 py-4 md:hidden",children:L.map(s=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3 bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:s.project?.name||r("common.unknown")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s.submitter?.name||r("common.unknown")}),e.jsxs("p",{className:"mt-1 text-xs text-gray-600 dark:text-gray-300 flex items-center gap-1",children:[e.jsx(V,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{children:s.week_number?r("dashboard.weekLabel",{week:s.week_number,year:s.report_year}):`${s.report_month}/${s.report_year}`})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:h(s.created_at)})]}),e.jsx("div",{className:"text-right",children:A(s.status)})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2",children:[s.status==="submitted"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>P(s.id),disabled:o===s.id,className:"px-2 py-1 text-xs rounded-md bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-300",children:o===s.id?e.jsx(b,{className:"w-4 h-4 animate-spin"}):e.jsx("span",{children:r("kpi.approve")})}),e.jsx("button",{onClick:()=>q(s),disabled:o===s.id,className:"px-2 py-1 text-xs rounded-md bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300",children:r("kpi.reject")})]}),e.jsxs("button",{onClick:()=>U(s),className:"px-2 py-1 text-xs rounded-md bg-gray-50 dark:bg-gray-900 text-gray-700 dark:text-gray-200 flex items-center gap-1",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{children:r("common.view")})]})]})]},s.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:r("common.project")}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:r("kpi.management.submittedBy")}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:r("kpi.management.period")}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:r("kpi.management.date")}),e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:r("common.status")}),e.jsx("th",{className:"text-right px-4 py-3 text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:r("common.actions")})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:L.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:s.project?.name||r("common.unknown")})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:s.submitter?.name||r("common.unknown")})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:s.week_number?r("dashboard.weekLabel",{week:s.week_number,year:s.report_year}):`${s.report_month}/${s.report_year}`})]})}),e.jsx("td",{className:"px-4 py-4 text-gray-500 dark:text-gray-400 text-sm",children:h(s.created_at)}),e.jsx("td",{className:"px-4 py-4",children:A(s.status)}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.status==="submitted"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>P(s.id),disabled:o===s.id,className:"p-2 text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/30 rounded-lg transition-colors",title:r("kpi.approve"),children:o===s.id?e.jsx(b,{className:"w-5 h-5 animate-spin"}):e.jsx(J,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>q(s),disabled:o===s.id,className:"p-2 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors",title:r("kpi.reject"),children:e.jsx(Q,{className:"w-5 h-5"})})]}),e.jsx("button",{onClick:()=>U(s),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:r("kpi.management.viewDetails"),children:e.jsx(Y,{className:"w-5 h-5"})})]})})]},s.id))})]})})]})}),e.jsx(D,{isOpen:W,onClose:()=>{p(!1),j(""),x(null)},title:r("kpi.management.rejectTitle"),size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:[r("common.project"),": ",e.jsx("strong",{children:a?.project?.name}),e.jsx("br",{}),r("kpi.management.period"),": ",e.jsx("strong",{children:a?.week_number?r("dashboard.weekLabel",{week:a.week_number,year:a.report_year}):`${a?.report_month}/${a?.report_year}`})]}),e.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-700 rounded-lg p-3",children:e.jsxs("p",{className:"text-amber-800 dark:text-amber-300 text-sm",children:[r("kpi.management.rejectWarningBefore")," ",e.jsx("strong",{children:r("kpi.status.draft")})," ",r("kpi.management.rejectWarningAfter")]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[r("kpi.rejectionReason")," *"]}),e.jsx("textarea",{value:E,onChange:s=>j(s.target.value),className:"input",rows:3,placeholder:r("kpi.management.rejectReasonPlaceholder")})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-3 justify-end pt-2",children:[e.jsx("button",{onClick:()=>{p(!1),j(""),x(null)},className:"btn-secondary w-full sm:w-auto",children:r("common.cancel")}),e.jsx("button",{onClick:ge,disabled:o,className:"btn-primary bg-red-600 hover:bg-red-700 w-full sm:w-auto",children:o?e.jsx(b,{className:"w-4 h-4 animate-spin mx-auto"}):r("kpi.reject")})]})]})}),e.jsx(D,{isOpen:!!a&&!W,onClose:()=>{x(null),_([])},title:r("kpi.management.detailsTitle"),size:"lg",children:a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("common.project")}),e.jsx("p",{className:"font-medium dark:text-gray-100",children:a.project?.name??""})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("kpi.management.submittedBy")}),e.jsx("p",{className:"font-medium dark:text-gray-100",children:a.submitter?.name??""})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("kpi.management.period")}),e.jsx("p",{className:"font-medium",children:a.week_number?`${r("dashboard.weekLabel",{week:a.week_number,year:a.report_year})} (${h(a.start_date)} - ${h(a.end_date)})`:`${a.report_month}/${a.report_year}`})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r("common.status")}),A(a.status)]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-blue-900 mb-3",children:r("kpi.management.sections.effectifInduction")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["1. ",r("kpi.weekly.effectif")]}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:a.hours_worked??0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["2. ",r("kpi.weekly.induction")]}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:a.employees_trained??0})]})]})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-amber-900 mb-3",children:r("kpi.management.sections.observationsAwareness")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-amber-200 dark:border-amber-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["3. ",r("kpi.weekly.ecarts")]}),e.jsx("p",{className:"text-lg font-bold text-amber-600",children:a.unsafe_conditions_reported??0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-amber-200 dark:border-amber-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["4. ",r("kpi.weekly.sensibilisation")]}),e.jsx("p",{className:"text-lg font-bold text-amber-600",children:a.toolbox_talks??0})]})]})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-red-900 mb-3",children:r("kpi.management.sections.accidentsIncidents")}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-amber-200 dark:border-amber-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["5. ",r("kpi.weekly.presquAccident")]}),e.jsx("p",{className:"text-lg font-bold text-amber-600",children:a.near_misses??0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-green-200 dark:border-green-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["6. ",r("kpi.weekly.premiersSoins")]}),e.jsx("p",{className:"text-lg font-bold text-green-600",children:a.first_aid_cases??0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-red-300 dark:border-red-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["7. ",r("kpi.weekly.accident")]}),e.jsx("p",{className:"text-lg font-bold text-red-600",children:a.accidents??0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-orange-200 dark:border-orange-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["8. ",r("kpi.weekly.joursArret")]}),e.jsx("p",{className:"text-lg font-bold text-orange-600",children:a.lost_workdays??0})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3",children:r("kpi.management.sections.inspectionsIndicators")}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["9. ",r("kpi.weekly.inspections")]}),e.jsx("p",{className:"text-lg font-bold text-gray-700 dark:text-gray-100",children:a.inspections_completed??0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["10. ",r("kpi.weekly.tauxGravite")]}),e.jsx("p",{className:"text-lg font-bold text-gray-700 dark:text-gray-100",children:a.tg_value??0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border dark:border-gray-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["11. ",r("kpi.weekly.tauxFrequence")]}),e.jsx("p",{className:"text-lg font-bold text-gray-700 dark:text-gray-100",children:a.tf_value??0})]})]})]}),e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-purple-900 mb-3",children:r("kpi.management.sections.trainingPermitsDiscipline")}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-purple-200 dark:border-purple-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["12. ",r("kpi.weekly.heuresFormation")]}),e.jsxs("p",{className:"text-lg font-bold text-purple-600",children:[a.training_hours??0,"h"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-purple-200 dark:border-purple-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["13. ",r("kpi.weekly.permisTravail")]}),e.jsx("p",{className:"text-lg font-bold text-purple-600",children:a.work_permits??0})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-purple-200 dark:border-purple-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["14. ",r("kpi.weekly.mesuresDisciplinaires")]}),e.jsx("p",{className:"text-lg font-bold text-purple-600",children:a.corrective_actions??0})]})]})]}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-green-900 mb-3",children:r("kpi.management.sections.complianceMonitoring")}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-green-200 dark:border-green-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["15. ",r("kpi.weekly.conformiteHSE")]}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[a.ppe_compliance_rate??0,"%"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-green-200 dark:border-green-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["16. ",r("kpi.weekly.conformiteMedecine")]}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[a.medical_compliance_rate??0,"%"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-green-200 dark:border-green-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["17. ",r("kpi.weekly.suiviBruit")]}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[a.noise_monitoring??0," dB"]})]})]})]}),e.jsxs("div",{className:"bg-cyan-50 dark:bg-cyan-900/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-cyan-900 mb-3",children:r("kpi.management.sections.energyConsumption")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-cyan-200 dark:border-cyan-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["18. ",r("kpi.weekly.consoEau")]}),e.jsxs("p",{className:"text-lg font-bold text-cyan-600",children:[a.water_consumption??0," m³"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-900 p-3 rounded-lg border border-cyan-200 dark:border-cyan-700",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["19. ",r("kpi.weekly.consoElectricite")]}),e.jsxs("p",{className:"text-lg font-bold text-cyan-600",children:[a.electricity_consumption??0," kWh"]})]})]})]}),a.rejection_reason&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-red-800 dark:text-red-200 mb-1",children:r("kpi.management.previouslyRejected")}),e.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm",children:a.rejection_reason}),a.rejected_at&&e.jsx("p",{className:"text-red-600 dark:text-red-300 text-xs mt-2",children:r("kpi.management.rejectedOn",{date:h(a.rejected_at)})})]}),a.notes&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:r("kpi.notes")}),e.jsx("p",{className:"bg-gray-50 dark:bg-gray-900 p-3 rounded-lg text-gray-700 dark:text-gray-100",children:a.notes})]}),ie?e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx(b,{className:"w-5 h-5 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500 dark:text-gray-400",children:r("kpi.dailyKpi.loadingDaily")})]}):e.jsx(Ne,{dailySnapshots:ne}),a.status==="submitted"&&e.jsxs("div",{className:"flex gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsxs("button",{onClick:()=>P(a.id),disabled:o,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),r("kpi.approve")]}),e.jsxs("button",{onClick:()=>{p(!0)},className:"btn-secondary flex-1 flex items-center justify-center gap-2 text-red-600 dark:text-red-400 border-red-200 dark:border-red-700 hover:bg-red-50 dark:hover:bg-red-900/30",children:[e.jsx(Q,{className:"w-4 h-4"}),r("kpi.reject")]})]})]})}),e.jsx(D,{isOpen:ce,onClose:()=>u(!1),title:r("hseExport.title"),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[e.jsx(G,{className:"w-8 h-8 text-blue-600 dark:text-blue-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900 dark:text-blue-100",children:r("hseExport.exportButton")}),e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:r("hseExport.description")})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("hseExport.selectProject")," *"]}),e.jsxs("select",{value:n.project_id,onChange:s=>C({...n,project_id:s.target.value}),className:"input w-full",children:[e.jsx("option",{value:"",children:r("hseExport.selectProject")}),R.map(s=>e.jsx("option",{value:s.id,children:ee(s)},s.id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("hseExport.week")," *"]}),e.jsx("select",{value:n.week,onChange:s=>C({...n,week:parseInt(s.target.value)}),className:"input w-full",children:z.map(s=>e.jsxs("option",{value:s,children:[r("hseExport.week")," ",s]},s))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:[r("hseExport.year")," *"]}),e.jsx("select",{value:n.year,onChange:s=>C({...n,year:parseInt(s.target.value)}),className:"input w-full",children:H.map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 p-3 rounded-lg",children:[e.jsxs("p",{className:"font-medium mb-1",children:[r("hseExport.sheets.projectInfo"),":"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("span",{children:["• ",r("hseExport.sheets.projectInfo")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.hseReporting")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.incidents")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.deviationsSgtm")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.deviationsSt")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.categories")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.certifications")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.personnel")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.training")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.inspections")]}),e.jsxs("span",{children:["• ",r("hseExport.sheets.workPermits")]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t dark:border-gray-700",children:[e.jsx("button",{onClick:()=>u(!1),className:"btn-secondary flex-1",disabled:S,children:r("common.cancel")}),e.jsx("button",{onClick:pe,disabled:S||!n.project_id,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:S?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-4 h-4 animate-spin"}),r("hseExport.exporting")]}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"w-4 h-4"}),r("hseExport.exportButton")]})})]})]})})]})}export{Me as default};
