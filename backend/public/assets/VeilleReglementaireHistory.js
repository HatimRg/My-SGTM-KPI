import{a as _,u as $,j as e,p as A,E as C}from"./index.js";import{u as E,b as T,r as s}from"./vendor-react.js";import{S as D}from"./Select.js";import{h as H,P as I,v as R,I as z,aL as F,z as w}from"./vendor-ui.js";import{s as M,g as k}from"./projectList.js";import"./vendor-utils.js";const O=t=>{if(!t)return"-";const l=new Date(t);return Number.isNaN(l.getTime())?String(t):l.toLocaleString()},B=t=>t.startsWith("/admin/regulatory-watch")?"/admin/regulatory-watch":t.startsWith("/supervisor/regulatory-watch")?"/supervisor/regulatory-watch":"/regulatory-watch";function X(){const{t}=_(),{user:l}=$(),i=E(),d=T(),c=s.useMemo(()=>B(d.pathname),[d.pathname]),[m,g]=s.useState([]),[x,u]=s.useState(!0),[n,S]=s.useState(""),y=l?.project_list_preference??"code",P=s.useMemo(()=>M(m,y),[m,y]),[W,h]=s.useState(!0),[j,b]=s.useState(null),[p,v]=s.useState([]);s.useEffect(()=>{(async()=>{try{u(!0);const r=await A.getAllList({status:"active"});g(Array.isArray(r)?r:[])}catch(r){g([]),w.error(r.response?.data?.message??t("errors.somethingWentWrong"))}finally{u(!1)}})()},[]),s.useEffect(()=>{(async()=>{try{h(!0);const r={per_page:50};n&&(r.project_id=Number(n));const o=(await C.getAll(r)).data?.data??null;b(o?.avg_overall_score??null);const N=o?.submissions?.data??[];v(Array.isArray(N)?N:[])}catch(r){b(null),v([]),w.error(r.response?.data?.message??t("errors.somethingWentWrong"))}finally{h(!1)}})()},[n]);const L=j===null?"-":`${j}%`;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 flex-col sm:flex-row",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-hse-primary/10 rounded-lg",children:e.jsx(H,{className:"w-5 h-5 text-hse-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:t("regulatoryWatch.title")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("regulatoryWatch.historySubtitle")})]})]}),e.jsxs("button",{type:"button",onClick:()=>i(`${c}/new/1`),className:"btn-primary flex items-center justify-center gap-2 w-full sm:w-auto",children:[e.jsx(I,{className:"w-4 h-4"}),t("regulatoryWatch.newSubmission")]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:t("regulatoryWatch.selectProject")}),e.jsxs(D,{value:n,onChange:a=>S(a.target.value),disabled:x,children:[e.jsx("option",{value:"",children:t(x?"common.loading":"common.allProjects")}),P.map(a=>e.jsx("option",{value:String(a.id),children:k(a)},a.id))]})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsxs("div",{className:"p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:t("regulatoryWatch.avgScore")}),e.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:L})]})})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:t("regulatoryWatch.historyTitle")})}),W?e.jsxs("div",{className:"p-6 flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(R,{className:"w-4 h-4 animate-spin"}),t("common.loading")]}):p.length===0?e.jsx("div",{className:"p-6 text-sm text-gray-500 dark:text-gray-400",children:t("regulatoryWatch.noSubmissions")}):e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:p.map(a=>{const r=a?.overall_score,f=r==null?"-":`${Number(r).toFixed(2)}%`,o=a?.week_year&&a?.week_number?`${t("dashboard.weekPrefix")} ${a.week_number} - ${a.week_year}`:null;return e.jsxs("div",{className:"p-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3 hover:bg-gray-50 dark:hover:bg-gray-900/40",children:[e.jsxs("button",{type:"button",className:"text-left flex-1",onClick:()=>i(`${c}/${a.id}`),children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:k(a.project)||a.project?.name||a.project?.code||t("common.unknown")}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[t("regulatoryWatch.submittedAt"),": ",O(a.submitted_at)]}),o&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:o})]}),e.jsxs("div",{className:"flex items-center justify-between md:justify-end gap-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:f}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",className:"btn-secondary flex items-center gap-2",onClick:()=>i(`${c}/${a.id}`),children:[e.jsx(z,{className:"w-4 h-4"}),t("regulatoryWatch.viewDetails")]}),e.jsxs("button",{type:"button",className:"btn-secondary flex items-center gap-2",onClick:()=>i(`${c}/${a.id}/resubmit`),children:[e.jsx(F,{className:"w-4 h-4"}),t("regulatoryWatch.resubmit")]})]})]})]},a.id)})})]})]})}export{X as default};
