import{a as D,u as E,j as e,p as T,G as F}from"./index.js";import{u as H,b as M,r as s}from"./vendor-react.js";import{S as O}from"./Select.js";import{h as R,P as z,v as J,I as B,aL as G,z as P}from"./vendor-ui.js";import{s as K,g as W}from"./projectList.js";import"./vendor-utils.js";const V=t=>{try{return JSON.parse(t)}catch{return null}},q=t=>{if(!t)return"-";const o=new Date(t);return Number.isNaN(o.getTime())?String(t):o.toLocaleString()},Q=t=>t.startsWith("/admin/regulatory-watch")?"/admin/regulatory-watch":t.startsWith("/supervisor/regulatory-watch")?"/supervisor/regulatory-watch":"/regulatory-watch";function ae(){const{t}=D(),{user:o}=E(),n=H(),u=M(),l=s.useMemo(()=>Q(u.pathname),[u.pathname]),[x,y]=s.useState([]),[h,b]=s.useState(!0),[i,$]=s.useState(""),j=o?.project_list_preference??"code",_=s.useMemo(()=>K(x,j),[x,j]),[L,p]=s.useState(!0),[f,v]=s.useState(null),[N,w]=s.useState([]),m=s.useMemo(()=>`regulatory_watch_draft:new:${o?.id?String(o.id):"anonymous"}:new`,[o?.id]),[g,d]=s.useState(null);s.useEffect(()=>{if(!(typeof window>"u"))try{const r=window.localStorage.getItem(m);if(!r){d(null);return}const a=V(r);d(a&&typeof a=="object"?a:null)}catch{d(null)}},[m]);const C=()=>{const r=Number.parseInt(String(g?.page??"1"),10),a=Number.isFinite(r)&&r>=1?r:1;n(`${l}/new/${a}`)},A=()=>{try{window.localStorage.removeItem(m)}catch{}d(null)};s.useEffect(()=>{(async()=>{try{b(!0);const a=await T.getAllList({status:"active"});y(Array.isArray(a)?a:[])}catch(a){y([]),P.error(a.response?.data?.message??t("errors.somethingWentWrong"))}finally{b(!1)}})()},[]),s.useEffect(()=>{(async()=>{try{p(!0);const a={per_page:50};i&&(a.project_id=Number(i));const c=(await F.getAll(a)).data?.data??null;v(c?.avg_overall_score??null);const S=c?.submissions?.data??[];w(Array.isArray(S)?S:[])}catch(a){v(null),w([]),P.error(a.response?.data?.message??t("errors.somethingWentWrong"))}finally{p(!1)}})()},[i]);const I=f===null?"-":`${f}%`;return e.jsxs("div",{className:"space-y-6",children:[g?.answers?e.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/10 rounded-xl border border-amber-200 dark:border-amber-900/30 p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:t("regulatoryWatch.draftSaved")}),e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-300 mt-1",children:[t("common.page")," ",g?.page??1]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:A,children:t("common.delete")}),e.jsx("button",{type:"button",className:"btn-primary",onClick:C,children:t("common.continue")})]})]})}):null,e.jsxs("div",{className:"flex items-start justify-between gap-4 flex-col sm:flex-row",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-hse-primary/10 rounded-lg",children:e.jsx(R,{className:"w-5 h-5 text-hse-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:t("regulatoryWatch.title")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("regulatoryWatch.historySubtitle")})]})]}),e.jsxs("button",{type:"button",onClick:()=>n(`${l}/new/1`),className:"btn-primary flex items-center justify-center gap-2 w-full sm:w-auto",children:[e.jsx(z,{className:"w-4 h-4"}),t("regulatoryWatch.newSubmission")]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:t("regulatoryWatch.selectProject")}),e.jsxs(O,{value:i,onChange:r=>$(r.target.value),disabled:h,children:[e.jsx("option",{value:"",children:t(h?"common.loading":"common.allProjects")}),_.map(r=>e.jsx("option",{value:String(r.id),children:W(r)},r.id))]})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsxs("div",{className:"p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:t("regulatoryWatch.avgScore")}),e.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:I})]})})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:t("regulatoryWatch.historyTitle")})}),L?e.jsxs("div",{className:"p-6 flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(J,{className:"w-4 h-4 animate-spin"}),t("common.loading")]}):N.length===0?e.jsx("div",{className:"p-6 text-sm text-gray-500 dark:text-gray-400",children:t("regulatoryWatch.noSubmissions")}):e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:N.map(r=>{const a=r?.overall_score,k=a==null?"-":`${Number(a).toFixed(2)}%`,c=r?.week_year&&r?.week_number?`${t("dashboard.weekPrefix")} ${r.week_number} - ${r.week_year}`:null;return e.jsxs("div",{className:"p-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3 hover:bg-gray-50 dark:hover:bg-gray-900/40",children:[e.jsxs("button",{type:"button",className:"text-left flex-1",onClick:()=>n(`${l}/${r.id}`),children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:W(r.project)||r.project?.name||r.project?.code||t("common.unknown")}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[t("regulatoryWatch.submittedAt"),": ",q(r.submitted_at)]}),c&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:c})]}),e.jsxs("div",{className:"flex items-center justify-between md:justify-end gap-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:k}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",className:"btn-secondary flex items-center gap-2",onClick:()=>n(`${l}/${r.id}`),children:[e.jsx(B,{className:"w-4 h-4"}),t("regulatoryWatch.viewDetails")]}),e.jsxs("button",{type:"button",className:"btn-secondary flex items-center gap-2",onClick:()=>n(`${l}/${r.id}/resubmit`),children:[e.jsx(G,{className:"w-4 h-4"}),t("regulatoryWatch.resubmit")]})]})]})]},r.id)})})]})]})}export{ae as default};
