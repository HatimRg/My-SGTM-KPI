import{a as S,j as e,p as W,C as P}from"./index.js";import{u as $,b as L,r}from"./vendor-react.js";import{S as _}from"./Select.js";import{h as A,P as C,v as E,I as T,aL as D,z as v}from"./vendor-ui.js";import"./vendor-utils.js";const H=t=>{if(!t)return"-";const l=new Date(t);return Number.isNaN(l.getTime())?String(t):l.toLocaleString()},I=t=>t.startsWith("/admin/regulatory-watch")?"/admin/regulatory-watch":t.startsWith("/supervisor/regulatory-watch")?"/supervisor/regulatory-watch":"/regulatory-watch";function V(){const{t}=S(),l=$(),c=L(),i=r.useMemo(()=>I(c.pathname),[c.pathname]),[f,d]=r.useState([]),[m,g]=r.useState(!0),[n,N]=r.useState(""),[w,x]=r.useState(!0),[u,y]=r.useState(null),[h,b]=r.useState([]);r.useEffect(()=>{(async()=>{try{g(!0);const s=await W.getAllList({status:"active"});d(Array.isArray(s)?s:[])}catch(s){d([]),v.error(s.response?.data?.message??t("errors.somethingWentWrong"))}finally{g(!1)}})()},[]),r.useEffect(()=>{(async()=>{try{x(!0);const s={per_page:50};n&&(s.project_id=Number(n));const o=(await P.getAll(s)).data?.data??null;y(o?.avg_overall_score??null);const p=o?.submissions?.data??[];b(Array.isArray(p)?p:[])}catch(s){y(null),b([]),v.error(s.response?.data?.message??t("errors.somethingWentWrong"))}finally{x(!1)}})()},[n]);const k=u===null?"-":`${u}%`;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 flex-col sm:flex-row",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-hse-primary/10 rounded-lg",children:e.jsx(A,{className:"w-5 h-5 text-hse-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:t("regulatoryWatch.title")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("regulatoryWatch.historySubtitle")})]})]}),e.jsxs("button",{type:"button",onClick:()=>l(`${i}/new`),className:"btn-primary flex items-center justify-center gap-2 w-full sm:w-auto",children:[e.jsx(C,{className:"w-4 h-4"}),t("regulatoryWatch.newSubmission")]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:t("regulatoryWatch.selectProject")}),e.jsxs(_,{value:n,onChange:a=>N(a.target.value),disabled:m,children:[e.jsx("option",{value:"",children:t(m?"common.loading":"common.allProjects")}),f.map(a=>e.jsx("option",{value:String(a.id),children:a.name},a.id))]})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsxs("div",{className:"p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:t("regulatoryWatch.avgScore")}),e.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:k})]})})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:t("regulatoryWatch.historyTitle")})}),w?e.jsxs("div",{className:"p-6 flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(E,{className:"w-4 h-4 animate-spin"}),t("common.loading")]}):h.length===0?e.jsx("div",{className:"p-6 text-sm text-gray-500 dark:text-gray-400",children:t("regulatoryWatch.noSubmissions")}):e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:h.map(a=>{const s=a?.overall_score,j=s==null?"-":`${Number(s).toFixed(2)}%`,o=a?.week_year&&a?.week_number?`${t("dashboard.weekPrefix")} ${a.week_number} - ${a.week_year}`:null;return e.jsxs("div",{className:"p-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3 hover:bg-gray-50 dark:hover:bg-gray-900/40",children:[e.jsxs("button",{type:"button",className:"text-left flex-1",onClick:()=>l(`${i}/${a.id}`),children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:a.project?.name??t("common.unknown")}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[t("regulatoryWatch.submittedAt"),": ",H(a.submitted_at)]}),o&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:o})]}),e.jsxs("div",{className:"flex items-center justify-between md:justify-end gap-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:j}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",className:"btn-secondary flex items-center gap-2",onClick:()=>l(`${i}/${a.id}`),children:[e.jsx(T,{className:"w-4 h-4"}),t("regulatoryWatch.viewDetails")]}),e.jsxs("button",{type:"button",className:"btn-secondary flex items-center gap-2",onClick:()=>l(`${i}/${a.id}/resubmit`),children:[e.jsx(D,{className:"w-4 h-4"}),t("regulatoryWatch.resubmit")]})]})]})]},a.id)})})]})]})}export{V as default};
