import{a as M,u as R,j as e,g as z,H as j}from"./index.js";import{u as J,b as B,r as s}from"./vendor-react.js";import{S as K}from"./Select.js";import{C as V}from"./ConfirmDialog.js";import{e as q,P as G,v as Q,I as U,aN as X,al as Y,z as g}from"./vendor-ui.js";import{s as Z,g as $}from"./projectList.js";import"./vendor-utils.js";import"./Modal.js";const ee=t=>{try{return JSON.parse(t)}catch{return null}},te=t=>{if(!t)return"-";const o=new Date(t);return Number.isNaN(o.getTime())?String(t):o.toLocaleString()},ae=t=>t.startsWith("/admin/regulatory-watch")?"/admin/regulatory-watch":t.startsWith("/supervisor/regulatory-watch")?"/supervisor/regulatory-watch":"/regulatory-watch";function me(){const{t}=M(),{user:o}=R(),c=J(),v=B(),i=s.useMemo(()=>ae(v.pathname),[v.pathname]),[w,N]=s.useState([]),[k,S]=s.useState(!0),[n,L]=s.useState(""),W=o?.project_list_preference??"code",A=s.useMemo(()=>Z(w,W),[w,W]),[I,P]=s.useState(!0),[C,u]=s.useState(null),[_,x]=s.useState([]),[y,h]=s.useState(null),b=s.useMemo(()=>`regulatory_watch_draft:new:${o?.id?String(o.id):"anonymous"}:new`,[o?.id]),[p,m]=s.useState(null);s.useEffect(()=>{if(!(typeof window>"u"))try{const a=window.localStorage.getItem(b);if(!a){m(null);return}const r=ee(a);m(r&&typeof r=="object"?r:null)}catch{m(null)}},[b]);const E=()=>{const a=Number.parseInt(String(p?.page??"1"),10),r=Number.isFinite(a)&&a>=1?a:1;c(`${i}/new/${r}`)},T=()=>{try{window.localStorage.removeItem(b)}catch{}m(null)};s.useEffect(()=>{(async()=>{try{S(!0);const r=await z.getAllList({status:"active"});N(Array.isArray(r)?r:[])}catch(r){N([]),g.error(r.response?.data?.message??t("errors.somethingWentWrong"))}finally{S(!1)}})()},[]),s.useEffect(()=>{(async()=>{try{P(!0);const r={per_page:50};n&&(r.project_id=Number(n));const l=(await j.getAll(r)).data?.data??null;u(l?.avg_overall_score??null);const D=l?.submissions?.data??[];x(Array.isArray(D)?D:[])}catch(r){u(null),x([]),g.error(r.response?.data?.message??t("errors.somethingWentWrong"))}finally{P(!1)}})()},[n]);const H=a=>{h(a)},O=async()=>{if(y?.id)try{await j.delete(y.id),g.success(t("common.deleted")??"Deleted");const a={per_page:50};n&&(a.project_id=Number(n));const d=(await j.getAll(a)).data?.data??null;u(d?.avg_overall_score??null);const f=d?.submissions?.data??[];x(Array.isArray(f)?f:[])}catch(a){g.error(a.response?.data?.message??t("errors.somethingWentWrong"))}finally{h(null)}},F=C===null?"-":`${C}%`;return e.jsxs("div",{className:"space-y-6",children:[p?.answers?e.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/10 rounded-xl border border-amber-200 dark:border-amber-900/30 p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:t("regulatoryWatch.draftSaved")}),e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-300 mt-1",children:[t("common.page")," ",p?.page??1]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"btn-secondary",onClick:T,children:t("common.delete")}),e.jsx("button",{type:"button",className:"btn-primary",onClick:E,children:t("common.continue")})]})]})}):null,e.jsxs("div",{className:"flex items-start justify-between gap-4 flex-col sm:flex-row",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-hse-primary/10 rounded-lg",children:e.jsx(q,{className:"w-5 h-5 text-hse-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:t("regulatoryWatch.title")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("regulatoryWatch.historySubtitle")})]})]}),e.jsxs("button",{type:"button",onClick:()=>c(`${i}/new/1`),className:"btn-primary flex items-center justify-center gap-2 w-full sm:w-auto",children:[e.jsx(G,{className:"w-4 h-4"}),t("regulatoryWatch.newSubmission")]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:t("regulatoryWatch.selectProject")}),e.jsxs(K,{value:n,onChange:a=>L(a.target.value),disabled:k,children:[e.jsx("option",{value:"",children:t(k?"common.loading":"common.allProjects")}),A.map(a=>e.jsx("option",{value:String(a.id),children:$(a)},a.id))]})]}),e.jsx("div",{className:"md:col-span-1",children:e.jsxs("div",{className:"p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:t("regulatoryWatch.avgScore")}),e.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:F})]})})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:t("regulatoryWatch.historyTitle")})}),I?e.jsxs("div",{className:"p-6 flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(Q,{className:"w-4 h-4 animate-spin"}),t("common.loading")]}):_.length===0?e.jsx("div",{className:"p-6 text-sm text-gray-500 dark:text-gray-400",children:t("regulatoryWatch.noSubmissions")}):e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:_.map(a=>{const r=a?.overall_score,d=r==null?"-":`${Number(r).toFixed(2)}%`,l=a?.week_year&&a?.week_number?`${t("dashboard.weekPrefix")} ${a.week_number} - ${a.week_year}`:null;return e.jsxs("div",{className:"p-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3 hover:bg-gray-50 dark:hover:bg-gray-900/40",children:[e.jsxs("button",{type:"button",className:"text-left flex-1",onClick:()=>c(`${i}/${a.id}`),children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:$(a.project)||a.project?.name||a.project?.code||t("common.unknown")}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[t("regulatoryWatch.submittedAt"),": ",te(a.submitted_at)]}),l&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:l})]}),e.jsxs("div",{className:"flex items-center justify-between md:justify-end gap-3",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:d}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",className:"btn-secondary flex items-center gap-2",onClick:()=>c(`${i}/${a.id}`),children:[e.jsx(U,{className:"w-4 h-4"}),t("regulatoryWatch.viewDetails")]}),e.jsxs("button",{type:"button",className:"btn-secondary flex items-center gap-2",onClick:()=>c(`${i}/${a.id}/resubmit`),children:[e.jsx(X,{className:"w-4 h-4"}),t("regulatoryWatch.resubmit")]}),e.jsxs("button",{type:"button",className:"btn-danger flex items-center gap-2",onClick:()=>H(a),children:[e.jsx(Y,{className:"w-4 h-4"}),t("common.delete")??"Delete"]})]})]})]},a.id)})})]}),e.jsx(V,{isOpen:!!y,title:t("common.confirm")??"Confirm",message:t("common.confirmDelete")??"Are you sure you want to delete this record?",confirmLabel:t("common.delete")??"Delete",cancelLabel:t("common.cancel")??"Cancel",variant:"danger",onConfirm:O,onCancel:()=>h(null)})]})}export{me as default};
