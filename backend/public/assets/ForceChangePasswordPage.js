import{a as j,u as b,j as s}from"./index.js";import{u as N,r as c}from"./vendor-react.js";import{q as v,a8 as m,a6 as p,E as w,a0 as P,z as i}from"./vendor-ui.js";import{g as C,P as _,c as k}from"./PasswordStrength.js";import"./vendor-utils.js";function S(r){return r==="admin"||r==="consultation"||r==="pole_director"||r==="works_director"||r==="hse_director"||r==="hr_director"?"/admin":r==="user"||r==="animateur"?"/sor":r==="supervisor"?"/supervisor":r==="hr"?"/hr":"/dashboard"}function F(){const r=N(),{t:a}=j(),{user:l,changePassword:f}=b(),d=c.useMemo(()=>C(l?.role),[l?.role]),[t,u]=c.useState({current_password:"",password:"",password_confirmation:""}),[o,h]=c.useState({current:!1,next:!1,confirm:!1}),[x,g]=c.useState(!1),y=async e=>{if(e.preventDefault(),!t.current_password){i.error(a("auth.passwordRequired"));return}if(t.password!==t.password_confirmation){i.error(a("profile.passwordMismatch"));return}if(!k(t.password,d).ok){i.error(a("auth.passwordPolicy.invalid"));return}g(!0);try{await f(t.current_password,t.password,t.password_confirmation),i.success(a("success.passwordChanged")),r(S(l?.role),{replace:!0})}catch(n){i.error(n.response?.data?.message||a("errors.failedToSave"))}finally{g(!1)}};return s.jsx("div",{className:"animate-fade-in",children:s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border border-gray-100 dark:border-gray-700",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-br from-sgtm-orange to-hse-primary mb-4 shadow-lg",children:s.jsx(v,{className:"w-8 h-8 text-white"})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:a("auth.forceChangePassword.title")}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:a("auth.forceChangePassword.subtitle")})]}),s.jsxs("form",{onSubmit:y,className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:a("auth.currentPassword")}),s.jsxs("div",{className:"relative",children:[s.jsx(m,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx("input",{type:o.current?"text":"password",value:t.current_password,onChange:e=>u(n=>({...n,current_password:e.target.value})),className:"input pl-10 pr-10",required:!0,autoComplete:"current-password"}),s.jsx("button",{type:"button",onClick:()=>h(e=>({...e,current:!e.current})),className:"absolute right-3 top-1/2 -translate-y-1/2","aria-label":o.current?a("auth.hidePassword"):a("auth.showPassword"),children:o.current?s.jsx(p,{className:"w-4 h-4 text-gray-400"}):s.jsx(w,{className:"w-4 h-4 text-gray-400"})})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"label",children:a("auth.newPassword")}),s.jsxs("div",{className:"relative",children:[s.jsx(m,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx("input",{type:o.next?"text":"password",value:t.password,onChange:e=>u(n=>({...n,password:e.target.value})),className:"input pl-10 pr-10",required:!0,minLength:d.minLength,autoComplete:"new-password"}),s.jsx("button",{type:"button",onClick:()=>h(e=>({...e,next:!e.next})),className:"absolute right-3 top-1/2 -translate-y-1/2","aria-label":o.next?a("auth.hidePassword"):a("auth.showPassword"),children:o.next?s.jsx(p,{className:"w-4 h-4 text-gray-400"}):s.jsx(w,{className:"w-4 h-4 text-gray-400"})})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"label",children:a("auth.confirmPassword")}),s.jsxs("div",{className:"relative",children:[s.jsx(m,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),s.jsx("input",{type:o.confirm?"text":"password",value:t.password_confirmation,onChange:e=>u(n=>({...n,password_confirmation:e.target.value})),className:"input pl-10 pr-10",required:!0,minLength:d.minLength,autoComplete:"new-password"}),s.jsx("button",{type:"button",onClick:()=>h(e=>({...e,confirm:!e.confirm})),className:"absolute right-3 top-1/2 -translate-y-1/2","aria-label":o.confirm?a("auth.hidePassword"):a("auth.showPassword"),children:o.confirm?s.jsx(p,{className:"w-4 h-4 text-gray-400"}):s.jsx(w,{className:"w-4 h-4 text-gray-400"})})]})]})]}),s.jsx(_,{password:t.password,role:l?.role}),s.jsx("button",{type:"submit",disabled:x,className:"btn-primary w-full py-3",children:x?s.jsxs("span",{className:"flex items-center justify-center gap-2",children:[s.jsx(P,{className:"w-5 h-5 animate-spin"}),a("common.saving")]}):a("auth.forceChangePassword.submit")})]})]})})}export{F as default};
