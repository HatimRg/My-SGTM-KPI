import{a as v,j as e,A as c}from"./index.js";import{r as o}from"./vendor-react.js";import{m as x,s as u,aj as _,v as A,F as f,X as p,q as l,A as h}from"./vendor-ui.js";import"./vendor-utils.js";const S={reminder:"Reminder"},C=a=>{const s={kpi_submitted:{icon:l,color:"text-blue-500",bg:"bg-blue-100 dark:bg-blue-900/30"},kpi_approved:{icon:l,color:"text-green-500",bg:"bg-green-100 dark:bg-green-900/30"},kpi_rejected:{icon:p,color:"text-red-500",bg:"bg-red-100 dark:bg-red-900/30"},project_assigned:{icon:f,color:"text-purple-500",bg:"bg-purple-100 dark:bg-purple-900/30"},sor_submitted:{icon:h,color:"text-orange-500",bg:"bg-orange-100 dark:bg-orange-900/30"},sor_corrected:{icon:l,color:"text-green-500",bg:"bg-green-100 dark:bg-green-900/30"},training_submitted:{icon:l,color:"text-indigo-500",bg:"bg-indigo-100 dark:bg-indigo-900/30"},awareness_submitted:{icon:l,color:"text-teal-500",bg:"bg-teal-100 dark:bg-teal-900/30"},reminder:{icon:u,color:"text-yellow-500",bg:"bg-yellow-100 dark:bg-yellow-900/30"},system:{icon:x,color:"text-gray-500",bg:"bg-gray-100 dark:bg-gray-700"},info:{icon:x,color:"text-blue-500",bg:"bg-blue-100 dark:bg-blue-900/30"},warning:{icon:h,color:"text-yellow-500",bg:"bg-yellow-100 dark:bg-yellow-900/30"},success:{icon:l,color:"text-green-500",bg:"bg-green-100 dark:bg-green-900/30"},error:{icon:p,color:"text-red-500",bg:"bg-red-100 dark:bg-red-900/30"}};return s[a]||s.info};function E(){const{t:a}=v(),[s,d]=o.useState([]),[k,b]=o.useState(!0),[i,g]=o.useState("all");o.useEffect(()=>{(async()=>{try{b(!0);const r=await c.getAll({per_page:50});d(r.data.data||[])}catch(r){console.error("Failed to load notifications",r)}finally{b(!1)}})()},[]);const j=async t=>{if(!t.read_at)try{await c.markAsRead(t.id),d(r=>r.map(n=>n.id===t.id?{...n,read_at:new Date().toISOString()}:n))}catch(r){console.error("Failed to mark notification as read",r)}},N=async()=>{try{await c.markAllAsRead(),d(t=>t.map(r=>({...r,read_at:new Date().toISOString()})))}catch(t){console.error("Failed to mark all notifications as read",t)}},w=async()=>{try{await c.deleteRead(),d(t=>t.filter(r=>!r.read_at))}catch(t){console.error("Failed to clear read notifications",t)}},y=o.useMemo(()=>s.filter(t=>!(i==="unread"&&t.read_at||i==="reminders"&&t.type!=="reminder")),[s,i]);return e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6 animate-fade-in",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:[a("nav.dashboard")," / ",a("notifications.title")]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:a("notifications.title")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"View all alerts, reminders, and system messages related to your HSE activity."})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"w-5 h-5 text-hse-primary"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:a("notifications.title")}),e.jsx("span",{className:"badge badge-info",children:s.length})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[e.jsx("button",{type:"button",onClick:()=>g("all"),className:`px-2 py-1 rounded-full border text-xs ${i==="all"?"bg-hse-primary text-white border-hse-primary":"border-gray-300 text-gray-600 dark:border-gray-600 dark:text-gray-300"}`,children:"All"}),e.jsx("button",{type:"button",onClick:()=>g("unread"),className:`px-2 py-1 rounded-full border text-xs ${i==="unread"?"bg-hse-primary text-white border-hse-primary":"border-gray-300 text-gray-600 dark:border-gray-600 dark:text-gray-300"}`,children:"Unread"}),e.jsxs("button",{type:"button",onClick:()=>g("reminders"),className:`px-2 py-1 rounded-full border text-xs flex items-center gap-1 ${i==="reminders"?"bg-hse-primary text-white border-hse-primary":"border-gray-300 text-gray-600 dark:border-gray-600 dark:text-gray-300"}`,children:[e.jsx(u,{className:"w-3 h-3"}),"Reminders"]}),e.jsx("span",{className:"hidden sm:inline-flex h-4 w-px bg-gray-200 dark:bg-gray-700"}),e.jsx("button",{type:"button",onClick:N,className:"text-xs text-hse-primary hover:underline",children:a("notifications.markAllRead")}),e.jsxs("button",{type:"button",onClick:w,className:"inline-flex items-center gap-1 text-xs text-red-600 dark:text-red-400 hover:underline",children:[e.jsx(_,{className:"w-3 h-3"}),"Clear read"]})]})]}),k?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(A,{className:"w-6 h-6 animate-spin text-hse-primary"})}):y.length===0?e.jsxs("div",{className:"py-12 text-center text-gray-500 dark:text-gray-400",children:[e.jsx(x,{className:"w-10 h-10 mx-auto mb-3 text-gray-300 dark:text-gray-600"}),e.jsx("p",{className:"text-sm",children:a("notifications.noNotifications")})]}):e.jsx("div",{className:"max-h-[70vh] overflow-y-auto divide-y divide-gray-100 dark:divide-gray-700",children:y.map(t=>{const r=C(t.type),n=r.icon,m=!t.read_at;return e.jsxs("div",{className:`px-4 py-3 flex gap-3 items-start ${m?"bg-blue-50/40 dark:bg-blue-900/10":"bg-white dark:bg-gray-800"}`,children:[e.jsx("div",{className:`w-9 h-9 rounded-full ${r.bg} flex items-center justify-center flex-shrink-0`,children:e.jsx(n,{className:`w-4 h-4 ${r.color}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("p",{className:`text-sm ${m?"font-semibold":"font-medium"} text-gray-900 dark:text-gray-100`,children:t.title}),m&&e.jsx("button",{type:"button",onClick:()=>j(t),className:"text-xs text-hse-primary hover:underline flex-shrink-0",children:a("notifications.markRead")})]}),t.message&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-300 mt-1",children:t.message}),t.project&&e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1 flex items-center gap-1",children:[e.jsx(f,{className:"w-3 h-3"}),t.project.name]}),e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:[new Date(t.created_at).toLocaleDateString()," ",new Date(t.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),t.type==="reminder"&&e.jsxs("p",{className:"text-[11px] text-amber-700 dark:text-amber-300 mt-1",children:[S.reminder,": pending KPI or SOR action."]})]})]},t.id)})})]})]})}export{E as default};
