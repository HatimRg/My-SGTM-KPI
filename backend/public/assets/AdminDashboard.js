import{d as ae,j as e,e as Pe,u as ca,p as ma,f as Ve}from"./index.js";import{r,u as xa,L as ha}from"./vendor-react.js";import{Q as ga,j as ea,e as Te,c as Me,A as ge,V as ba,Y as ua,Z as aa,_ as ta,U as Ce,s as Ke,q as pa,$ as fa,a0 as ya,a1 as ja,a2 as ka,a3 as va,a4 as Na,a5 as _a,z as ke,a6 as wa,a7 as Sa,v as Ca,a8 as Ta,a9 as Ma,h as Xe,F as Aa,T as $a,aa as Ra,ab as Pa}from"./vendor-ui.js";import{R as M,A as be,C as K,X as D,Y as $,T as A,a as ee,P as De,b as Fe,c as he,L as G,d as We,e as q,B as de,f as H,g as sa}from"./vendor-charts.js";import{g as ie,a as Ka}from"./weekHelper.js";import{s as Da,g as Ze}from"./projectList.js";import"./vendor-utils.js";class Fa{constructor(){this.cache=new Map,this.timestamps=new Map}generateKey(l,d={}){const o=Object.keys(d).sort().reduce((s,n)=>(s[n]=d[n],s),{});return`${l}:${JSON.stringify(o)}`}get(l,d={},o=3e4){const s=this.generateKey(l,d),n=this.timestamps.get(s);return!n||Date.now()-n>o?(this.delete(s),null):this.cache.get(s)}set(l,d={},o){const s=this.generateKey(l,d);this.cache.set(s,o),this.timestamps.set(s,Date.now())}delete(l){this.cache.delete(l),this.timestamps.delete(l)}clearPattern(l){for(const d of this.cache.keys())d.includes(l)&&this.delete(d)}clear(){this.cache.clear(),this.timestamps.clear()}getStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}}const Je=new Fa;async function Qe(t,l,d={},o=3e4){const s=Je.get(l,d,o);if(s)return Promise.resolve(s);const n=await t(d);return Je.set(l,d,n),n}const Wa=[{id:"overview",nameKey:"dashboard.themes.overview",icon:ga,gradient:"from-purple-500 to-purple-700"},{id:"safety",nameKey:"dashboard.themes.safety",icon:ea,gradient:"from-red-500 to-red-700"},{id:"training",nameKey:"dashboard.themes.training",icon:Te,gradient:"from-blue-500 to-blue-700"},{id:"compliance",nameKey:"dashboard.themes.compliance",icon:Me,gradient:"from-green-500 to-green-700"},{id:"deviations",nameKey:"dashboard.themes.deviations",icon:ge,gradient:"from-amber-500 to-amber-700"},{id:"environmental",nameKey:"dashboard.themes.environmental",icon:ba,gradient:"from-emerald-500 to-emerald-700"}],za=r.memo(function({activeTheme:l,onThemeChange:d}){const o=ae();return e.jsx("div",{className:"relative mb-4",children:e.jsx("div",{className:"flex items-center justify-center gap-1 flex-wrap",children:Wa.map(s=>{const n=s.icon,i=l===s.id;return e.jsxs("button",{onClick:()=>d(s.id),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg border transition-all duration-200 ${i?`bg-gradient-to-r ${s.gradient} text-white border-transparent shadow-md`:"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600 hover:shadow-sm"}`,children:[e.jsx(n,{className:`w-4 h-4 ${i?"text-white":""}`}),e.jsx("span",{className:`font-medium text-xs ${i?"text-white":""}`,children:o(s.nameKey)})]},s.id)})})})}),J={fatal:"#dc2626",serious:"#f59e0b",minor:"#16a34a",tf:"#f59e0b",tg:"#8b5cf6"},ve=r.memo(function({title:l,value:d,icon:o,color:s,trend:n}){const i={red:"border-red-200 bg-red-50 dark:border-red-700 dark:bg-red-900/50 text-red-600 dark:text-red-400",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${i[s]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(o,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:l})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:d}),n&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:n})]})}),La=r.memo(function({kpiSummary:l,weeklyTrends:d,projectPerformance:o}){const s=ae(),n=r.useMemo(()=>({totalAccidents:l?.total_accidents??0,fatalAccidents:l?.fatal_accidents??0,avgTF:Number(l?.avg_tf??0).toFixed(2),avgTG:Number(l?.avg_tg??0).toFixed(2),lostWorkdays:l?.lost_workdays??0}),[l]),i=r.useMemo(()=>(d??[]).map(h=>({week:h.week_label,accidents:h.accidents??0})),[d]),y=r.useMemo(()=>{n.totalAccidents;const h=n.fatalAccidents,N=l?.serious_accidents,F=l?.minor_accidents,z=N!=null&&F!==null&&F!==void 0,c=z?Number(N??0):(d??[]).reduce((v,_)=>v+Number(_?.serious_accidents??0),0),b=z?Number(F??0):(d??[]).reduce((v,_)=>v+Number(_?.minor_accidents??0),0);return[{name:s("dashboard.safety.fatal"),value:Number(h??0),color:J.fatal},{name:s("dashboard.safety.serious"),value:Number(c??0),color:J.serious},{name:s("dashboard.safety.minor"),value:Number(b??0),color:J.minor}].filter(v=>v.value>0)},[n,s,l,d]),j=r.useMemo(()=>(d??[]).map(h=>({week:h.week_label,tf:Number(h.tf??0).toFixed(4),tg:Number(h.tg??0).toFixed(4)})),[d]),p=r.useMemo(()=>(o??[]).slice(0,6).map(h=>({name:h.name?.length>15?h.name.substring(0,15)+"...":h.name,accidents:h.total_accidents??0})),[o]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(ve,{title:s("dashboard.safety.totalAccidents"),value:n.totalAccidents,icon:ge,color:n.totalAccidents>0?"red":"green",trend:s("dashboard.safety.yearToDate")}),e.jsx(ve,{title:s("dashboard.safety.fatalAccidents"),value:n.fatalAccidents,icon:ua,color:n.fatalAccidents>0?"red":"green",trend:n.fatalAccidents===0?s("dashboard.safety.noFatalities"):s("dashboard.safety.critical")}),e.jsx(ve,{title:s("dashboard.safety.tfRate"),value:n.avgTF,icon:aa,color:"amber",trend:s("dashboard.safety.avgFrequencyRate")}),e.jsx(ve,{title:s("dashboard.safety.tgRate"),value:n.avgTG,icon:ta,color:"purple",trend:s("dashboard.safety.avgSeverityRate")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("dashboard.safety.accidentTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(be,{data:i,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"accidentGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#dc2626",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#dc2626",stopOpacity:.1})]})}),e.jsx(K,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week",tick:{fontSize:11}}),e.jsx($,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(ee,{type:"monotone",dataKey:"accidents",stroke:"#dc2626",fill:"url(#accidentGradient)",name:"Accidents"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("dashboard.safety.accidentsBySeverity")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:y.length>0?e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(De,{children:[e.jsx(Fe,{data:y,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:h,value:N})=>`${h}: ${N}`,children:y.map((h,N)=>e.jsx(he,{fill:h.color},`cell-${N}`))}),e.jsx(A,{}),e.jsx(G,{})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-green-600 dark:text-green-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ge,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"font-medium",children:s("dashboard.safety.noAccidents")}),e.jsx("p",{className:"text-sm text-gray-500",children:s("dashboard.safety.greatSafety")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("dashboard.safety.tfVsTg")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(We,{data:j,children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week",tick:{fontSize:11}}),e.jsx($,{tick:{fontSize:11}}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(G,{}),e.jsx(q,{type:"monotone",dataKey:"tf",stroke:J.tf,strokeWidth:2,dot:{fill:J.tf,r:3},name:"TF Rate"}),e.jsx(q,{type:"monotone",dataKey:"tg",stroke:J.tg,strokeWidth:2,dot:{fill:J.tg,r:3},name:"TG Rate"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("dashboard.safety.accidentsByProject")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(de,{data:p,layout:"vertical",children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{type:"number",allowDecimals:!1,tick:{fontSize:11}}),e.jsx($,{type:"category",dataKey:"name",tick:{fontSize:10},width:100}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(H,{dataKey:"accidents",fill:"#dc2626",radius:[0,4,4,0],name:"Accidents"})]})})})})]})]})]})}),Q=r.memo(function({title:l,value:d,icon:o,color:s,trend:n}){const i={blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${i[s]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(o,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:l})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:d}),n&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:n})]})}),Ia=r.memo(function({kpiSummary:l,weeklyTrends:d,projectPerformance:o,trainingData:s,awarenessData:n}){const i=ae(),y=r.useMemo(()=>{const c=s?.total??l?.total_trainings??0,b=s?.total_participants??l?.employees_trained??0,v=s?.total_hours??l?.total_training_hours??l?.training_hours??0,_=l?.total_trainings_planned??0,W=_>0?Math.round(c/_*100):null;return{totalTrainings:c,employeesTrained:b,trainingHours:v,completionRate:W}},[l,s]),j=r.useMemo(()=>({totalSessions:n?.total??0,totalParticipants:n?.total_participants??0,totalHours:n?.total_hours??0}),[n]),p=r.useMemo(()=>s?.by_week?.length>0?s.by_week.map(c=>({week:"S"+c.week_number,trainings:c.count??0,participants:c.participants??0})):(d??[]).map(c=>({week:c.week_label,trainings:c.trainings??0})),[d,s]),h=r.useMemo(()=>{if(s?.by_theme?.length>0){const c=["#3b82f6","#8b5cf6","#ec4899","#14b8a6","#f59e0b","#ef4444","#10b981","#6366f1"];return s.by_theme.slice(0,8).map((b,v)=>({name:b.theme?.length>20?b.theme.substring(0,20)+"...":b.theme,fullName:b.theme,value:b.count,participants:b.participants??0,color:c[v%c.length]}))}return[]},[s]),N=r.useMemo(()=>s?.by_duration?.length>0?s.by_duration.map(c=>({duration:c.duration,count:c.count,participants:c.participants??0})):[],[s]),F=r.useMemo(()=>{if(n?.by_theme?.length>0){const c=["#16a34a","#0ea5e9","#f97316","#a855f7","#eab308","#06b6d4","#84cc16","#d946ef"];return n.by_theme.slice(0,8).map((b,v)=>({name:b.theme?.length>20?b.theme.substring(0,20)+"...":b.theme,fullName:b.theme,value:b.count,participants:b.participants??0,color:c[v%c.length]}))}return[]},[n]),z=r.useMemo(()=>s?.by_type?.length>0?s.by_type.map(c=>({name:c.type==="internal"?i("dashboard.training.internal"):i("dashboard.training.external"),value:c.count,color:c.type==="internal"?"#3b82f6":"#8b5cf6"})):[],[s,i]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Q,{title:i("dashboard.training.totalTrainings"),value:y.totalTrainings,icon:Te,color:"blue",trend:i("dashboard.training.sessionsCompleted")}),e.jsx(Q,{title:i("dashboard.training.employeesTrained"),value:y.employeesTrained,icon:Ce,color:"green",trend:i("dashboard.training.uniqueAttendees")}),e.jsx(Q,{title:i("dashboard.training.trainingHours"),value:y.trainingHours,icon:Ke,color:"purple",trend:i("dashboard.training.totalHoursDelivered")}),e.jsx(Q,{title:i("dashboard.training.completionRate"),value:y.completionRate!==null?`${y.completionRate}%`:"—",icon:pa,color:"amber",trend:`${i("dashboard.training.target")}: 95%`})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i("dashboard.training.trainingTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(be,{data:p,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"trainingGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.1})]})}),e.jsx(K,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week",tick:{fontSize:11}}),e.jsx($,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(ee,{type:"monotone",dataKey:"trainings",stroke:"#3b82f6",fill:"url(#trainingGradient)",name:"Trainings"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i("dashboard.training.trainingByTheme")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-72",children:h.length>0?e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(de,{data:h,layout:"vertical",margin:{left:10,right:20},children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{type:"number",allowDecimals:!1,tick:{fontSize:11}}),e.jsx($,{type:"category",dataKey:"name",tick:{fontSize:10},width:120}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},formatter:(c,b,v)=>[`${c} sessions (${v.payload.participants} participants)`,"Count"]}),e.jsx(H,{dataKey:"value",radius:[0,4,4,0],children:h.map((c,b)=>e.jsx(he,{fill:c.color},`cell-${b}`))})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Te,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"font-medium",children:i("dashboard.training.noTrainingData")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i("dashboard.training.trainingByDuration")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:N.length>0?e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(de,{data:N,children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"duration",tick:{fontSize:11}}),e.jsx($,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},formatter:(c,b)=>[c,b==="count"?"Sessions":"Participants"]}),e.jsx(H,{dataKey:"count",fill:"#8b5cf6",radius:[4,4,0,0],name:"Sessions"})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{className:"font-medium",children:i("dashboard.training.noTrainingData")})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i("dashboard.training.awarenessByTheme")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-72",children:F.length>0?e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(de,{data:F,layout:"vertical",margin:{left:10,right:20},children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{type:"number",allowDecimals:!1,tick:{fontSize:11}}),e.jsx($,{type:"category",dataKey:"name",tick:{fontSize:10},width:120}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},formatter:(c,b,v)=>[`${c} sessions (${v.payload.participants} participants)`,"Count"]}),e.jsx(H,{dataKey:"value",radius:[0,4,4,0],children:F.map((c,b)=>e.jsx(he,{fill:c.color},`cell-${b}`))})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{className:"font-medium",children:i("dashboard.training.noTrainingData")})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i("dashboard.training.trainingByType")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:z.length>0?e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(De,{children:[e.jsx(Fe,{data:z,cx:"50%",cy:"45%",innerRadius:40,outerRadius:70,paddingAngle:5,dataKey:"value",label:({value:c})=>c,labelLine:!1,children:z.map((c,b)=>e.jsx(he,{fill:c.color},`cell-${b}`))}),e.jsx(A,{formatter:(c,b)=>[c,b]}),e.jsx(G,{verticalAlign:"bottom",height:36,formatter:c=>e.jsx("span",{className:"text-sm",children:c})})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{className:"font-medium",children:i("dashboard.training.noTrainingData")})})})})]})]}),j.totalSessions>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx(Q,{title:i("dashboard.training.totalAwareness"),value:j.totalSessions,icon:Ce,color:"green",trend:`${j.totalParticipants} participants`}),e.jsx(Q,{title:i("dashboard.training.awarenessParticipants"),value:j.totalParticipants,icon:Ce,color:"purple"}),e.jsx(Q,{title:i("dashboard.training.awarenessHours"),value:Math.round(j.totalHours??0),icon:Ke,color:"amber"})]})]})}),Oa={compliance:"#16a34a"},Ne=r.memo(function({title:l,value:d,icon:o,color:s,trend:n}){const i={green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${i[s]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(o,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:l})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:d}),n&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:n})]})}),Ba=r.memo(function({kpiSummary:l,weeklyTrends:d,projectPerformance:o,inspectionData:s,sorData:n,regulatoryWatch:i}){const y=ae(),j=r.useMemo(()=>{const N=l?.total_inspections??0,F=Number(i?.avg_overall_score??0).toFixed(1),z=Number(l?.avg_medical_compliance??0).toFixed(1),c=n?.stats?.total??0,b=n?.stats?.closed??0,v=c>0?Math.round(b/c*100):null;return{totalInspections:N,hseCompliance:F,medicalCompliance:z,auditScore:v}},[l,n,i]),p=r.useMemo(()=>(d??[]).map(N=>({week:N.week_label,inspections:N.inspections??0})),[d]),h=r.useMemo(()=>(n?.by_category??[]).map(N=>({category:N.label??N.category,count:N.count??0})),[n]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Ne,{title:y("dashboard.compliance.totalInspections"),value:j.totalInspections,icon:Me,color:"green",trend:y("dashboard.compliance.completedThisYear")}),e.jsx(Ne,{title:y("dashboard.compliance.hseCompliance"),value:`${j.hseCompliance}%`,icon:ea,color:"blue",trend:y("dashboard.compliance.avgScore")}),e.jsx(Ne,{title:y("dashboard.compliance.medicalCompliance"),value:`${j.medicalCompliance}%`,icon:fa,color:"purple",trend:y("dashboard.compliance.healthChecks")}),j.auditScore!==null&&e.jsx(Ne,{title:y("dashboard.compliance.auditScore"),value:`${j.auditScore}%`,icon:ya,color:"amber",trend:y("dashboard.compliance.latestAudit")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:y("dashboard.compliance.inspectionTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(be,{data:p,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"complianceGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#16a34a",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#16a34a",stopOpacity:.1})]})}),e.jsx(K,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week",tick:{fontSize:11}}),e.jsx($,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(ee,{type:"monotone",dataKey:"inspections",stroke:"#16a34a",fill:"url(#complianceGradient)",name:"Inspections"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:y("dashboard.compliance.auditFindings")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(de,{data:h,children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"category",tick:{fontSize:11}}),e.jsx($,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(H,{dataKey:"count",fill:Oa.compliance,name:y("dashboard.compliance.findings"),radius:[4,4,0,0]})]})})})})]})]})]})}),P={water:"#0ea5e9",electricity:"#eab308",hse:"#22c55e",medical:"#8b5cf6",training:"#f59e0b",nearMiss:"#ef4444"},_e=r.memo(function({title:l,value:d,icon:o,color:s,trend:n,unit:i}){const y={blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400",yellow:"border-yellow-200 bg-yellow-50 dark:border-yellow-700 dark:bg-yellow-900/50 text-yellow-600 dark:text-yellow-400",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${y[s]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(o,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:l})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:[d,e.jsx("span",{className:"text-sm font-normal ml-1",children:i})]}),n&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:n})]})}),Ea=r.memo(function({kpiSummary:l,weeklyTrends:d}){const o=ae(),s=r.useMemo(()=>({waterConsumption:Number(l?.total_water_consumption??0),electricityUsage:Number(l?.total_electricity_consumption??0),hseCompliance:Math.round(Number(l?.avg_hse_compliance??0)),medicalCompliance:Math.round(Number(l?.avg_medical_compliance??0)),trainingHours:Math.round(Number(l?.total_training_hours??0)),nearMisses:Number(l?.total_near_misses??0),workPermits:Number(l?.total_work_permits??0)}),[l]),n=r.useMemo(()=>(d??[]).map(p=>({week:p.week_label,water:p.water??0,electricity:p.electricity??0,training_hours:p.training_hours??0})),[d]),i=r.useMemo(()=>(d??[]).map(p=>({week:p.week_label,hse:p.hse_compliance??0,medical:p.medical_compliance??0})),[d]),y=r.useMemo(()=>(d??[]).map(p=>({week:p.week_label,near_misses:p.near_misses??0,accidents:p.accidents??0,inspections:p.inspections??0})),[d]),j=r.useMemo(()=>[{name:o("dashboard.environmental.hseCompliance"),current:s.hseCompliance,target:95,color:P.hse},{name:o("dashboard.environmental.medicalCompliance"),current:s.medicalCompliance,target:95,color:P.medical}],[o,s]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(_e,{title:o("dashboard.environmental.hseCompliance"),value:s.hseCompliance,icon:Me,color:"green",unit:"%",trend:o("dashboard.environmental.yearToDate")}),e.jsx(_e,{title:o("dashboard.environmental.medicalCompliance"),value:s.medicalCompliance,icon:ja,color:"purple",unit:"%",trend:o("dashboard.environmental.yearToDate")}),e.jsx(_e,{title:o("dashboard.environmental.waterConsumption"),value:s.waterConsumption.toLocaleString(),icon:ka,color:"blue",unit:"m³",trend:o("dashboard.environmental.yearToDate")}),e.jsx(_e,{title:o("dashboard.environmental.electricityUsage"),value:s.electricityUsage.toLocaleString(),icon:va,color:"yellow",unit:"kWh",trend:o("dashboard.environmental.yearToDate")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:o("dashboard.environmental.complianceTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(We,{data:i,children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week",tick:{fontSize:11}}),e.jsx($,{tick:{fontSize:11},domain:[0,100]}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(G,{}),e.jsx(q,{type:"monotone",dataKey:"hse",stroke:P.hse,strokeWidth:2,dot:{fill:P.hse,r:3},name:o("dashboard.environmental.hseCompliance")}),e.jsx(q,{type:"monotone",dataKey:"medical",stroke:P.medical,strokeWidth:2,dot:{fill:P.medical,r:3},name:o("dashboard.environmental.medicalCompliance")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:o("dashboard.environmental.waterVsElectricity")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(sa,{data:n,children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week",tick:{fontSize:11}}),e.jsx($,{yAxisId:"left",tick:{fontSize:11},stroke:P.water}),e.jsx($,{yAxisId:"right",orientation:"right",tick:{fontSize:11},stroke:P.electricity}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(G,{}),e.jsx(H,{yAxisId:"left",dataKey:"water",fill:P.water,name:"Water (m³)",radius:[4,4,0,0]}),e.jsx(q,{yAxisId:"right",type:"monotone",dataKey:"electricity",stroke:P.electricity,strokeWidth:2,name:"Electricity (kWh)"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:o("dashboard.environmental.safetyTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(be,{data:y,children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week",tick:{fontSize:11}}),e.jsx($,{tick:{fontSize:11}}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(G,{}),e.jsx(ee,{type:"monotone",dataKey:"inspections",stroke:P.hse,fill:P.hse,fillOpacity:.6,name:o("dashboard.inspections")}),e.jsx(ee,{type:"monotone",dataKey:"near_misses",stroke:P.training,fill:P.training,fillOpacity:.6,name:o("dashboard.nearMisses")}),e.jsx(ee,{type:"monotone",dataKey:"accidents",stroke:P.nearMiss,fill:P.nearMiss,fillOpacity:.6,name:o("dashboard.accidents")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:o("dashboard.environmental.complianceProgress")})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"space-y-6 py-4",children:[j.map((p,h)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:p.name}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[p.current,"% / ",p.target,"%"]})]}),e.jsxs("div",{className:"relative h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:[e.jsx("div",{className:"absolute h-full rounded-full transition-all duration-500",style:{width:`${Math.min(p.current,100)}%`,backgroundColor:p.color}}),e.jsx("div",{className:"absolute h-full w-0.5 bg-gray-800 dark:bg-gray-300",style:{left:`${p.target}%`},title:`Target: ${p.target}%`})]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:p.current>=p.target?`✓ ${o("dashboard.environmental.targetAchieved")}`:`${p.target-p.current}% ${o("dashboard.environmental.toTarget")}`})]},h)),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:s.trainingHours.toLocaleString()}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:o("dashboard.environmental.trainingHoursYTD")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:s.nearMisses}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:o("dashboard.environmental.nearMissesYTD")})]})]})})]})})]})]})]})}),Y={open:"#dc2626",in_progress:"#f59e0b",closed:"#16a34a",trend:"#3b82f6"},we=r.memo(function({title:l,value:d,icon:o,color:s,subtitle:n}){const i={red:"border-red-200 bg-red-50 dark:border-red-700 dark:bg-red-900/50 text-red-600 dark:text-red-400",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400",blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${i[s]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(o,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:l})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:d}),n&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:n})]})}),Ga=r.memo(function({year:l,projects:d,projectId:o="all",week:s="all"}){const n=ae(),[i,y]=r.useState(!0),[j,p]=r.useState(null),h=r.useMemo(()=>{const _=j?.avg_close_days;if(_==null)return"—";const W=Number(_);if(Number.isNaN(W))return"—";if(W<2){const le=Math.max(0,Math.round(W*24*60)),T=Math.floor(le/60),Ae=le%60;return`${T.toString().padStart(2,"0")}h${Ae.toString().padStart(2,"0")}min`}const S=Math.round(W*10)/10;return`${Number.isInteger(S)?String(S):S.toFixed(1)}d`},[j?.avg_close_days]);r.useEffect(()=>{let _=!0;return(async()=>{y(!0);try{const S={year:l};o!=="all"&&(S.project_id=o),s!=="all"&&(S.week=s);const R=await Pe.getSorCharts(S);if(!_)return;p(R.data.data)}finally{_&&y(!1)}})(),()=>{_=!1}},[l,o,s]);const N=j?.stats??{},F=j?.by_status??[],z=j?.by_category??[],c=j?.by_week??[],b=r.useMemo(()=>{const _=S=>S==="open"?n("dashboard.deviations.status.open"):S==="in_progress"?n("dashboard.deviations.status.inProgress"):S==="closed"?n("dashboard.deviations.status.closed"):S,W=S=>S==="open"?Y.open:S==="in_progress"?Y.in_progress:S==="closed"?Y.closed:Y.trend;return F.map(S=>({name:_(S.status),value:S.count,color:W(S.status)})).filter(S=>S.value>0)},[F,n]),v=r.useMemo(()=>z.slice(0,10).map(_=>({category:(_.label??_.category??"").toString().slice(0,28),count:_.count??0})),[z]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(we,{title:n("dashboard.deviations.total"),value:N.total??0,icon:ge,color:"blue",subtitle:n("dashboard.deviations.yearContext",{year:l})}),e.jsx(we,{title:n("dashboard.deviations.open"),value:N.open??0,icon:Ke,color:"red",subtitle:n("dashboard.deviations.inProgressAndOpen")}),e.jsx(we,{title:n("dashboard.deviations.closed"),value:N.closed??0,icon:Na,color:"green",subtitle:n("dashboard.deviations.closedSubtitle")}),e.jsx(we,{title:n("dashboard.deviations.avgCloseDays"),value:h,icon:_a,color:"purple",subtitle:n("dashboard.deviations.avgCloseSubtitle")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n("dashboard.deviations.trend")})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(be,{data:c,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"devTrendGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:Y.trend,stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:Y.trend,stopOpacity:.1})]})}),e.jsx(K,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week_label",tick:{fontSize:11}}),e.jsx($,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(ee,{type:"monotone",dataKey:"count",stroke:Y.trend,fill:"url(#devTrendGradient)",name:n("dashboard.deviations.total")})]})})}),i&&e.jsx("div",{className:"text-xs text-gray-400 mt-2",children:n("common.loading")})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n("dashboard.deviations.byStatus")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:b.length>0?e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(De,{children:[e.jsx(Fe,{data:b,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:_,value:W})=>`${_}: ${W}`,children:b.map((_,W)=>e.jsx(he,{fill:_.color},`cell-${W}`))}),e.jsx(A,{}),e.jsx(G,{})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:n("common.noData")})})})]}),e.jsxs("div",{className:"card lg:col-span-2",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n("dashboard.deviations.byCategory")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-72",children:v.length>0?e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(de,{data:v,children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"category",tick:{fontSize:10},interval:0}),e.jsx($,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(H,{dataKey:"count",fill:Y.trend,name:n("dashboard.deviations.total"),radius:[4,4,0,0]})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:n("common.noData")})})})]})]})]})});function Ja(){const t=ae(),{user:l}=ca(),[d,o]=r.useState(null),[s,n]=r.useState(!0),[i,y]=r.useState(ie().year),[j,p]=r.useState(ie().year-1),[h,N]=r.useState(null),[F,z]=r.useState(!1),[c,b]=r.useState("overview"),[v,_]=r.useState(""),[W,S]=r.useState([]),[R,le]=r.useState("all"),[T,Ae]=r.useState("all"),[oe,ra]=r.useState(null),[V,ze]=r.useState("all"),[U,Le]=r.useState(null),X=r.useRef(null),$e=xa(),Ie=r.useCallback(async()=>{try{n(!0);const a={year:i};v&&(a.pole=v),R!=="all"&&(a.project_id=R),T!=="all"&&(a.week=T);const m=await Qe(Pe.getAdminDashboard,"/dashboard/admin",a,3e4);o(m.data.data)}catch{ke.error(t("dashboard.loadFailed")||t("errors.failedToLoad"))}finally{n(!1)}},[i,v,R,T]),Oe=r.useCallback(async()=>{try{const a=await ma.getPoles(),m=a.data?.data?.poles||a.data?.poles||[];S(Array.isArray(m)?m:[])}catch{S([])}},[]),Be=r.useCallback(async()=>{if(!j){N(null);return}try{const a=await Qe(Pe.getAdminDashboard,"/dashboard/admin",{year:j},3e4);N(a.data.data??null)}catch(a){console.error("Failed to load comparison dashboard data",a),ke.error(t("dashboard.compareLoadFailed")??t("errors.failedToLoad"))}},[j]);r.useEffect(()=>{Ie(),Be()},[Ie,Be]),r.useEffect(()=>{Oe()},[Oe]),r.useEffect(()=>{p(i-1)},[i]);const Ee=r.useCallback(async a=>{z(!0);try{const m=a==="excel"?await Ve.exportExcel({year:i}):await Ve.exportPdf({year:i}),x=new Blob([m.data],{type:a==="excel"?"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"application/pdf"}),u=window.URL.createObjectURL(x),f=document.createElement("a");f.href=u,f.download=`kpi_report_${i}.${a==="excel"?"xlsx":"pdf"}`,f.click(),window.URL.revokeObjectURL(u),ke.success(t("dashboard.exportSuccess"))}catch{ke.error(t("dashboard.exportFailed")||t("errors.somethingWentWrong"))}finally{z(!1)}},[i]),te=r.useMemo(()=>d?.stats??{},[d?.stats]),Ge=r.useMemo(()=>d?.kpi_summary??{},[d?.kpi_summary]),ue=r.useMemo(()=>d?.weekly_trends??[],[d?.weekly_trends]),pe=r.useMemo(()=>d?.project_performance??[],[d?.project_performance]),se=r.useMemo(()=>d?.weekly_status??[],[d?.weekly_status]),fe=r.useMemo(()=>d?.projects??[],[d?.projects]);r.useEffect(()=>{X.current&&(!Array.isArray(se)||se.length===0||requestAnimationFrame(()=>{X.current&&X.current.scrollTo({left:X.current.scrollWidth,behavior:"auto"})}))},[se,i]);const na=r.useMemo(()=>Ka(i),[i]),L=r.useMemo(()=>{if(T==="all")return ue;const a=Number(T);return Number.isNaN(a)?ue:(ue||[]).filter(m=>Number(m.week)===a)},[ue,T]),B=r.useMemo(()=>{if(R==="all")return pe;const a=Number(R);return Number.isNaN(a)?pe:(pe||[]).filter(m=>Number(m.id)===a)},[pe,R]),ye=r.useCallback((a,m,{higherIsBetter:x})=>{const u=Number(a??0),f=Number(m??0);if(u===f)return null;const g=x?u>f:u<f,k=f===0?100:Math.abs((u-f)/f*100),w=k>=10?Math.round(k):Math.round(k*10)/10,Z=u>f?wa:Sa,je=g?"bg-green-50 text-green-700 dark:bg-green-900/30 dark:text-green-300":"bg-red-50 text-red-700 dark:bg-red-900/30 dark:text-red-300";return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[11px] font-semibold ${je}`,children:[e.jsx(Z,{className:"w-3.5 h-3.5"}),w,"%"]})},[]),I=r.useMemo(()=>d?.training_data||{},[d?.training_data]),re=r.useMemo(()=>d?.awareness_data||{},[d?.awareness_data]),ia=r.useMemo(()=>d?.sor_data||{},[d?.sor_data]);r.useMemo(()=>d?.permit_data||{},[d?.permit_data]);const O=r.useMemo(()=>d?.inspection_data||{},[d?.inspection_data]),ne=r.useMemo(()=>{const a=Array.isArray(fe)?fe:[];return v?a.filter(m=>m?.pole===v):a},[fe,v]),He=l?.project_list_preference||"code",Ue=r.useMemo(()=>Da(ne,He),[ne,He]);r.useEffect(()=>{if(R==="all")return;ne.some(m=>String(m.id)===String(R))||le("all")},[ne,R]),r.useEffect(()=>{if(V==="all")return;ne.some(m=>String(m.id)===String(V))||ze("all")},[ne,V]);const ce=r.useMemo(()=>{if(T==="all")return I;const a=Number(T);if(Number.isNaN(a))return I;const x=(Array.isArray(I?.by_week)?I.by_week:[]).filter(k=>Number(k.week_number)===a),u=x.reduce((k,w)=>k+Number(w?.count??0),0),f=x.reduce((k,w)=>k+Number(w?.participants??0),0),g=x.reduce((k,w)=>k+Number(w?.hours??0),0);return{...I,total:u,total_participants:f,total_hours:g,by_week:x}},[I,T]),Ye=r.useMemo(()=>{if(T==="all")return O;const a=Number(T);if(Number.isNaN(a))return O;const x=(Array.isArray(O?.by_week)?O.by_week:[]).filter(f=>Number(f.week_number)===a),u=x.reduce((f,g)=>f+Number(g?.count??0),0);return{...O,stats:{...O?.stats||{},total:u},by_week:x}},[O,T]),da=r.useMemo(()=>{if(T==="all")return re;const a=Number(T);if(Number.isNaN(a))return re;const x=(Array.isArray(re?.by_week)?re.by_week:[]).filter(k=>Number(k.week_number)===a),u=x.reduce((k,w)=>k+Number(w?.count??0),0),f=x.reduce((k,w)=>k+Number(w?.participants??0),0),g=x.reduce((k,w)=>k+Number(w?.hours??0),0);return{...re,total:u,total_participants:f,total_hours:g,by_week:x}},[re,T]),C=r.useMemo(()=>{const a=Ge||{},m={...a,total_trainings:I?.total??a.total_trainings??0,employees_trained:I?.total_participants??a.employees_trained??0,total_training_hours:I?.total_hours??a.total_training_hours??0,total_inspections:O?.stats?.total??a.total_inspections??0};if(T!=="all"){const x=Array.isArray(L)?L:[],u=g=>x.reduce((k,w)=>k+Number(w?.[g]??0),0),f=g=>{if(x.length===0)return 0;const k=x.map(w=>Number(w?.[g]??0));return k.reduce((w,Z)=>w+Z,0)/k.length};return{...m,total_accidents:u("accidents"),fatal_accidents:u("fatal_accidents"),serious_accidents:u("serious_accidents"),minor_accidents:u("minor_accidents"),total_inspections:Ye?.stats?.total??u("inspections"),total_near_misses:u("near_misses"),total_work_permits:u("work_permits"),avg_tf:f("tf"),avg_tg:f("tg"),avg_hse_compliance:f("hse_compliance"),avg_medical_compliance:f("medical_compliance"),total_water_consumption:u("water"),total_electricity_consumption:u("electricity"),total_trainings:ce?.total??0,employees_trained:ce?.total_participants??0,total_training_hours:ce?.total_hours??0}}if(R!=="all"){const x=Array.isArray(B)?B[0]:null;if(x)return{...m,total_accidents:Number(x.total_accidents??0),total_trainings:Number(x.total_trainings??0),avg_tf:Number(x.avg_tf??0),avg_tg:Number(x.avg_tg??0)}}return m},[Ge,I,O,ce,Ye,L,T,R,B]),la=r.useCallback(a=>{if(!a||!a.activeLabel)return;const m=a.activeLabel,x=L.find(u=>u.week_label===m);if(x){ra(x);const u=new URLSearchParams;let f=x.week;if(!f&&typeof m=="string"){const k=parseInt(m.replace(/\D/g,""),10);Number.isNaN(k)||(f=k)}f&&u.set("week",f);const g=x.year||i;g&&u.set("year",g),$e(`/admin/kpi?${u.toString()}`)}},[L,i,$e]),oa=r.useMemo(()=>[...Array(6)].map((a,m)=>ie().year+1-m),[]);return s?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(Ca,{className:"w-8 h-8 animate-spin text-hse-primary"})}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:t("dashboard.adminTitle")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:t("dashboard.overview")})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 px-3 py-2",children:[e.jsx(Ta,{className:"w-4 h-4 text-gray-400"}),e.jsx("select",{value:i,onChange:a=>y(Number(a.target.value)),className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-none focus:ring-0 text-sm font-medium",children:oa.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>Ee("excel"),disabled:F,className:"btn-secondary flex items-center gap-2",children:[e.jsx(Ma,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:t("dashboard.exportExcel")})]}),e.jsxs("button",{onClick:()=>Ee("pdf"),disabled:F,className:"btn-secondary flex items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:t("dashboard.exportPdf")})]})]})]})]}),e.jsx(za,{activeTheme:c,onThemeChange:b}),e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-end gap-2",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:flex-wrap sm:items-center gap-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white/70 dark:bg-gray-900/40 px-3 py-2 w-full sm:w-auto",children:[e.jsxs("select",{value:v,onChange:a=>_(a.target.value),className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-none focus:ring-0 text-sm w-full sm:w-auto",children:[e.jsx("option",{value:"",children:t("common.allPoles")}),W.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsx("span",{className:"hidden sm:block w-px h-5 bg-gray-200 dark:bg-gray-700"}),e.jsxs("select",{value:R,onChange:a=>le(a.target.value),className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-none focus:ring-0 text-sm w-full sm:w-auto",children:[e.jsx("option",{value:"all",children:t("common.allProjects")}),Ue.map(a=>e.jsx("option",{value:a.id,children:Ze(a)},a.id))]}),e.jsx("span",{className:"hidden sm:block w-px h-5 bg-gray-200 dark:bg-gray-700"}),e.jsxs("select",{value:T,onChange:a=>Ae(a.target.value),className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-none focus:ring-0 text-sm w-full sm:w-auto",children:[e.jsx("option",{value:"all",children:t("common.all")}),na.map(a=>e.jsx("option",{value:a.week,children:a.label},a.week))]})]})}),c==="safety"&&e.jsx(La,{kpiSummary:C,weeklyTrends:L,projectPerformance:B}),c==="training"&&e.jsx(Ia,{kpiSummary:C,weeklyTrends:L,projectPerformance:B,trainingData:ce,awarenessData:da}),c==="compliance"&&e.jsx(Ba,{kpiSummary:C,weeklyTrends:L,projectPerformance:B,inspectionData:O,sorData:ia,regulatoryWatch:d?.regulatory_watch}),c==="deviations"&&e.jsx(Ga,{year:i,projects:fe,projectId:R,week:T}),c==="environmental"&&e.jsx(Ea,{kpiSummary:C,weeklyTrends:L}),c==="overview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Se,{title:t("dashboard.totalProjects"),value:te.total_projects??0,subtitle:`${te.active_projects??0} ${t("dashboard.activeLabel")}`,icon:Aa,color:"blue"}),e.jsx(Se,{title:t("dashboard.totalUsers"),value:te.total_users??0,subtitle:`${te.active_users??0} ${t("dashboard.activeLabel")}`,icon:Ce,color:"green"}),e.jsx(Se,{title:t("dashboard.activeMachines"),value:te.active_machines??0,subtitle:t("dashboard.activeMachinesSubtitle"),icon:$a,color:"amber"}),e.jsx(Se,{title:t("dashboard.totalReports"),value:te.total_reports??0,subtitle:t("dashboard.inYear",{year:i}),icon:Xe,color:"purple"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(xe,{title:t("dashboard.safety.totalAccidents"),value:C.total_accidents??0,icon:ge,color:C.total_accidents>0?"red":"green",trend:C.fatal_accidents>0?`${C.fatal_accidents} ${t("dashboard.safety.fatal")}`:t("dashboard.safety.noFatalities")}),e.jsx(xe,{title:t("dashboard.training.totalTrainings"),value:C.total_trainings??0,icon:Te,color:"blue",trend:`${C.employees_trained??0} ${t("dashboard.training.employeesTrained")}`}),e.jsx(xe,{title:t("dashboard.compliance.totalInspections"),value:C.total_inspections??0,icon:Me,color:"green"}),e.jsx(xe,{title:t("dashboard.avgTf"),value:Number(C.avg_tf??0).toFixed(2),icon:ta,color:"amber",trend:t("dashboard.rates.frequencyRate")}),e.jsx(xe,{title:t("dashboard.avgTg"),value:Number(C.avg_tg??0).toFixed(2),icon:aa,color:"purple",trend:t("dashboard.rates.severityRate")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t("dashboard.weeklyKpiTrends")})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"h-80",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(We,{data:L,onClick:la,children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week_label",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx($,{tick:{fontSize:12}}),e.jsx(A,{labelFormatter:a=>`${t("dashboard.weekPrefix")} ${a.replace("S","")}`}),e.jsx(G,{}),e.jsx(q,{type:"monotone",dataKey:"accidents",stroke:"#dc2626",strokeWidth:2,dot:{fill:"#dc2626",r:3},name:t("dashboard.accidents")}),e.jsx(q,{type:"monotone",dataKey:"trainings",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:3},name:t("dashboard.training.totalTrainings")}),e.jsx(q,{type:"monotone",dataKey:"inspections",stroke:"#16a34a",strokeWidth:2,dot:{fill:"#16a34a",r:3},name:t("dashboard.inspections")})]})})}),oe&&e.jsxs("div",{className:"mt-4 text-xs text-gray-600 dark:text-gray-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"font-semibold",children:t("dashboard.detailsForWeek",{week:oe.week_label})}),e.jsx("button",{type:"button",onClick:()=>$e("/admin/kpi"),className:"btn-secondary btn-sm",children:t("dashboard.viewKpiReports")})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("dashboard.accidents")}),e.jsx("p",{className:"font-semibold",children:oe.accidents??0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("dashboard.training.totalTrainings")}),e.jsx("p",{className:"font-semibold",children:oe.trainings??0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("dashboard.inspections")}),e.jsx("p",{className:"font-semibold",children:oe.inspections??0})]})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t("dashboard.tfTgRates")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-80",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(sa,{data:L,children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week_label",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx($,{yAxisId:"left",tick:{fontSize:12},stroke:"#f59e0b",label:{value:t("dashboard.rates.frequencyRate"),angle:-90,position:"insideLeft",style:{fill:"#f59e0b"}}}),e.jsx($,{yAxisId:"right",orientation:"right",tick:{fontSize:12},stroke:"#8b5cf6",label:{value:t("dashboard.rates.severityRate"),angle:90,position:"insideRight",style:{fill:"#8b5cf6"}}}),e.jsx(A,{labelFormatter:a=>`${t("dashboard.weekPrefix")} ${a.replace("S","")}`,formatter:(a,m)=>[Number(a).toFixed(4),m]}),e.jsx(G,{}),e.jsx(H,{yAxisId:"left",dataKey:"tf",fill:"#f59e0b",name:t("dashboard.rates.frequencyRate"),radius:[4,4,0,0]}),e.jsx(H,{yAxisId:"right",dataKey:"tg",fill:"#8b5cf6",name:t("dashboard.rates.severityRate"),radius:[4,4,0,0]})]})})})})]})]}),se.filter(a=>a.total_projects>0).length>0&&e.jsxs("div",{className:"card mt-6",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t("dashboard.submissionStatus")}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("select",{value:V,onChange:a=>ze(a.target.value),className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg px-3 py-1.5 text-sm font-medium dark:text-gray-200 focus:ring-2 focus:ring-hse-primary",children:[e.jsx("option",{value:"all",children:t("common.allProjects")}),Ue.map(a=>e.jsx("option",{value:a.id,children:Ze(a)},a.id))]})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>X.current?.scrollBy({left:-300,behavior:"smooth"}),className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 bg-white/90 dark:bg-gray-700/90 hover:bg-white dark:hover:bg-gray-600 shadow-lg rounded-full p-2 border dark:border-gray-600",children:e.jsx(Ra,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})}),e.jsx("button",{type:"button",onClick:()=>X.current?.scrollBy({left:300,behavior:"smooth"}),className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 bg-white/90 dark:bg-gray-700/90 hover:bg-white dark:hover:bg-gray-600 shadow-lg rounded-full p-2 border dark:border-gray-600",children:e.jsx(Pa,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})}),e.jsx("div",{ref:X,className:"flex gap-2 overflow-x-auto scroll-smooth px-10 py-3 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",style:{scrollbarWidth:"thin"},children:(()=>{const a=ie(),m=i<a.year?52:a.week;return Array.from({length:m},(x,u)=>u+1)})().map(a=>{const m=se.find(E=>E.week===a),x=ie(),u=i<x.year||i===x.year&&a<x.week,f=a===x.week&&i===x.year;let g="not_submitted";const k=m?.projects||[];V==="all"?g=m?.status||"not_submitted":g=k.find(qe=>qe.project_id===parseInt(V))?.status||"not_submitted";const w=m?.approved_count??0,Z=m?.submitted_count??0,je=m?.draft_count??0,me=m?.total_projects??0;if(me<=0)return null;let Re="";if(g==="partial"&&me>0){const E=[];w>0&&E.push("rgb(34, 197, 94)"),Z>0&&E.push("rgb(251, 191, 36)"),je>0&&E.push("rgb(96, 165, 250)"),me-w-Z-je>0&&E.push("rgb(254, 202, 202)"),Re=E.length>1?`linear-gradient(135deg, ${E.join(", ")})`:""}return e.jsxs("div",{"data-week":a,className:`relative flex-shrink-0 w-14 p-2 rounded-lg text-center transition-all cursor-pointer ${U===a?"ring-2 ring-gray-900 ring-offset-2 scale-110":""} ${f&&U!==a?"ring-2 ring-hse-primary ring-offset-2":""} ${g==="approved"?"bg-green-500 text-white":g==="partial"?"text-white":g==="submitted"?"bg-amber-400 text-white":g==="draft"?"bg-blue-400 text-white":u?"bg-red-100 text-red-600 hover:bg-red-200":"bg-gray-100 text-gray-500"}`,style:g==="partial"&&Re?{background:Re}:{},onClick:()=>Le(U===a?null:a),children:[e.jsxs("p",{className:"text-xs font-medium",children:[t("dashboard.weekShortPrefix"),a]}),V==="all"&&me>1?e.jsxs("p",{className:"text-xs font-bold mt-0.5",children:[w+Z,"/",me]}):e.jsx("p",{className:"text-lg font-bold mt-0.5",children:g==="approved"?"✓":g==="partial"?"◐":g==="submitted"?"⏳":g==="draft"?"📝":u?"!":"-"})]},`admin-week-${i}-${a}`)})})]}),U&&(()=>{const m=se.find(g=>g.week===U)?.projects||[],x=ie(),u=U===x.week&&i===x.year,f=i<x.year||i===x.year&&U<x.week;return m.length===0?null:e.jsxs("div",{className:"mt-3 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-700 pb-2 mb-2",children:[e.jsxs("p",{className:"font-semibold",children:[t("dashboard.weekDetailsTitle").replace("{{week}}",U),u&&e.jsxs("span",{className:"ml-2 text-hse-primary",children:["(",t("dashboard.currentWeekLabel"),")"]})]}),e.jsx("button",{type:"button",onClick:()=>Le(null),className:"text-gray-400 hover:text-white",children:"✕"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:m.map(g=>{const w=g.status==="not_submitted"&&f;return e.jsxs("div",{className:"flex items-center justify-between gap-2 bg-gray-800 rounded px-2 py-1.5",children:[e.jsx("span",{className:"truncate font-medium",children:g.project_code}),e.jsx("span",{className:`flex-shrink-0 px-1.5 py-0.5 rounded text-[10px] font-medium ${g.status==="approved"?"bg-green-500":g.status==="submitted"?"bg-amber-400":g.status==="draft"?"bg-blue-400":w?"bg-red-400":"bg-gray-500"}`,children:g.status==="approved"?t("status.approved"):g.status==="submitted"?t("status.pending"):g.status==="draft"?t("status.draft"):t(w?"status.missing":"status.notSubmitted")})]},g.project_id)})})]})})(),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4 pt-4 mt-2 border-t dark:border-gray-700 text-xs text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-green-500"})," ",t("status.approved")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-gradient-to-br from-green-400 to-amber-400"})," ",t("status.partial")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-amber-400"})," ",t("status.pending")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-blue-400"})," ",t("status.draft")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-red-100 border border-red-200"})," ",t("status.missing")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded ring-2 ring-hse-primary ring-offset-1"})," ",t("dashboard.currentWeekLabel")]})]})]})]}),h&&e.jsxs("div",{className:"card mt-6",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t("dashboard.yearOverYearSummary",{year:i,compareYear:j})})}),e.jsxs("div",{className:"card-body grid grid-cols-1 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx("span",{children:t("dashboard.safety.totalAccidents")}),ye(C.total_accidents,h?.kpi_summary?.total_accidents,{higherIsBetter:!1})]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[C.total_accidents??0," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["(",i,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[h?.kpi_summary?.total_accidents??0," (",j,")"]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx("span",{children:t("dashboard.training.totalTrainings")}),ye(C.total_trainings,h?.training_data?.total??h?.kpi_summary?.total_trainings,{higherIsBetter:!0})]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[C.total_trainings??0," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["(",i,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[h?.training_data?.total??h?.kpi_summary?.total_trainings??0," (",j,")"]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx("span",{children:t("dashboard.inspections")}),ye(C.total_inspections,h?.inspection_data?.stats?.total??h?.kpi_summary?.total_inspections,{higherIsBetter:!0})]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[C.total_inspections??0," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["(",i,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[h?.inspection_data?.stats?.total??h?.kpi_summary?.total_inspections??0," (",j,")"]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx("span",{children:t("dashboard.tfTgRates")}),ye(Number(C.avg_tf??0)+Number(C.avg_tg??0),Number(h?.kpi_summary?.avg_tf??0)+Number(h?.kpi_summary?.avg_tg??0),{higherIsBetter:!1})]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[Number(C.avg_tf??0).toFixed(2)," / ",Number(C.avg_tg??0).toFixed(2),e.jsxs("span",{className:"text-xs text-gray-400",children:[" (",i,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[Number(h?.kpi_summary?.avg_tf??0).toFixed(2)," / ",Number(h?.kpi_summary?.avg_tg??0).toFixed(2)," (",j,")"]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t("dashboard.projectPerformance")}),e.jsx(ha,{to:"/admin/projects",className:"text-sm text-hse-primary hover:underline",children:t("dashboard.viewAllProjects")})]}),B.length===0?e.jsx("div",{className:"p-6 text-center text-sm text-gray-500 dark:text-gray-400",children:t("dashboard.noProjectData")}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 p-4 md:hidden",children:B.slice(0,5).map(a=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3 bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:a.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.code})]}),e.jsxs("div",{className:"text-right text-xs text-gray-600 dark:text-gray-300 space-y-1",children:[e.jsxs("p",{children:[e.jsxs("span",{className:"font-semibold",children:[t("dashboard.reports"),":"]})," ",a.reports_count]}),e.jsxs("p",{children:[e.jsxs("span",{className:"font-semibold",children:[t("dashboard.training.totalTrainings"),":"]})," ",a.total_trainings]})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-[11px] text-gray-600 dark:text-gray-300",children:[e.jsxs("span",{children:[t("dashboard.accidents"),": ",e.jsx("span",{className:a.total_accidents>0?"text-red-600 dark:text-red-400 font-semibold":"text-green-600 dark:text-green-400",children:a.total_accidents})]}),e.jsxs("span",{children:["TF: ",Number(a.avg_tf).toFixed(2)," • TG: ",Number(a.avg_tg).toFixed(2)]})]})]},a.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:t("common.project")}),e.jsx("th",{children:t("dashboard.reports")}),e.jsx("th",{children:t("dashboard.accidents")}),e.jsx("th",{children:t("dashboard.training.totalTrainings")}),e.jsx("th",{children:t("dashboard.avgTf")}),e.jsx("th",{children:t("dashboard.avgTg")})]})}),e.jsx("tbody",{children:B.slice(0,5).map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium dark:text-gray-100",children:a.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.code})]})}),e.jsx("td",{children:a.reports_count}),e.jsx("td",{children:e.jsx("span",{className:a.total_accidents>0?"text-red-600 dark:text-red-400 font-semibold":"text-green-600 dark:text-green-400",children:a.total_accidents})}),e.jsx("td",{children:a.total_trainings}),e.jsx("td",{children:Number(a.avg_tf).toFixed(2)}),e.jsx("td",{children:Number(a.avg_tg).toFixed(2)})]},a.id))})]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t("dashboard.recentSubmissions")})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:d?.recent_reports?.filter(a=>a.status!=="draft").slice(0,5).map(a=>e.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:a.project?.name||"Unknown Project"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.report_month,"/",a.report_year," • Submitted by ",a.submitter?.name]})]}),e.jsx("span",{className:`badge ${a.status==="approved"?"badge-success":a.status==="submitted"?"badge-warning":a.status==="rejected"?"badge-danger":"badge-info"}`,children:a.status})]})},a.id))})]})]})]})}const Se=r.memo(function({title:l,value:d,subtitle:o,icon:s,color:n}){const i={blue:"bg-blue-50 text-blue-600",green:"bg-green-50 text-green-600",amber:"bg-amber-50 text-amber-600",purple:"bg-purple-50 text-purple-600",red:"bg-red-50 text-red-600"};return e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:l}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1",children:d}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:o})]}),e.jsx("div",{className:`p-3 rounded-lg ${i[n]}`,children:e.jsx(s,{className:"w-5 h-5"})})]})})}),xe=r.memo(function({title:l,value:d,icon:o,color:s,trend:n}){const i={red:"border-red-200 bg-red-50 dark:border-red-700 dark:bg-red-900/50",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50",blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50"},y={red:"text-red-600 dark:text-red-400",green:"text-green-600 dark:text-green-400",blue:"text-blue-600 dark:text-blue-400",amber:"text-amber-600 dark:text-amber-400",purple:"text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${i[s]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(o,{className:`w-5 h-5 ${y[s]}`}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:l})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:d}),n&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:n})]})});export{Ja as default};
