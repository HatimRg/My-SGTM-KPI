import{d as ve,j as e,p as ht,e as ne,u as xt,f as Je,g as gt,h as et}from"./index.js";import{r as a,u as ut,L as bt}from"./vendor-react.js";import{Q as pt,j as rt,e as He,c as Ge,i as ft,A as Fe,V as yt,Y as jt,Z as nt,_ as lt,U as ze,s as Ze,q as vt,$ as kt,a0 as Nt,z as De,a1 as _t,a2 as wt,a3 as St,a4 as Ct,a5 as Tt,a6 as Mt,a7 as $t,a8 as At,a9 as Rt,v as Kt,aa as Pt,ab as Dt,h as tt,F as zt,T as Ft,ac as Lt,ad as Wt}from"./vendor-ui.js";import{R as W,A as qe,C as O,X as H,Y as I,T as B,a as Ae,P as ot,b as it,c as we,L as fe,d as Xe,e as je,B as ge,f as J,g as dt,h as Ve,i as It,S as Bt,Z as Ut,j as Et}from"./vendor-charts.js";import{g as $e,a as Ot}from"./weekHelper.js";import{s as Ht,g as at}from"./projectList.js";import"./vendor-utils.js";const Gt=[{id:"overview",nameKey:"dashboard.themes.overview",icon:pt,gradient:"from-purple-500 to-purple-700"},{id:"safety",nameKey:"dashboard.themes.safety",icon:rt,gradient:"from-red-500 to-red-700"},{id:"training",nameKey:"dashboard.themes.training",icon:He,gradient:"from-blue-500 to-blue-700"},{id:"compliance",nameKey:"dashboard.themes.compliance",icon:Ge,gradient:"from-green-500 to-green-700"},{id:"ppe",nameKey:"dashboard.themes.ppe",icon:ft,gradient:"from-slate-500 to-slate-700"},{id:"deviations",nameKey:"dashboard.themes.deviations",icon:Fe,gradient:"from-amber-500 to-amber-700"},{id:"environmental",nameKey:"dashboard.themes.environmental",icon:yt,gradient:"from-emerald-500 to-emerald-700"}],qt=a.memo(function({activeTheme:g,onThemeChange:i}){const x=ve();return e.jsx("div",{className:"relative mb-4",children:e.jsx("div",{className:"flex items-center justify-center gap-1 flex-wrap",children:Gt.map(l=>{const h=l.icon,s=g===l.id;return e.jsxs("button",{onClick:()=>i(l.id),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg border transition-all duration-200 ${s?`bg-gradient-to-r ${l.gradient} text-white border-transparent shadow-md`:"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600 hover:shadow-sm"}`,children:[e.jsx(h,{className:`w-4 h-4 ${s?"text-white":""}`}),e.jsx("span",{className:`font-medium text-xs ${s?"text-white":""}`,children:x(l.nameKey)})]},l.id)})})})}),Ne={fatal:"#dc2626",serious:"#f59e0b",minor:"#16a34a",tf:"#f59e0b",tg:"#8b5cf6"},We=a.memo(function({title:g,value:i,icon:x,color:l,trend:h}){const s={red:"border-red-200 bg-red-50 dark:border-red-700 dark:bg-red-900/50 text-red-600 dark:text-red-400",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${s[l]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(x,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:g})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:i}),h&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:h})]})}),Yt=a.memo(function({kpiSummary:g,weeklyTrends:i,projectPerformance:x}){const l=ve(),h=a.useMemo(()=>({totalAccidents:g?.total_accidents??0,fatalAccidents:g?.fatal_accidents??0,avgTF:Number(g?.avg_tf??0).toFixed(2),avgTG:Number(g?.avg_tg??0).toFixed(2),lostWorkdays:g?.lost_workdays??0}),[g]),s=a.useMemo(()=>(i??[]).map(b=>({week:b.week_label,accidents:b.accidents??0})),[i]),_=a.useMemo(()=>{h.totalAccidents;const b=h.fatalAccidents,$=g?.serious_accidents,K=g?.minor_accidents,Y=$!=null&&K!==null&&K!==void 0,m=Y?Number($??0):(i??[]).reduce((T,ee)=>T+Number(ee?.serious_accidents??0),0),w=Y?Number(K??0):(i??[]).reduce((T,ee)=>T+Number(ee?.minor_accidents??0),0);return[{name:l("dashboard.safety.fatal"),value:Number(b??0),color:Ne.fatal},{name:l("dashboard.safety.serious"),value:Number(m??0),color:Ne.serious},{name:l("dashboard.safety.minor"),value:Number(w??0),color:Ne.minor}].filter(T=>T.value>0)},[h,l,g,i]),R=a.useMemo(()=>(i??[]).map(b=>({week:b.week_label,tf:Number(b.tf??0).toFixed(4),tg:Number(b.tg??0).toFixed(4)})),[i]),p=a.useMemo(()=>(x??[]).slice(0,6).map(b=>({name:b.name?.length>15?b.name.substring(0,15)+"...":b.name,accidents:b.total_accidents??0})),[x]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(We,{title:l("dashboard.safety.totalAccidents"),value:h.totalAccidents,icon:Fe,color:h.totalAccidents>0?"red":"green",trend:l("dashboard.safety.yearToDate")}),e.jsx(We,{title:l("dashboard.safety.fatalAccidents"),value:h.fatalAccidents,icon:jt,color:h.fatalAccidents>0?"red":"green",trend:h.fatalAccidents===0?l("dashboard.safety.noFatalities"):l("dashboard.safety.critical")}),e.jsx(We,{title:l("dashboard.safety.tfRate"),value:h.avgTF,icon:nt,color:"amber",trend:l("dashboard.safety.avgFrequencyRate")}),e.jsx(We,{title:l("dashboard.safety.tgRate"),value:h.avgTG,icon:lt,color:"purple",trend:l("dashboard.safety.avgSeverityRate")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:l("dashboard.safety.accidentTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(qe,{data:s,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"accidentGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#dc2626",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#dc2626",stopOpacity:.1})]})}),e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(H,{dataKey:"week",tick:{fontSize:11}}),e.jsx(I,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(B,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(Ae,{type:"monotone",dataKey:"accidents",stroke:"#dc2626",fill:"url(#accidentGradient)",name:"Accidents"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:l("dashboard.safety.accidentsBySeverity")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:_.length>0?e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(ot,{children:[e.jsx(it,{data:_,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:b,value:$})=>`${b}: ${$}`,children:_.map((b,$)=>e.jsx(we,{fill:b.color},`cell-${$}`))}),e.jsx(B,{}),e.jsx(fe,{})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-green-600 dark:text-green-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Fe,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"font-medium",children:l("dashboard.safety.noAccidents")}),e.jsx("p",{className:"text-sm text-gray-500",children:l("dashboard.safety.greatSafety")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:l("dashboard.safety.tfVsTg")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(Xe,{data:R,children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(H,{dataKey:"week",tick:{fontSize:11}}),e.jsx(I,{tick:{fontSize:11}}),e.jsx(B,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(fe,{}),e.jsx(je,{type:"monotone",dataKey:"tf",stroke:Ne.tf,strokeWidth:2,dot:{fill:Ne.tf,r:3},name:"TF Rate"}),e.jsx(je,{type:"monotone",dataKey:"tg",stroke:Ne.tg,strokeWidth:2,dot:{fill:Ne.tg,r:3},name:"TG Rate"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:l("dashboard.safety.accidentsByProject")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(ge,{data:p,layout:"vertical",children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(H,{type:"number",allowDecimals:!1,tick:{fontSize:11}}),e.jsx(I,{type:"category",dataKey:"name",tick:{fontSize:10},width:100}),e.jsx(B,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(J,{dataKey:"accidents",fill:"#dc2626",radius:[0,4,4,0],name:"Accidents"})]})})})})]})]})]})}),_e=a.memo(function({title:g,value:i,icon:x,color:l,trend:h}){const s={blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${s[l]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(x,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:g})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:i}),h&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:h})]})}),Vt=a.memo(function({kpiSummary:g,weeklyTrends:i,projectPerformance:x,trainingData:l,awarenessData:h}){const s=ve(),_=a.useMemo(()=>{const m=l?.total??g?.total_trainings??0,w=l?.total_participants??g?.employees_trained??0,T=l?.total_hours??g?.total_training_hours??g?.training_hours??0,ee=g?.total_trainings_planned??0,ce=ee>0?Math.round(m/ee*100):null;return{totalTrainings:m,employeesTrained:w,trainingHours:T,completionRate:ce}},[g,l]),R=a.useMemo(()=>({totalSessions:h?.total??0,totalParticipants:h?.total_participants??0,totalHours:h?.total_hours??0}),[h]),p=a.useMemo(()=>l?.by_week?.length>0?l.by_week.map(m=>({week:"S"+m.week_number,trainings:m.count??0,participants:m.participants??0})):(i??[]).map(m=>({week:m.week_label,trainings:m.trainings??0})),[i,l]),b=a.useMemo(()=>{if(l?.by_theme?.length>0){const m=["#3b82f6","#8b5cf6","#ec4899","#14b8a6","#f59e0b","#ef4444","#10b981","#6366f1"];return l.by_theme.slice(0,8).map((w,T)=>({name:w.theme?.length>20?w.theme.substring(0,20)+"...":w.theme,fullName:w.theme,value:w.count,participants:w.participants??0,color:m[T%m.length]}))}return[]},[l]),$=a.useMemo(()=>l?.by_duration?.length>0?l.by_duration.map(m=>({duration:m.duration,count:m.count,participants:m.participants??0})):[],[l]),K=a.useMemo(()=>{if(h?.by_theme?.length>0){const m=["#16a34a","#0ea5e9","#f97316","#a855f7","#eab308","#06b6d4","#84cc16","#d946ef"];return h.by_theme.slice(0,8).map((w,T)=>({name:w.theme?.length>20?w.theme.substring(0,20)+"...":w.theme,fullName:w.theme,value:w.count,participants:w.participants??0,color:m[T%m.length]}))}return[]},[h]),Y=a.useMemo(()=>l?.by_type?.length>0?l.by_type.map(m=>({name:m.type==="internal"?s("dashboard.training.internal"):s("dashboard.training.external"),value:m.count,color:m.type==="internal"?"#3b82f6":"#8b5cf6"})):[],[l,s]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(_e,{title:s("dashboard.training.totalTrainings"),value:_.totalTrainings,icon:He,color:"blue",trend:s("dashboard.training.sessionsCompleted")}),e.jsx(_e,{title:s("dashboard.training.employeesTrained"),value:_.employeesTrained,icon:ze,color:"green",trend:s("dashboard.training.uniqueAttendees")}),e.jsx(_e,{title:s("dashboard.training.trainingHours"),value:_.trainingHours,icon:Ze,color:"purple",trend:s("dashboard.training.totalHoursDelivered")}),e.jsx(_e,{title:s("dashboard.training.completionRate"),value:_.completionRate!==null?`${_.completionRate}%`:"—",icon:vt,color:"amber",trend:`${s("dashboard.training.target")}: 95%`})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("dashboard.training.trainingTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(qe,{data:p,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"trainingGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.1})]})}),e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(H,{dataKey:"week",tick:{fontSize:11}}),e.jsx(I,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(B,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(Ae,{type:"monotone",dataKey:"trainings",stroke:"#3b82f6",fill:"url(#trainingGradient)",name:"Trainings"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("dashboard.training.trainingByTheme")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-72",children:b.length>0?e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(ge,{data:b,layout:"vertical",margin:{left:10,right:20},children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(H,{type:"number",allowDecimals:!1,tick:{fontSize:11}}),e.jsx(I,{type:"category",dataKey:"name",tick:{fontSize:10},width:120}),e.jsx(B,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},formatter:(m,w,T)=>[`${m} sessions (${T.payload.participants} participants)`,"Count"]}),e.jsx(J,{dataKey:"value",radius:[0,4,4,0],children:b.map((m,w)=>e.jsx(we,{fill:m.color},`cell-${w}`))})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(He,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"font-medium",children:s("dashboard.training.noTrainingData")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("dashboard.training.trainingByDuration")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:$.length>0?e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(ge,{data:$,children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(H,{dataKey:"duration",tick:{fontSize:11}}),e.jsx(I,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(B,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},formatter:(m,w)=>[m,w==="count"?"Sessions":"Participants"]}),e.jsx(J,{dataKey:"count",fill:"#8b5cf6",radius:[4,4,0,0],name:"Sessions"})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{className:"font-medium",children:s("dashboard.training.noTrainingData")})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("dashboard.training.awarenessByTheme")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-72",children:K.length>0?e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(ge,{data:K,layout:"vertical",margin:{left:10,right:20},children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(H,{type:"number",allowDecimals:!1,tick:{fontSize:11}}),e.jsx(I,{type:"category",dataKey:"name",tick:{fontSize:10},width:120}),e.jsx(B,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},formatter:(m,w,T)=>[`${m} sessions (${T.payload.participants} participants)`,"Count"]}),e.jsx(J,{dataKey:"value",radius:[0,4,4,0],children:K.map((m,w)=>e.jsx(we,{fill:m.color},`cell-${w}`))})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{className:"font-medium",children:s("dashboard.training.noTrainingData")})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("dashboard.training.trainingByType")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:Y.length>0?e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(ot,{children:[e.jsx(it,{data:Y,cx:"50%",cy:"45%",innerRadius:40,outerRadius:70,paddingAngle:5,dataKey:"value",label:({value:m})=>m,labelLine:!1,children:Y.map((m,w)=>e.jsx(we,{fill:m.color},`cell-${w}`))}),e.jsx(B,{formatter:(m,w)=>[m,w]}),e.jsx(fe,{verticalAlign:"bottom",height:36,formatter:m=>e.jsx("span",{className:"text-sm",children:m})})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{className:"font-medium",children:s("dashboard.training.noTrainingData")})})})})]})]}),R.totalSessions>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx(_e,{title:s("dashboard.training.totalAwareness"),value:R.totalSessions,icon:ze,color:"green",trend:`${R.totalParticipants} participants`}),e.jsx(_e,{title:s("dashboard.training.awarenessParticipants"),value:R.totalParticipants,icon:ze,color:"purple"}),e.jsx(_e,{title:s("dashboard.training.awarenessHours"),value:Math.round(R.totalHours??0),icon:Ze,color:"amber"})]})]})}),Zt={compliance:"#16a34a"},Ie=a.memo(function({title:g,value:i,icon:x,color:l,trend:h}){const s={green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${s[l]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(x,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:g})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:i}),h&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:h})]})}),Xt=a.memo(function({kpiSummary:g,weeklyTrends:i,projectPerformance:x,inspectionData:l,sorData:h,regulatoryWatch:s}){const _=ve(),R=a.useMemo(()=>{const $=g?.total_inspections??0,K=Number(s?.avg_overall_score??0).toFixed(1),Y=Number(g?.avg_medical_compliance??0).toFixed(1),m=h?.stats?.total??0,w=h?.stats?.closed??0,T=m>0?Math.round(w/m*100):null;return{totalInspections:$,hseCompliance:K,medicalCompliance:Y,auditScore:T}},[g,h,s]),p=a.useMemo(()=>(i??[]).map($=>({week:$.week_label,inspections:$.inspections??0})),[i]),b=a.useMemo(()=>(h?.by_category??[]).map($=>({category:$.label??$.category,count:$.count??0})),[h]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Ie,{title:_("dashboard.compliance.totalInspections"),value:R.totalInspections,icon:Ge,color:"green",trend:_("dashboard.compliance.completedThisYear")}),e.jsx(Ie,{title:_("dashboard.compliance.hseCompliance"),value:`${R.hseCompliance}%`,icon:rt,color:"blue",trend:_("dashboard.compliance.avgScore")}),e.jsx(Ie,{title:_("dashboard.compliance.medicalCompliance"),value:`${R.medicalCompliance}%`,icon:kt,color:"purple",trend:_("dashboard.compliance.healthChecks")}),R.auditScore!==null&&e.jsx(Ie,{title:_("dashboard.compliance.auditScore"),value:`${R.auditScore}%`,icon:Nt,color:"amber",trend:_("dashboard.compliance.latestAudit")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:_("dashboard.compliance.inspectionTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(qe,{data:p,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"complianceGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#16a34a",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#16a34a",stopOpacity:.1})]})}),e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(H,{dataKey:"week",tick:{fontSize:11}}),e.jsx(I,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(B,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(Ae,{type:"monotone",dataKey:"inspections",stroke:"#16a34a",fill:"url(#complianceGradient)",name:"Inspections"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:_("dashboard.compliance.auditFindings")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(ge,{data:b,children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(H,{dataKey:"category",tick:{fontSize:11}}),e.jsx(I,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(B,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(J,{dataKey:"count",fill:Zt.compliance,name:_("dashboard.compliance.findings"),radius:[4,4,0,0]})]})})})})]})]})]})}),st=["#3b82f6","#22c55e","#f59e0b","#ef4444","#8b5cf6","#06b6d4","#ec4899","#14b8a6","#f97316","#84cc16","#0ea5e9","#a855f7"],Qt=a.memo(function({active:g,payload:i,label:x,t:l,poleLabelByKey:h}){if(!g||!i||i.length===0)return null;const s=i[0],_=String(s?.dataKey??""),R=_.includes("__p_")?_.split("__p_")[0]:"",p=h?.[R]??"",b=p?`${x} • ${p}`:x,$=i.filter(K=>Number(K?.value??0)>0);return e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-3 shadow-lg",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-gray-100 text-sm mb-2",children:b}),e.jsx("div",{className:"space-y-1",children:$.map(K=>e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded",style:{backgroundColor:K.color}}),e.jsx("span",{className:"text-xs text-gray-700 dark:text-gray-200",children:K.name})]}),e.jsx("span",{className:"text-xs font-semibold text-gray-900 dark:text-gray-100",children:K.value})]},K.dataKey))}),e.jsx("p",{className:"mt-2 text-[11px] text-gray-500 dark:text-gray-400",children:l("ppe.analytics.tooltipHint")})]})}),Jt=a.memo(function({year:g,projectId:i,pole:x}){const l=ve(),h=d=>String(d??"").trim().toLowerCase().replace(/[^a-z0-9]+/g,"_")||"unknown",[s,_]=a.useState(!0),[R,p]=a.useState([]),[b,$]=a.useState([]),[K,Y]=a.useState("year"),[m,w]=a.useState(()=>new Date().getMonth()+1),[T,ee]=a.useState(""),[ce,me]=a.useState([]);a.useEffect(()=>{(async()=>{try{const v=await ht.getItems(),j=v.data?.data??v.data??[],M=Array.isArray(j)?j:[];p(M),$(M.map(G=>G.id))}catch{p([]),$([])}})()},[]),a.useEffect(()=>{const d=async()=>{try{_(!0);const v={year:g,duration:K,item_ids:b};x&&(v.pole=x),i&&i!=="all"&&(v.project_id=i),K==="month"&&(v.month=m),K==="week"&&(v.week=T);const M=(await ne.getPpeConsumptionAnalytics(v)).data?.data?.rows??[];me(Array.isArray(M)?M:[])}catch{De.error(l("errors.failedToLoad")),me([])}finally{_(!1)}};if(K==="week"&&(!T||String(T).trim()==="")){me([]),_(!1);return}if(!b||b.length===0){me([]),_(!1);return}d()},[g,K,m,T,b,i,x,l]);const U=a.useMemo(()=>(R??[]).map(d=>({id:d.id,name:d.name})),[R]),Q=a.useMemo(()=>new Set(b.map(d=>Number(d))),[b]),D=a.useMemo(()=>!ce||ce.length===0?[]:ce.filter(d=>Q.has(Number(d.item_id))),[ce,Q]),ue=a.useMemo(()=>{const d=new Map;for(const j of D){const M=Number(j.project_id),G=Number(j.quantity??0);d.set(M,(d.get(M)??0)+G)}const v=Array.from(d.entries()).map(([j,M])=>{const G=D.find(ae=>Number(ae.project_id)===Number(j)),E=G?.project_code?`${G.project_code}`:G?.project_name??`#${j}`;return{projectId:j,total:M,name:E}});return v.sort((j,M)=>M.total-j.total),v},[D]),he=a.useMemo(()=>{const d=new Map;return ue.forEach((v,j)=>{d.set(v.projectId,st[j%st.length])}),d},[ue]),le=a.useMemo(()=>{const d=new Set;for(const j of D)d.add(String(j.pole??""));const v=Array.from(d.values());return v.sort((j,M)=>j.localeCompare(M)),v},[D]),oe=a.useMemo(()=>{const d={};for(const v of le)d[h(v)]=v;return d},[le]),Z=a.useMemo(()=>{const d=new Map;for(const j of D){const M=Number(j.item_id),G=j.item_name;d.has(M)||d.set(M,{item_id:M,label:G,item_name:G,byPole:new Map});const E=d.get(M),ae=String(j.pole??"");E.byPole.has(ae)||E.byPole.set(ae,new Map);const se=Number(j.project_id),de=Number(j.quantity??0),te=E.byPole.get(ae);te.set(se,(te.get(se)??0)+de)}const v=Array.from(d.values());return v.sort((j,M)=>String(j.item_name||"").localeCompare(String(M.item_name||""))),v.map(j=>{const M={label:j.label,item_name:j.item_name};for(const[G,E]of j.byPole.entries()){const ae=h(G);for(const[se,de]of E.entries())M[`${ae}__p_${se}`]=de}return M})},[D]),X=a.useMemo(()=>le.flatMap(d=>{const v=h(d);return ue.map(j=>({key:`${v}__p_${j.projectId}`,stackId:v,poleLabel:d,name:j.name,color:he.get(j.projectId)??"#3b82f6"}))}),[le,ue,he]),Se=d=>{$(d?U.map(v=>v.id):[])},ie=b.length>0&&b.length===U.length;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:l("ppe.analytics.title")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:l("ppe.analytics.subtitle")})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("select",{value:K,onChange:d=>Y(d.target.value),className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md px-2 py-1 text-sm",children:[e.jsx("option",{value:"year",children:l("ppe.analytics.duration.year")}),e.jsx("option",{value:"month",children:l("ppe.analytics.duration.month")}),e.jsx("option",{value:"week",children:l("ppe.analytics.duration.week")})]}),K==="month"&&e.jsx("input",{type:"number",min:1,max:12,value:m,onChange:d=>w(Number(d.target.value)),className:"w-20 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md px-2 py-1 text-sm"}),K==="week"&&e.jsx("input",{type:"number",min:1,max:52,value:T,onChange:d=>ee(d.target.value),placeholder:"1-52",className:"w-20 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md px-2 py-1 text-sm"})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:l("ppe.analytics.filters.items")}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:ie,onChange:d=>Se(d.target.checked)}),l("ppe.analytics.filters.selectAll")]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 max-h-40 overflow-y-auto pr-1",children:U.map(d=>{const v=Q.has(Number(d.id));return e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-700 dark:text-gray-200",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:j=>{const M=new Set(Q);j.target.checked?M.add(Number(d.id)):M.delete(Number(d.id)),$(Array.from(M.values()))}}),d.name]},d.id)})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100",children:l("ppe.analytics.chartTitle")})}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"h-[520px]",children:e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(ge,{data:Z,margin:{top:10,right:20,left:10,bottom:90},barCategoryGap:18,children:[e.jsx(O,{strokeDasharray:"3 3"}),e.jsx(H,{dataKey:"label",interval:0,angle:-45,textAnchor:"end",height:90,tick:{fontSize:11}}),e.jsx(I,{tick:{fontSize:11},width:60,label:{value:l("ppe.analytics.yAxis"),angle:-90,position:"insideLeft"}}),e.jsx(B,{shared:!1,content:d=>e.jsx(Qt,{...d,t:l,poleLabelByKey:oe})}),X.map(d=>e.jsx(J,{dataKey:d.key,stackId:d.stackId,fill:d.color,name:d.name,isAnimationActive:!1},d.key))]})})}),!s&&Z.length===0&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:l("ppe.analytics.noData")}),s&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:l("common.loading")})]})]})]})}),V={water:"#0ea5e9",electricity:"#eab308",hse:"#22c55e",medical:"#8b5cf6",training:"#f59e0b",nearMiss:"#ef4444"},Be=a.memo(function({title:g,value:i,icon:x,color:l,trend:h,unit:s}){const _={blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400",yellow:"border-yellow-200 bg-yellow-50 dark:border-yellow-700 dark:bg-yellow-900/50 text-yellow-600 dark:text-yellow-400",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${_[l]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(x,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:g})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:[i,e.jsx("span",{className:"text-sm font-normal ml-1",children:s})]}),h&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:h})]})}),ea=a.memo(function({kpiSummary:g,weeklyTrends:i}){const x=ve(),l=a.useMemo(()=>({waterConsumption:Number(g?.total_water_consumption??0),electricityUsage:Number(g?.total_electricity_consumption??0),hseCompliance:Math.round(Number(g?.avg_hse_compliance??0)),medicalCompliance:Math.round(Number(g?.avg_medical_compliance??0)),trainingHours:Math.round(Number(g?.total_training_hours??0)),nearMisses:Number(g?.total_near_misses??0),workPermits:Number(g?.total_work_permits??0)}),[g]),h=a.useMemo(()=>(i??[]).map(p=>({week:p.week_label,water:p.water??0,electricity:p.electricity??0,training_hours:p.training_hours??0})),[i]),s=a.useMemo(()=>(i??[]).map(p=>({week:p.week_label,hse:p.hse_compliance??0,medical:p.medical_compliance??0})),[i]),_=a.useMemo(()=>(i??[]).map(p=>({week:p.week_label,near_misses:p.near_misses??0,accidents:p.accidents??0,inspections:p.inspections??0})),[i]),R=a.useMemo(()=>[{name:x("dashboard.environmental.hseCompliance"),current:l.hseCompliance,target:95,color:V.hse},{name:x("dashboard.environmental.medicalCompliance"),current:l.medicalCompliance,target:95,color:V.medical}],[x,l]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Be,{title:x("dashboard.environmental.hseCompliance"),value:l.hseCompliance,icon:Ge,color:"green",unit:"%",trend:x("dashboard.environmental.yearToDate")}),e.jsx(Be,{title:x("dashboard.environmental.medicalCompliance"),value:l.medicalCompliance,icon:_t,color:"purple",unit:"%",trend:x("dashboard.environmental.yearToDate")}),e.jsx(Be,{title:x("dashboard.environmental.waterConsumption"),value:l.waterConsumption.toLocaleString(),icon:wt,color:"blue",unit:"m³",trend:x("dashboard.environmental.yearToDate")}),e.jsx(Be,{title:x("dashboard.environmental.electricityUsage"),value:l.electricityUsage.toLocaleString(),icon:St,color:"yellow",unit:"kWh",trend:x("dashboard.environmental.yearToDate")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:x("dashboard.environmental.complianceTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(Xe,{data:s,children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(H,{dataKey:"week",tick:{fontSize:11}}),e.jsx(I,{tick:{fontSize:11},domain:[0,100]}),e.jsx(B,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(fe,{}),e.jsx(je,{type:"monotone",dataKey:"hse",stroke:V.hse,strokeWidth:2,dot:{fill:V.hse,r:3},name:x("dashboard.environmental.hseCompliance")}),e.jsx(je,{type:"monotone",dataKey:"medical",stroke:V.medical,strokeWidth:2,dot:{fill:V.medical,r:3},name:x("dashboard.environmental.medicalCompliance")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:x("dashboard.environmental.waterVsElectricity")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(dt,{data:h,children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(H,{dataKey:"week",tick:{fontSize:11}}),e.jsx(I,{yAxisId:"left",tick:{fontSize:11},stroke:V.water}),e.jsx(I,{yAxisId:"right",orientation:"right",tick:{fontSize:11},stroke:V.electricity}),e.jsx(B,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(fe,{}),e.jsx(J,{yAxisId:"left",dataKey:"water",fill:V.water,name:"Water (m³)",radius:[4,4,0,0]}),e.jsx(je,{yAxisId:"right",type:"monotone",dataKey:"electricity",stroke:V.electricity,strokeWidth:2,name:"Electricity (kWh)"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:x("dashboard.environmental.safetyTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(qe,{data:_,children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(H,{dataKey:"week",tick:{fontSize:11}}),e.jsx(I,{tick:{fontSize:11}}),e.jsx(B,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(fe,{}),e.jsx(Ae,{type:"monotone",dataKey:"inspections",stroke:V.hse,fill:V.hse,fillOpacity:.6,name:x("dashboard.inspections")}),e.jsx(Ae,{type:"monotone",dataKey:"near_misses",stroke:V.training,fill:V.training,fillOpacity:.6,name:x("dashboard.nearMisses")}),e.jsx(Ae,{type:"monotone",dataKey:"accidents",stroke:V.nearMiss,fill:V.nearMiss,fillOpacity:.6,name:x("dashboard.accidents")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:x("dashboard.environmental.complianceProgress")})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"space-y-6 py-4",children:[R.map((p,b)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:p.name}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[p.current,"% / ",p.target,"%"]})]}),e.jsxs("div",{className:"relative h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:[e.jsx("div",{className:"absolute h-full rounded-full transition-all duration-500",style:{width:`${Math.min(p.current,100)}%`,backgroundColor:p.color}}),e.jsx("div",{className:"absolute h-full w-0.5 bg-gray-800 dark:bg-gray-300",style:{left:`${p.target}%`},title:`Target: ${p.target}%`})]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:p.current>=p.target?`✓ ${x("dashboard.environmental.targetAchieved")}`:`${p.target-p.current}% ${x("dashboard.environmental.toTarget")}`})]},p.name)),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:l.trainingHours.toLocaleString()}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:x("dashboard.environmental.trainingHoursYTD")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:l.nearMisses}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:x("dashboard.environmental.nearMissesYTD")})]})]})})]})})]})]})]})}),Ue={trend:"#3b82f6",resolved:"#16a34a",unresolved:"#dc2626"},Ee=["#2563eb","#7c3aed","#f59e0b","#10b981","#ef4444","#06b6d4","#a855f7","#84cc16"],Ke=a.memo(function({title:g,value:i,icon:x,color:l,subtitle:h}){const s={red:"border-red-200 bg-red-50 dark:border-red-700 dark:bg-red-900/50 text-red-600 dark:text-red-400",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400",blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${s[l]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(x,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:g})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:i}),h&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:h})]})}),ta=a.memo(function({year:g,projects:i,projectId:x="all",week:l="all",pole:h=""}){const s=ve(),[_,R]=a.useState(!0),[p,b]=a.useState(null),[$,K]=a.useState(null),[Y,m]=a.useState(null),[w,T]=a.useState(null),[ee,ce]=a.useState(null),[me,U]=a.useState(null),[Q,D]=a.useState(null),[ue,he]=a.useState(null),[le,oe]=a.useState(null),Z=o=>{if(o==null)return"—";const r=Number(o);return Number.isNaN(r)?"—":r<48?`${Math.round(r*10)/10}h`:`${Math.round(r/24*10)/10}d`},X=a.useMemo(()=>{const o=new Map,r=k=>{const c=String(k??"");let C=0;for(let L=0;L<c.length;L+=1)C=(C<<5)-C+c.charCodeAt(L),C|=0;return Math.abs(C)};return[...new Set([...(Q?.items??[]).map(k=>k?.pole).filter(Boolean),...(le?.rows??[]).map(k=>k?.pole).filter(Boolean)])].forEach(k=>{const c=r(k)%Ee.length;o.set(k,Ee[c])}),k=>{const c=k&&String(k).trim()!==""?String(k):"—";if(!o.has(c)){const C=r(c)%Ee.length;o.set(c,Ee[C])}return o.get(c)}},[Q?.items,le?.rows]);a.useEffect(()=>{let o=!0;return(async()=>{R(!0);try{const u={year:g};h&&(u.pole=h),x!=="all"&&(u.project_id=x),l!=="all"&&(u.week=l);const[k,c,C,L,xe,be,Te,Me,F]=await Promise.all([ne.getSorAnalyticsKpis(u),ne.getSorProjectTreemap(u),ne.getSorThemeAvgResolution(u),ne.getSorThemeResolutionBox(u),ne.getSorThemeUnresolvedCount(u),ne.getSorThemeResolvedUnresolved(u),ne.getSorThemeBubble(u),ne.getSorUserThemeAvgResolution(u),ne.getSorPoleThemeUnresolvedRate(u)]);if(!o)return;b(k.data.data),K(c.data.data),m(C.data.data),T(L.data.data),ce(xe.data.data),U(be.data.data),D(Te.data.data),he(Me.data.data),oe(F.data.data)}finally{o&&R(!1)}})(),()=>{o=!1}},[g,x,l,h]);const Se=p?.total??0,ie=p?.unresolved_pct??0,d=p?.avg_resolution_hours,v=p?.worst_theme,j=p?.worst_project,M=p?.highest_avg_resolution_user,G=a.useMemo(()=>($?.items??[]).map(r=>({name:r.name,size:r.count??0,pole:r.pole??"—",count:r.count??0})),[$?.items]),E=a.useMemo(()=>(Y?.items??[]).filter(r=>r?.avg_hours!==null&&r?.avg_hours!==void 0).map(r=>({theme:(r.theme??"").toString().slice(0,28),theme_full:r.theme,avg_hours:Number(r.avg_hours??0),count:r.count??0})),[Y?.items]),ae=a.useMemo(()=>{const o=Math.max(0,...E.map(r=>r.avg_hours));return o>0?o:1},[E]),se=a.useMemo(()=>(ee?.items??[]).map(r=>({theme:(r.theme??"").toString().slice(0,28),theme_full:r.theme,count:r.count??0})),[ee?.items]),de=a.useMemo(()=>(me?.items??[]).map(r=>({theme:(r.theme??"").toString().slice(0,26),theme_full:r.theme,resolved:r.resolved??0,unresolved:r.unresolved??0,total:r.total??0})),[me?.items]),te=a.useMemo(()=>(Q?.items??[]).filter(r=>r?.avg_hours!==null&&r?.avg_hours!==void 0).map(r=>({theme:(r.theme??"").toString().slice(0,26),theme_full:r.theme,avg_hours:Number(r.avg_hours??0),count:Number(r.count??0),pole:r.pole??"—"})),[Q?.items]),ye=a.useMemo(()=>{const o=Q?.items??[],r=new Map;return o.forEach(u=>{const k=u?.pole&&String(u.pole).trim()!==""?String(u.pole):"—",c=Number(u?.count??0),C=Number(u?.avg_hours??0);r.has(k)||r.set(k,{pole:k,total:0,_weightedHours:0});const L=r.get(k);L.total+=c,L._weightedHours+=c*C}),Array.from(r.values()).map(u=>({pole:u.pole,total:u.total,avg_hours:u.total>0?u._weightedHours/u.total:0})).sort((u,k)=>k.total-u.total)},[Q?.items]),Ce=a.useMemo(()=>(w?.items??[]).filter(r=>r&&r.count>0).map(r=>({theme:(r.theme??"").toString().slice(0,26),theme_full:r.theme,count:r.count,min:Number(r.min??0),q1:Number(r.q1??0),median:Number(r.median??0),q3:Number(r.q3??0),max:Number(r.max??0)})),[w?.items]),q=a.useMemo(()=>{const o=Math.max(0,...Ce.map(r=>r.max));return o>0?o:1},[Ce]),re=(o,r,u)=>{if(o==null)return"transparent";const k=Number(o);if(Number.isNaN(k)||k<=0)return"transparent";const C=.15+Math.min(1,Math.max(0,k/Math.max(1,r)))*.85;return`rgba(${u[0]}, ${u[1]}, ${u[2]}, ${C})`};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(Ke,{title:s("dashboard.deviations.total"),value:Se,icon:Fe,color:"blue",subtitle:s("dashboard.deviations.yearContext",{year:g})}),e.jsx(Ke,{title:s("dashboard.deviations.analytics.unresolvedPct"),value:`${ie}%`,icon:Ze,color:"red",subtitle:s("dashboard.deviations.analytics.unresolvedSubtitle")}),e.jsx(Ke,{title:s("dashboard.deviations.analytics.avgResolution"),value:d==null?"—":Z(d),icon:Ct,color:"green",subtitle:s("dashboard.deviations.analytics.avgResolutionSubtitle")}),e.jsx(Ke,{title:s("dashboard.deviations.analytics.worstTheme"),value:v?.label??"—",icon:Tt,color:"purple",subtitle:v?`${Z(v.avg_resolution_hours)} · ${v.unresolved??0}`:"—"}),e.jsx(Ke,{title:s("dashboard.deviations.analytics.worstProject"),value:j?.code??j?.name??"—",icon:Mt,color:"amber",subtitle:M?`${M.name} · ${Z(M.avg_resolution_hours)}`:"—"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("dashboard.deviations.analytics.poleTotals")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-[420px]",children:ye.length>0?e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(ge,{data:ye,layout:"vertical",margin:{left:12,right:92,top:10,bottom:10},barCategoryGap:14,children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(H,{type:"number",tick:{fontSize:11}}),e.jsx(I,{type:"category",dataKey:"pole",width:92,tick:{fontSize:11}}),e.jsx(B,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},formatter:o=>[o,s("dashboard.deviations.analytics.count")]}),e.jsxs(J,{dataKey:"total",radius:[0,6,6,0],barSize:38,children:[ye.map(o=>e.jsx(we,{fill:X(o.pole)},o.pole)),e.jsx(Ve,{dataKey:"total",position:"right",offset:8,fill:"#111827",fontSize:11})]})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:s("common.noData")})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("dashboard.deviations.analytics.projectTreemap")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-[420px]",children:G.length>0?e.jsx(W,{width:"100%",height:"100%",children:e.jsx(It,{data:G,dataKey:"size",nameKey:"name",stroke:"#ffffff",fill:"#93c5fd",content:({depth:o,x:r,y:u,width:k,height:c,name:C,payload:L})=>{const xe=L?.pole,be=L?.count,Te=X(xe),Me=k>70&&c>28;return e.jsxs("g",{children:[e.jsx("rect",{x:r,y:u,width:k,height:c,style:{fill:Te,stroke:"#ffffff",strokeWidth:2}}),Me&&e.jsx("text",{x:r+6,y:u+18,fill:"#ffffff",fontSize:11,fontWeight:700,children:String(C).slice(0,18)}),Me&&e.jsx("text",{x:r+6,y:u+34,fill:"#ffffff",fontSize:11,children:be})]})}})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:s("common.noData")})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("dashboard.deviations.analytics.themeAvgResolution")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-80",children:E.length>0?e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(ge,{data:E,layout:"vertical",margin:{left:10,right:20,top:10,bottom:10},children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(H,{type:"number",tick:{fontSize:11}}),e.jsx(I,{type:"category",dataKey:"theme",width:160,tick:{fontSize:11}}),e.jsx(B,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},formatter:(o,r,u)=>[Z(o),s("dashboard.deviations.analytics.hours")],labelFormatter:(o,r)=>r?.[0]?.payload?.theme_full??o}),e.jsxs(J,{dataKey:"avg_hours",radius:[0,6,6,0],children:[E.map(o=>{const r=Math.min(1,Math.max(0,o.avg_hours/ae)),u=Math.round(22+r*220),k=Math.round(163-r*120),c=Math.round(74-r*40);return e.jsx(we,{fill:`rgb(${u}, ${k}, ${c})`},o.theme_full)}),e.jsx(Ve,{dataKey:"avg_hours",position:"right",formatter:o=>Z(o),fill:"#111827",fontSize:11})]})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:s("common.noData")})})})]}),e.jsxs("div",{className:"card lg:col-span-2",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("dashboard.deviations.analytics.themeResolutionBox")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"space-y-2",children:Ce.length===0?e.jsx("div",{className:"flex items-center justify-center h-72 text-gray-400",children:s("common.noData")}):e.jsx("div",{className:"space-y-2",children:Ce.map(o=>{const r=o.min/q*100,u=o.max/q*100,k=o.q1/q*100,c=o.q3/q*100,C=o.median/q*100;return e.jsxs("div",{className:"grid grid-cols-[220px_1fr] gap-3 items-center",children:[e.jsx("div",{className:"text-[11px] text-gray-700 dark:text-gray-200 whitespace-nowrap overflow-hidden text-ellipsis",title:o.theme_full,children:o.theme}),e.jsxs("div",{className:"relative h-7",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 right-0 bg-gray-50 dark:bg-white/5 rounded"}),e.jsx("div",{className:"absolute top-1/2 h-[2px] bg-gray-300 dark:bg-white/20",style:{left:`${r}%`,right:`${100-u}%`,transform:"translateY(-50%)"}}),e.jsx("div",{className:"absolute top-1/2 w-[2px] bg-gray-400 dark:bg-white/40",style:{left:`${r}%`,height:"10px",transform:"translate(-50%, -50%)"}}),e.jsx("div",{className:"absolute top-1/2 w-[2px] bg-gray-400 dark:bg-white/40",style:{left:`${u}%`,height:"10px",transform:"translate(-50%, -50%)"}}),e.jsx("div",{className:"absolute top-1/2 bg-blue-500/70 dark:bg-blue-400/70 rounded",style:{left:`${k}%`,width:`${Math.max(0,c-k)}%`,height:"14px",transform:"translateY(-50%)"}}),e.jsx("div",{className:"absolute top-1/2 w-[2px] bg-white",style:{left:`${C}%`,height:"14px",transform:"translate(-50%, -50%)"}}),e.jsx("div",{className:"absolute -top-0.5 right-0 text-[10px] text-gray-500 dark:text-gray-400",children:Z(o.median)})]})]},o.theme_full)})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("dashboard.deviations.analytics.unresolvedByTheme")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-80",children:se.length>0?e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(ge,{data:se,layout:"vertical",margin:{left:10,right:20,top:10,bottom:10},children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(H,{type:"number",tick:{fontSize:11}}),e.jsx(I,{type:"category",dataKey:"theme",width:170,tick:{fontSize:11}}),e.jsx(B,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},labelFormatter:(o,r)=>r?.[0]?.payload?.theme_full??o}),e.jsx(J,{dataKey:"count",fill:Ue.unresolved,radius:[0,6,6,0],children:e.jsx(Ve,{dataKey:"count",position:"right",fill:"#111827",fontSize:11})})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:s("common.noData")})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("dashboard.deviations.analytics.resolvedVsUnresolved")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-80",children:de.length>0?e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(ge,{data:de,layout:"vertical",margin:{left:10,right:20,top:10,bottom:10},children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(H,{type:"number",tick:{fontSize:11}}),e.jsx(I,{type:"category",dataKey:"theme",width:170,tick:{fontSize:11}}),e.jsx(B,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},labelFormatter:(o,r)=>r?.[0]?.payload?.theme_full??o}),e.jsx(fe,{}),e.jsx(J,{dataKey:"unresolved",stackId:"a",fill:Ue.unresolved,name:s("dashboard.deviations.analytics.unresolved")}),e.jsx(J,{dataKey:"resolved",stackId:"a",fill:Ue.resolved,name:s("dashboard.deviations.analytics.resolved")})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:s("common.noData")})})})]}),e.jsxs("div",{className:"card lg:col-span-2",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("dashboard.deviations.analytics.themeBubble")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-96",children:te.length>0?e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(Bt,{margin:{top:10,right:20,left:10,bottom:10},children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(H,{type:"number",dataKey:"avg_hours",name:s("dashboard.deviations.analytics.avgResolution"),tick:{fontSize:11}}),e.jsx(I,{type:"category",dataKey:"theme",name:s("dashboard.deviations.analytics.theme"),width:220,tick:{fontSize:11}}),e.jsx(Ut,{type:"number",dataKey:"count",range:[80,600]}),e.jsx(B,{cursor:{strokeDasharray:"3 3"},contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},formatter:(o,r,u)=>r==="avg_hours"?[Z(o),s("dashboard.deviations.analytics.avgResolution")]:r==="count"?[o,s("dashboard.deviations.analytics.count")]:[o,r],labelFormatter:(o,r)=>r?.[0]?.payload?.theme_full??o}),e.jsx(Et,{name:s("dashboard.deviations.analytics.theme"),data:te,fill:Ue.trend,children:te.map(o=>e.jsx(we,{fill:X(o.pole)},o.theme_full))})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:s("common.noData")})})})]}),e.jsxs("div",{className:"card lg:col-span-2",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("dashboard.deviations.analytics.userThemeHeatmap")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-x-auto",children:(()=>{const o=ue?.themes??[],r=ue?.rows??[],u=r.flatMap(c=>o.map(C=>Number(c?.values?.[C.key]??0))).filter(c=>c>0),k=Math.max(0,...u);return o.length===0||r.length===0?e.jsx("div",{className:"flex items-center justify-center h-72 text-gray-400",children:s("common.noData")}):e.jsxs("div",{className:"grid min-w-full",style:{gridTemplateColumns:`220px repeat(${o.length}, minmax(72px, 1fr))`},children:[e.jsxs("div",{className:"text-xs font-semibold text-gray-600 dark:text-gray-300 p-2",children:[e.jsx(ze,{className:"w-4 h-4 inline-block mr-1"}),s("dashboard.deviations.analytics.user")]}),o.map(c=>e.jsx("div",{className:"text-[11px] font-semibold text-gray-600 dark:text-gray-300 p-2 text-center",title:c.label,children:String(c.label).slice(0,12)},c.key)),r.map(c=>e.jsxs(a.Fragment,{children:[e.jsx("div",{className:"text-[11px] text-gray-700 dark:text-gray-200 p-2 whitespace-nowrap overflow-hidden text-ellipsis",title:c.user,children:c.user}),o.map(C=>{const L=c?.values?.[C.key],xe=re(L,k,[220,38,38]);return e.jsx("div",{className:"text-[11px] font-semibold text-gray-900 dark:text-gray-100 p-2 text-center border border-gray-100 dark:border-white/10",style:{backgroundColor:xe},title:`${c.user} · ${C.label}: ${Z(L)}`,children:L?Z(L):""},`${c.user_id}-${C.key}`)})]},c.user_id))]})})()})})]}),e.jsxs("div",{className:"card lg:col-span-2",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("dashboard.deviations.analytics.poleThemeHeatmap")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"overflow-x-auto",children:(()=>{const o=le?.themes??[],r=le?.rows??[],u=r.flatMap(c=>o.map(C=>Number(c?.values?.[C.key]??0))).filter(c=>c>0),k=Math.max(0,...u);return o.length===0||r.length===0?e.jsx("div",{className:"flex items-center justify-center h-72 text-gray-400",children:s("common.noData")}):e.jsxs("div",{className:"grid",style:{gridTemplateColumns:`220px repeat(${o.length}, minmax(64px, 1fr))`},children:[e.jsxs("div",{className:"text-xs font-semibold text-gray-600 dark:text-gray-300 p-2",children:[e.jsx($t,{className:"w-4 h-4 inline-block mr-1"}),s("dashboard.deviations.analytics.pole")]}),o.map(c=>e.jsx("div",{className:"text-[11px] font-semibold text-gray-600 dark:text-gray-300 p-2 text-center",title:c.label,children:String(c.label).slice(0,12)},c.key)),r.map(c=>e.jsxs(a.Fragment,{children:[e.jsx("div",{className:"text-[11px] font-semibold p-2 whitespace-nowrap overflow-hidden text-ellipsis",style:{color:X(c.pole)},title:c.pole,children:c.pole}),o.map(C=>{const L=c?.values?.[C.key],xe=re(L,k,[220,38,38]);return e.jsx("div",{className:"text-[11px] font-semibold text-gray-900 dark:text-gray-100 p-2 text-center border border-gray-100 dark:border-white/10",style:{backgroundColor:xe},title:`${c.pole} · ${C.label}: ${L??0}%`,children:L?`${L}%`:""},`${c.pole}-${C.key}`)})]},c.pole))]})})()})})]})]})]})});function da(){const n=ve(),{user:g}=xt(),[i,x]=a.useState(null),[l,h]=a.useState(!0),[s,_]=a.useState($e().year),[R,p]=a.useState($e().year-1),[b,$]=a.useState(null),[K,Y]=a.useState(!1),[m,w]=a.useState("overview"),[T,ee]=a.useState(""),[ce,me]=a.useState([]),[U,Q]=a.useState("all"),[D,ue]=a.useState("all"),[he,le]=a.useState(null),[oe,Z]=a.useState("all"),[X,Se]=a.useState(null),ie=a.useRef(null),d=ut(),v=a.useCallback(async()=>{try{h(!0);const t={year:s};T&&(t.pole=T),U!=="all"&&(t.project_id=U),D!=="all"&&(t.week=D);const f=await Je(ne.getAdminDashboard,"/dashboard/admin",t,3e4);x(f.data.data)}catch{De.error(n("dashboard.loadFailed")||n("errors.failedToLoad"))}finally{h(!1)}},[s,T,U,D]),j=a.useCallback(async()=>{try{const t=await gt.getPoles(),f=t.data?.data?.poles||t.data?.poles||[];me(Array.isArray(f)?f:[])}catch{me([])}},[]),M=a.useCallback(async()=>{if(!R){$(null);return}try{const t=await Je(ne.getAdminDashboard,"/dashboard/admin",{year:R},3e4);$(t.data.data??null)}catch(t){console.error("Failed to load comparison dashboard data",t),De.error(n("dashboard.compareLoadFailed")??n("errors.failedToLoad"))}},[R]);a.useEffect(()=>{v(),M()},[v,M]),a.useEffect(()=>{j()},[j]),a.useEffect(()=>{p(s-1)},[s]);const G=a.useCallback(async t=>{Y(!0);try{const f=t==="excel"?await et.exportExcel({year:s}):await et.exportPdf({year:s}),y=new Blob([f.data],{type:t==="excel"?"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"application/pdf"}),S=window.URL.createObjectURL(y),A=document.createElement("a");A.href=S,A.download=`kpi_report_${s}.${t==="excel"?"xlsx":"pdf"}`,A.click(),window.URL.revokeObjectURL(S),De.success(n("dashboard.exportSuccess"))}catch{De.error(n("dashboard.exportFailed")||n("errors.somethingWentWrong"))}finally{Y(!1)}},[s]),E=a.useMemo(()=>i?.stats??{},[i?.stats]),ae=a.useMemo(()=>i?.kpi_summary??{},[i?.kpi_summary]),se=a.useMemo(()=>i?.weekly_trends??[],[i?.weekly_trends]),de=a.useMemo(()=>i?.project_performance??[],[i?.project_performance]),te=a.useMemo(()=>i?.weekly_status??[],[i?.weekly_status]),ye=a.useMemo(()=>i?.projects??[],[i?.projects]);a.useEffect(()=>{ie.current&&(!Array.isArray(te)||te.length===0||requestAnimationFrame(()=>{ie.current&&ie.current.scrollTo({left:ie.current.scrollWidth,behavior:"auto"})}))},[te,s]);const Ce=a.useMemo(()=>Ot(s),[s]),q=a.useMemo(()=>{if(D==="all")return se;const t=Number(D);return Number.isNaN(t)?se:(se||[]).filter(f=>Number(f.week)===t)},[se,D]),re=a.useMemo(()=>{if(U==="all")return de;const t=Number(U);return Number.isNaN(t)?de:(de||[]).filter(f=>Number(f.id)===t)},[de,U]),o=a.useCallback((t,f,{higherIsBetter:y})=>{const S=Number(t??0),A=Number(f??0);if(S===A)return null;const N=y?S>A:S<A,P=A===0?100:Math.abs((S-A)/A*100),z=P>=10?Math.round(P):Math.round(P*10)/10,ke=S>A?At:Rt,Le=N?"bg-green-50 text-green-700 dark:bg-green-900/30 dark:text-green-300":"bg-red-50 text-red-700 dark:bg-red-900/30 dark:text-red-300";return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[11px] font-semibold ${Le}`,children:[e.jsx(ke,{className:"w-3.5 h-3.5"}),z,"%"]})},[]),r=a.useMemo(()=>i?.training_data||{},[i?.training_data]),u=a.useMemo(()=>i?.awareness_data||{},[i?.awareness_data]),k=a.useMemo(()=>i?.sor_data||{},[i?.sor_data]);a.useMemo(()=>i?.permit_data||{},[i?.permit_data]);const c=a.useMemo(()=>i?.inspection_data||{},[i?.inspection_data]),C=a.useMemo(()=>{const t=Array.isArray(ye)?ye:[];return T?t.filter(f=>f?.pole===T):t},[ye,T]),L=g?.project_list_preference||"code",xe=a.useMemo(()=>Ht(C,L),[C,L]);a.useEffect(()=>{if(U==="all")return;C.some(f=>String(f.id)===String(U))||Q("all")},[C,U]),a.useEffect(()=>{if(oe==="all")return;C.some(f=>String(f.id)===String(oe))||Z("all")},[C,oe]);const be=a.useMemo(()=>{if(D==="all")return r;const t=Number(D);if(Number.isNaN(t))return r;const y=(Array.isArray(r?.by_week)?r.by_week:[]).filter(P=>Number(P.week_number)===t),S=y.reduce((P,z)=>P+Number(z?.count??0),0),A=y.reduce((P,z)=>P+Number(z?.participants??0),0),N=y.reduce((P,z)=>P+Number(z?.hours??0),0);return{...r,total:S,total_participants:A,total_hours:N,by_week:y}},[r,D]),Te=a.useMemo(()=>{if(D==="all")return c;const t=Number(D);if(Number.isNaN(t))return c;const y=(Array.isArray(c?.by_week)?c.by_week:[]).filter(A=>Number(A.week_number)===t),S=y.reduce((A,N)=>A+Number(N?.count??0),0);return{...c,stats:{...c?.stats||{},total:S},by_week:y}},[c,D]),Me=a.useMemo(()=>{if(D==="all")return u;const t=Number(D);if(Number.isNaN(t))return u;const y=(Array.isArray(u?.by_week)?u.by_week:[]).filter(P=>Number(P.week_number)===t),S=y.reduce((P,z)=>P+Number(z?.count??0),0),A=y.reduce((P,z)=>P+Number(z?.participants??0),0),N=y.reduce((P,z)=>P+Number(z?.hours??0),0);return{...u,total:S,total_participants:A,total_hours:N,by_week:y}},[u,D]),F=a.useMemo(()=>{const t=ae||{},f={...t,total_trainings:r?.total??t.total_trainings??0,employees_trained:r?.total_participants??t.employees_trained??0,total_training_hours:r?.total_hours??t.total_training_hours??0,total_inspections:c?.stats?.total??t.total_inspections??0};if(D!=="all"){const y=Array.isArray(q)?q:[],S=N=>y.reduce((P,z)=>P+Number(z?.[N]??0),0),A=N=>{if(y.length===0)return 0;const P=y.map(z=>Number(z?.[N]??0));return P.reduce((z,ke)=>z+ke,0)/P.length};return{...f,total_accidents:S("accidents"),fatal_accidents:S("fatal_accidents"),serious_accidents:S("serious_accidents"),minor_accidents:S("minor_accidents"),total_inspections:Te?.stats?.total??S("inspections"),total_near_misses:S("near_misses"),total_work_permits:S("work_permits"),avg_tf:A("tf"),avg_tg:A("tg"),avg_hse_compliance:A("hse_compliance"),avg_medical_compliance:A("medical_compliance"),total_water_consumption:S("water"),total_electricity_consumption:S("electricity"),total_trainings:be?.total??0,employees_trained:be?.total_participants??0,total_training_hours:be?.total_hours??0}}if(U!=="all"){const y=Array.isArray(re)?re[0]:null;if(y)return{...f,total_accidents:Number(y.total_accidents??0),total_trainings:Number(y.total_trainings??0),avg_tf:Number(y.avg_tf??0),avg_tg:Number(y.avg_tg??0)}}return f},[ae,r,c,be,Te,q,D,U,re]),ct=a.useCallback(t=>{if(!t||!t.activeLabel)return;const f=t.activeLabel,y=q.find(S=>S.week_label===f);if(y){le(y);const S=new URLSearchParams;let A=y.week;if(!A&&typeof f=="string"){const P=parseInt(f.replace(/\D/g,""),10);Number.isNaN(P)||(A=P)}A&&S.set("week",A);const N=y.year||s;N&&S.set("year",N),d(`/admin/kpi?${S.toString()}`)}},[q,s,d]),mt=a.useMemo(()=>[...Array(6)].map((t,f)=>$e().year+1-f),[]);return l?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(Kt,{className:"w-8 h-8 animate-spin text-hse-primary"})}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:n("dashboard.adminTitle")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:n("dashboard.overview")})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 px-3 py-2",children:[e.jsx(Pt,{className:"w-4 h-4 text-gray-400"}),e.jsx("select",{value:s,onChange:t=>_(Number(t.target.value)),className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-none focus:ring-0 text-sm font-medium",children:mt.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>G("excel"),disabled:K,className:"btn-secondary flex items-center gap-2",children:[e.jsx(Dt,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:n("dashboard.exportExcel")})]}),e.jsxs("button",{onClick:()=>G("pdf"),disabled:K,className:"btn-secondary flex items-center gap-2",children:[e.jsx(tt,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:n("dashboard.exportPdf")})]})]})]})]}),e.jsx(qt,{activeTheme:m,onThemeChange:w}),e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-end gap-2",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:flex-wrap sm:items-center gap-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white/70 dark:bg-gray-900/40 px-3 py-2 w-full sm:w-auto",children:[e.jsxs("select",{value:T,onChange:t=>ee(t.target.value),className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-none focus:ring-0 text-sm w-full sm:w-auto",children:[e.jsx("option",{value:"",children:n("common.allPoles")}),ce.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("span",{className:"hidden sm:block w-px h-5 bg-gray-200 dark:bg-gray-700"}),e.jsxs("select",{value:U,onChange:t=>Q(t.target.value),className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-none focus:ring-0 text-sm w-full sm:w-auto",children:[e.jsx("option",{value:"all",children:n("common.allProjects")}),xe.map(t=>e.jsx("option",{value:t.id,children:at(t)},t.id))]}),m!=="ppe"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden sm:block w-px h-5 bg-gray-200 dark:bg-gray-700"}),e.jsxs("select",{value:D,onChange:t=>ue(t.target.value),className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-none focus:ring-0 text-sm w-full sm:w-auto",children:[e.jsx("option",{value:"all",children:n("common.all")}),Ce.map(t=>e.jsx("option",{value:t.week,children:t.label},t.week))]})]})]})}),m==="safety"&&e.jsx(Yt,{kpiSummary:F,weeklyTrends:q,projectPerformance:re}),m==="training"&&e.jsx(Vt,{kpiSummary:F,weeklyTrends:q,projectPerformance:re,trainingData:be,awarenessData:Me}),m==="compliance"&&e.jsx(Xt,{kpiSummary:F,weeklyTrends:q,projectPerformance:re,inspectionData:c,sorData:k,regulatoryWatch:i?.regulatory_watch}),m==="ppe"&&e.jsx(Jt,{year:s,projectId:U,pole:T}),m==="deviations"&&e.jsx(ta,{year:s,projects:ye,projectId:U,week:D,pole:T}),m==="environmental"&&e.jsx(ea,{kpiSummary:F,weeklyTrends:q}),m==="overview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Oe,{title:n("dashboard.totalProjects"),value:E.total_projects??0,subtitle:`${E.active_projects??0} ${n("dashboard.activeLabel")}`,icon:zt,color:"blue"}),e.jsx(Oe,{title:n("dashboard.totalUsers"),value:E.total_users??0,subtitle:`${E.active_users??0} ${n("dashboard.activeLabel")}`,icon:ze,color:"green"}),e.jsx(Oe,{title:n("dashboard.activeMachines"),value:E.active_machines??0,subtitle:n("dashboard.activeMachinesSubtitle"),icon:Ft,color:"amber"}),e.jsx(Oe,{title:n("dashboard.totalReports"),value:E.total_reports??0,subtitle:n("dashboard.inYear",{year:s}),icon:tt,color:"purple"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(Pe,{title:n("dashboard.safety.totalAccidents"),value:F.total_accidents??0,icon:Fe,color:F.total_accidents>0?"red":"green",trend:F.fatal_accidents>0?`${F.fatal_accidents} ${n("dashboard.safety.fatal")}`:n("dashboard.safety.noFatalities")}),e.jsx(Pe,{title:n("dashboard.training.totalTrainings"),value:F.total_trainings??0,icon:He,color:"blue",trend:`${F.employees_trained??0} ${n("dashboard.training.employeesTrained")}`}),e.jsx(Pe,{title:n("dashboard.compliance.totalInspections"),value:F.total_inspections??0,icon:Ge,color:"green"}),e.jsx(Pe,{title:n("dashboard.avgTf"),value:Number(F.avg_tf??0).toFixed(2),icon:lt,color:"amber",trend:n("dashboard.rates.frequencyRate")}),e.jsx(Pe,{title:n("dashboard.avgTg"),value:Number(F.avg_tg??0).toFixed(2),icon:nt,color:"purple",trend:n("dashboard.rates.severityRate")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n("dashboard.weeklyKpiTrends")})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"h-80",children:e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(Xe,{data:q,onClick:ct,children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(H,{dataKey:"week_label",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(I,{tick:{fontSize:12}}),e.jsx(B,{labelFormatter:t=>`${n("dashboard.weekPrefix")} ${t.replace("S","")}`}),e.jsx(fe,{}),e.jsx(je,{type:"monotone",dataKey:"accidents",stroke:"#dc2626",strokeWidth:2,dot:{fill:"#dc2626",r:3},name:n("dashboard.accidents")}),e.jsx(je,{type:"monotone",dataKey:"trainings",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:3},name:n("dashboard.training.totalTrainings")}),e.jsx(je,{type:"monotone",dataKey:"inspections",stroke:"#16a34a",strokeWidth:2,dot:{fill:"#16a34a",r:3},name:n("dashboard.inspections")})]})})}),he&&e.jsxs("div",{className:"mt-4 text-xs text-gray-600 dark:text-gray-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"font-semibold",children:n("dashboard.detailsForWeek",{week:he.week_label})}),e.jsx("button",{type:"button",onClick:()=>d("/admin/kpi"),className:"btn-secondary btn-sm",children:n("dashboard.viewKpiReports")})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:n("dashboard.accidents")}),e.jsx("p",{className:"font-semibold",children:he.accidents??0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:n("dashboard.training.totalTrainings")}),e.jsx("p",{className:"font-semibold",children:he.trainings??0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:n("dashboard.inspections")}),e.jsx("p",{className:"font-semibold",children:he.inspections??0})]})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n("dashboard.tfTgRates")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-80",children:e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(dt,{data:q,children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(H,{dataKey:"week_label",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx(I,{yAxisId:"left",tick:{fontSize:12},stroke:"#f59e0b",label:{value:n("dashboard.rates.frequencyRate"),angle:-90,position:"insideLeft",style:{fill:"#f59e0b"}}}),e.jsx(I,{yAxisId:"right",orientation:"right",tick:{fontSize:12},stroke:"#8b5cf6",label:{value:n("dashboard.rates.severityRate"),angle:90,position:"insideRight",style:{fill:"#8b5cf6"}}}),e.jsx(B,{labelFormatter:t=>`${n("dashboard.weekPrefix")} ${t.replace("S","")}`,formatter:(t,f)=>[Number(t).toFixed(4),f]}),e.jsx(fe,{}),e.jsx(J,{yAxisId:"left",dataKey:"tf",fill:"#f59e0b",name:n("dashboard.rates.frequencyRate"),radius:[4,4,0,0]}),e.jsx(J,{yAxisId:"right",dataKey:"tg",fill:"#8b5cf6",name:n("dashboard.rates.severityRate"),radius:[4,4,0,0]})]})})})})]})]}),te.filter(t=>t.total_projects>0).length>0&&e.jsxs("div",{className:"card mt-6",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n("dashboard.submissionStatus")}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("select",{value:oe,onChange:t=>Z(t.target.value),className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg px-3 py-1.5 text-sm font-medium dark:text-gray-200 focus:ring-2 focus:ring-hse-primary",children:[e.jsx("option",{value:"all",children:n("common.allProjects")}),xe.map(t=>e.jsx("option",{value:t.id,children:at(t)},t.id))]})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>ie.current?.scrollBy({left:-300,behavior:"smooth"}),className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 bg-white/90 dark:bg-gray-700/90 hover:bg-white dark:hover:bg-gray-600 shadow-lg rounded-full p-2 border dark:border-gray-600",children:e.jsx(Lt,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})}),e.jsx("button",{type:"button",onClick:()=>ie.current?.scrollBy({left:300,behavior:"smooth"}),className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 bg-white/90 dark:bg-gray-700/90 hover:bg-white dark:hover:bg-gray-600 shadow-lg rounded-full p-2 border dark:border-gray-600",children:e.jsx(Wt,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})}),e.jsx("div",{ref:ie,className:"flex gap-2 overflow-x-auto scroll-smooth px-10 py-3 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",style:{scrollbarWidth:"thin"},children:(()=>{const t=$e(),f=s<t.year?52:t.week;return Array.from({length:f},(y,S)=>S+1)})().map(t=>{const f=te.find(pe=>pe.week===t),y=$e(),S=s<y.year||s===y.year&&t<y.week,A=t===y.week&&s===y.year;let N="not_submitted";const P=f?.projects||[];oe==="all"?N=f?.status||"not_submitted":N=P.find(Qe=>Qe.project_id===parseInt(oe))?.status||"not_submitted";const z=f?.approved_count??0,ke=f?.submitted_count??0,Le=f?.draft_count??0,Re=f?.total_projects??0;if(Re<=0)return null;let Ye="";if(N==="partial"&&Re>0){const pe=[];z>0&&pe.push("rgb(34, 197, 94)"),ke>0&&pe.push("rgb(251, 191, 36)"),Le>0&&pe.push("rgb(96, 165, 250)"),Re-z-ke-Le>0&&pe.push("rgb(254, 202, 202)"),Ye=pe.length>1?`linear-gradient(135deg, ${pe.join(", ")})`:""}return e.jsxs("div",{"data-week":t,className:`relative flex-shrink-0 w-14 p-2 rounded-lg text-center transition-all cursor-pointer ${X===t?"ring-2 ring-gray-900 ring-offset-2 scale-110":""} ${A&&X!==t?"ring-2 ring-hse-primary ring-offset-2":""} ${N==="approved"?"bg-green-500 text-white":N==="partial"?"text-white":N==="submitted"?"bg-amber-400 text-white":N==="draft"?"bg-blue-400 text-white":S?"bg-red-100 text-red-600 hover:bg-red-200":"bg-gray-100 text-gray-500"}`,style:N==="partial"&&Ye?{background:Ye}:{},onClick:()=>Se(X===t?null:t),children:[e.jsxs("p",{className:"text-xs font-medium",children:[n("dashboard.weekShortPrefix"),t]}),oe==="all"&&Re>1?e.jsxs("p",{className:"text-xs font-bold mt-0.5",children:[z+ke,"/",Re]}):e.jsx("p",{className:"text-lg font-bold mt-0.5",children:N==="approved"?"✓":N==="partial"?"◐":N==="submitted"?"⏳":N==="draft"?"📝":S?"!":"-"})]},`admin-week-${s}-${t}`)})})]}),X&&(()=>{const f=te.find(N=>N.week===X)?.projects||[],y=$e(),S=X===y.week&&s===y.year,A=s<y.year||s===y.year&&X<y.week;return f.length===0?null:e.jsxs("div",{className:"mt-3 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-700 pb-2 mb-2",children:[e.jsxs("p",{className:"font-semibold",children:[n("dashboard.weekDetailsTitle").replace("{{week}}",X),S&&e.jsxs("span",{className:"ml-2 text-hse-primary",children:["(",n("dashboard.currentWeekLabel"),")"]})]}),e.jsx("button",{type:"button",onClick:()=>Se(null),className:"text-gray-400 hover:text-white",children:"✕"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:f.map(N=>{const z=N.status==="not_submitted"&&A;return e.jsxs("div",{className:"flex items-center justify-between gap-2 bg-gray-800 rounded px-2 py-1.5",children:[e.jsx("span",{className:"truncate font-medium",children:N.project_code}),e.jsx("span",{className:`flex-shrink-0 px-1.5 py-0.5 rounded text-[10px] font-medium ${N.status==="approved"?"bg-green-500":N.status==="submitted"?"bg-amber-400":N.status==="draft"?"bg-blue-400":z?"bg-red-400":"bg-gray-500"}`,children:N.status==="approved"?n("status.approved"):N.status==="submitted"?n("status.pending"):N.status==="draft"?n("status.draft"):n(z?"status.missing":"status.notSubmitted")})]},N.project_id)})})]})})(),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4 pt-4 mt-2 border-t dark:border-gray-700 text-xs text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-green-500"})," ",n("status.approved")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-gradient-to-br from-green-400 to-amber-400"})," ",n("status.partial")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-amber-400"})," ",n("status.pending")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-blue-400"})," ",n("status.draft")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-red-100 border border-red-200"})," ",n("status.missing")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded ring-2 ring-hse-primary ring-offset-1"})," ",n("dashboard.currentWeekLabel")]})]})]})]}),b&&e.jsxs("div",{className:"card mt-6",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n("dashboard.yearOverYearSummary",{year:s,compareYear:R})})}),e.jsxs("div",{className:"card-body grid grid-cols-1 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx("span",{children:n("dashboard.safety.totalAccidents")}),o(F.total_accidents,b?.kpi_summary?.total_accidents,{higherIsBetter:!1})]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[F.total_accidents??0," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["(",s,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[b?.kpi_summary?.total_accidents??0," (",R,")"]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx("span",{children:n("dashboard.training.totalTrainings")}),o(F.total_trainings,b?.training_data?.total??b?.kpi_summary?.total_trainings,{higherIsBetter:!0})]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[F.total_trainings??0," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["(",s,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[b?.training_data?.total??b?.kpi_summary?.total_trainings??0," (",R,")"]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx("span",{children:n("dashboard.inspections")}),o(F.total_inspections,b?.inspection_data?.stats?.total??b?.kpi_summary?.total_inspections,{higherIsBetter:!0})]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[F.total_inspections??0," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["(",s,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[b?.inspection_data?.stats?.total??b?.kpi_summary?.total_inspections??0," (",R,")"]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx("span",{children:n("dashboard.tfTgRates")}),o(Number(F.avg_tf??0)+Number(F.avg_tg??0),Number(b?.kpi_summary?.avg_tf??0)+Number(b?.kpi_summary?.avg_tg??0),{higherIsBetter:!1})]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[Number(F.avg_tf??0).toFixed(2)," / ",Number(F.avg_tg??0).toFixed(2),e.jsxs("span",{className:"text-xs text-gray-400",children:[" (",s,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[Number(b?.kpi_summary?.avg_tf??0).toFixed(2)," / ",Number(b?.kpi_summary?.avg_tg??0).toFixed(2)," (",R,")"]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n("dashboard.projectPerformance")}),e.jsx(bt,{to:"/admin/projects",className:"text-sm text-hse-primary hover:underline",children:n("dashboard.viewAllProjects")})]}),re.length===0?e.jsx("div",{className:"p-6 text-center text-sm text-gray-500 dark:text-gray-400",children:n("dashboard.noProjectData")}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 p-4 md:hidden",children:re.slice(0,5).map(t=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3 bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.code})]}),e.jsxs("div",{className:"text-right text-xs text-gray-600 dark:text-gray-300 space-y-1",children:[e.jsxs("p",{children:[e.jsxs("span",{className:"font-semibold",children:[n("dashboard.reports"),":"]})," ",t.reports_count]}),e.jsxs("p",{children:[e.jsxs("span",{className:"font-semibold",children:[n("dashboard.training.totalTrainings"),":"]})," ",t.total_trainings]})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-[11px] text-gray-600 dark:text-gray-300",children:[e.jsxs("span",{children:[n("dashboard.accidents"),": ",e.jsx("span",{className:t.total_accidents>0?"text-red-600 dark:text-red-400 font-semibold":"text-green-600 dark:text-green-400",children:t.total_accidents})]}),e.jsxs("span",{children:["TF: ",Number(t.avg_tf).toFixed(2)," • TG: ",Number(t.avg_tg).toFixed(2)]})]})]},t.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:n("common.project")}),e.jsx("th",{children:n("dashboard.reports")}),e.jsx("th",{children:n("dashboard.accidents")}),e.jsx("th",{children:n("dashboard.training.totalTrainings")}),e.jsx("th",{children:n("dashboard.avgTf")}),e.jsx("th",{children:n("dashboard.avgTg")})]})}),e.jsx("tbody",{children:re.slice(0,5).map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium dark:text-gray-100",children:t.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.code})]})}),e.jsx("td",{children:t.reports_count}),e.jsx("td",{children:e.jsx("span",{className:t.total_accidents>0?"text-red-600 dark:text-red-400 font-semibold":"text-green-600 dark:text-green-400",children:t.total_accidents})}),e.jsx("td",{children:t.total_trainings}),e.jsx("td",{children:Number(t.avg_tf).toFixed(2)}),e.jsx("td",{children:Number(t.avg_tg).toFixed(2)})]},t.id))})]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n("dashboard.recentSubmissions")})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:i?.recent_reports?.filter(t=>t.status!=="draft").slice(0,5).map(t=>e.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:t.project?.name||"Unknown Project"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.report_month,"/",t.report_year," • Submitted by ",t.submitter?.name]})]}),e.jsx("span",{className:`badge ${t.status==="approved"?"badge-success":t.status==="submitted"?"badge-warning":t.status==="rejected"?"badge-danger":"badge-info"}`,children:t.status})]})},t.id))})]})]})]})}const Oe=a.memo(function({title:g,value:i,subtitle:x,icon:l,color:h}){const s={blue:"bg-blue-50 text-blue-600",green:"bg-green-50 text-green-600",amber:"bg-amber-50 text-amber-600",purple:"bg-purple-50 text-purple-600",red:"bg-red-50 text-red-600"};return e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:g}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1",children:i}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:x})]}),e.jsx("div",{className:`p-3 rounded-lg ${s[h]}`,children:e.jsx(l,{className:"w-5 h-5"})})]})})}),Pe=a.memo(function({title:g,value:i,icon:x,color:l,trend:h}){const s={red:"border-red-200 bg-red-50 dark:border-red-700 dark:bg-red-900/50",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50",blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50"},_={red:"text-red-600 dark:text-red-400",green:"text-green-600 dark:text-green-400",blue:"text-blue-600 dark:text-blue-400",amber:"text-amber-600 dark:text-amber-400",purple:"text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${s[l]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(x,{className:`w-5 h-5 ${_[l]}`}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:g})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:i}),h&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:h})]})});export{da as default};
