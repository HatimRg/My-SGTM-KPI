import{d as ae,j as e,e as Ke,u as oa,f as Ve,p as ca,g as Xe}from"./index.js";import{r as s,u as ma,L as xa}from"./vendor-react.js";import{Q as ha,j as Je,e as Te,c as Me,A as ge,V as ga,Y as ba,Z as ea,_ as aa,U as Ce,s as Pe,q as ua,$ as pa,a0 as fa,a1 as ya,a2 as ja,a3 as ka,a4 as va,a5 as Na,z as ke,a6 as _a,a7 as wa,v as Sa,a8 as Ca,a9 as Ta,h as Ze,F as Ma,T as Aa,aa as $a,ab as Ra}from"./vendor-ui.js";import{R as M,A as be,C as P,X as D,Y as $,T as A,a as ee,P as De,b as Fe,c as he,L as G,d as We,e as q,B as ie,f as H,g as ta}from"./vendor-charts.js";import{g as de,a as Ka}from"./weekHelper.js";import{s as Pa,g as Qe}from"./projectList.js";import"./vendor-utils.js";const Da=[{id:"overview",nameKey:"dashboard.themes.overview",icon:ha,gradient:"from-purple-500 to-purple-700"},{id:"safety",nameKey:"dashboard.themes.safety",icon:Je,gradient:"from-red-500 to-red-700"},{id:"training",nameKey:"dashboard.themes.training",icon:Te,gradient:"from-blue-500 to-blue-700"},{id:"compliance",nameKey:"dashboard.themes.compliance",icon:Me,gradient:"from-green-500 to-green-700"},{id:"deviations",nameKey:"dashboard.themes.deviations",icon:ge,gradient:"from-amber-500 to-amber-700"},{id:"environmental",nameKey:"dashboard.themes.environmental",icon:ga,gradient:"from-emerald-500 to-emerald-700"}],Fa=s.memo(function({activeTheme:o,onThemeChange:i}){const c=ae();return e.jsx("div",{className:"relative mb-4",children:e.jsx("div",{className:"flex items-center justify-center gap-1 flex-wrap",children:Da.map(n=>{const d=n.icon,r=o===n.id;return e.jsxs("button",{onClick:()=>i(n.id),className:`flex items-center gap-1.5 px-3 py-2 rounded-lg border transition-all duration-200 ${r?`bg-gradient-to-r ${n.gradient} text-white border-transparent shadow-md`:"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600 hover:shadow-sm"}`,children:[e.jsx(d,{className:`w-4 h-4 ${r?"text-white":""}`}),e.jsx("span",{className:`font-medium text-xs ${r?"text-white":""}`,children:c(n.nameKey)})]},n.id)})})})}),Q={fatal:"#dc2626",serious:"#f59e0b",minor:"#16a34a",tf:"#f59e0b",tg:"#8b5cf6"},ve=s.memo(function({title:o,value:i,icon:c,color:n,trend:d}){const r={red:"border-red-200 bg-red-50 dark:border-red-700 dark:bg-red-900/50 text-red-600 dark:text-red-400",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${r[n]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(c,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:o})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:i}),d&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:d})]})}),Wa=s.memo(function({kpiSummary:o,weeklyTrends:i,projectPerformance:c}){const n=ae(),d=s.useMemo(()=>({totalAccidents:o?.total_accidents??0,fatalAccidents:o?.fatal_accidents??0,avgTF:Number(o?.avg_tf??0).toFixed(2),avgTG:Number(o?.avg_tg??0).toFixed(2),lostWorkdays:o?.lost_workdays??0}),[o]),r=s.useMemo(()=>(i??[]).map(h=>({week:h.week_label,accidents:h.accidents??0})),[i]),y=s.useMemo(()=>{d.totalAccidents;const h=d.fatalAccidents,N=o?.serious_accidents,F=o?.minor_accidents,z=N!=null&&F!==null&&F!==void 0,l=z?Number(N??0):(i??[]).reduce((v,_)=>v+Number(_?.serious_accidents??0),0),b=z?Number(F??0):(i??[]).reduce((v,_)=>v+Number(_?.minor_accidents??0),0);return[{name:n("dashboard.safety.fatal"),value:Number(h??0),color:Q.fatal},{name:n("dashboard.safety.serious"),value:Number(l??0),color:Q.serious},{name:n("dashboard.safety.minor"),value:Number(b??0),color:Q.minor}].filter(v=>v.value>0)},[d,n,o,i]),j=s.useMemo(()=>(i??[]).map(h=>({week:h.week_label,tf:Number(h.tf??0).toFixed(4),tg:Number(h.tg??0).toFixed(4)})),[i]),p=s.useMemo(()=>(c??[]).slice(0,6).map(h=>({name:h.name?.length>15?h.name.substring(0,15)+"...":h.name,accidents:h.total_accidents??0})),[c]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(ve,{title:n("dashboard.safety.totalAccidents"),value:d.totalAccidents,icon:ge,color:d.totalAccidents>0?"red":"green",trend:n("dashboard.safety.yearToDate")}),e.jsx(ve,{title:n("dashboard.safety.fatalAccidents"),value:d.fatalAccidents,icon:ba,color:d.fatalAccidents>0?"red":"green",trend:d.fatalAccidents===0?n("dashboard.safety.noFatalities"):n("dashboard.safety.critical")}),e.jsx(ve,{title:n("dashboard.safety.tfRate"),value:d.avgTF,icon:ea,color:"amber",trend:n("dashboard.safety.avgFrequencyRate")}),e.jsx(ve,{title:n("dashboard.safety.tgRate"),value:d.avgTG,icon:aa,color:"purple",trend:n("dashboard.safety.avgSeverityRate")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n("dashboard.safety.accidentTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(be,{data:r,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"accidentGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#dc2626",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#dc2626",stopOpacity:.1})]})}),e.jsx(P,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week",tick:{fontSize:11}}),e.jsx($,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(ee,{type:"monotone",dataKey:"accidents",stroke:"#dc2626",fill:"url(#accidentGradient)",name:"Accidents"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n("dashboard.safety.accidentsBySeverity")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:y.length>0?e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(De,{children:[e.jsx(Fe,{data:y,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:h,value:N})=>`${h}: ${N}`,children:y.map((h,N)=>e.jsx(he,{fill:h.color},`cell-${N}`))}),e.jsx(A,{}),e.jsx(G,{})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-green-600 dark:text-green-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ge,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"font-medium",children:n("dashboard.safety.noAccidents")}),e.jsx("p",{className:"text-sm text-gray-500",children:n("dashboard.safety.greatSafety")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n("dashboard.safety.tfVsTg")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(We,{data:j,children:[e.jsx(P,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week",tick:{fontSize:11}}),e.jsx($,{tick:{fontSize:11}}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(G,{}),e.jsx(q,{type:"monotone",dataKey:"tf",stroke:Q.tf,strokeWidth:2,dot:{fill:Q.tf,r:3},name:"TF Rate"}),e.jsx(q,{type:"monotone",dataKey:"tg",stroke:Q.tg,strokeWidth:2,dot:{fill:Q.tg,r:3},name:"TG Rate"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:n("dashboard.safety.accidentsByProject")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(ie,{data:p,layout:"vertical",children:[e.jsx(P,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{type:"number",allowDecimals:!1,tick:{fontSize:11}}),e.jsx($,{type:"category",dataKey:"name",tick:{fontSize:10},width:100}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(H,{dataKey:"accidents",fill:"#dc2626",radius:[0,4,4,0],name:"Accidents"})]})})})})]})]})]})}),J=s.memo(function({title:o,value:i,icon:c,color:n,trend:d}){const r={blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${r[n]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(c,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:o})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:i}),d&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:d})]})}),za=s.memo(function({kpiSummary:o,weeklyTrends:i,projectPerformance:c,trainingData:n,awarenessData:d}){const r=ae(),y=s.useMemo(()=>{const l=n?.total??o?.total_trainings??0,b=n?.total_participants??o?.employees_trained??0,v=n?.total_hours??o?.total_training_hours??o?.training_hours??0,_=o?.total_trainings_planned??0,W=_>0?Math.round(l/_*100):null;return{totalTrainings:l,employeesTrained:b,trainingHours:v,completionRate:W}},[o,n]),j=s.useMemo(()=>({totalSessions:d?.total??0,totalParticipants:d?.total_participants??0,totalHours:d?.total_hours??0}),[d]),p=s.useMemo(()=>n?.by_week?.length>0?n.by_week.map(l=>({week:"S"+l.week_number,trainings:l.count??0,participants:l.participants??0})):(i??[]).map(l=>({week:l.week_label,trainings:l.trainings??0})),[i,n]),h=s.useMemo(()=>{if(n?.by_theme?.length>0){const l=["#3b82f6","#8b5cf6","#ec4899","#14b8a6","#f59e0b","#ef4444","#10b981","#6366f1"];return n.by_theme.slice(0,8).map((b,v)=>({name:b.theme?.length>20?b.theme.substring(0,20)+"...":b.theme,fullName:b.theme,value:b.count,participants:b.participants??0,color:l[v%l.length]}))}return[]},[n]),N=s.useMemo(()=>n?.by_duration?.length>0?n.by_duration.map(l=>({duration:l.duration,count:l.count,participants:l.participants??0})):[],[n]),F=s.useMemo(()=>{if(d?.by_theme?.length>0){const l=["#16a34a","#0ea5e9","#f97316","#a855f7","#eab308","#06b6d4","#84cc16","#d946ef"];return d.by_theme.slice(0,8).map((b,v)=>({name:b.theme?.length>20?b.theme.substring(0,20)+"...":b.theme,fullName:b.theme,value:b.count,participants:b.participants??0,color:l[v%l.length]}))}return[]},[d]),z=s.useMemo(()=>n?.by_type?.length>0?n.by_type.map(l=>({name:l.type==="internal"?r("dashboard.training.internal"):r("dashboard.training.external"),value:l.count,color:l.type==="internal"?"#3b82f6":"#8b5cf6"})):[],[n,r]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(J,{title:r("dashboard.training.totalTrainings"),value:y.totalTrainings,icon:Te,color:"blue",trend:r("dashboard.training.sessionsCompleted")}),e.jsx(J,{title:r("dashboard.training.employeesTrained"),value:y.employeesTrained,icon:Ce,color:"green",trend:r("dashboard.training.uniqueAttendees")}),e.jsx(J,{title:r("dashboard.training.trainingHours"),value:y.trainingHours,icon:Pe,color:"purple",trend:r("dashboard.training.totalHoursDelivered")}),e.jsx(J,{title:r("dashboard.training.completionRate"),value:y.completionRate!==null?`${y.completionRate}%`:"—",icon:ua,color:"amber",trend:`${r("dashboard.training.target")}: 95%`})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:r("dashboard.training.trainingTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(be,{data:p,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"trainingGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:.1})]})}),e.jsx(P,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week",tick:{fontSize:11}}),e.jsx($,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(ee,{type:"monotone",dataKey:"trainings",stroke:"#3b82f6",fill:"url(#trainingGradient)",name:"Trainings"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:r("dashboard.training.trainingByTheme")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-72",children:h.length>0?e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(ie,{data:h,layout:"vertical",margin:{left:10,right:20},children:[e.jsx(P,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{type:"number",allowDecimals:!1,tick:{fontSize:11}}),e.jsx($,{type:"category",dataKey:"name",tick:{fontSize:10},width:120}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},formatter:(l,b,v)=>[`${l} sessions (${v.payload.participants} participants)`,"Count"]}),e.jsx(H,{dataKey:"value",radius:[0,4,4,0],children:h.map((l,b)=>e.jsx(he,{fill:l.color},`cell-${b}`))})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Te,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"font-medium",children:r("dashboard.training.noTrainingData")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:r("dashboard.training.trainingByDuration")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:N.length>0?e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(ie,{data:N,children:[e.jsx(P,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"duration",tick:{fontSize:11}}),e.jsx($,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},formatter:(l,b)=>[l,b==="count"?"Sessions":"Participants"]}),e.jsx(H,{dataKey:"count",fill:"#8b5cf6",radius:[4,4,0,0],name:"Sessions"})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{className:"font-medium",children:r("dashboard.training.noTrainingData")})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:r("dashboard.training.awarenessByTheme")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-72",children:F.length>0?e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(ie,{data:F,layout:"vertical",margin:{left:10,right:20},children:[e.jsx(P,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{type:"number",allowDecimals:!1,tick:{fontSize:11}}),e.jsx($,{type:"category",dataKey:"name",tick:{fontSize:10},width:120}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"},formatter:(l,b,v)=>[`${l} sessions (${v.payload.participants} participants)`,"Count"]}),e.jsx(H,{dataKey:"value",radius:[0,4,4,0],children:F.map((l,b)=>e.jsx(he,{fill:l.color},`cell-${b}`))})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{className:"font-medium",children:r("dashboard.training.noTrainingData")})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:r("dashboard.training.trainingByType")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:z.length>0?e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(De,{children:[e.jsx(Fe,{data:z,cx:"50%",cy:"45%",innerRadius:40,outerRadius:70,paddingAngle:5,dataKey:"value",label:({value:l})=>l,labelLine:!1,children:z.map((l,b)=>e.jsx(he,{fill:l.color},`cell-${b}`))}),e.jsx(A,{formatter:(l,b)=>[l,b]}),e.jsx(G,{verticalAlign:"bottom",height:36,formatter:l=>e.jsx("span",{className:"text-sm",children:l})})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{className:"font-medium",children:r("dashboard.training.noTrainingData")})})})})]})]}),j.totalSessions>0&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx(J,{title:r("dashboard.training.totalAwareness"),value:j.totalSessions,icon:Ce,color:"green",trend:`${j.totalParticipants} participants`}),e.jsx(J,{title:r("dashboard.training.awarenessParticipants"),value:j.totalParticipants,icon:Ce,color:"purple"}),e.jsx(J,{title:r("dashboard.training.awarenessHours"),value:Math.round(j.totalHours??0),icon:Pe,color:"amber"})]})]})}),La={compliance:"#16a34a"},Ne=s.memo(function({title:o,value:i,icon:c,color:n,trend:d}){const r={green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${r[n]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(c,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:o})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:i}),d&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:d})]})}),Ia=s.memo(function({kpiSummary:o,weeklyTrends:i,projectPerformance:c,inspectionData:n,sorData:d,regulatoryWatch:r}){const y=ae(),j=s.useMemo(()=>{const N=o?.total_inspections??0,F=Number(r?.avg_overall_score??0).toFixed(1),z=Number(o?.avg_medical_compliance??0).toFixed(1),l=d?.stats?.total??0,b=d?.stats?.closed??0,v=l>0?Math.round(b/l*100):null;return{totalInspections:N,hseCompliance:F,medicalCompliance:z,auditScore:v}},[o,d,r]),p=s.useMemo(()=>(i??[]).map(N=>({week:N.week_label,inspections:N.inspections??0})),[i]),h=s.useMemo(()=>(d?.by_category??[]).map(N=>({category:N.label??N.category,count:N.count??0})),[d]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Ne,{title:y("dashboard.compliance.totalInspections"),value:j.totalInspections,icon:Me,color:"green",trend:y("dashboard.compliance.completedThisYear")}),e.jsx(Ne,{title:y("dashboard.compliance.hseCompliance"),value:`${j.hseCompliance}%`,icon:Je,color:"blue",trend:y("dashboard.compliance.avgScore")}),e.jsx(Ne,{title:y("dashboard.compliance.medicalCompliance"),value:`${j.medicalCompliance}%`,icon:pa,color:"purple",trend:y("dashboard.compliance.healthChecks")}),j.auditScore!==null&&e.jsx(Ne,{title:y("dashboard.compliance.auditScore"),value:`${j.auditScore}%`,icon:fa,color:"amber",trend:y("dashboard.compliance.latestAudit")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:y("dashboard.compliance.inspectionTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(be,{data:p,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"complianceGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#16a34a",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#16a34a",stopOpacity:.1})]})}),e.jsx(P,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week",tick:{fontSize:11}}),e.jsx($,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(ee,{type:"monotone",dataKey:"inspections",stroke:"#16a34a",fill:"url(#complianceGradient)",name:"Inspections"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:y("dashboard.compliance.auditFindings")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(ie,{data:h,children:[e.jsx(P,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"category",tick:{fontSize:11}}),e.jsx($,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(H,{dataKey:"count",fill:La.compliance,name:y("dashboard.compliance.findings"),radius:[4,4,0,0]})]})})})})]})]})]})}),K={water:"#0ea5e9",electricity:"#eab308",hse:"#22c55e",medical:"#8b5cf6",training:"#f59e0b",nearMiss:"#ef4444"},_e=s.memo(function({title:o,value:i,icon:c,color:n,trend:d,unit:r}){const y={blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400",yellow:"border-yellow-200 bg-yellow-50 dark:border-yellow-700 dark:bg-yellow-900/50 text-yellow-600 dark:text-yellow-400",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${y[n]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(c,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:o})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:[i,e.jsx("span",{className:"text-sm font-normal ml-1",children:r})]}),d&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:d})]})}),Ba=s.memo(function({kpiSummary:o,weeklyTrends:i}){const c=ae(),n=s.useMemo(()=>({waterConsumption:Number(o?.total_water_consumption??0),electricityUsage:Number(o?.total_electricity_consumption??0),hseCompliance:Math.round(Number(o?.avg_hse_compliance??0)),medicalCompliance:Math.round(Number(o?.avg_medical_compliance??0)),trainingHours:Math.round(Number(o?.total_training_hours??0)),nearMisses:Number(o?.total_near_misses??0),workPermits:Number(o?.total_work_permits??0)}),[o]),d=s.useMemo(()=>(i??[]).map(p=>({week:p.week_label,water:p.water??0,electricity:p.electricity??0,training_hours:p.training_hours??0})),[i]),r=s.useMemo(()=>(i??[]).map(p=>({week:p.week_label,hse:p.hse_compliance??0,medical:p.medical_compliance??0})),[i]),y=s.useMemo(()=>(i??[]).map(p=>({week:p.week_label,near_misses:p.near_misses??0,accidents:p.accidents??0,inspections:p.inspections??0})),[i]),j=s.useMemo(()=>[{name:c("dashboard.environmental.hseCompliance"),current:n.hseCompliance,target:95,color:K.hse},{name:c("dashboard.environmental.medicalCompliance"),current:n.medicalCompliance,target:95,color:K.medical}],[c,n]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(_e,{title:c("dashboard.environmental.hseCompliance"),value:n.hseCompliance,icon:Me,color:"green",unit:"%",trend:c("dashboard.environmental.yearToDate")}),e.jsx(_e,{title:c("dashboard.environmental.medicalCompliance"),value:n.medicalCompliance,icon:ya,color:"purple",unit:"%",trend:c("dashboard.environmental.yearToDate")}),e.jsx(_e,{title:c("dashboard.environmental.waterConsumption"),value:n.waterConsumption.toLocaleString(),icon:ja,color:"blue",unit:"m³",trend:c("dashboard.environmental.yearToDate")}),e.jsx(_e,{title:c("dashboard.environmental.electricityUsage"),value:n.electricityUsage.toLocaleString(),icon:ka,color:"yellow",unit:"kWh",trend:c("dashboard.environmental.yearToDate")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:c("dashboard.environmental.complianceTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(We,{data:r,children:[e.jsx(P,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week",tick:{fontSize:11}}),e.jsx($,{tick:{fontSize:11},domain:[0,100]}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(G,{}),e.jsx(q,{type:"monotone",dataKey:"hse",stroke:K.hse,strokeWidth:2,dot:{fill:K.hse,r:3},name:c("dashboard.environmental.hseCompliance")}),e.jsx(q,{type:"monotone",dataKey:"medical",stroke:K.medical,strokeWidth:2,dot:{fill:K.medical,r:3},name:c("dashboard.environmental.medicalCompliance")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:c("dashboard.environmental.waterVsElectricity")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(ta,{data:d,children:[e.jsx(P,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week",tick:{fontSize:11}}),e.jsx($,{yAxisId:"left",tick:{fontSize:11},stroke:K.water}),e.jsx($,{yAxisId:"right",orientation:"right",tick:{fontSize:11},stroke:K.electricity}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(G,{}),e.jsx(H,{yAxisId:"left",dataKey:"water",fill:K.water,name:"Water (m³)",radius:[4,4,0,0]}),e.jsx(q,{yAxisId:"right",type:"monotone",dataKey:"electricity",stroke:K.electricity,strokeWidth:2,name:"Electricity (kWh)"})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:c("dashboard.environmental.safetyTrends")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(be,{data:y,children:[e.jsx(P,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week",tick:{fontSize:11}}),e.jsx($,{tick:{fontSize:11}}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(G,{}),e.jsx(ee,{type:"monotone",dataKey:"inspections",stroke:K.hse,fill:K.hse,fillOpacity:.6,name:c("dashboard.inspections")}),e.jsx(ee,{type:"monotone",dataKey:"near_misses",stroke:K.training,fill:K.training,fillOpacity:.6,name:c("dashboard.nearMisses")}),e.jsx(ee,{type:"monotone",dataKey:"accidents",stroke:K.nearMiss,fill:K.nearMiss,fillOpacity:.6,name:c("dashboard.accidents")})]})})})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:c("dashboard.environmental.complianceProgress")})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"space-y-6 py-4",children:[j.map((p,h)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:p.name}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[p.current,"% / ",p.target,"%"]})]}),e.jsxs("div",{className:"relative h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:[e.jsx("div",{className:"absolute h-full rounded-full transition-all duration-500",style:{width:`${Math.min(p.current,100)}%`,backgroundColor:p.color}}),e.jsx("div",{className:"absolute h-full w-0.5 bg-gray-800 dark:bg-gray-300",style:{left:`${p.target}%`},title:`Target: ${p.target}%`})]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:p.current>=p.target?`✓ ${c("dashboard.environmental.targetAchieved")}`:`${p.target-p.current}% ${c("dashboard.environmental.toTarget")}`})]},h)),e.jsx("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:n.trainingHours.toLocaleString()}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:c("dashboard.environmental.trainingHoursYTD")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:n.nearMisses}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:c("dashboard.environmental.nearMissesYTD")})]})]})})]})})]})]})]})}),Y={open:"#dc2626",in_progress:"#f59e0b",closed:"#16a34a",trend:"#3b82f6"},we=s.memo(function({title:o,value:i,icon:c,color:n,subtitle:d}){const r={red:"border-red-200 bg-red-50 dark:border-red-700 dark:bg-red-900/50 text-red-600 dark:text-red-400",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50 text-amber-600 dark:text-amber-400",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50 text-green-600 dark:text-green-400",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50 text-purple-600 dark:text-purple-400",blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${r[n]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(c,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:o})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:i}),d&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:d})]})}),Oa=s.memo(function({year:o,projects:i,projectId:c="all",week:n="all"}){const d=ae(),[r,y]=s.useState(!0),[j,p]=s.useState(null),h=s.useMemo(()=>{const _=j?.avg_close_days;if(_==null)return"—";const W=Number(_);if(Number.isNaN(W))return"—";if(W<2){const le=Math.max(0,Math.round(W*24*60)),T=Math.floor(le/60),Ae=le%60;return`${T.toString().padStart(2,"0")}h${Ae.toString().padStart(2,"0")}min`}const S=Math.round(W*10)/10;return`${Number.isInteger(S)?String(S):S.toFixed(1)}d`},[j?.avg_close_days]);s.useEffect(()=>{let _=!0;return(async()=>{y(!0);try{const S={year:o};c!=="all"&&(S.project_id=c),n!=="all"&&(S.week=n);const R=await Ke.getSorCharts(S);if(!_)return;p(R.data.data)}finally{_&&y(!1)}})(),()=>{_=!1}},[o,c,n]);const N=j?.stats??{},F=j?.by_status??[],z=j?.by_category??[],l=j?.by_week??[],b=s.useMemo(()=>{const _=S=>S==="open"?d("dashboard.deviations.status.open"):S==="in_progress"?d("dashboard.deviations.status.inProgress"):S==="closed"?d("dashboard.deviations.status.closed"):S,W=S=>S==="open"?Y.open:S==="in_progress"?Y.in_progress:S==="closed"?Y.closed:Y.trend;return F.map(S=>({name:_(S.status),value:S.count,color:W(S.status)})).filter(S=>S.value>0)},[F,d]),v=s.useMemo(()=>z.slice(0,10).map(_=>({category:(_.label??_.category??"").toString().slice(0,28),count:_.count??0})),[z]);return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(we,{title:d("dashboard.deviations.total"),value:N.total??0,icon:ge,color:"blue",subtitle:d("dashboard.deviations.yearContext",{year:o})}),e.jsx(we,{title:d("dashboard.deviations.open"),value:N.open??0,icon:Pe,color:"red",subtitle:d("dashboard.deviations.inProgressAndOpen")}),e.jsx(we,{title:d("dashboard.deviations.closed"),value:N.closed??0,icon:va,color:"green",subtitle:d("dashboard.deviations.closedSubtitle")}),e.jsx(we,{title:d("dashboard.deviations.avgCloseDays"),value:h,icon:Na,color:"purple",subtitle:d("dashboard.deviations.avgCloseSubtitle")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:d("dashboard.deviations.trend")})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"h-64",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(be,{data:l,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"devTrendGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:Y.trend,stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:Y.trend,stopOpacity:.1})]})}),e.jsx(P,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week_label",tick:{fontSize:11}}),e.jsx($,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(ee,{type:"monotone",dataKey:"count",stroke:Y.trend,fill:"url(#devTrendGradient)",name:d("dashboard.deviations.total")})]})})}),r&&e.jsx("div",{className:"text-xs text-gray-400 mt-2",children:d("common.loading")})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:d("dashboard.deviations.byStatus")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-64",children:b.length>0?e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(De,{children:[e.jsx(Fe,{data:b,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:5,dataKey:"value",label:({name:_,value:W})=>`${_}: ${W}`,children:b.map((_,W)=>e.jsx(he,{fill:_.color},`cell-${W}`))}),e.jsx(A,{}),e.jsx(G,{})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:d("common.noData")})})})]}),e.jsxs("div",{className:"card lg:col-span-2",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:d("dashboard.deviations.byCategory")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-72",children:v.length>0?e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(ie,{data:v,children:[e.jsx(P,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"category",tick:{fontSize:10},interval:0}),e.jsx($,{allowDecimals:!1,tick:{fontSize:11}}),e.jsx(A,{contentStyle:{backgroundColor:"#1f2937",border:"none",borderRadius:"8px"},labelStyle:{color:"#f3f4f6"}}),e.jsx(H,{dataKey:"count",fill:Y.trend,name:d("dashboard.deviations.total"),radius:[4,4,0,0]})]})}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:d("common.noData")})})})]})]})]})});function Xa(){const t=ae(),{user:o}=oa(),[i,c]=s.useState(null),[n,d]=s.useState(!0),[r,y]=s.useState(de().year),[j,p]=s.useState(de().year-1),[h,N]=s.useState(null),[F,z]=s.useState(!1),[l,b]=s.useState("overview"),[v,_]=s.useState(""),[W,S]=s.useState([]),[R,le]=s.useState("all"),[T,Ae]=s.useState("all"),[oe,sa]=s.useState(null),[V,ze]=s.useState("all"),[U,Le]=s.useState(null),X=s.useRef(null),$e=ma(),Ie=s.useCallback(async()=>{try{d(!0);const a={year:r};v&&(a.pole=v),R!=="all"&&(a.project_id=R),T!=="all"&&(a.week=T);const m=await Ve(Ke.getAdminDashboard,"/dashboard/admin",a,3e4);c(m.data.data)}catch{ke.error(t("dashboard.loadFailed")||t("errors.failedToLoad"))}finally{d(!1)}},[r,v,R,T]),Be=s.useCallback(async()=>{try{const a=await ca.getPoles(),m=a.data?.data?.poles||a.data?.poles||[];S(Array.isArray(m)?m:[])}catch{S([])}},[]),Oe=s.useCallback(async()=>{if(!j){N(null);return}try{const a=await Ve(Ke.getAdminDashboard,"/dashboard/admin",{year:j},3e4);N(a.data.data??null)}catch(a){console.error("Failed to load comparison dashboard data",a),ke.error(t("dashboard.compareLoadFailed")??t("errors.failedToLoad"))}},[j]);s.useEffect(()=>{Ie(),Oe()},[Ie,Oe]),s.useEffect(()=>{Be()},[Be]),s.useEffect(()=>{p(r-1)},[r]);const Ee=s.useCallback(async a=>{z(!0);try{const m=a==="excel"?await Xe.exportExcel({year:r}):await Xe.exportPdf({year:r}),x=new Blob([m.data],{type:a==="excel"?"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"application/pdf"}),u=window.URL.createObjectURL(x),f=document.createElement("a");f.href=u,f.download=`kpi_report_${r}.${a==="excel"?"xlsx":"pdf"}`,f.click(),window.URL.revokeObjectURL(u),ke.success(t("dashboard.exportSuccess"))}catch{ke.error(t("dashboard.exportFailed")||t("errors.somethingWentWrong"))}finally{z(!1)}},[r]),te=s.useMemo(()=>i?.stats??{},[i?.stats]),Ge=s.useMemo(()=>i?.kpi_summary??{},[i?.kpi_summary]),ue=s.useMemo(()=>i?.weekly_trends??[],[i?.weekly_trends]),pe=s.useMemo(()=>i?.project_performance??[],[i?.project_performance]),se=s.useMemo(()=>i?.weekly_status??[],[i?.weekly_status]),fe=s.useMemo(()=>i?.projects??[],[i?.projects]);s.useEffect(()=>{X.current&&(!Array.isArray(se)||se.length===0||requestAnimationFrame(()=>{X.current&&X.current.scrollTo({left:X.current.scrollWidth,behavior:"auto"})}))},[se,r]);const ra=s.useMemo(()=>Ka(r),[r]),L=s.useMemo(()=>{if(T==="all")return ue;const a=Number(T);return Number.isNaN(a)?ue:(ue||[]).filter(m=>Number(m.week)===a)},[ue,T]),O=s.useMemo(()=>{if(R==="all")return pe;const a=Number(R);return Number.isNaN(a)?pe:(pe||[]).filter(m=>Number(m.id)===a)},[pe,R]),ye=s.useCallback((a,m,{higherIsBetter:x})=>{const u=Number(a??0),f=Number(m??0);if(u===f)return null;const g=x?u>f:u<f,k=f===0?100:Math.abs((u-f)/f*100),w=k>=10?Math.round(k):Math.round(k*10)/10,Z=u>f?_a:wa,je=g?"bg-green-50 text-green-700 dark:bg-green-900/30 dark:text-green-300":"bg-red-50 text-red-700 dark:bg-red-900/30 dark:text-red-300";return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[11px] font-semibold ${je}`,children:[e.jsx(Z,{className:"w-3.5 h-3.5"}),w,"%"]})},[]),I=s.useMemo(()=>i?.training_data||{},[i?.training_data]),re=s.useMemo(()=>i?.awareness_data||{},[i?.awareness_data]),na=s.useMemo(()=>i?.sor_data||{},[i?.sor_data]);s.useMemo(()=>i?.permit_data||{},[i?.permit_data]);const B=s.useMemo(()=>i?.inspection_data||{},[i?.inspection_data]),ne=s.useMemo(()=>{const a=Array.isArray(fe)?fe:[];return v?a.filter(m=>m?.pole===v):a},[fe,v]),He=o?.project_list_preference||"code",Ue=s.useMemo(()=>Pa(ne,He),[ne,He]);s.useEffect(()=>{if(R==="all")return;ne.some(m=>String(m.id)===String(R))||le("all")},[ne,R]),s.useEffect(()=>{if(V==="all")return;ne.some(m=>String(m.id)===String(V))||ze("all")},[ne,V]);const ce=s.useMemo(()=>{if(T==="all")return I;const a=Number(T);if(Number.isNaN(a))return I;const x=(Array.isArray(I?.by_week)?I.by_week:[]).filter(k=>Number(k.week_number)===a),u=x.reduce((k,w)=>k+Number(w?.count??0),0),f=x.reduce((k,w)=>k+Number(w?.participants??0),0),g=x.reduce((k,w)=>k+Number(w?.hours??0),0);return{...I,total:u,total_participants:f,total_hours:g,by_week:x}},[I,T]),Ye=s.useMemo(()=>{if(T==="all")return B;const a=Number(T);if(Number.isNaN(a))return B;const x=(Array.isArray(B?.by_week)?B.by_week:[]).filter(f=>Number(f.week_number)===a),u=x.reduce((f,g)=>f+Number(g?.count??0),0);return{...B,stats:{...B?.stats||{},total:u},by_week:x}},[B,T]),da=s.useMemo(()=>{if(T==="all")return re;const a=Number(T);if(Number.isNaN(a))return re;const x=(Array.isArray(re?.by_week)?re.by_week:[]).filter(k=>Number(k.week_number)===a),u=x.reduce((k,w)=>k+Number(w?.count??0),0),f=x.reduce((k,w)=>k+Number(w?.participants??0),0),g=x.reduce((k,w)=>k+Number(w?.hours??0),0);return{...re,total:u,total_participants:f,total_hours:g,by_week:x}},[re,T]),C=s.useMemo(()=>{const a=Ge||{},m={...a,total_trainings:I?.total??a.total_trainings??0,employees_trained:I?.total_participants??a.employees_trained??0,total_training_hours:I?.total_hours??a.total_training_hours??0,total_inspections:B?.stats?.total??a.total_inspections??0};if(T!=="all"){const x=Array.isArray(L)?L:[],u=g=>x.reduce((k,w)=>k+Number(w?.[g]??0),0),f=g=>{if(x.length===0)return 0;const k=x.map(w=>Number(w?.[g]??0));return k.reduce((w,Z)=>w+Z,0)/k.length};return{...m,total_accidents:u("accidents"),fatal_accidents:u("fatal_accidents"),serious_accidents:u("serious_accidents"),minor_accidents:u("minor_accidents"),total_inspections:Ye?.stats?.total??u("inspections"),total_near_misses:u("near_misses"),total_work_permits:u("work_permits"),avg_tf:f("tf"),avg_tg:f("tg"),avg_hse_compliance:f("hse_compliance"),avg_medical_compliance:f("medical_compliance"),total_water_consumption:u("water"),total_electricity_consumption:u("electricity"),total_trainings:ce?.total??0,employees_trained:ce?.total_participants??0,total_training_hours:ce?.total_hours??0}}if(R!=="all"){const x=Array.isArray(O)?O[0]:null;if(x)return{...m,total_accidents:Number(x.total_accidents??0),total_trainings:Number(x.total_trainings??0),avg_tf:Number(x.avg_tf??0),avg_tg:Number(x.avg_tg??0)}}return m},[Ge,I,B,ce,Ye,L,T,R,O]),ia=s.useCallback(a=>{if(!a||!a.activeLabel)return;const m=a.activeLabel,x=L.find(u=>u.week_label===m);if(x){sa(x);const u=new URLSearchParams;let f=x.week;if(!f&&typeof m=="string"){const k=parseInt(m.replace(/\D/g,""),10);Number.isNaN(k)||(f=k)}f&&u.set("week",f);const g=x.year||r;g&&u.set("year",g),$e(`/admin/kpi?${u.toString()}`)}},[L,r,$e]),la=s.useMemo(()=>[...Array(6)].map((a,m)=>de().year+1-m),[]);return n?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(Sa,{className:"w-8 h-8 animate-spin text-hse-primary"})}):e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:t("dashboard.adminTitle")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:t("dashboard.overview")})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 px-3 py-2",children:[e.jsx(Ca,{className:"w-4 h-4 text-gray-400"}),e.jsx("select",{value:r,onChange:a=>y(Number(a.target.value)),className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-none focus:ring-0 text-sm font-medium",children:la.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>Ee("excel"),disabled:F,className:"btn-secondary flex items-center gap-2",children:[e.jsx(Ta,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:t("dashboard.exportExcel")})]}),e.jsxs("button",{onClick:()=>Ee("pdf"),disabled:F,className:"btn-secondary flex items-center gap-2",children:[e.jsx(Ze,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:t("dashboard.exportPdf")})]})]})]})]}),e.jsx(Fa,{activeTheme:l,onThemeChange:b}),e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-end gap-2",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:flex-wrap sm:items-center gap-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white/70 dark:bg-gray-900/40 px-3 py-2 w-full sm:w-auto",children:[e.jsxs("select",{value:v,onChange:a=>_(a.target.value),className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-none focus:ring-0 text-sm w-full sm:w-auto",children:[e.jsx("option",{value:"",children:t("common.allPoles")}),W.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsx("span",{className:"hidden sm:block w-px h-5 bg-gray-200 dark:bg-gray-700"}),e.jsxs("select",{value:R,onChange:a=>le(a.target.value),className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-none focus:ring-0 text-sm w-full sm:w-auto",children:[e.jsx("option",{value:"all",children:t("common.allProjects")}),Ue.map(a=>e.jsx("option",{value:a.id,children:Qe(a)},a.id))]}),e.jsx("span",{className:"hidden sm:block w-px h-5 bg-gray-200 dark:bg-gray-700"}),e.jsxs("select",{value:T,onChange:a=>Ae(a.target.value),className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-none focus:ring-0 text-sm w-full sm:w-auto",children:[e.jsx("option",{value:"all",children:t("common.all")}),ra.map(a=>e.jsx("option",{value:a.week,children:a.label},a.week))]})]})}),l==="safety"&&e.jsx(Wa,{kpiSummary:C,weeklyTrends:L,projectPerformance:O}),l==="training"&&e.jsx(za,{kpiSummary:C,weeklyTrends:L,projectPerformance:O,trainingData:ce,awarenessData:da}),l==="compliance"&&e.jsx(Ia,{kpiSummary:C,weeklyTrends:L,projectPerformance:O,inspectionData:B,sorData:na,regulatoryWatch:i?.regulatory_watch}),l==="deviations"&&e.jsx(Oa,{year:r,projects:fe,projectId:R,week:T}),l==="environmental"&&e.jsx(Ba,{kpiSummary:C,weeklyTrends:L}),l==="overview"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Se,{title:t("dashboard.totalProjects"),value:te.total_projects??0,subtitle:`${te.active_projects??0} ${t("dashboard.activeLabel")}`,icon:Ma,color:"blue"}),e.jsx(Se,{title:t("dashboard.totalUsers"),value:te.total_users??0,subtitle:`${te.active_users??0} ${t("dashboard.activeLabel")}`,icon:Ce,color:"green"}),e.jsx(Se,{title:t("dashboard.activeMachines"),value:te.active_machines??0,subtitle:t("dashboard.activeMachinesSubtitle"),icon:Aa,color:"amber"}),e.jsx(Se,{title:t("dashboard.totalReports"),value:te.total_reports??0,subtitle:t("dashboard.inYear",{year:r}),icon:Ze,color:"purple"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(xe,{title:t("dashboard.safety.totalAccidents"),value:C.total_accidents??0,icon:ge,color:C.total_accidents>0?"red":"green",trend:C.fatal_accidents>0?`${C.fatal_accidents} ${t("dashboard.safety.fatal")}`:t("dashboard.safety.noFatalities")}),e.jsx(xe,{title:t("dashboard.training.totalTrainings"),value:C.total_trainings??0,icon:Te,color:"blue",trend:`${C.employees_trained??0} ${t("dashboard.training.employeesTrained")}`}),e.jsx(xe,{title:t("dashboard.compliance.totalInspections"),value:C.total_inspections??0,icon:Me,color:"green"}),e.jsx(xe,{title:t("dashboard.avgTf"),value:Number(C.avg_tf??0).toFixed(2),icon:aa,color:"amber",trend:t("dashboard.rates.frequencyRate")}),e.jsx(xe,{title:t("dashboard.avgTg"),value:Number(C.avg_tg??0).toFixed(2),icon:ea,color:"purple",trend:t("dashboard.rates.severityRate")})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t("dashboard.weeklyKpiTrends")})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"h-80",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(We,{data:L,onClick:ia,children:[e.jsx(P,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week_label",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx($,{tick:{fontSize:12}}),e.jsx(A,{labelFormatter:a=>`${t("dashboard.weekPrefix")} ${a.replace("S","")}`}),e.jsx(G,{}),e.jsx(q,{type:"monotone",dataKey:"accidents",stroke:"#dc2626",strokeWidth:2,dot:{fill:"#dc2626",r:3},name:t("dashboard.accidents")}),e.jsx(q,{type:"monotone",dataKey:"trainings",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:3},name:t("dashboard.training.totalTrainings")}),e.jsx(q,{type:"monotone",dataKey:"inspections",stroke:"#16a34a",strokeWidth:2,dot:{fill:"#16a34a",r:3},name:t("dashboard.inspections")})]})})}),oe&&e.jsxs("div",{className:"mt-4 text-xs text-gray-600 dark:text-gray-300",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"font-semibold",children:t("dashboard.detailsForWeek",{week:oe.week_label})}),e.jsx("button",{type:"button",onClick:()=>$e("/admin/kpi"),className:"btn-secondary btn-sm",children:t("dashboard.viewKpiReports")})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("dashboard.accidents")}),e.jsx("p",{className:"font-semibold",children:oe.accidents??0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("dashboard.training.totalTrainings")}),e.jsx("p",{className:"font-semibold",children:oe.trainings??0})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:t("dashboard.inspections")}),e.jsx("p",{className:"font-semibold",children:oe.inspections??0})]})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t("dashboard.tfTgRates")})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"h-80",children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(ta,{data:L,children:[e.jsx(P,{strokeDasharray:"3 3",stroke:"#f0f0f0",className:"dark:opacity-20"}),e.jsx(D,{dataKey:"week_label",tick:{fontSize:10},interval:"preserveStartEnd"}),e.jsx($,{yAxisId:"left",tick:{fontSize:12},stroke:"#f59e0b",label:{value:t("dashboard.rates.frequencyRate"),angle:-90,position:"insideLeft",style:{fill:"#f59e0b"}}}),e.jsx($,{yAxisId:"right",orientation:"right",tick:{fontSize:12},stroke:"#8b5cf6",label:{value:t("dashboard.rates.severityRate"),angle:90,position:"insideRight",style:{fill:"#8b5cf6"}}}),e.jsx(A,{labelFormatter:a=>`${t("dashboard.weekPrefix")} ${a.replace("S","")}`,formatter:(a,m)=>[Number(a).toFixed(4),m]}),e.jsx(G,{}),e.jsx(H,{yAxisId:"left",dataKey:"tf",fill:"#f59e0b",name:t("dashboard.rates.frequencyRate"),radius:[4,4,0,0]}),e.jsx(H,{yAxisId:"right",dataKey:"tg",fill:"#8b5cf6",name:t("dashboard.rates.severityRate"),radius:[4,4,0,0]})]})})})})]})]}),se.filter(a=>a.total_projects>0).length>0&&e.jsxs("div",{className:"card mt-6",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t("dashboard.submissionStatus")}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("select",{value:V,onChange:a=>ze(a.target.value),className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg px-3 py-1.5 text-sm font-medium dark:text-gray-200 focus:ring-2 focus:ring-hse-primary",children:[e.jsx("option",{value:"all",children:t("common.allProjects")}),Ue.map(a=>e.jsx("option",{value:a.id,children:Qe(a)},a.id))]})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:()=>X.current?.scrollBy({left:-300,behavior:"smooth"}),className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 bg-white/90 dark:bg-gray-700/90 hover:bg-white dark:hover:bg-gray-600 shadow-lg rounded-full p-2 border dark:border-gray-600",children:e.jsx($a,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})}),e.jsx("button",{type:"button",onClick:()=>X.current?.scrollBy({left:300,behavior:"smooth"}),className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 bg-white/90 dark:bg-gray-700/90 hover:bg-white dark:hover:bg-gray-600 shadow-lg rounded-full p-2 border dark:border-gray-600",children:e.jsx(Ra,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})}),e.jsx("div",{ref:X,className:"flex gap-2 overflow-x-auto scroll-smooth px-10 py-3 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",style:{scrollbarWidth:"thin"},children:(()=>{const a=de(),m=r<a.year?52:a.week;return Array.from({length:m},(x,u)=>u+1)})().map(a=>{const m=se.find(E=>E.week===a),x=de(),u=r<x.year||r===x.year&&a<x.week,f=a===x.week&&r===x.year;let g="not_submitted";const k=m?.projects||[];V==="all"?g=m?.status||"not_submitted":g=k.find(qe=>qe.project_id===parseInt(V))?.status||"not_submitted";const w=m?.approved_count??0,Z=m?.submitted_count??0,je=m?.draft_count??0,me=m?.total_projects??0;if(me<=0)return null;let Re="";if(g==="partial"&&me>0){const E=[];w>0&&E.push("rgb(34, 197, 94)"),Z>0&&E.push("rgb(251, 191, 36)"),je>0&&E.push("rgb(96, 165, 250)"),me-w-Z-je>0&&E.push("rgb(254, 202, 202)"),Re=E.length>1?`linear-gradient(135deg, ${E.join(", ")})`:""}return e.jsxs("div",{"data-week":a,className:`relative flex-shrink-0 w-14 p-2 rounded-lg text-center transition-all cursor-pointer ${U===a?"ring-2 ring-gray-900 ring-offset-2 scale-110":""} ${f&&U!==a?"ring-2 ring-hse-primary ring-offset-2":""} ${g==="approved"?"bg-green-500 text-white":g==="partial"?"text-white":g==="submitted"?"bg-amber-400 text-white":g==="draft"?"bg-blue-400 text-white":u?"bg-red-100 text-red-600 hover:bg-red-200":"bg-gray-100 text-gray-500"}`,style:g==="partial"&&Re?{background:Re}:{},onClick:()=>Le(U===a?null:a),children:[e.jsxs("p",{className:"text-xs font-medium",children:[t("dashboard.weekShortPrefix"),a]}),V==="all"&&me>1?e.jsxs("p",{className:"text-xs font-bold mt-0.5",children:[w+Z,"/",me]}):e.jsx("p",{className:"text-lg font-bold mt-0.5",children:g==="approved"?"✓":g==="partial"?"◐":g==="submitted"?"⏳":g==="draft"?"📝":u?"!":"-"})]},`admin-week-${r}-${a}`)})})]}),U&&(()=>{const m=se.find(g=>g.week===U)?.projects||[],x=de(),u=U===x.week&&r===x.year,f=r<x.year||r===x.year&&U<x.week;return m.length===0?null:e.jsxs("div",{className:"mt-3 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-700 pb-2 mb-2",children:[e.jsxs("p",{className:"font-semibold",children:[t("dashboard.weekDetailsTitle").replace("{{week}}",U),u&&e.jsxs("span",{className:"ml-2 text-hse-primary",children:["(",t("dashboard.currentWeekLabel"),")"]})]}),e.jsx("button",{type:"button",onClick:()=>Le(null),className:"text-gray-400 hover:text-white",children:"✕"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:m.map(g=>{const w=g.status==="not_submitted"&&f;return e.jsxs("div",{className:"flex items-center justify-between gap-2 bg-gray-800 rounded px-2 py-1.5",children:[e.jsx("span",{className:"truncate font-medium",children:g.project_code}),e.jsx("span",{className:`flex-shrink-0 px-1.5 py-0.5 rounded text-[10px] font-medium ${g.status==="approved"?"bg-green-500":g.status==="submitted"?"bg-amber-400":g.status==="draft"?"bg-blue-400":w?"bg-red-400":"bg-gray-500"}`,children:g.status==="approved"?t("status.approved"):g.status==="submitted"?t("status.pending"):g.status==="draft"?t("status.draft"):t(w?"status.missing":"status.notSubmitted")})]},g.project_id)})})]})})(),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4 pt-4 mt-2 border-t dark:border-gray-700 text-xs text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-green-500"})," ",t("status.approved")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-gradient-to-br from-green-400 to-amber-400"})," ",t("status.partial")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-amber-400"})," ",t("status.pending")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-blue-400"})," ",t("status.draft")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-red-100 border border-red-200"})," ",t("status.missing")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded ring-2 ring-hse-primary ring-offset-1"})," ",t("dashboard.currentWeekLabel")]})]})]})]}),h&&e.jsxs("div",{className:"card mt-6",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t("dashboard.yearOverYearSummary",{year:r,compareYear:j})})}),e.jsxs("div",{className:"card-body grid grid-cols-1 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx("span",{children:t("dashboard.safety.totalAccidents")}),ye(C.total_accidents,h?.kpi_summary?.total_accidents,{higherIsBetter:!1})]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[C.total_accidents??0," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["(",r,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[h?.kpi_summary?.total_accidents??0," (",j,")"]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx("span",{children:t("dashboard.training.totalTrainings")}),ye(C.total_trainings,h?.training_data?.total??h?.kpi_summary?.total_trainings,{higherIsBetter:!0})]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[C.total_trainings??0," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["(",r,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[h?.training_data?.total??h?.kpi_summary?.total_trainings??0," (",j,")"]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx("span",{children:t("dashboard.inspections")}),ye(C.total_inspections,h?.inspection_data?.stats?.total??h?.kpi_summary?.total_inspections,{higherIsBetter:!0})]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[C.total_inspections??0," ",e.jsxs("span",{className:"text-xs text-gray-400",children:["(",r,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[h?.inspection_data?.stats?.total??h?.kpi_summary?.total_inspections??0," (",j,")"]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx("span",{children:t("dashboard.tfTgRates")}),ye(Number(C.avg_tf??0)+Number(C.avg_tg??0),Number(h?.kpi_summary?.avg_tf??0)+Number(h?.kpi_summary?.avg_tg??0),{higherIsBetter:!1})]}),e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100",children:[Number(C.avg_tf??0).toFixed(2)," / ",Number(C.avg_tg??0).toFixed(2),e.jsxs("span",{className:"text-xs text-gray-400",children:[" (",r,")"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[Number(h?.kpi_summary?.avg_tf??0).toFixed(2)," / ",Number(h?.kpi_summary?.avg_tg??0).toFixed(2)," (",j,")"]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t("dashboard.projectPerformance")}),e.jsx(xa,{to:"/admin/projects",className:"text-sm text-hse-primary hover:underline",children:t("dashboard.viewAllProjects")})]}),O.length===0?e.jsx("div",{className:"p-6 text-center text-sm text-gray-500 dark:text-gray-400",children:t("dashboard.noProjectData")}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 p-4 md:hidden",children:O.slice(0,5).map(a=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3 bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:a.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.code})]}),e.jsxs("div",{className:"text-right text-xs text-gray-600 dark:text-gray-300 space-y-1",children:[e.jsxs("p",{children:[e.jsxs("span",{className:"font-semibold",children:[t("dashboard.reports"),":"]})," ",a.reports_count]}),e.jsxs("p",{children:[e.jsxs("span",{className:"font-semibold",children:[t("dashboard.training.totalTrainings"),":"]})," ",a.total_trainings]})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-[11px] text-gray-600 dark:text-gray-300",children:[e.jsxs("span",{children:[t("dashboard.accidents"),": ",e.jsx("span",{className:a.total_accidents>0?"text-red-600 dark:text-red-400 font-semibold":"text-green-600 dark:text-green-400",children:a.total_accidents})]}),e.jsxs("span",{children:["TF: ",Number(a.avg_tf).toFixed(2)," • TG: ",Number(a.avg_tg).toFixed(2)]})]})]},a.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:t("common.project")}),e.jsx("th",{children:t("dashboard.reports")}),e.jsx("th",{children:t("dashboard.accidents")}),e.jsx("th",{children:t("dashboard.training.totalTrainings")}),e.jsx("th",{children:t("dashboard.avgTf")}),e.jsx("th",{children:t("dashboard.avgTg")})]})}),e.jsx("tbody",{children:O.slice(0,5).map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium dark:text-gray-100",children:a.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.code})]})}),e.jsx("td",{children:a.reports_count}),e.jsx("td",{children:e.jsx("span",{className:a.total_accidents>0?"text-red-600 dark:text-red-400 font-semibold":"text-green-600 dark:text-green-400",children:a.total_accidents})}),e.jsx("td",{children:a.total_trainings}),e.jsx("td",{children:Number(a.avg_tf).toFixed(2)}),e.jsx("td",{children:Number(a.avg_tg).toFixed(2)})]},a.id))})]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t("dashboard.recentSubmissions")})}),e.jsx("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:i?.recent_reports?.filter(a=>a.status!=="draft").slice(0,5).map(a=>e.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:a.project?.name||"Unknown Project"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[a.report_month,"/",a.report_year," • Submitted by ",a.submitter?.name]})]}),e.jsx("span",{className:`badge ${a.status==="approved"?"badge-success":a.status==="submitted"?"badge-warning":a.status==="rejected"?"badge-danger":"badge-info"}`,children:a.status})]})},a.id))})]})]})]})}const Se=s.memo(function({title:o,value:i,subtitle:c,icon:n,color:d}){const r={blue:"bg-blue-50 text-blue-600",green:"bg-green-50 text-green-600",amber:"bg-amber-50 text-amber-600",purple:"bg-purple-50 text-purple-600",red:"bg-red-50 text-red-600"};return e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:o}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1",children:i}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:c})]}),e.jsx("div",{className:`p-3 rounded-lg ${r[d]}`,children:e.jsx(n,{className:"w-5 h-5"})})]})})}),xe=s.memo(function({title:o,value:i,icon:c,color:n,trend:d}){const r={red:"border-red-200 bg-red-50 dark:border-red-700 dark:bg-red-900/50",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50",blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50"},y={red:"text-red-600 dark:text-red-400",green:"text-green-600 dark:text-green-400",blue:"text-blue-600 dark:text-blue-400",amber:"text-amber-600 dark:text-amber-400",purple:"text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${r[n]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(c,{className:`w-5 h-5 ${y[n]}`}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:o})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:i}),d&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:d})]})});export{Xa as default};
