import{u as q,a as B,e as G,j as e}from"./index-Cj_Nywl_.js";import{r as m,L as y}from"./vendor-react-Bagy_njL.js";import{z as M,r as X,a0 as H,P as J,F as A,e as I,o as Y,A as O,K as Q,c as V,T as E,R as Z,a7 as ee,n as ae,X as re,a2 as se,a3 as te}from"./vendor-ui-ByylQ01J.js";import{g as _}from"./weekHelper-DiwCDpdk.js";import"./vendor-utils-MYqKZVQ3.js";function oe(){const[n,f]=m.useState(null),[b,x]=m.useState(!0),[l,u]=m.useState(new Date().getFullYear()),[v,z]=m.useState("all"),[c,L]=m.useState(null),{user:K}=q(),{t:r}=B(),g=m.useRef(null);m.useEffect(()=>{U()},[l]),m.useEffect(()=>{if(n&&g.current){const a=_();if(l===a.year){const s=g.current.querySelector(`[data-week="${a.week}"]`);if(s){const d=g.current.clientWidth,o=s.offsetWidth+8,j=s.offsetLeft-d+o*3;g.current.scrollTo({left:Math.max(0,j),behavior:"smooth"})}}}},[n,l]);const U=async()=>{try{x(!0);const a=await G.getUserDashboard(l);f(a.data.data)}catch{M.error(r("errors.failedToLoad"))}finally{x(!1)}},P=r("datePicker.months");if(b)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(X,{className:"w-8 h-8 animate-spin text-hse-primary"})});const N=n?.stats||{},h=n?.kpi_summary||{},$=n?.projects||[],S=n?.recent_reports||[];return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:[r("dashboard.welcome"),", ",K?.name?.split(" ")[0],"!"]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:r("dashboard.overview")})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 px-3 py-2",children:[e.jsx(H,{className:"w-4 h-4 text-gray-400"}),e.jsx("select",{value:l,onChange:a=>u(Number(a.target.value)),className:"bg-transparent border-none focus:ring-0 text-sm font-medium dark:text-gray-200",children:[...Array(5)].map((a,s)=>{const d=new Date().getFullYear()-s;return e.jsx("option",{value:d,children:d},d)})})]}),e.jsxs(y,{to:"/kpi/submit",className:"btn-primary flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),r("kpi.submission")]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(C,{title:r("nav.myProjects"),value:N.assigned_projects||0,icon:A,color:"blue"}),e.jsx(C,{title:r("dashboard.recentSubmissions"),value:N.reports_submitted||0,subtitle:`${l}`,icon:I,color:"green"}),e.jsx(C,{title:r("dashboard.pendingReports"),value:N.pending_approval||0,icon:Y,color:"amber"}),e.jsx(C,{title:r("kpi.status.draft"),value:N.draft_reports||0,icon:I,color:"purple"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(k,{title:r("kpi.accidents.title"),value:h.total_accidents||0,icon:O,color:h.total_accidents>0?"red":"green"}),e.jsx(k,{title:r("kpi.training.title"),value:h.total_trainings||0,icon:Q,color:"blue"}),e.jsx(k,{title:r("kpi.inspections.title"),value:h.total_inspections||0,icon:V,color:"green"}),e.jsx(k,{title:r("dashboard.avgTf"),value:Number(h.avg_tf||0).toFixed(2),icon:E,color:"amber"}),e.jsx(k,{title:r("dashboard.avgTg"),value:Number(h.avg_tg||0).toFixed(2),icon:E,color:"purple"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:r("nav.myProjects")}),e.jsx(y,{to:"/my-projects",className:"text-sm text-hse-primary hover:underline",children:r("common.view")})]}),e.jsxs("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:[$.slice(0,4).map(a=>e.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-hse-primary/10 dark:bg-hse-primary/20 rounded-lg flex items-center justify-center",children:e.jsx(A,{className:"w-5 h-5 text-hse-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:a.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a.code})]})]}),e.jsx(y,{to:`/kpi/submit/${a.id}`,className:"btn-outline text-xs py-1 px-3",children:r("kpi.submission")})]})},a.id)),$.length===0&&e.jsx("div",{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:r("projects.noProjects")})]})]}),(()=>{const a=S.filter(s=>s.status==="draft");return a.length===0?null:e.jsxs("div",{className:"card border-amber-200 dark:border-amber-700 bg-amber-50/30 dark:bg-amber-900/20",children:[e.jsxs("div",{className:"card-header flex items-center justify-between bg-amber-50 dark:bg-amber-900/30 border-b border-amber-200 dark:border-amber-700",children:[e.jsxs("h3",{className:"font-semibold text-amber-900 dark:text-amber-300 flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),r("dashboard.draftsToComplete")]}),e.jsxs("span",{className:"bg-amber-100 dark:bg-amber-800 text-amber-800 dark:text-amber-100 text-xs font-medium px-2 py-1 rounded-full",children:[a.length," ",a.length>1?r("dashboard.draftLabelPlural"):r("dashboard.draftLabel")]})]}),e.jsx("div",{className:"divide-y divide-amber-100 dark:divide-amber-800",children:a.map(s=>e.jsx("div",{className:"p-4 hover:bg-amber-50/50 dark:hover:bg-amber-900/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:s.project?.name||r("common.unknown")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.week_number?r("dashboard.weekLabel").replace("{{week}}",s.week_number).replace("{{year}}",s.report_year):r("dashboard.monthYearLabel").replace("{{month}}",P[s.report_month-1]).replace("{{year}}",s.report_year)}),s.rejection_reason&&e.jsxs("div",{className:"mt-2 p-2 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700 rounded text-xs text-red-700 dark:text-red-300",children:[e.jsxs("strong",{children:[r("kpi.rejectionReason"),":"]})," ",s.rejection_reason]})]}),e.jsxs(y,{to:`/kpi/edit/${s.id}`,className:"btn-primary text-sm py-2 px-4 flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),r("common.edit")]})]})},s.id))})]})})(),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:r("dashboard.recentSubmissions")}),e.jsx(y,{to:"/kpi/history",className:"text-sm text-hse-primary hover:underline",children:r("common.view")})]}),e.jsxs("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:[S.filter(a=>a.status!=="draft").slice(0,4).map(a=>e.jsx("div",{className:"p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:a.project?.name||r("common.unknown")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:a.week_number?r("dashboard.weekLabel").replace("{{week}}",a.week_number).replace("{{year}}",a.report_year):r("dashboard.monthYearLabel").replace("{{month}}",P[a.report_month-1]).replace("{{year}}",a.report_year)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.status==="approved"&&e.jsx(ae,{className:"w-5 h-5 text-green-500"}),a.status==="rejected"&&e.jsx(re,{className:"w-5 h-5 text-red-500"}),a.status==="submitted"&&e.jsx(Y,{className:"w-5 h-5 text-amber-500"}),e.jsx("span",{className:`badge ${a.status==="approved"?"badge-success":a.status==="submitted"?"badge-warning":a.status==="rejected"?"badge-danger":"badge-info"}`,children:r(`kpi.status.${a.status}`)})]})]})},a.id)),S.filter(a=>a.status!=="draft").length===0&&e.jsx("div",{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:r("kpi.noReports")})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:r("dashboard.submissionStatus")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{value:v,onChange:a=>z(a.target.value),className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg px-3 py-1.5 text-sm font-medium dark:text-gray-200 focus:ring-2 focus:ring-hse-primary",children:[e.jsx("option",{value:"all",children:r("common.allProjects")}),n?.projects?.map(a=>e.jsxs("option",{value:a.id,children:[a.code," - ",a.name]},a.id))]}),e.jsx("select",{value:l,onChange:a=>u(Number(a.target.value)),className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg px-3 py-1.5 text-sm font-medium dark:text-gray-200 focus:ring-2 focus:ring-hse-primary",children:[...Array(5)].map((a,s)=>{const d=new Date().getFullYear()-s;return e.jsx("option",{value:d,children:d},d)})})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>g.current?.scrollBy({left:-300,behavior:"smooth"}),className:"absolute left-0 top-1/2 -translate-y-1/2 z-10 bg-white/90 dark:bg-gray-700/90 hover:bg-white dark:hover:bg-gray-600 shadow-lg rounded-full p-2 border dark:border-gray-600",children:e.jsx(se,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})}),e.jsx("button",{onClick:()=>g.current?.scrollBy({left:300,behavior:"smooth"}),className:"absolute right-0 top-1/2 -translate-y-1/2 z-10 bg-white/90 dark:bg-gray-700/90 hover:bg-white dark:hover:bg-gray-600 shadow-lg rounded-full p-2 border dark:border-gray-600",children:e.jsx(te,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})}),e.jsx("div",{ref:g,className:"flex gap-2 overflow-x-auto scroll-smooth px-10 py-3 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",style:{scrollbarWidth:"thin"},children:(()=>{const a=_(),s=l<a.year?52:a.week;return Array.from({length:s},(d,o)=>o+1)})().map(a=>{const s=n?.weekly_status?.find(i=>i.week===a),d=_(),o=l<d.year||l===d.year&&a<d.week,j=a===d.week&&l===d.year;let t="not_submitted",R=s?.projects||[];v==="all"?t=s?.status||"not_submitted":t=R.find(F=>F.project_id===parseInt(v))?.status||"not_submitted";const p=s?.approved_count||0,W=s?.submitted_count||0,T=s?.draft_count||0,w=s?.total_projects||1;let D="";if(t==="partial"&&w>0){const i=[];p>0&&i.push("rgb(34, 197, 94)"),W>0&&i.push("rgb(251, 191, 36)"),T>0&&i.push("rgb(96, 165, 250)"),w-p-W-T>0&&i.push("rgb(254, 202, 202)"),D=i.length>1?`linear-gradient(135deg, ${i.join(", ")})`:""}return e.jsxs("div",{"data-week":a,className:`relative flex-shrink-0 w-14 p-2 rounded-lg text-center transition-all cursor-pointer ${c===a?"ring-2 ring-gray-900 ring-offset-2 scale-110":""} ${j&&c!==a?"ring-2 ring-hse-primary ring-offset-2":""} ${t==="approved"?"bg-green-500 text-white":t==="partial"?"text-white":t==="submitted"?"bg-amber-400 text-white":t==="draft"?"bg-blue-400 text-white":o?"bg-red-100 text-red-600 hover:bg-red-200":"bg-gray-100 text-gray-500"}`,style:t==="partial"&&D?{background:D}:{},onClick:()=>L(c===a?null:a),children:[e.jsxs("p",{className:"text-xs font-medium",children:[r("dashboard.weekShortPrefix"),a]}),v==="all"&&w>1?e.jsxs("p",{className:"text-xs font-bold mt-0.5",children:[p+W,"/",w]}):e.jsx("p",{className:"text-lg font-bold mt-0.5",children:t==="approved"?"âœ“":t==="partial"?"â—":t==="submitted"?"â³":t==="draft"?"ðŸ“":o?"!":"-"})]},`week-${l}-${a}`)})})]}),c&&(()=>{const s=n?.weekly_status?.find(t=>t.week===c)?.projects||[],d=_(),o=c===d.week&&l===d.year,j=l<d.year||l===d.year&&c<d.week;return s.length===0?null:e.jsxs("div",{className:"mt-3 p-3 bg-gray-900 text-white text-xs rounded-lg shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-700 pb-2 mb-2",children:[e.jsxs("p",{className:"font-semibold",children:[r("dashboard.weekDetailsTitle").replace("{{week}}",c),o&&e.jsxs("span",{className:"ml-2 text-hse-primary",children:["(",r("dashboard.currentWeekLabel"),")"]})]}),e.jsx("button",{onClick:()=>L(null),className:"text-gray-400 hover:text-white",children:"âœ•"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2",children:s.map(t=>{const p=t.status==="not_submitted"&&j;return e.jsxs("div",{className:"flex items-center justify-between gap-2 bg-gray-800 rounded px-2 py-1.5",children:[e.jsx("span",{className:"truncate font-medium",children:t.project_code}),e.jsx("span",{className:`flex-shrink-0 px-1.5 py-0.5 rounded text-[10px] font-medium ${t.status==="approved"?"bg-green-500":t.status==="submitted"?"bg-amber-400":t.status==="draft"?"bg-blue-400":p?"bg-red-400":"bg-gray-500"}`,children:t.status==="approved"?r("status.approved"):t.status==="submitted"?r("status.pending"):t.status==="draft"?r("status.draft"):r(p?"status.missing":"status.notSubmitted")})]},t.project_id)})})]})})(),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4 pt-4 mt-2 border-t dark:border-gray-700 text-xs text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-green-500"})," ",r("status.approved")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-gradient-to-br from-green-400 to-amber-400"})," ",r("status.partial")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-amber-400"})," ",r("status.pending")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-blue-400"})," ",r("status.draft")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-red-100 border border-red-200"})," ",r("status.missing")]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-3 h-3 rounded ring-2 ring-hse-primary ring-offset-1"})," ",r("dashboard.currentWeekLabel")]})]})]})]})]})}function C({title:n,value:f,subtitle:b,icon:x,color:l}){const u={blue:"bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400",green:"bg-green-50 text-green-600 dark:bg-green-900/30 dark:text-green-400",amber:"bg-amber-50 text-amber-600 dark:bg-amber-900/30 dark:text-amber-400",purple:"bg-purple-50 text-purple-600 dark:bg-purple-900/30 dark:text-purple-400"};return e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:n}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mt-1",children:f}),b&&e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:b})]}),e.jsx("div",{className:`p-3 rounded-lg ${u[l]}`,children:e.jsx(x,{className:"w-5 h-5"})})]})})}function k({title:n,value:f,icon:b,color:x}){const l={red:"border-red-200 bg-red-50 dark:border-red-700 dark:bg-red-900/50",green:"border-green-200 bg-green-50 dark:border-green-700 dark:bg-green-900/50",blue:"border-blue-200 bg-blue-50 dark:border-blue-700 dark:bg-blue-900/50",amber:"border-amber-200 bg-amber-50 dark:border-amber-700 dark:bg-amber-900/50",purple:"border-purple-200 bg-purple-50 dark:border-purple-700 dark:bg-purple-900/50"},u={red:"text-red-600 dark:text-red-400",green:"text-green-600 dark:text-green-400",blue:"text-blue-600 dark:text-blue-400",amber:"text-amber-600 dark:text-amber-400",purple:"text-purple-600 dark:text-purple-400"};return e.jsxs("div",{className:`rounded-xl border-2 p-4 ${l[x]}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(b,{className:`w-5 h-5 ${u[x]}`}),e.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:n})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:f})]})}export{oe as default};
