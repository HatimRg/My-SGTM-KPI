import{a as z,j as n}from"./index.js";import{r as o,a as H}from"./vendor-react.js";import{ap as K,as as T,at as U}from"./vendor-ui.js";function J({value:i,onChange:N,placeholder:M,className:S="",required:R=!1,disabled:b=!1}){const{t:u,language:E}=z(),[c,m]=o.useState(!1),[h,p]=o.useState(()=>i?new Date(i):new Date),[l,x]=o.useState("days"),[k,D]=o.useState({top:0,left:0,placement:"bottom"}),f=o.useRef(null),w=o.useRef(null),y=o.useRef(null),P=u("datePicker.days"),F=u("datePicker.months"),$=u("datePicker.monthsFull");o.useEffect(()=>{const t=r=>{const a=f.current&&f.current.contains(r.target),d=y.current&&y.current.contains(r.target);!a&&!d&&m(!1)},e=r=>{r.key==="Escape"&&m(!1)};return c&&(document.addEventListener("mousedown",t),document.addEventListener("keydown",e)),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",e)}},[c]),o.useEffect(()=>{if(!c)return;const t=w.current?.getBoundingClientRect();if(!t)return;const e=256,r=8;let a=t.left;a+e>window.innerWidth-r&&(a=Math.max(r,window.innerWidth-e-r));const d=t.bottom+4;D({top:d,left:a,placement:"bottom"})},[c]),o.useEffect(()=>{if(!c)return;const t=w.current?.getBoundingClientRect(),e=y.current?.getBoundingClientRect();if(!t||!e)return;const r=8;if(e.bottom>window.innerHeight-r){const d=Math.max(r,t.top-e.height-4);D(g=>({...g,top:d,placement:"top"}))}},[c,l,h]);const L=t=>{const e=t.getFullYear(),r=t.getMonth(),a=new Date(e,r,1),d=new Date(e,r+1,0),g=[],I=new Date(e,r,0);for(let s=a.getDay()-1;s>=0;s--)g.push({date:new Date(e,r-1,I.getDate()-s),isCurrentMonth:!1});for(let s=1;s<=d.getDate();s++)g.push({date:new Date(e,r,s),isCurrentMonth:!0});const C=42,W=C-g.length;for(let s=1;s<=Math.max(0,W);s++)g.push({date:new Date(e,r+1,s),isCurrentMonth:!1});return g.slice(0,C)},v=t=>{const e=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return`${e}-${r}-${a}`},j=t=>{N(v(t)),m(!1),x("days")},Y=t=>{p(new Date(h.getFullYear(),t,1)),x("days")},B=t=>t.toDateString()===new Date().toDateString(),V=t=>i&&v(t)===i,O=()=>{if(!i)return"";const[t,e,r]=i.split("-").map(Number);if(!t||!e||!r)return"";const a=E==="fr"?"fr-FR":"en-US";return new Date(t,e-1,r).toLocaleDateString(a,{day:"2-digit",month:"2-digit",year:"numeric"})};return n.jsxs("div",{ref:f,className:`relative ${S}`,children:[n.jsxs("div",{onClick:()=>!b&&m(!c),ref:w,className:`input flex items-center justify-between cursor-pointer ${b?"opacity-50 cursor-not-allowed":""}`,children:[n.jsx("span",{className:i?"text-gray-900 dark:text-gray-100":"text-gray-400 dark:text-gray-500",children:O()??M??u("datePicker.select")}),n.jsx(K,{className:"w-4 h-4 text-gray-400"})]}),n.jsx("input",{type:"hidden",value:i??"",required:R}),c&&H.createPortal(n.jsxs("div",{ref:y,style:{top:k.top,left:k.left,width:256},className:"fixed z-[9999] bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-2",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsx("button",{type:"button",onClick:()=>p(t=>new Date(t.getFullYear()-(l==="months"?1:0),t.getMonth()-(l==="days"?1:0),1)),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:n.jsx(T,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})}),n.jsxs("button",{type:"button",onClick:()=>x(l==="days"?"months":"days"),className:"font-medium text-sm text-gray-900 dark:text-gray-100 hover:text-hse-primary dark:hover:text-hse-primary px-2 py-0.5 rounded hover:bg-gray-100 dark:hover:bg-gray-700",children:[$[h.getMonth()]," ",h.getFullYear()]}),n.jsx("button",{type:"button",onClick:()=>p(t=>new Date(t.getFullYear()+(l==="months"?1:0),t.getMonth()+(l==="days"?1:0),1)),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:n.jsx(U,{className:"w-4 h-4 text-gray-600 dark:text-gray-400"})})]}),l==="months"?n.jsx("div",{className:"grid grid-cols-3 gap-1",children:F.map((t,e)=>n.jsx("button",{type:"button",onClick:()=>Y(e),className:`py-2 text-xs rounded transition-colors
                    ${h.getMonth()===e?"bg-hse-primary text-white":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:t},e))}):n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"grid grid-cols-7 gap-0.5 mb-1",children:P.map((t,e)=>n.jsx("div",{className:"text-center text-[10px] font-medium text-gray-500 dark:text-gray-400 py-0.5",children:t},e))}),n.jsx("div",{className:"grid grid-cols-7 gap-0.5",children:L(h).map((t,e)=>n.jsx("button",{type:"button",onClick:()=>j(t.date),className:`p-1.5 text-xs rounded transition-colors
                      ${t.isCurrentMonth?"text-gray-900 dark:text-gray-100":"text-gray-300 dark:text-gray-600"}
                      ${B(t.date)?"ring-1 ring-hse-primary":""}
                      ${V(t.date)?"bg-hse-primary text-white":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:t.date.getDate()},e))})]}),n.jsx("div",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:n.jsx("button",{type:"button",onClick:()=>j(new Date),className:"w-full text-xs text-hse-primary hover:underline",children:u("datePicker.today")})})]}),document.body)]})}export{J as D};
