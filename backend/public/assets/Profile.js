import{u as A,a as B,v as O,j as e}from"./index.js";import{r as n}from"./vendor-react.js";import{g as R,P as I,c as J}from"./PasswordStrength.js";import{a3 as _,J as K,a4 as F,aX as G,a0 as u,aP as C,a8 as d,a6 as g,E as f,M as H,b as Q,z as i}from"./vendor-ui.js";import"./vendor-utils.js";function ee(){const{user:l,updateProfile:j,changePassword:L}=A(),{t:s,language:D,setLanguage:X,languages:M}=B(),{isDark:y,toggleTheme:T}=O(),m=n.useMemo(()=>R(l?.role),[l?.role]),[c,N]=n.useState({name:l?.name??"",phone:l?.phone??""}),[p,E]=n.useState({project_list_preference:l?.project_list_preference??"code"}),[r,o]=n.useState({current_password:"",password:"",password_confirmation:""}),[t,x]=n.useState({current:!1,new:!1,confirm:!1}),[w,v]=n.useState(!1),[b,P]=n.useState(!1),[S,k]=n.useState(!1),U=async a=>{a.preventDefault(),v(!0);try{await j(c),i.success(s("profile.profileUpdated"))}catch(h){i.error(h.response?.data?.message??s("errors.failedToSave"))}finally{v(!1)}},q=async()=>{k(!0);try{await j(p),i.success(s("profile.preferencesUpdated"))}catch(a){i.error(a.response?.data?.message??s("errors.failedToSave"))}finally{k(!1)}},z=async a=>{if(a.preventDefault(),r.password!==r.password_confirmation){i.error(s("profile.passwordMismatch"));return}if(!J(r.password,m).ok){i.error(s("auth.passwordPolicy.invalid"));return}P(!0);try{await L(r.current_password,r.password,r.password_confirmation),i.success(s("success.passwordChanged")),o({current_password:"",password:"",password_confirmation:""})}catch(h){i.error(h.response?.data?.message||s("errors.failedToSave"))}finally{P(!1)}};return e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:s("profile.title")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:s("profile.subtitle")})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("profile.personalInfo")})}),e.jsxs("form",{onSubmit:U,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"w-20 h-20 bg-hse-primary rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-2xl font-bold",children:l?.name?.charAt(0)?.toUpperCase()||"U"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-gray-100",children:l?.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 capitalize flex items-center gap-1",children:[e.jsx(_,{className:"w-4 h-4"}),l?.role]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("users.form.fullName")}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:c.name,onChange:a=>N({...c,name:a.target.value}),className:"input pl-10",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("users.form.email")}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"email",value:l?.email??"",className:"input pl-10 bg-gray-50 dark:bg-gray-900",disabled:!0})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:s("profile.emailReadOnly")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("users.form.phone")}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"tel",value:c.phone,onChange:a=>N({...c,phone:a.target.value}),className:"input pl-10",placeholder:"+212 6XX XXX XXX"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("users.form.role")}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:l?.role??"",className:"input pl-10 bg-gray-50 dark:bg-gray-900 capitalize",disabled:!0})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:w,className:"btn-primary",children:w?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4 animate-spin"}),s("common.saving")]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),s("profile.updateProfile")]})})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100",children:s("profile.changePassword")})}),e.jsxs("form",{onSubmit:z,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("auth.currentPassword")}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:t.current?"text":"password",value:r.current_password,onChange:a=>o({...r,current_password:a.target.value}),className:"input pl-10 pr-10",required:!0}),e.jsx("button",{type:"button",onClick:()=>x({...t,current:!t.current}),className:"absolute right-3 top-1/2 -translate-y-1/2",children:t.current?e.jsx(g,{className:"w-4 h-4 text-gray-400"}):e.jsx(f,{className:"w-4 h-4 text-gray-400"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("auth.newPassword")}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:t.new?"text":"password",value:r.password,onChange:a=>o({...r,password:a.target.value}),className:"input pl-10 pr-10",required:!0,minLength:m.minLength}),e.jsx("button",{type:"button",onClick:()=>x({...t,new:!t.new}),className:"absolute right-3 top-1/2 -translate-y-1/2",children:t.new?e.jsx(g,{className:"w-4 h-4 text-gray-400"}):e.jsx(f,{className:"w-4 h-4 text-gray-400"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("auth.confirmPassword")}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:t.confirm?"text":"password",value:r.password_confirmation,onChange:a=>o({...r,password_confirmation:a.target.value}),className:"input pl-10 pr-10",required:!0,minLength:m.minLength}),e.jsx("button",{type:"button",onClick:()=>x({...t,confirm:!t.confirm}),className:"absolute right-3 top-1/2 -translate-y-1/2",children:t.confirm?e.jsx(g,{className:"w-4 h-4 text-gray-400"}):e.jsx(f,{className:"w-4 h-4 text-gray-400"})})]})]})]}),e.jsx(I,{password:r.password,role:l?.role}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:b,className:"btn-primary",children:b?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4 animate-spin"}),s("common.saving")]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"w-4 h-4"}),s("profile.changePassword")]})})})]})]}),e.jsxs("div",{className:"card p-6",children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-gray-100 mb-4",children:s("profile.preferencesTitle")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("profile.language")}),e.jsx("select",{className:"input",value:D,onChange:a=>X(a.target.value),children:M.map(a=>e.jsx("option",{value:a.code,children:a.name},a.code))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("profile.projectListPreference")}),e.jsxs("select",{className:"input",value:p.project_list_preference,onChange:a=>E({...p,project_list_preference:a.target.value}),children:[e.jsx("option",{value:"code",children:s("profile.projectListByCode")}),e.jsx("option",{value:"name",children:s("profile.projectListByName")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:s("profile.theme")}),e.jsxs("button",{type:"button",onClick:T,className:"w-full flex items-center justify-between px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-200",children:s(y?"common.darkMode":"common.lightMode")}),e.jsx("span",{className:"flex items-center gap-1.5 text-gray-600 dark:text-gray-300",children:y?e.jsx(H,{className:"w-4 h-4"}):e.jsx(Q,{className:"w-4 h-4"})})]})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsx("button",{type:"button",onClick:q,disabled:S,className:"btn-primary",children:S?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4 animate-spin"}),s("common.saving")]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4"}),s("profile.savePreferences")]})})})]})]})}export{ee as default};
