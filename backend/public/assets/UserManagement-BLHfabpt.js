import{a as X,g as x,p as G,j as e}from"./index-Cj_Nywl_.js";import{r as l}from"./vendor-react-Bagy_njL.js";import{M as J}from"./Modal-CFdjfuaB.js";import{C as Q}from"./ConfirmDialog-R0bb8T7D.js";import{S}from"./Select-D_zVsBMD.js";import{z as i,a4 as V,a5 as W,a6 as Y,F as U,a7 as E,a8 as F,a9 as P,aa as A,r as Z}from"./vendor-ui-ByylQ01J.js";import"./vendor-utils-MYqKZVQ3.js";function ne(){const{t:a}=X(),[y,D]=l.useState([]),[L,M]=l.useState([]),[$,f]=l.useState(!0),[h,q]=l.useState(""),[u,O]=l.useState(""),[z,N]=l.useState(!1),[d,p]=l.useState(null),[t,n]=l.useState({name:"",email:"",password:"",role:"responsable",phone:"",project_ids:[]}),[w,k]=l.useState(!1),[c,R]=l.useState({current_page:1,last_page:1}),[m,g]=l.useState(null);l.useEffect(()=>{o(),T()},[h,u]);const o=async(s=1)=>{try{f(!0);const r=await x.getAll({page:s,search:h,role:u,per_page:10});D(r.data.data||[]),R(r.data.meta||{current_page:1,last_page:1})}catch{i.error(a("users.loadError"))}finally{f(!1)}},T=async()=>{try{const s=await G.getAll({per_page:100});M(s.data.data||[])}catch{console.error("Failed to load projects")}},j=(s=null)=>{s?(p(s),n({name:s.name,email:s.email,password:"",role:s.role,phone:s.phone||"",project_ids:s.projects?.map(r=>r.id)||[]})):(p(null),n({name:"",email:"",password:"",role:"responsable",phone:"",project_ids:[]})),N(!0)},v=()=>{N(!1),p(null)},B=async s=>{s.preventDefault(),k(!0);try{d?(await x.update(d.id,t),i.success(a("users.updateSuccess"))):(await x.create(t),i.success(a("users.createSuccess"))),v(),o()}catch(r){const b=r.response?.data?.message||a("users.saveError");i.error(b)}finally{k(!1)}},_=s=>{g(s)},H=async()=>{if(m)try{await x.delete(m.id),i.success(a("users.deleteSuccess")),o()}catch(s){i.error(s.response?.data?.message||a("users.deleteError"))}finally{g(null)}},C=async s=>{try{await x.toggleStatus(s.id),i.success(s.is_active?a("users.deactivateSuccess"):a("users.activateSuccess")),o()}catch(r){i.error(r.response?.data?.message||a("users.statusError"))}},K=s=>{n(r=>({...r,project_ids:r.project_ids.includes(s)?r.project_ids.filter(b=>b!==s):[...r.project_ids,s]}))};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:a("users.title")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:a("users.subtitle")})]}),e.jsxs("button",{onClick:()=>j(),className:"btn-primary flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"}),a("users.addUser")]})]}),e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:a("users.searchPlaceholder"),value:h,onChange:s=>q(s.target.value),className:"input pl-10"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-gray-400"}),e.jsxs(S,{value:u,onChange:s=>O(s.target.value),className:"w-40",children:[e.jsx("option",{value:"",children:a("users.allRoles")}),e.jsx("option",{value:"admin",children:a("users.roles.admin")}),e.jsx("option",{value:"responsable",children:a("users.roles.responsable")}),e.jsx("option",{value:"supervisor",children:a("users.roles.supervisor")}),e.jsx("option",{value:"user",children:a("users.roles.user")}),e.jsx("option",{value:"animateur",children:a("users.roles.animateur")}),e.jsx("option",{value:"hr",children:a("users.roles.hr")})]})]})]})}),e.jsxs("div",{className:"card",children:[$?e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"hidden md:block space-y-2 animate-pulse",children:Array.from({length:6},(s,r)=>e.jsx("div",{className:"h-12 rounded-md bg-gray-100 dark:bg-gray-800"},r))}),e.jsx("div",{className:"md:hidden space-y-3 animate-pulse",children:Array.from({length:4},(s,r)=>e.jsx("div",{className:"h-20 rounded-lg bg-gray-100 dark:bg-gray-800"},r))})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3 md:hidden",children:y.map(s=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-3 bg-white dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-hse-primary rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:s.email})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 text-xs",children:[e.jsx("span",{className:`badge ${s.role==="admin"?"badge-info":"badge-success"}`,children:s.role}),e.jsx("span",{className:`badge ${s.is_active?"badge-success":"badge-danger"}`,children:s.is_active?a("users.status.active"):a("users.status.inactive")})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-[11px] text-gray-600 dark:text-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-3 h-3 text-gray-400 dark:text-gray-500"}),e.jsx("span",{children:s.projects?.length||0})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>j(s),className:"p-1.5 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700",title:a("common.edit"),children:e.jsx(E,{className:"w-4 h-4 text-gray-600 dark:text-gray-200"})}),e.jsx("button",{onClick:()=>C(s),className:"p-1.5 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700",title:s.is_active?a("users.deactivate"):a("users.activate"),children:s.is_active?e.jsx(F,{className:"w-4 h-4 text-amber-600"}):e.jsx(P,{className:"w-4 h-4 text-green-600"})}),e.jsx("button",{onClick:()=>_(s),className:"p-1.5 rounded-md hover:bg-red-50 dark:hover:bg-red-900/30",title:a("common.delete"),children:e.jsx(A,{className:"w-4 h-4 text-red-600"})})]})]})]},s.id))}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:a("users.table.user")}),e.jsx("th",{children:a("users.table.role")}),e.jsx("th",{children:a("users.table.projects")}),e.jsx("th",{children:a("users.table.status")}),e.jsx("th",{children:a("users.table.actions")})]})}),e.jsx("tbody",{children:y.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-hse-primary rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-semibold",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:s.email})]})]})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.role==="admin"?"badge-info":"badge-success"}`,children:s.role})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-4 h-4 text-gray-400 dark:text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:s.projects?.length||0})]})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.is_active?"badge-success":"badge-danger"}`,children:s.is_active?a("users.status.active"):a("users.status.inactive")})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>j(s),className:"p-2 hover:bg-gray-100 rounded-lg",title:a("common.edit"),children:e.jsx(E,{className:"w-4 h-4 text-gray-600"})}),e.jsx("button",{onClick:()=>C(s),className:"p-2 hover:bg-gray-100 rounded-lg",title:s.is_active?a("users.deactivate"):a("users.activate"),children:s.is_active?e.jsx(F,{className:"w-4 h-4 text-amber-600"}):e.jsx(P,{className:"w-4 h-4 text-green-600"})}),e.jsx("button",{onClick:()=>_(s),className:"p-2 hover:bg-gray-100 rounded-lg",title:a("common.delete"),children:e.jsx(A,{className:"w-4 h-4 text-red-600"})})]})})]},s.id))})]})})]}),c.last_page>1&&e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-100",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[a("common.page")," ",c.current_page," ",a("common.of")," ",c.last_page]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o(c.current_page-1),disabled:c.current_page===1,className:"btn-secondary text-sm",children:a("common.previous")}),e.jsx("button",{onClick:()=>o(c.current_page+1),disabled:c.current_page===c.last_page,className:"btn-secondary text-sm",children:a("common.next")})]})]})]}),e.jsx(J,{isOpen:z,onClose:v,title:a(d?"users.editUser":"users.createUser"),size:"md",children:e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("users.form.fullName")}),e.jsx("input",{type:"text",value:t.name,onChange:s=>n({...t,name:s.target.value}),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("users.form.email")}),e.jsx("input",{type:"email",value:t.email,onChange:s=>n({...t,email:s.target.value}),className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:[a("users.form.password")," ",d&&`(${a("users.form.passwordHint")})`]}),e.jsx("input",{type:"password",value:t.password,onChange:s=>n({...t,password:s.target.value}),className:"input",...!d&&{required:!0},minLength:8})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("users.form.role")}),e.jsxs(S,{value:t.role,onChange:s=>n({...t,role:s.target.value}),children:[e.jsx("option",{value:"responsable",children:a("users.roles.responsable")}),e.jsx("option",{value:"supervisor",children:a("users.roles.supervisor")}),e.jsx("option",{value:"user",children:a("users.roles.user")}),e.jsx("option",{value:"animateur",children:a("users.roles.animateur")}),e.jsx("option",{value:"hr",children:a("users.roles.hr")}),e.jsx("option",{value:"admin",children:a("users.roles.admin")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("users.form.phone")}),e.jsx("input",{type:"tel",value:t.phone,onChange:s=>n({...t,phone:s.target.value}),className:"input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:a("users.form.assignProjects")}),e.jsx("div",{className:"max-h-40 overflow-y-auto border border-gray-200 dark:border-gray-600 rounded-lg p-2 space-y-1 bg-white dark:bg-gray-700",children:L.map(s=>e.jsxs("label",{className:"flex items-center gap-2 p-2 hover:bg-gray-50 dark:hover:bg-gray-600 rounded cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.project_ids.includes(s.id),onChange:()=>K(s.id),className:"w-4 h-4 text-hse-primary border-gray-300 dark:border-gray-500 rounded focus:ring-hse-primary"}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-gray-100",children:s.name}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",s.code,")"]})]},s.id))})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:v,className:"btn-secondary w-full sm:w-auto",children:a("common.cancel")}),e.jsx("button",{type:"submit",disabled:w,className:"btn-primary w-full sm:w-auto",children:w?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 animate-spin"}),a("common.saving")]}):a(d?"users.updateUser":"users.createUserBtn")})]})]})}),e.jsx(Q,{isOpen:!!m,title:a("common.confirm"),message:m?a("users.deleteConfirm",{name:m.name}):"",confirmLabel:a("common.delete"),cancelLabel:a("common.cancel"),variant:"danger",onConfirm:H,onCancel:()=>g(null)})]})}export{ne as default};
