import{a as la,u as oa,w as Se,v as E,j as e,p as da}from"./index.js";import{b as ca,r as s}from"./vendor-react.js";import{D as Ce}from"./DatePicker.js";import{S as ae}from"./Select.js";import{M as te}from"./Modal.js";import{s as xa,g as Ee}from"./projectList.js";import{z as f,A as N,U as ma,P as Le,ad as ga,e as Ae,s as L,o as re,al as se,i as pa}from"./vendor-ui.js";import"./vendor-utils.js";const ie=[{value:"induction_hse",labelKey:"qualifiedPersonnel.types.inductionHse"},{value:"aptitude_physique",labelKey:"qualifiedPersonnel.types.aptitudePhysique"},{value:"travail_en_hauteur",labelKey:"qualifiedPersonnel.types.travailHauteur"},{value:"elinguage",labelKey:"qualifiedPersonnel.types.elinguage"},{value:"outillage_electrique",labelKey:"qualifiedPersonnel.types.outillageElectrique"},{value:"inspecteur_echafaudage",labelKey:"qualifiedPersonnel.types.inspecteurEchafaudage"},{value:"monteur_echafaudage",labelKey:"qualifiedPersonnel.types.monteurEchafaudage"},{value:"incendie",labelKey:"qualifiedPersonnel.types.incendie"},{value:"secourisme",labelKey:"qualifiedPersonnel.types.secourisme"},{value:"reconnaissance_hse",labelKey:"qualifiedPersonnel.types.reconnaissanceHse"},{value:"other",labelKey:"qualifiedPersonnel.types.other"}],ua=ie.reduce((t,A)=>(t[A.value]=A.labelKey,t),{}),w={valid:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300",expiring:"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-300",expired:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300",no_expiry:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300"};function wa(){const{t}=la(),{user:A}=oa(),ne=ca(),[le,We]=s.useState([]),[m,U]=s.useState(""),[p,B]=s.useState(""),[n,W]=s.useState(""),[g,P]=s.useState(""),[oe,de]=s.useState([]),ce=A?.project_list_preference??"code",z=s.useMemo(()=>xa(le,ce),[le,ce]),[xe,Fe]=s.useState([]),[T,y]=s.useState(1),[F,De]=s.useState(1),[Oe,Me]=s.useState(0),[$e,me]=s.useState(!1),[o,u]=s.useState(null),[I,ge]=s.useState([]),[Ke,pe]=s.useState(!1),[H,Re]=s.useState([]),[Ue,ue]=s.useState(!1),[q,v]=s.useState(1),[Y,Be]=s.useState(1),[V,ze]=s.useState(0),[h,ye]=s.useState(""),[D,he]=s.useState(""),[b,fe]=s.useState(""),[k,be]=s.useState(""),[O,je]=s.useState(null),[Ne,ve]=s.useState(!1),[Ie,j]=s.useState(!1),[He,M]=s.useState(!1),[$,G]=s.useState(null),[l,Ye]=s.useState(!1),[K,Ve]=s.useState([]),[Ge,ke]=s.useState(!1),[_,S]=s.useState(1),[Q,Qe]=s.useState(1),[X,Xe]=s.useState(0),J=b&&k&&typeof b=="string"&&typeof k=="string"?k<b:!1;s.useEffect(()=>{(async()=>{try{const r=await da.getAllList({status:"active"});We(r)}catch(r){console.error("Failed to load projects for qualified personnel page",r)}})()},[]),s.useEffect(()=>{const a=new URLSearchParams(ne.search),r=a.get("project_id"),d=a.get("worker_id");r&&(U(r),y(1)),d&&Se.getById(d).then(i=>{const c=i.data,x=c.data??c;u(x);const _e=x?.full_name&&String(x.full_name).trim()||`${x?.prenom??""} ${x?.nom??""}`.trim()||x?.cin&&String(x.cin).trim()||"";_e&&(B(_e),y(1))}).catch(i=>{console.error("Failed to load worker for qualified personnel deep-link",i)})},[ne.search]),s.useEffect(()=>{Je()},[m,p,n,g,T]),s.useEffect(()=>{l||we()},[m,p,n,g,q,l]),s.useEffect(()=>{(async()=>{try{const r={};m&&(r.project_id=m);const i=(await E.getOtherLabels(r)).data,c=i.data??i;de(Array.isArray(c)?c:[])}catch(r){console.error("Failed to load other training labels",r),de([])}})()},[m]),s.useEffect(()=>{o?Pe(o.id):ge([])},[o]),s.useEffect(()=>{l&&Te()},[l,_,m,p,n,g]);const Je=async()=>{try{me(!0);const a={page:T,per_page:25,is_active:!0};m&&(a.project_id=m),p&&(a.search=p),n&&(a.training_type=n),n==="other"&&g&&(a.training_label=g);const d=(await Se.getAll(a)).data,i=d.data??d,c=Array.isArray(i)?i:Array.isArray(i?.data)?i.data:[],x=d.meta??i.meta??i;Fe(c),De(x.last_page??1),Me(x.total??c.length)}catch(a){console.error("Failed to load workers for qualified personnel",a),f.error(t("errors.somethingWentWrong")??"Failed to load workers")}finally{me(!1)}},we=async()=>{try{ue(!0);const a={page:q,per_page:25};m&&(a.project_id=m),p&&(a.search=p),n&&(a.training_type=n),n==="other"&&g&&(a.training_label=g);const d=(await E.getAll(a)).data,i=d.data??d,c=Array.isArray(i)?i:i.data??[],x=d.meta??i.meta??i;Re(c),Be(x.last_page??1),ze(x.total??c.length)}catch(a){console.error("Failed to load overview worker trainings",a),f.error(t("errors.somethingWentWrong")??"Failed to load trainings")}finally{ue(!1)}},Pe=async a=>{try{pe(!0);const r={worker_id:a,per_page:100},i=(await E.getAll(r)).data,c=i.data??i,x=Array.isArray(c)?c:c.data??[];ge(x)}catch(r){console.error("Failed to load worker trainings",r),f.error(t("errors.somethingWentWrong")??"Failed to load trainings")}finally{pe(!1)}},Te=async()=>{try{ke(!0);const a={status:"expiring_or_expired",for_my_projects:!0,page:_,per_page:25};m&&(a.project_id=m),p&&(a.search=p),n&&(a.training_type=n),n==="other"&&g&&(a.training_label=g);const d=(await E.getAll(a)).data,i=d.data??d,c=Array.isArray(i)?i:i.data??[],x=d.meta??i.meta??i;Ve(c),Qe(x.last_page??1),Xe(x.total??c.length)}catch(a){console.error("Failed to load expiring trainings",a),f.error(t("errors.somethingWentWrong")??"Failed to load trainings")}finally{ke(!1)}},Ze=a=>{u(a)},ea=a=>{const r=a.target.files?.[0];if(r&&r.type!=="application/pdf"){f.error("PDF only");return}je(r??null)},aa=async a=>{if(a.preventDefault(),!!o&&!(!h||!b)&&!(h==="other"&&!D.trim())){if(J){f.error(t("qualifiedPersonnel.invalidExpiry")??"Expiry date can't be before training date");return}ve(!0);try{const r={worker_id:o.id,training_type:h,training_label:h==="other"?D.trim():void 0,training_date:b,expiry_date:k||void 0,certificate:O||void 0};await E.create(r),f.success(t("qualifiedPersonnel.trainingCreated")??"Worker training saved"),ye(""),he(""),fe(""),be(""),je(null),Pe(o.id),we(),l&&Te(),j(!1)}catch(r){console.error("Failed to save worker training",r);const d=r.response?.data?.message??t("errors.somethingWentWrong")??"Failed to save training";f.error(d)}finally{ve(!1)}}},C=a=>a?new Date(a).toLocaleDateString("fr-FR"):"",Z=a=>{const r=ua[a.training_type];return r?t(r):a.training_label?a.training_label:a.training_type},ee=a=>t(a==="expiring"?"qualifiedPersonnel.statusExpiring":a==="expired"?"qualifiedPersonnel.statusExpired":a==="no_expiry"?"qualifiedPersonnel.statusNoExpiry":"qualifiedPersonnel.statusValid"),qe=s.useMemo(()=>Array.isArray(I)?[...I].sort((a,r)=>a.expiry_date&&r.expiry_date?a.expiry_date.localeCompare(r.expiry_date):a.expiry_date?-1:r.expiry_date?1:(r.training_date??"").localeCompare(a.training_date??"")):[],[I]),ta=()=>n?n==="other"&&g?`other::${g}`:n:"",R=s.useMemo(()=>{const a=Array.isArray(H)?H:[];return n?n==="other"&&g?a.filter(r=>r.training_type==="other"&&(r.training_label??"")===g):a.filter(r=>r.training_type===n):a},[H,n,g]),ra=!!(m||p||n||g),sa=()=>{U(""),B(""),W(""),P(""),y(1),v(1),S(1),u(null)},ia=s.useMemo(()=>{if(!m)return"";const a=z.find(r=>String(r.id)===String(m));return a?Ee(a):""},[m,z]),na=s.useMemo(()=>l?`${K.length} / ${X}`:`${R.length} / ${V}`,[l,K.length,X,R.length,V]);return e.jsxs("div",{className:"space-y-4 animate-fade-in",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:[t("nav.dashboard")," / ",t("qualifiedPersonnel.navLabel")]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 truncate",children:t("qualifiedPersonnel.pageTitle")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t("qualifiedPersonnel.pageSubtitle")})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsxs("button",{type:"button",onClick:()=>{Ye(a=>!a),S(1)},className:`btn-sm flex items-center gap-2 ${l?"btn-primary":"btn-outline"}`,children:[e.jsx(N,{className:`w-4 h-4 ${l?"text-white":"text-amber-500"}`}),t(l?"qualifiedPersonnel.viewAllButton":"qualifiedPersonnel.viewExpiringButton")]}),e.jsxs("button",{type:"button",onClick:()=>M(!0),className:"btn-outline btn-sm flex items-center gap-2",children:[e.jsx(ma,{className:"w-4 h-4"}),t("qualifiedPersonnel.workerCardTitle")]}),e.jsxs("button",{type:"button",onClick:()=>j(!0),className:"btn-primary btn-sm flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4"}),t("qualifiedPersonnel.addTrainingTitle")]})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:t("common.project")}),e.jsxs(ae,{value:m,onChange:a=>{U(a.target.value),y(1),v(1),S(1),u(null),P("")},children:[e.jsx("option",{value:"",children:t("workers.allProjects")}),z.map(a=>e.jsx("option",{value:a.id,children:Ee(a)},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:t("qualifiedPersonnel.trainingType")}),e.jsxs(ae,{value:ta(),onChange:a=>{const r=a.target.value;r?r.startsWith("other::")?(W("other"),P(r.slice(7))):(W(r),P("")):(W(""),P("")),y(1),v(1)},className:"py-1.5 text-sm",children:[e.jsx("option",{value:"",children:t("qualifiedPersonnel.filters.trainingPlaceholder")}),ie.filter(a=>a.value!=="other").map(a=>e.jsx("option",{value:a.value,children:t(a.labelKey)},a.value)),oe.length>0&&e.jsx("optgroup",{label:t("qualifiedPersonnel.types.other"),children:oe.map(a=>e.jsx("option",{value:`other::${a}`,children:a},a))})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label text-xs",children:t("common.search")}),e.jsxs("div",{className:"relative",children:[e.jsx(ga,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:p,onChange:a=>{B(a.target.value),y(1),v(1),u(null)},placeholder:t("qualifiedPersonnel.filters.searchPlaceholder"),className:"input pl-9 py-1.5 text-sm"})]})]})]}),e.jsxs("div",{className:"mt-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-700 px-3 py-2",children:[e.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:t("workers.title")}),e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:Oe})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-700 px-3 py-2",children:[e.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:t("common.project")}),e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate",children:ia||t("common.all")})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-700 px-3 py-2",children:[e.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:t(l?"qualifiedPersonnel.expiringListTitle":"qualifiedPersonnel.trainingListTitle")}),e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:na})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-700 px-3 py-2",children:[e.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:t("common.selected")}),e.jsx("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate",children:o?`${o.prenom} ${o.nom}`:"-"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{type:"button",onClick:sa,disabled:!ra,className:"btn-outline btn-sm disabled:opacity-50 disabled:cursor-not-allowed",children:t("common.reset")})})]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4 text-hse-primary"}),e.jsx("h2",{className:"font-semibold text-gray-900 dark:text-gray-100 text-sm",children:t(l?"qualifiedPersonnel.expiringListTitle":"qualifiedPersonnel.trainingListTitle")})]}),e.jsxs("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:[t("common.page")," ",l?_:q," ",t("common.of")," ",l?Q:Y]})]}),l?Ge?e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx(L,{className:"w-6 h-6 animate-spin text-hse-primary"})}):K.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("qualifiedPersonnel.noExpiring")??t("qualifiedPersonnel.noTrainings")}):e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsxs("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:[t("workers.nom"),"/",t("workers.prenom")]}),e.jsx("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:t("workers.cin")}),e.jsx("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:t("workers.projet")}),e.jsx("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:t("qualifiedPersonnel.colType")}),e.jsx("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:t("qualifiedPersonnel.colEndDate")}),e.jsx("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:t("common.status")})]})}),e.jsx("tbody",{children:K.map(a=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/60",children:[e.jsx("td",{className:"py-2.5 px-3 text-gray-900 dark:text-gray-100",children:e.jsxs("button",{type:"button",onClick:()=>{a.worker&&u(a.worker)},className:"hover:underline",children:[a.worker?.prenom," ",a.worker?.nom]})}),e.jsx("td",{className:"py-2.5 px-3 text-gray-700 dark:text-gray-200 font-mono",children:a.worker?.cin?.toUpperCase()}),e.jsx("td",{className:"py-2.5 px-3 text-gray-700 dark:text-gray-200",children:a.worker?.project?.name??""}),e.jsx("td",{className:"py-2.5 px-3 text-gray-700 dark:text-gray-200",children:Z(a)}),e.jsx("td",{className:"py-2.5 px-3 text-gray-700 dark:text-gray-200",children:C(a.expiry_date)}),e.jsx("td",{className:"py-2.5 px-3",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[11px] ${w[a.status]??w.valid}`,children:[a.status==="expired"&&e.jsx(N,{className:"w-3 h-3"}),a.status==="expiring"&&e.jsx(N,{className:"w-3 h-3"}),a.status==="valid"&&e.jsx(re,{className:"w-3 h-3"}),ee(a.status)]})})]},a.id))})]})}):Ue?e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx(L,{className:"w-6 h-6 animate-spin text-hse-primary"})}):R.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("qualifiedPersonnel.noTrainings")}):e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsxs("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:[t("workers.nom"),"/",t("workers.prenom")]}),e.jsx("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:t("workers.cin")}),e.jsx("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:t("workers.projet")}),e.jsx("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:t("qualifiedPersonnel.colType")}),e.jsx("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:t("qualifiedPersonnel.colStartDate")}),e.jsx("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:t("qualifiedPersonnel.colEndDate")}),e.jsx("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:t("common.status")}),e.jsx("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:t("qualifiedPersonnel.colCertificate")}),e.jsx("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:t("common.actions")})]})}),e.jsx("tbody",{children:R.map(a=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/60",children:[e.jsx("td",{className:"py-2.5 px-3 text-gray-900 dark:text-gray-100",children:e.jsxs("button",{type:"button",onClick:()=>{a.worker&&u(a.worker)},className:"hover:underline",children:[a.worker?.prenom," ",a.worker?.nom]})}),e.jsx("td",{className:"py-2.5 px-3 text-gray-700 dark:text-gray-200 font-mono",children:a.worker?.cin?.toUpperCase()}),e.jsx("td",{className:"py-2.5 px-3 text-gray-700 dark:text-gray-200",children:a.worker?.project?.name??""}),e.jsx("td",{className:"py-2.5 px-3 text-gray-700 dark:text-gray-200",children:Z(a)}),e.jsx("td",{className:"py-2.5 px-3 text-gray-700 dark:text-gray-200",children:C(a.training_date)}),e.jsx("td",{className:"py-2.5 px-3 text-gray-700 dark:text-gray-200",children:C(a.expiry_date)}),e.jsx("td",{className:"py-2.5 px-3",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[11px] ${w[a.status]??w.valid}`,children:[a.status==="expired"&&e.jsx(N,{className:"w-3 h-3"}),a.status==="expiring"&&e.jsx(N,{className:"w-3 h-3"}),a.status==="valid"&&e.jsx(re,{className:"w-3 h-3"}),ee(a.status)]})}),e.jsx("td",{className:"py-2.5 px-3 text-gray-700 dark:text-gray-200",children:a.certificate_url?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>G(a),className:"text-[11px] text-hse-primary hover:underline",children:t("qualifiedPersonnel.viewCertificate")}),e.jsxs("a",{href:a.certificate_url,download:!0,className:"text-[11px] text-gray-500 hover:underline flex items-center gap-1",children:[e.jsx(se,{className:"w-3 h-3"}),t("qualifiedPersonnel.downloadCertificate")]})]}):e.jsx("span",{className:"text-[11px] text-gray-400",children:"-"})}),e.jsx("td",{className:"py-2.5 px-3",children:e.jsx("button",{type:"button",onClick:()=>{a.worker&&(u(a.worker),j(!0))},className:"btn-outline btn-xs",children:t("qualifiedPersonnel.addTrainingTitle")})})]},a.id))})]})}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:l?t("qualifiedPersonnel.filters.resultsCount",{count:X}):t("qualifiedPersonnel.filters.resultsCount",{count:V})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>l?S(a=>Math.max(1,a-1)):v(a=>Math.max(1,a-1)),disabled:l?_===1:q===1,className:"btn-outline btn-sm disabled:opacity-50 disabled:cursor-not-allowed",children:t("common.previous")}),e.jsx("button",{type:"button",onClick:()=>l?S(a=>Math.min(Q,a+1)):v(a=>Math.min(Y,a+1)),disabled:l?_===Q:q===Y,className:"btn-outline btn-sm disabled:opacity-50 disabled:cursor-not-allowed",children:t("common.next")})]})]})]}),o&&e.jsxs("div",{className:"card p-4 space-y-3",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:t("common.selected")}),e.jsxs("div",{className:"text-base font-semibold text-gray-900 dark:text-gray-100 truncate",children:[o.prenom," ",o.nom]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 font-mono truncate",children:o.cin?.toUpperCase()})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>j(!0),className:"btn-primary btn-sm flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4"}),t("qualifiedPersonnel.addTrainingTitle")]}),e.jsxs("button",{type:"button",onClick:()=>u(null),className:"btn-outline btn-sm flex items-center gap-2",children:[e.jsx(pa,{className:"w-4 h-4"}),t("common.unselect")]})]})]}),Ke?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(L,{className:"w-5 h-5 animate-spin text-hse-primary"})}):qe.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("qualifiedPersonnel.noTrainings")}):e.jsx("div",{className:"overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-700",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:t("qualifiedPersonnel.colType")}),e.jsx("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:t("qualifiedPersonnel.colStartDate")}),e.jsx("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:t("qualifiedPersonnel.colEndDate")}),e.jsx("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:t("common.status")}),e.jsx("th",{className:"py-2.5 px-3 font-medium text-gray-600 dark:text-gray-300",children:t("qualifiedPersonnel.colCertificate")})]})}),e.jsx("tbody",{children:qe.map(a=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/60",children:[e.jsx("td",{className:"py-2.5 px-3 text-gray-900 dark:text-gray-100",children:Z(a)}),e.jsx("td",{className:"py-2.5 px-3 text-gray-700 dark:text-gray-200",children:C(a.training_date)}),e.jsx("td",{className:"py-2.5 px-3 text-gray-700 dark:text-gray-200",children:C(a.expiry_date)}),e.jsx("td",{className:"py-2.5 px-3",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-[11px] ${w[a.status]??w.valid}`,children:[a.status==="expired"&&e.jsx(N,{className:"w-3 h-3"}),a.status==="expiring"&&e.jsx(N,{className:"w-3 h-3"}),a.status==="valid"&&e.jsx(re,{className:"w-3 h-3"}),ee(a.status)]})}),e.jsx("td",{className:"py-2.5 px-3 text-gray-700 dark:text-gray-200",children:a.certificate_url?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>G(a),className:"text-[11px] text-hse-primary hover:underline",children:t("qualifiedPersonnel.viewCertificate")}),e.jsxs("a",{href:a.certificate_url,download:!0,className:"text-[11px] text-gray-500 hover:underline flex items-center gap-1",children:[e.jsx(se,{className:"w-3 h-3"}),t("qualifiedPersonnel.downloadCertificate")]})]}):e.jsx("span",{className:"text-[11px] text-gray-400",children:"-"})})]},a.id))})]})})]}),e.jsx(te,{isOpen:He,onClose:()=>M(!1),title:t("qualifiedPersonnel.workerCardTitle"),size:"xl",children:e.jsxs("div",{className:"space-y-3",children:[$e?e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx(L,{className:"w-6 h-6 animate-spin text-hse-primary"})}):xe.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t("workers.noWorkers")}):e.jsx("div",{className:"space-y-2",children:xe.map(a=>e.jsx("button",{type:"button",onClick:()=>{Ze(a),M(!1)},className:"w-full text-left border rounded-xl px-3 py-2 text-xs transition-colors border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("p",{className:"font-semibold text-gray-900 dark:text-gray-100 text-sm truncate",children:[a.prenom," ",a.nom]}),e.jsx("p",{className:"text-[11px] text-gray-500 dark:text-gray-400 font-mono truncate",children:a.cin?.toUpperCase()})]}),e.jsxs("div",{className:"text-right text-[11px] text-gray-500 dark:text-gray-400",children:[e.jsx("p",{className:"truncate max-w-[180px]",children:a.fonction??""}),e.jsx("p",{className:"truncate max-w-[180px]",children:a.project?.name??""})]})]})},a.id))}),F>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:[t("common.page")," ",T," ",t("common.of")," ",F]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>y(a=>Math.max(1,a-1)),disabled:T===1,className:"btn-outline btn-sm disabled:opacity-50 disabled:cursor-not-allowed",children:t("common.previous")}),e.jsx("button",{type:"button",onClick:()=>y(a=>Math.min(F,a+1)),disabled:T===F,className:"btn-outline btn-sm disabled:opacity-50 disabled:cursor-not-allowed",children:t("common.next")})]})]})]})}),e.jsx(te,{isOpen:Ie,onClose:()=>j(!1),title:t("qualifiedPersonnel.addTrainingTitle"),size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[o?e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-700 px-3 py-2",children:[e.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:t("common.selected")}),e.jsxs("div",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100",children:[o.prenom," ",o.nom]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 font-mono",children:o.cin?.toUpperCase()})]}):e.jsx("div",{className:"rounded-xl border border-amber-200 bg-amber-50 text-amber-800 dark:border-amber-900/40 dark:bg-amber-900/20 dark:text-amber-200 px-3 py-2 text-sm",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{children:t("qualifiedPersonnel.noWorkerSelected")??"Select a worker first"}),e.jsx("button",{type:"button",onClick:()=>{j(!1),M(!0)},className:"btn-outline btn-sm",children:t("common.select")})]})}),e.jsxs("form",{onSubmit:aa,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:t("qualifiedPersonnel.trainingType")}),e.jsxs(ae,{value:h,onChange:a=>ye(a.target.value),children:[e.jsx("option",{value:"",children:t("common.select")}),ie.map(a=>e.jsx("option",{value:a.value,children:t(a.labelKey)},a.value))]})]}),h==="other"&&e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:t("qualifiedPersonnel.trainingLabel")}),e.jsx("input",{type:"text",value:D,onChange:a=>he(a.target.value),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:t("qualifiedPersonnel.trainingDate")}),e.jsx(Ce,{value:b,onChange:fe,placeholder:t("qualifiedPersonnel.trainingDate")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:t("qualifiedPersonnel.expiryDate")}),e.jsx(Ce,{value:k,onChange:be,placeholder:t("qualifiedPersonnel.expiryDate")}),J&&e.jsx("div",{className:"mt-1 text-[11px] text-red-600 dark:text-red-400",children:t("qualifiedPersonnel.invalidExpiry")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:t("qualifiedPersonnel.certificate")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:O?O.name:t("qualifiedPersonnel.chooseFile")})]}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:ea,className:"hidden"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>j(!1),className:"btn-outline btn-sm",children:t("common.cancel")}),e.jsxs("button",{type:"submit",disabled:Ne||!o||!h||!b||h==="other"&&!D.trim()||J,className:"btn-primary btn-sm flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:[Ne&&e.jsx(L,{className:"w-4 h-4 animate-spin"}),t("qualifiedPersonnel.saveTraining")]})]})]})]})}),$&&e.jsx(te,{isOpen:!!$,onClose:()=>G(null),title:t("qualifiedPersonnel.viewCertificate"),size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[70vh]",children:e.jsx("iframe",{src:$.certificate_url,title:t("qualifiedPersonnel.viewCertificate"),className:"w-full h-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white"})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("a",{href:$.certificate_url,download:!0,className:"btn-primary inline-flex items-center gap-2 text-sm",children:[e.jsx(se,{className:"w-4 h-4"}),t("qualifiedPersonnel.downloadCertificate")]})})]})})]})}export{wa as default};
