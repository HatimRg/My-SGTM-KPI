import{a as at,u as tt,H as h,p as st,j as e,n as ka}from"./index.js";import{r as n}from"./vendor-react.js";import{z as l,ae as rt,v,R as Ca,P as _e,C as nt,T as it,ac as Sa,ax as Da,aJ as ct,aj as Me,h as ke,U as lt,c as dt,I as Oa,am as Ce}from"./vendor-ui.js";import{S as z}from"./Select.js";import{M as N}from"./Modal.js";import{D as re}from"./DatePicker.js";import{s as ot,g as $a}from"./projectList.js";import"./vendor-utils.js";const mt=50,k=new Map;function ft(){const{t:s}=at(),{user:Ta,token:W}=tt(),ne=({machineId:a,updatedAt:t,alt:r,className:c})=>{const[u,y]=n.useState(null);return n.useEffect(()=>{if(!a||!W){y(null);return}let w=!1;const P=t?encodeURIComponent(String(t)):"",et=`/api/heavy-machinery/machines/${a}/image${P?`?v=${P}`:""}`,ae=`${W}::${a}::${P}`,te=k.get(ae);if(te?.objectUrl)return y(te.objectUrl),()=>{w=!0};if(te?.pending)return te.pending.then(M=>{w||y(M)}).catch(()=>{w||y(null)}),()=>{w=!0};const _a=(async()=>{const M=await fetch(et,{headers:{Authorization:`Bearer ${W}`}});if(!M.ok)throw new Error(`image fetch failed: ${M.status}`);const se=await M.blob();return URL.createObjectURL(se)})();return k.set(ae,{pending:_a}),(async()=>{try{const M=await _a;for(k.set(ae,{objectUrl:M});k.size>mt;){const se=k.keys().next().value,Ma=k.get(se);k.delete(se),Ma?.objectUrl&&URL.revokeObjectURL(Ma.objectUrl)}w||y(M)}catch{k.delete(ae),w||y(null)}})(),()=>{w=!0}},[a,W,t]),u?e.jsx("img",{src:u,alt:r,className:c,loading:"lazy"}):null},[ie,Se]=n.useState([]),[ce,De]=n.useState(!1),[le,Fa]=n.useState(""),[Oe,$e]=n.useState([]),Te=Ta?.project_list_preference??"code",Fe=n.useMemo(()=>ot(Oe,Te),[Oe,Te]),[Le,T]=n.useState(!1),[Ae,Ie]=n.useState(!1),[Ue,q]=n.useState(!1),[de,Ee]=n.useState(""),[B,K]=n.useState(null),[Re,Pe]=n.useState(!1),[La,H]=n.useState(!1),oe=n.useRef(null),[i,p]=n.useState({serial_number:"",internal_code:"",machine_type:"",brand:"",model:"",project_id:"",is_active:!0,image:null}),[Y,ze]=n.useState(!1),[d,We]=n.useState(null),[me,qe]=n.useState(!1),[D,F]=n.useState("documents"),[m,he]=n.useState(null),[Be,G]=n.useState(!1),[Ke,He]=n.useState(!1),[o,g]=n.useState({serial_number:"",internal_code:"",machine_type:"",brand:"",model:"",project_id:"",is_active:!0,image:null}),[Ye,Ge]=n.useState(!1),[Qe,Q]=n.useState(!1),[Ve,Je]=n.useState(!1),[L,ue]=n.useState(null),[x,O]=n.useState({document_key:"",document_label:"",start_date:"",expiry_date:"",file:null}),[Xe,V]=n.useState(!1),[Ze,ea]=n.useState(!1),[b,J]=n.useState({start_date:"",end_date:"",file:null}),[C,X]=n.useState(""),[aa,$]=n.useState([]),[Aa,ta]=n.useState(!1),[A,I]=n.useState(""),[sa,ye]=n.useState(""),[ra,na]=n.useState(!1),[xe,pe]=n.useState(null),[f,ge]=n.useState(null),[Ia,be]=n.useState(!1),[U,ia]=n.useState(null),[ca,la]=n.useState(!1),ve=n.useRef(null),[Z,da]=n.useState([]),[S,oa]=n.useState([]),[fe,ee]=n.useState(""),[je,ma]=n.useState("");n.useEffect(()=>{const a=t=>{const r=t.target;!oe.current||!(r instanceof Node)||oe.current.contains(r)||H(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]);const ha=n.useCallback(async()=>{try{const t=(await h.getDocumentKeys()).data?.data??[];da(Array.isArray(t)?t:[])}catch{da([])}},[]),E=n.useCallback(async()=>{try{const t=(await h.getMachineTypes()).data?.data??[];oa(Array.isArray(t)?t:[])}catch{oa([])}},[]),ua=a=>{if(!a)return null;const t=/filename\*=UTF-8''([^;]+)|filename="?([^";]+)"?/i.exec(a),r=decodeURIComponent(t?.[1]??t?.[2]??"");return r!==""?r:null},ya=(a,t)=>{if(!a)return"";const r=new Date(`${a}T00:00:00`);if(Number.isNaN(r.getTime()))return"";r.setDate(r.getDate()+t);const c=r.getFullYear(),u=String(r.getMonth()+1).padStart(2,"0"),y=String(r.getDate()).padStart(2,"0");return`${c}-${u}-${y}`},we=(a,t)=>{if(!a)return"";const r=new Date(`${a}T00:00:00`);if(Number.isNaN(r.getTime()))return"";r.setFullYear(r.getFullYear()+t);const c=r.getFullYear(),u=String(r.getMonth()+1).padStart(2,"0"),y=String(r.getDate()).padStart(2,"0");return`${c}-${u}-${y}`},xa=a=>!a||typeof a!="string"?null:a.startsWith("/api/")?a.slice(4):a.startsWith("api/")?a.slice(3):a,pa=(a,t)=>{const r=URL.createObjectURL(a),c=document.createElement("a");c.href=r,c.download=t??"template.xlsx",document.body.appendChild(c),c.click(),c.remove(),setTimeout(()=>URL.revokeObjectURL(r),5e3)},Ua=async()=>{try{const a=await h.downloadMachinesTemplate(),t=ua(a.headers?.["content-disposition"])??"SGTM-Machines-Template.xlsx";pa(a.data,t)}catch{l.error(s("heavyMachinery.viewMachines.bulk.downloadTemplateFailed"))}},Ea=()=>{na(!0)},Ra=async()=>{if(!U){l.error(s("heavyMachinery.viewMachines.bulk.chooseFile"));return}try{la(!0);const a=new FormData;a.append("file",U);const r=(await h.importMachines(a)).data?.data??{},c=r.imported??0,u=r.updated??0,y=r.errors??[];l.success(s("heavyMachinery.viewMachines.bulk.importSummary",{imported:c,updated:u})),y.length>0&&l.error(s("heavyMachinery.viewMachines.bulk.importIssues",{count:y.length})),ia(null),ve.current&&(ve.current.value=""),_()}catch(a){l.error(a.response?.data?.message??s("heavyMachinery.viewMachines.bulk.importFailed"))}finally{la(!1)}},ga=n.useCallback(async()=>{try{const a=await st.getAllList({status:"active"});$e(Array.isArray(a)?a:[])}catch{$e([])}},[]),_=n.useCallback(async()=>{try{De(!0);const t=(await h.getMachines()).data?.data??[];Se(Array.isArray(t)?t:[])}catch(a){l.error(a.response?.data?.message??s("errors.failedToLoad")??"Failed to load"),Se([])}finally{De(!1)}},[s]);n.useEffect(()=>{ga(),_(),ha(),E()},[ga,_,ha,E]),n.useEffect(()=>()=>{f&&URL.revokeObjectURL(f)},[f]);const ba=n.useMemo(()=>{const a=Array.isArray(ie)?ie:[],t=le.trim().toLowerCase();return t?a.filter(r=>[r.serial_number,r.internal_code,r.machine_type,r.brand,r.model,r.project?.name].filter(Boolean).join(" ").toLowerCase().includes(t)):a},[ie,le]),Pa=()=>{p({serial_number:"",internal_code:"",machine_type:"",brand:"",model:"",project_id:"",is_active:!0,image:null}),ee(""),Ee(""),K(null),q(!0)},za=async()=>{const a=de.trim();if(a)try{Pe(!0);const r=(await h.globalSearch(a)).data?.data?.machine??null;if(r?.id){const c=r.machine_type??"",u=c&&S.includes(c);K(r.id),ee(S.length>0?u?c:"__custom__":""),p({serial_number:r.serial_number??a,internal_code:r.internal_code??"",machine_type:c,brand:r.brand??"",model:r.model??"",project_id:r.project_id?String(r.project_id):"",is_active:!!r.is_active,image:null})}else K(null),ee(""),p({serial_number:a,internal_code:"",machine_type:"",brand:"",model:"",project_id:"",is_active:!0,image:null});q(!1),T(!0)}catch(t){l.error(t.response?.data?.message??s("errors.somethingWentWrong"))}finally{Pe(!1)}},Wa=()=>{const a=m?.machine;if(!a)return;const t=a.machine_type??"",r=t&&S.includes(t);g({serial_number:a.serial_number??"",internal_code:a.internal_code??"",machine_type:t,brand:a.brand??"",model:a.model??"",project_id:a.project_id?String(a.project_id):"",is_active:!!a.is_active,image:null}),ma(r?t:"__custom__"),G(!0)},qa=async a=>{a.preventDefault();try{if(Ie(!0),B){const r={serial_number:i.serial_number,internal_code:i.internal_code?.trim()?i.internal_code.trim():null,machine_type:i.machine_type,brand:i.brand,model:i.model?.trim()?i.model.trim():null,project_id:i.project_id?Number(i.project_id):null,is_active:!!i.is_active};if(await h.updateMachine(B,r),i.image){const c=new FormData;c.append("image",i.image),await h.uploadMachineImage(B,c)}l.success(s("common.success")),T(!1),K(null),_(),E();return}const t=new FormData;t.append("serial_number",i.serial_number),i.internal_code?.trim()&&t.append("internal_code",i.internal_code.trim()),t.append("machine_type",i.machine_type),t.append("brand",i.brand),i.model?.trim()&&t.append("model",i.model.trim()),i.project_id&&t.append("project_id",i.project_id),t.append("is_active",i.is_active?"1":"0"),i.image&&t.append("image",i.image),await h.createMachine(t),l.success(s("heavyMachinery.viewMachines.form.created")),T(!1),_(),E()}catch(t){l.error(t.response?.data?.message??s("heavyMachinery.viewMachines.form.saveFailed"))}finally{Ie(!1)}},j=async a=>{if(a)try{qe(!0);const t=await h.getMachine(a);he(t.data?.data??null)}catch(t){l.error(t.response?.data?.message??s("errors.failedToLoad")??"Failed to load"),he(null)}finally{qe(!1)}},va=async a=>{We(a),ze(!0),F("documents"),X(""),$([]),I(""),ye(""),await j(a)},fa=()=>{ze(!1),We(null),he(null),F("documents")},ja=async a=>{if(a?.file_view_url)try{pe(a),be(!0),f&&(URL.revokeObjectURL(f),ge(null));const t=xa(a.file_view_url),r=await ka.get(t,{responseType:"blob"}),c=URL.createObjectURL(r.data);ge(c)}catch(t){l.error(t.response?.data?.message??s("errors.somethingWentWrong")??"Failed to preview"),pe(null)}finally{be(!1)}},Ba=()=>{pe(null),be(!1),f&&(URL.revokeObjectURL(f),ge(null))},Ne=async(a,t="document.pdf")=>{if(a?.file_download_url)try{const r=xa(a.file_download_url),c=await ka.get(r,{responseType:"blob"}),y=ua(c.headers?.["content-disposition"])??t;pa(c.data,y)}catch(r){l.error(r.response?.data?.message??s("errors.somethingWentWrong")??"Failed to download")}},wa=(a=null)=>{ue(a);const t=a?.document_key??"",r=a?.document_label??"",c=Z.find(P=>P.key===t)?.label,u=a?.start_date??"",y=a?.expiry_date??"",w=!y&&u?we(u,1):y;O({document_key:t,document_label:r||c||"",start_date:u,expiry_date:w,file:null}),Q(!0)},Ka=async a=>{if(a.preventDefault(),!!d&&x.document_key.trim()){if(!x.file&&!L){l.error(s("heavyMachinery.viewMachines.documents.choosePdf"));return}try{Je(!0);const t=new FormData;t.append("document_key",x.document_key.trim()),x.start_date&&t.append("start_date",x.start_date),x.expiry_date&&t.append("expiry_date",x.expiry_date),x.file&&t.append("file",x.file),L?.id?await h.updateDocument(d,L.id,t):await h.upsertDocument(d,t),l.success(s("heavyMachinery.viewMachines.documents.uploaded")),Q(!1),ue(null),await j(d)}catch(t){l.error(t.response?.data?.message??s("heavyMachinery.viewMachines.documents.uploadFailed"))}finally{Je(!1)}}},Ha=async a=>{if(!(!d||!a?.id||!window.confirm(s("common.delete"))))try{await h.deleteDocument(d,a.id),l.success(s("common.success")),await j(d)}catch(r){l.error(r.response?.data?.message??s("errors.somethingWentWrong")??"Failed")}},Ya=()=>{J({start_date:"",end_date:"",file:null}),V(!0)},Ga=async a=>{if(a.preventDefault(),!!d){if(!b.file){l.error(s("heavyMachinery.viewMachines.inspections.choosePdf"));return}try{ea(!0);const t=new FormData;b.start_date&&t.append("start_date",b.start_date),b.end_date&&t.append("end_date",b.end_date),t.append("file",b.file),await h.upsertInspection(d,t),l.success(s("heavyMachinery.viewMachines.inspections.uploaded")),V(!1),await j(d)}catch(t){l.error(t.response?.data?.message??s("heavyMachinery.viewMachines.inspections.uploadFailed"))}finally{ea(!1)}}},Qa=async a=>{if(!(!d||!a?.id||!window.confirm(s("heavyMachinery.viewMachines.inspections.deleteConfirm"))))try{await h.deleteInspection(d,a.id),l.success(s("heavyMachinery.viewMachines.inspections.deleted")),await j(d)}catch(r){l.error(r.response?.data?.message??s("heavyMachinery.viewMachines.inspections.deleteFailed"))}},R=m?.machine?.project_id,Na=n.useCallback(async()=>{if(R)try{ta(!0);const t=(await h.searchWorkers({project_id:R,q:C.trim()?C.trim():void 0,limit:20})).data?.data??[];$(Array.isArray(t)?t:[])}catch(a){$([]),l.error(a.response?.data?.message??s("errors.failedToLoad")??"Failed to load")}finally{ta(!1)}},[R,C]);n.useEffect(()=>{if(!Y||!R)return;if(!C.trim()){$([]),I("");return}const a=setTimeout(()=>{Na()},350);return()=>clearTimeout(a)},[Y,R,C,Na]);const Va=async()=>{if(!(!d||!A))try{await h.addOperator(d,A),l.success(s("heavyMachinery.viewMachines.operators.assigned")),X(""),$([]),I(""),await j(d)}catch(a){l.error(a.response?.data?.message??s("heavyMachinery.viewMachines.operators.assignFailed"))}},Ja=async a=>{if(d)try{await h.removeOperator(d,a),l.success(s("heavyMachinery.viewMachines.operators.removed")),await j(d)}catch(t){l.error(t.response?.data?.message??s("heavyMachinery.viewMachines.operators.removeFailed"))}},Xa=async a=>{if(a.preventDefault(),!!d)try{He(!0);const t={serial_number:o.serial_number,internal_code:o.internal_code?.trim()?o.internal_code.trim():null,machine_type:o.machine_type,brand:o.brand,model:o.model?.trim()?o.model.trim():null,project_id:o.project_id?Number(o.project_id):null,is_active:!!o.is_active};if(await h.updateMachine(d,t),o.image){const r=new FormData;r.append("image",o.image),await h.uploadMachineImage(d,r)}l.success(s("common.success")),G(!1),await j(d),_(),E()}catch(t){l.error(t.response?.data?.message??s("errors.somethingWentWrong")??"Failed")}finally{He(!1)}},Za=async()=>{if(!(!d||!window.confirm(s("heavyMachinery.viewMachines.delete.confirmProfessional")??`Please delete this machine only if it was added by mistake. If the machine still exists but is no longer in your project, set it to INACTIVE instead.

Do you want to delete it now?`)))try{await h.deleteMachine(d),l.success(s("heavyMachinery.viewMachines.delete.success")),fa(),_()}catch(t){l.error(t.response?.data?.message??s("heavyMachinery.viewMachines.delete.failed"))}};return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:s("heavyMachinery.title")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:s("heavyMachinery.viewMachines.title")})]}),e.jsx("div",{className:"card p-4 overflow-visible",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(rt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:le,onChange:a=>Fa(a.target.value),placeholder:s("heavyMachinery.viewMachines.searchPlaceholder"),className:"input pl-9"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:_,className:"btn-secondary flex items-center gap-2",disabled:ce,children:[ce?e.jsx(v,{className:"w-4 h-4 animate-spin"}):e.jsx(Ca,{className:"w-4 h-4"}),s("heavyMachinery.viewMachines.refresh")]}),e.jsxs("div",{className:"relative",ref:oe,children:[e.jsxs("button",{type:"button",onClick:()=>H(a=>!a),className:"btn-primary flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"}),s("heavyMachinery.viewMachines.addMachine"),e.jsx(nt,{className:"w-4 h-4"})]}),La&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 shadow-lg z-50 overflow-hidden",children:[e.jsx("button",{type:"button",className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>{H(!1),Pa()},children:s("common.create")}),e.jsx("button",{type:"button",className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>{H(!1),Ea()},children:s("heavyMachinery.viewMachines.bulk.title")})]})]})]})]})}),ce?e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx(v,{className:"w-6 h-6 animate-spin text-hse-primary"})}):ba.length===0?e.jsxs("div",{className:"card p-8 text-center",children:[e.jsx(it,{className:"w-10 h-10 text-gray-300 dark:text-gray-700 mx-auto mb-3"}),e.jsx("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:s("heavyMachinery.viewMachines.emptyTitle")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:s("heavyMachinery.viewMachines.emptyHelp")})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:ba.map(a=>e.jsxs("div",{role:"button",tabIndex:0,onClick:()=>va(a.id),onKeyDown:t=>{t.key==="Enter"&&va(a.id)},className:"card p-4 text-left hover:shadow-md transition-shadow cursor-pointer",children:[a.image_url&&e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"w-full h-40 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 overflow-hidden",children:e.jsx(ne,{machineId:a.id,updatedAt:a.updated_at,alt:a.serial_number,className:"w-full h-full object-cover"})})}),e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-semibold text-gray-900 dark:text-gray-100 truncate",children:a.internal_code?`${a.internal_code} · ${a.serial_number}`:a.serial_number}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 truncate",children:(a.machine_type??"")+(a.brand?` · ${a.brand}`:"")+(a.model?` · ${a.model}`:"")}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 truncate",children:a.project?.name??"-"})]}),e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-[11px] ${a.is_active?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-200":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300"}`,children:a.is_active?s("common.active"):s("common.inactive")})]})]},a.id))}),ra&&e.jsx(N,{isOpen:ra,onClose:()=>na(!1),title:s("heavyMachinery.viewMachines.bulk.title"),size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:s("heavyMachinery.viewMachines.bulk.help")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx("button",{type:"button",onClick:Ua,className:"btn-secondary",children:s("heavyMachinery.viewMachines.bulk.downloadTemplate")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Sa,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:U?U.name:s("heavyMachinery.viewMachines.bulk.chooseFile")})]}),e.jsx("input",{ref:ve,type:"file",accept:".xlsx,.xls",className:"hidden",onChange:a=>ia(a.target.files?.[0]??null)})]}),e.jsx("button",{type:"button",onClick:Ra,disabled:ca||!U,className:"btn-primary",children:s(ca?"heavyMachinery.viewMachines.bulk.importing":"heavyMachinery.viewMachines.bulk.import")})]})]})}),Ue&&e.jsx(N,{isOpen:Ue,onClose:()=>q(!1),title:s("heavyMachinery.viewMachines.form.createSerialTitle"),size:"md",children:e.jsxs("form",{onSubmit:a=>{a.preventDefault(),za()},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.machine.serial")}),e.jsx("input",{className:"input",value:de,onChange:a=>Ee(a.target.value)})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",className:"btn-outline",onClick:()=>q(!1),children:s("common.cancel")}),e.jsxs("button",{type:"submit",className:"btn-primary flex items-center gap-2",disabled:Re||!de.trim(),children:[Re&&e.jsx(v,{className:"w-4 h-4 animate-spin"}),s("heavyMachinery.viewMachines.form.checkSerial")]})]})]})}),Le&&e.jsx(N,{isOpen:Le,onClose:()=>T(!1),title:s("heavyMachinery.viewMachines.form.createTitle"),size:"xl",children:e.jsxs("form",{onSubmit:qa,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.machine.serial")}),e.jsx("input",{className:"input",value:i.serial_number,readOnly:!0,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.machine.internal")}),e.jsx("input",{className:"input",value:i.internal_code,onChange:a=>p(t=>({...t,internal_code:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.machine.type")}),S.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{value:fe,onChange:a=>{const t=a.target.value;ee(t),p(t==="__custom__"||t==="Autre"?r=>({...r,machine_type:""}):r=>({...r,machine_type:t}))},required:!0,children:[e.jsx("option",{value:"",children:s("common.select")}),S.map(a=>e.jsx("option",{value:a,children:a},a)),e.jsx("option",{value:"__custom__",children:"Autre..."})]}),(fe==="__custom__"||fe==="Autre")&&e.jsx("input",{className:"input",value:i.machine_type,onChange:a=>p(t=>({...t,machine_type:a.target.value})),required:!0})]}):e.jsx("input",{className:"input",value:i.machine_type,onChange:a=>p(t=>({...t,machine_type:a.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.machine.brand")}),e.jsx("input",{className:"input",value:i.brand,onChange:a=>p(t=>({...t,brand:a.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.machine.model")}),e.jsx("input",{className:"input",value:i.model,onChange:a=>p(t=>({...t,model:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.machine.project")}),e.jsxs(z,{value:i.project_id,onChange:a=>p(t=>({...t,project_id:a.target.value})),children:[e.jsx("option",{value:"",children:s("common.none")}),Fe.map(a=>e.jsx("option",{value:a.id,children:$a(a)},a.id))]})]})]}),e.jsxs("div",{className:`flex items-center justify-between rounded-lg border p-3 ${i.is_active?"border-green-200 bg-green-50 dark:border-green-900/40 dark:bg-green-900/10":"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800"}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:s("heavyMachinery.viewMachines.machine.active")}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300",children:i.is_active?s("common.active"):s("common.inactive")})]}),e.jsx("button",{type:"button",role:"switch","aria-checked":!!i.is_active,onClick:()=>p(a=>({...a,is_active:!a.is_active})),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${i.is_active?"bg-green-600":"bg-gray-300 dark:bg-gray-600"}`,children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full bg-white transition ${i.is_active?"translate-x-5":"translate-x-1"}`})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.form.image")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Da,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:i.image?i.image.name:s("heavyMachinery.viewMachines.form.chooseImage")})]}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:a=>p(t=>({...t,image:a.target.files?.[0]??null}))})]}),e.jsx("p",{className:"text-[11px] text-gray-500 dark:text-gray-400 mt-1",children:s("heavyMachinery.viewMachines.form.chooseImage")})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",className:"btn-outline",onClick:()=>T(!1),children:s("common.cancel")}),e.jsxs("button",{type:"submit",className:"btn-primary flex items-center gap-2",disabled:Ae||!i.serial_number.trim()||!i.machine_type.trim()||!i.brand.trim(),children:[Ae&&e.jsx(v,{className:"w-4 h-4 animate-spin"}),s(B?"common.save":"common.create")]})]})]})}),Y&&e.jsx(N,{isOpen:Y,onClose:fa,title:s("heavyMachinery.viewMachines.details"),size:"full",children:me||!m?e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx(v,{className:"w-6 h-6 animate-spin text-hse-primary"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx("div",{className:"w-full rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 overflow-hidden",children:m.machine?.image_url?e.jsx("button",{type:"button",className:"w-full",onClick:()=>Ge(!0),title:s("common.view"),children:e.jsx(ne,{machineId:m.machine?.id,updatedAt:m.machine?.updated_at,alt:m.machine?.serial_number??"machine",className:"w-full h-72 object-contain"})}):e.jsx("div",{className:"w-full h-72 flex items-center justify-center text-sm text-gray-500",children:s("common.noData")})}),e.jsxs("div",{className:"min-w-0 flex flex-col justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:m.machine?.project?.name??"-"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-gray-100 truncate",children:m.machine?.internal_code?`${m.machine.internal_code} · ${m.machine.serial_number}`:m.machine?.serial_number}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1",children:(m.machine?.machine_type??"")+(m.machine?.brand?` · ${m.machine.brand}`:"")+(m.machine?.model?` · ${m.machine.model}`:"")})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",className:"btn-secondary flex items-center gap-2",onClick:Wa,children:[e.jsx(ct,{className:"w-4 h-4"}),s("common.edit")]}),e.jsxs("button",{type:"button",className:"btn-secondary flex items-center gap-2",onClick:()=>j(d),disabled:me,children:[me?e.jsx(v,{className:"w-4 h-4 animate-spin"}):e.jsx(Ca,{className:"w-4 h-4"}),s("common.refresh")]}),e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2 text-red-600 dark:text-red-400 border-red-200 dark:border-red-800 hover:bg-red-50 dark:hover:bg-red-900/20",onClick:Za,children:[e.jsx(Me,{className:"w-4 h-4"}),s("common.delete")]})]})]})]}),e.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex gap-2 -mb-px",children:[e.jsxs("button",{type:"button",onClick:()=>F("documents"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${D==="documents"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(ke,{className:"w-4 h-4"}),s("heavyMachinery.viewMachines.tabs.documents")]}),e.jsxs("button",{type:"button",onClick:()=>F("operators"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${D==="operators"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(lt,{className:"w-4 h-4"}),s("heavyMachinery.viewMachines.tabs.operators")]}),e.jsxs("button",{type:"button",onClick:()=>F("inspections"),className:`px-3 py-2 text-sm border rounded-t-lg flex items-center gap-2 ${D==="inspections"?"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 border-b-white dark:border-b-gray-900 text-hse-primary":"border-transparent text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100"}`,children:[e.jsx(dt,{className:"w-4 h-4"}),s("heavyMachinery.viewMachines.tabs.inspections")]})]})}),D==="documents"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:()=>wa(null),children:[e.jsx(_e,{className:"w-4 h-4"}),s("heavyMachinery.viewMachines.documents.add")]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("heavyMachinery.viewMachines.documents.label")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("heavyMachinery.viewMachines.documents.startDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("heavyMachinery.viewMachines.documents.expiryDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("common.actions")})]})}),e.jsx("tbody",{children:(m.documents??[]).map(a=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:[e.jsx("div",{className:"font-medium",children:a.document_label}),e.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:a.document_key})]}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:a.start_date??""}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:a.expiry_date??""}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.file_view_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>ja(a),children:[e.jsx(Oa,{className:"w-4 h-4"}),s("common.view")]}),a.file_download_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Ne(a,`${a.document_key??"document"}.pdf`),children:[e.jsx(Ce,{className:"w-4 h-4"}),s("common.download")]}),e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>wa(a),children:[e.jsx(Sa,{className:"w-4 h-4"}),s("heavyMachinery.viewMachines.documents.replace")]}),e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2 text-red-600 dark:text-red-400",onClick:()=>Ha(a),children:[e.jsx(Me,{className:"w-4 h-4"}),s("common.delete")]})]})})]},a.id))})]})})]}),D==="operators"&&e.jsx("div",{className:"space-y-4",children:m.machine?.project_id?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card p-4 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 items-start",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("input",{className:"input",value:C,onChange:a=>{X(a.target.value),I(""),ye("")},placeholder:s("heavyMachinery.viewMachines.operators.searchPlaceholder")}),C.trim()&&!A&&e.jsx("div",{className:"mt-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 overflow-hidden",children:Aa?e.jsx("div",{className:"px-3 py-2 text-xs text-gray-500",children:"..."}):aa.length===0?e.jsx("div",{className:"px-3 py-2 text-xs text-gray-500",children:s("common.noData")}):e.jsx("div",{className:"max-h-56 overflow-auto",children:aa.map(a=>e.jsxs("button",{type:"button",className:"w-full text-left px-3 py-2 text-sm hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>{I(String(a.id)),ye(`${a.full_name}${a.cin?` (${a.cin})`:""}`),X(`${a.full_name}${a.cin?` (${a.cin})`:""}`),$([])},children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-gray-100",children:a.full_name}),e.jsxs("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:[a.cin??""," ",a.fonction?`· ${a.fonction}`:""]})]},a.id))})})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{type:"button",className:"btn-primary w-full",disabled:!A,onClick:Va,children:s("heavyMachinery.viewMachines.operators.assign")})})]}),A&&sa&&e.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-300",children:[s("common.selected"),": ",sa]})]}),e.jsx("div",{className:"card p-4",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("heavyMachinery.viewMachines.tabs.operators")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:"CIN"}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("common.actions")})]})}),e.jsx("tbody",{children:(m.operators??[]).map(a=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsx("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:e.jsx("a",{href:`/workers?worker_id=${a.id}`,className:"text-hse-primary hover:underline",target:"_blank",rel:"noreferrer",children:a.full_name})}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200 font-mono",children:a.cin??""}),e.jsx("td",{className:"py-2 pr-3",children:e.jsx("button",{type:"button",className:"btn-outline btn-sm text-red-600 dark:text-red-400",onClick:()=>Ja(a.id),children:s("heavyMachinery.viewMachines.operators.remove")})})]},a.id))})]})})})]}):e.jsx("div",{className:"card p-4 text-sm text-gray-600 dark:text-gray-300",children:s("heavyMachinery.viewMachines.operators.helpNoProject")})}),D==="inspections"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",className:"btn-primary flex items-center gap-2",onClick:Ya,children:[e.jsx(_e,{className:"w-4 h-4"}),s("heavyMachinery.viewMachines.inspections.add")]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 text-left",children:[e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:"#"}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("heavyMachinery.viewMachines.inspections.startDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("heavyMachinery.viewMachines.inspections.endDate")}),e.jsx("th",{className:"py-2 pr-3 font-medium text-gray-500 dark:text-gray-400",children:s("common.actions")})]})}),e.jsx("tbody",{children:(m.inspections??[]).map(a=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("td",{className:"py-2 pr-3 text-gray-900 dark:text-gray-100",children:["v",a.version??1]}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:a.start_date??""}),e.jsx("td",{className:"py-2 pr-3 text-gray-700 dark:text-gray-200",children:a.end_date??""}),e.jsx("td",{className:"py-2 pr-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.file_view_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>ja(a),children:[e.jsx(Oa,{className:"w-4 h-4"}),s("common.view")]}),a.file_download_url&&e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2",onClick:()=>Ne(a,`inspection_${a.id}.pdf`),children:[e.jsx(Ce,{className:"w-4 h-4"}),s("common.download")]}),e.jsxs("button",{type:"button",className:"btn-outline btn-sm flex items-center gap-2 text-red-600 dark:text-red-400",onClick:()=>Qa(a),children:[e.jsx(Me,{className:"w-4 h-4"}),s("common.delete")]})]})})]},a.id))})]})})]})]})}),Be&&e.jsx(N,{isOpen:Be,onClose:()=>G(!1),title:s("common.edit"),size:"xl",children:e.jsxs("form",{onSubmit:Xa,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.machine.serial")}),e.jsx("input",{className:"input",value:o.serial_number,onChange:a=>g(t=>({...t,serial_number:a.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.machine.internal")}),e.jsx("input",{className:"input",value:o.internal_code,onChange:a=>g(t=>({...t,internal_code:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.machine.type")}),S.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{value:je,onChange:a=>{const t=a.target.value;ma(t),g(t==="__custom__"||t==="Autre"?r=>({...r,machine_type:""}):r=>({...r,machine_type:t}))},required:!0,children:[e.jsx("option",{value:"",children:s("common.select")}),S.map(a=>e.jsx("option",{value:a,children:a},a)),e.jsx("option",{value:"__custom__",children:"Autre..."})]}),(je==="__custom__"||je==="Autre")&&e.jsx("input",{className:"input",value:o.machine_type,onChange:a=>g(t=>({...t,machine_type:a.target.value})),required:!0})]}):e.jsx("input",{className:"input",value:o.machine_type,onChange:a=>g(t=>({...t,machine_type:a.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.machine.brand")}),e.jsx("input",{className:"input",value:o.brand,onChange:a=>g(t=>({...t,brand:a.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.machine.model")}),e.jsx("input",{className:"input",value:o.model,onChange:a=>g(t=>({...t,model:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.machine.project")}),e.jsxs(z,{value:o.project_id,onChange:a=>g(t=>({...t,project_id:a.target.value})),children:[e.jsx("option",{value:"",children:s("common.none")}),Fe.map(a=>e.jsx("option",{value:a.id,children:$a(a)},a.id))]})]})]}),e.jsxs("div",{className:`flex items-center justify-between rounded-lg border p-3 ${o.is_active?"border-green-200 bg-green-50 dark:border-green-900/40 dark:bg-green-900/10":"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800"}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:s("heavyMachinery.viewMachines.machine.active")}),e.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-300",children:o.is_active?s("common.active"):s("common.inactive")})]}),e.jsx("button",{type:"button",role:"switch","aria-checked":!!o.is_active,onClick:()=>g(a=>({...a,is_active:!a.is_active})),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${o.is_active?"bg-green-600":"bg-gray-300 dark:bg-gray-600"}`,children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full bg-white transition ${o.is_active?"translate-x-5":"translate-x-1"}`})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.form.image")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Da,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:o.image?o.image.name:s("common.select")})]}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:a=>g(t=>({...t,image:a.target.files?.[0]??null}))})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",className:"btn-outline",onClick:()=>G(!1),children:s("common.cancel")}),e.jsxs("button",{type:"submit",className:"btn-primary flex items-center gap-2",disabled:Ke,children:[Ke&&e.jsx(v,{className:"w-4 h-4 animate-spin"}),s("common.save")]})]})]})}),Ye&&m?.machine?.image_url&&e.jsx(N,{isOpen:Ye,onClose:()=>Ge(!1),title:s("common.view"),size:"xl",children:e.jsx("div",{className:"w-full h-[70vh] rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900 overflow-hidden flex items-center justify-center",children:e.jsx(ne,{machineId:m.machine?.id,updatedAt:m.machine?.updated_at,alt:m.machine?.serial_number??"machine",className:"max-w-full max-h-full object-contain"})})}),Qe&&e.jsx(N,{isOpen:Qe,onClose:()=>{Q(!1),ue(null)},title:s("heavyMachinery.viewMachines.documents.uploadTitle",{label:x.document_label||"-"}),size:"xl",children:e.jsxs("form",{onSubmit:Ka,className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.documents.key")}),Z.length>0?e.jsxs(z,{value:x.document_key,disabled:!!L?.id,onChange:a=>{const t=a.target.value,r=Z.find(c=>c.key===t)?.label??"";O(c=>({...c,document_key:t,document_label:r}))},required:!0,children:[e.jsx("option",{value:"",children:s("common.select")}),Z.map(a=>e.jsx("option",{value:a.key,children:a.label},a.key))]}):e.jsx("input",{className:"input",value:x.document_key,disabled:!!L?.id,onChange:a=>O(t=>({...t,document_key:a.target.value})),required:!0})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.documents.startDate")}),e.jsx(re,{value:x.start_date,onChange:a=>O(t=>{const r=t.start_date?we(t.start_date,1):"",c=a?we(a,1):"",u=!t.expiry_date||t.expiry_date===r;return{...t,start_date:a,expiry_date:u?c:t.expiry_date}})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.documents.expiryDate")}),e.jsx(re,{value:x.expiry_date,onChange:a=>O(t=>({...t,expiry_date:a}))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.documents.file")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:x.file?x.file.name:s("heavyMachinery.viewMachines.documents.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:a=>O(t=>({...t,file:a.target.files?.[0]??null})),className:"hidden"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",className:"btn-outline",onClick:()=>Q(!1),children:s("common.cancel")}),e.jsxs("button",{type:"submit",className:"btn-primary flex items-center gap-2",disabled:Ve,children:[Ve&&e.jsx(v,{className:"w-4 h-4 animate-spin"}),s("common.save")]})]})]})}),Xe&&e.jsx(N,{isOpen:Xe,onClose:()=>V(!1),title:s("heavyMachinery.viewMachines.inspections.uploadTitle"),size:"xl",children:e.jsxs("form",{onSubmit:Ga,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.inspections.startDate")}),e.jsx(re,{value:b.start_date,onChange:a=>J(t=>{const r=t.start_date?ya(t.start_date,7):"",c=a?ya(a,7):"",u=!t.end_date||t.end_date===r;return{...t,start_date:a,end_date:u?c:t.end_date}})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.inspections.endDate")}),e.jsx(re,{value:b.end_date,onChange:a=>J(t=>({...t,end_date:a}))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label text-xs",children:s("heavyMachinery.viewMachines.inspections.file")}),e.jsxs("label",{className:"flex items-center justify-between border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-xs cursor-pointer hover:border-hse-primary hover:bg-hse-primary/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-200",children:b.file?b.file.name:s("heavyMachinery.viewMachines.inspections.choosePdf")})]}),e.jsx("input",{type:"file",accept:"application/pdf",onChange:a=>J(t=>({...t,file:a.target.files?.[0]??null})),className:"hidden"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("button",{type:"button",className:"btn-outline",onClick:()=>V(!1),children:s("common.cancel")}),e.jsxs("button",{type:"submit",className:"btn-primary flex items-center gap-2",disabled:Ze,children:[Ze&&e.jsx(v,{className:"w-4 h-4 animate-spin"}),s("common.save")]})]})]})}),xe&&e.jsx(N,{isOpen:!!xe,onClose:Ba,title:s("common.view"),size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[70vh]",children:Ia?e.jsx("div",{className:"w-full h-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 flex items-center justify-center",children:e.jsx(v,{className:"w-6 h-6 animate-spin text-hse-primary"})}):f?e.jsx("iframe",{src:f,title:s("common.view"),className:"w-full h-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white"}):e.jsx("div",{className:"w-full h-full rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 flex items-center justify-center text-sm text-gray-500 dark:text-gray-400",children:s("errors.somethingWentWrong")})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",onClick:()=>Ne(xe,"file.pdf"),className:"btn-primary inline-flex items-center gap-2 text-sm",children:[e.jsx(Ce,{className:"w-4 h-4"}),s("common.download")]})})]})})]})}export{ft as default};
